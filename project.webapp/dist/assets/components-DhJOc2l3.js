import{r as S,u as It,R as Ft}from"./router-cMghrlxF.js";import{T as rt,Z as We,C as Dt,a as Ye,A as Lt,L as ft,S as xt,E as Xe,X as Pt,B as Ot,b as Ze,c as ke,d as bt,e as $t,f as Rt,g as _t,I as et,h as Ut,i as vt,D as ot,j as Mt,F as Ht,k as qt,P as at}from"./ui--EKNAzw6.js";import{r as Bt}from"./vendor-DavUf6mE.js";var Qe={exports:{}},Ee={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var it;function Jt(){if(it)return Ee;it=1;var a=Bt(),s=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function g(y,m,p){var A,w={},l=null,i=null;p!==void 0&&(l=""+p),m.key!==void 0&&(l=""+m.key),m.ref!==void 0&&(i=m.ref);for(A in m)n.call(m,A)&&!c.hasOwnProperty(A)&&(w[A]=m[A]);if(y&&y.defaultProps)for(A in m=y.defaultProps,m)w[A]===void 0&&(w[A]=m[A]);return{$$typeof:s,type:y,key:l,ref:i,props:w,_owner:r.current}}return Ee.Fragment=t,Ee.jsx=g,Ee.jsxs=g,Ee}var lt;function Gt(){return lt||(lt=1,Qe.exports=Jt()),Qe.exports}var e=Gt();const zt="modulepreload",Vt=function(a){return"/"+a},ct={},dt=function(s,t,n){let r=Promise.resolve();if(t&&t.length>0){let m=function(p){return Promise.all(p.map(A=>Promise.resolve(A).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),y=g?.nonce||g?.getAttribute("nonce");r=m(t.map(p=>{if(p=Vt(p),p in ct)return;ct[p]=!0;const A=p.endsWith(".css"),w=A?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${w}`))return;const l=document.createElement("link");if(l.rel=A?"stylesheet":zt,A||(l.as="script"),l.crossOrigin="",l.href=p,y&&l.setAttribute("nonce",y),document.head.appendChild(l),A)return new Promise((i,x)=>{l.addEventListener("load",i),l.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${p}`)))})}))}function c(g){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=g,window.dispatchEvent(y),!y.defaultPrevented)throw g}return r.then(g=>{for(const y of g||[])y.status==="rejected"&&c(y.reason);return s().catch(c)})},de="http://localhost:5000/api";class Qt{config={clientId:"8d042e34-5a5f-40f5-a019-ee56de49b64e",tenantId:"c16b04b5-b78c-4cce-b3f8-93686f221d09",redirectUri:"http://localhost:5173/auth/callback",scopes:["openid","profile","email","User.Read"]};constructor(){this.config.clientId||console.error("[AuthService] Azure Client ID is not configured"),this.config.tenantId||console.error("[AuthService] Azure Tenant ID is not configured"),console.log("[AuthService] Configuration loaded:",{clientId:this.config.clientId?"Configured":"Missing",tenantId:this.config.tenantId?"Configured":"Missing",redirectUri:this.config.redirectUri})}async initializeMSAL(){try{if(typeof window<"u"&&!window.msalInstance){console.log("[AuthService] Initializing MSAL with config:",{clientId:this.config.clientId,tenantId:this.config.tenantId,redirectUri:this.config.redirectUri}),console.log("[AuthService] Importing @azure/msal-browser...");const{PublicClientApplication:s}=await dt(async()=>{const{PublicClientApplication:t}=await import("./index-CIVusHlu.js");return{PublicClientApplication:t}},[]);console.log("[AuthService] MSAL imported successfully"),console.log("[AuthService] Creating MSAL instance..."),window.msalInstance=new s({auth:{clientId:this.config.clientId,authority:`https://login.microsoftonline.com/${this.config.tenantId}`,redirectUri:this.config.redirectUri},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}}),console.log("[AuthService] MSAL instance created"),console.log("[AuthService] Initializing MSAL instance..."),await window.msalInstance.initialize(),console.log("[AuthService] MSAL instance initialized successfully")}else console.log("[AuthService] MSAL instance already exists");return window.msalInstance}catch(s){throw console.error("[AuthService] Error initializing MSAL:",s),new Error(`Failed to initialize Microsoft Authentication: ${s instanceof Error?s.message:"Unknown error"}`)}}async testMSALConfiguration(){try{console.log("[AuthService] Testing MSAL configuration...");const s=await this.initializeMSAL();return console.log("[AuthService] MSAL configuration test successful"),!0}catch(s){return console.error("[AuthService] MSAL configuration test failed:",s),!1}}async clearActiveInteractions(s){try{console.log("[AuthService] Clearing active interactions..."),await s.clearCache(),s.browserStorage&&await s.browserStorage.clear();const t=[];for(let n=0;n<localStorage.length;n++){const r=localStorage.key(n);r&&r.includes("msal")&&t.push(r)}t.forEach(n=>localStorage.removeItem(n)),console.log("[AuthService] Active interactions cleared")}catch(t){console.warn("[AuthService] Warning clearing interactions:",t)}}resetMSALInstance(){try{console.log("[AuthService] Resetting MSAL instance..."),window.msalInstance&&delete window.msalInstance,console.log("[AuthService] MSAL instance reset")}catch(s){console.warn("[AuthService] Warning resetting MSAL instance:",s)}}async login(){try{if(console.log("[AuthService] Starting Microsoft login..."),console.log("[AuthService] Config:",this.config),!this.config.clientId||this.config.clientId==="your_azure_client_id_here")throw new Error("Azure Client ID not configured. Please set VITE_REACT_APP_AZURE_CLIENT_ID in your environment variables.");if(!this.config.tenantId||this.config.tenantId==="your_azure_tenant_id_here")throw new Error("Azure Tenant ID not configured. Please set VITE_REACT_APP_AZURE_TENANT_ID in your environment variables.");const s=await this.initializeMSAL();console.log("[AuthService] MSAL instance ready, starting login popup..."),await this.clearActiveInteractions(s);const t={scopes:this.config.scopes,prompt:"select_account"};console.log("[AuthService] Login request config:",t),console.log("[AuthService] About to call loginPopup...");let n;try{if(console.log("[AuthService] About to call MSAL loginPopup..."),n=await s.loginPopup(t),console.log("[AuthService] MSAL login successful, got access token"),console.log("[AuthService] MSAL response:",{hasAccessToken:!!n.accessToken,hasAccount:!!n.account,accountName:n.account?.name,accountUsername:n.account?.username}),!n.accessToken)throw console.error("[AuthService] MSAL login succeeded but no access token received"),new Error("MSAL login succeeded but no access token received");console.log("[AuthService] MSAL access token confirmed:",{tokenLength:n.accessToken.length,tokenPreview:n.accessToken.substring(0,20)+"..."}),console.log("[AuthService] MSAL login completed successfully, proceeding to backend exchange..."),console.log("[AuthService] Checking configuration before backend call:",{hasClientId:!!this.config.clientId,hasTenantId:!!this.config.tenantId,clientId:this.config.clientId,tenantId:this.config.tenantId})}catch(c){if(console.error("[AuthService] Popup error:",c),c.errorCode==="interaction_in_progress"){console.log("[AuthService] Interaction in progress, clearing cache and retrying..."),await this.clearActiveInteractions(s),await new Promise(g=>setTimeout(g,1e3));try{n=await s.loginPopup(t),console.log("[AuthService] MSAL login successful on retry, got access token")}catch(g){throw console.error("[AuthService] Retry failed:",g),g.errorCode==="interaction_in_progress"?(console.log("[AuthService] Persistent interaction issue, resetting MSAL instance..."),this.resetMSALInstance(),new Error("Authentication session is stuck. Please refresh the page and try again.")):g}}else throw c}console.log("[AuthService] Exchanging token with backend..."),console.log("[AuthService] MSAL access token received:",{hasToken:!!n.accessToken,tokenLength:n.accessToken?.length,tokenPreview:n.accessToken?.substring(0,20)+"..."}),console.log("[AuthService] About to start backend token exchange process...");let r;try{console.log("[AuthService] About to call exchangeTokenForBackendToken..."),console.log("[AuthService] Backend URL will be:",`${de}/auth/login`),console.log("[AuthService] Making backend request..."),r=await this.exchangeTokenForBackendToken(n.accessToken),console.log("[AuthService] Backend token exchange successful")}catch(c){throw console.error("[AuthService] Backend token exchange failed:",c),console.error("[AuthService] Backend error details:",{message:c.message,stack:c.stack}),c}if(console.log("[AuthService] Backend response received:",{type:typeof r,keys:Object.keys(r),hasAccessToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,hasExpiresAt:!!r.expiresAt}),console.log("[AuthService] About to store tokens:",{accessToken:!!r.accessToken,refreshToken:!!r.refreshToken,expiresAt:r.expiresAt,accessTokenLength:r.accessToken?.length,refreshTokenLength:r.refreshToken?.length}),!r.accessToken||!r.refreshToken||!r.expiresAt){if(console.error("[AuthService] Missing required token fields:",{accessToken:!!r.accessToken,refreshToken:!!r.refreshToken,expiresAt:!!r.expiresAt}),!r.accessToken)throw new Error("Backend response missing access token");const c=new Date;c.setDate(c.getDate()+7);const g="fallback-refresh-"+Date.now();console.log("[AuthService] Using fallback values:",{expiresAt:c.toISOString(),refreshToken:g}),r.refreshToken=r.refreshToken||g,r.expiresAt=r.expiresAt||c.toISOString()}return this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),console.log("[AuthService] Tokens stored successfully"),r}catch(s){throw console.error("[AuthService] Microsoft login error:",s),s instanceof Error?new Error(`Microsoft authentication failed: ${s.message}`):new Error("Failed to authenticate with Microsoft Entra ID")}}async googleLogin(){try{const s="1003899655255-ib2ru0fiq7apqbgt4ifk48rmka88kqf0.apps.googleusercontent.com";return await this.loadGoogleIdentityServices(),new Promise((t,n)=>{let r=!1;const c=setTimeout(()=>{r||(r=!0,n(new Error("Google authentication timed out. Please try again.")))},6e4);try{window.google.accounts.oauth2.initTokenClient({client_id:s,scope:"openid profile email",prompt:"select_account",callback:async A=>{try{if(r)return;if(clearTimeout(c),A.error){r=!0,n(new Error(`Google OAuth error: ${A.error}`));return}if(!A.access_token){r=!0,n(new Error("No access token received from Google"));return}console.log("✅ [AuthService] Google OAuth successful, got access token");const w=await this.exchangeGoogleTokenForBackendToken(A.access_token);this.setTokens(w.accessToken,w.refreshToken,w.expiresAt),r=!0,t(w)}catch(w){r||(r=!0,clearTimeout(c),n(w))}}}).requestAccessToken()}catch(p){r||(r=!0,clearTimeout(c),n(new Error(`Failed to initialize Google OAuth: ${p instanceof Error?p.message:"Unknown error"}`)))}const g=()=>{clearTimeout(c)},y=t,m=n;t=p=>{g(),y(p)},n=p=>{g(),m(p)}})}catch(s){throw console.error("Google login error:",s),new Error(`Failed to authenticate with Google: ${s instanceof Error?s.message:"Unknown error"}`)}}async loadGoogleIdentityServices(){return new Promise((s,t)=>{if(window.google){s();return}const n=document.createElement("script");n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,n.onload=()=>s(),n.onerror=()=>t(new Error("Failed to load Google Identity Services")),document.head.appendChild(n)})}async googleLoginOneTap(){try{return await this.loadGoogleIdentityServices(),new Promise((s,t)=>{window.google.accounts.id.initialize({client_id:"1003899655255-ib2ru0fiq7apqbgt4ifk48rmka88kqf0.apps.googleusercontent.com",callback:async n=>{try{if(n.error){t(new Error(n.error));return}const r=await this.exchangeGoogleTokenForBackendToken(n.credential);this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),s(r)}catch(r){t(r)}}}),window.google.accounts.id.prompt()})}catch(s){throw console.error("Google One Tap login error:",s),new Error("Failed to authenticate with Google")}}async exchangeGoogleTokenForBackendToken(s){try{const n=await(await fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${s}`)).json(),r=await fetch(`${de}/auth/google-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:s,userInfo:n})});if(!r.ok){const g=await r.json().catch(()=>({}));throw new Error(g.error||"Failed to authenticate with backend")}const c=await r.json();return console.log("✅ [AuthService] Google token exchange successful, received data:",{user:c.user,hasAccessToken:!!c.accessToken,hasRefreshToken:!!c.refreshToken,expiresAt:c.expiresAt}),this.setTokens(c.accessToken,c.refreshToken,c.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Google login"),c}catch(t){throw console.error("Error exchanging Google token:",t),new Error("Failed to authenticate with backend")}}async localLogin(s){try{if(console.log("🔐 [AuthService] Starting local login with credentials:",{email:s.email,passwordLength:s.password.length}),console.log("🌐 [AuthService] API Base URL:",de),!s.email||!s.password)throw new Error("Email and password are required");if(!s.email.includes("@"))throw new Error("Please enter a valid email address");if(s.password.length<6)throw new Error("Password must be at least 6 characters long");const t=await fetch(`${de}/auth/local-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("📡 [AuthService] Local login response status:",t.status),!t.ok){const r=await t.json().catch(()=>({}));throw console.error("❌ [AuthService] Local login failed:",r),t.status===401?new Error("Invalid email or password. Please check your credentials and try again."):t.status===404?new Error("User not found. Please check your email or sign up for a new account."):t.status===500?new Error("Server error. Please try again later or contact support."):new Error(r.error||`Login failed with status ${t.status}`)}const n=await t.json();if(console.log("✅ [AuthService] Local login successful, received data:",{user:n.user,hasAccessToken:!!n.accessToken,hasRefreshToken:!!n.refreshToken,expiresAt:n.expiresAt}),!n.accessToken||!n.refreshToken||!n.expiresAt)throw new Error("Invalid response from server. Missing authentication tokens.");return this.setTokens(n.accessToken,n.refreshToken,n.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for local login"),n}catch(t){throw console.error("❌ [AuthService] Local login error:",t),t instanceof Error?t:new Error("Local authentication failed. Please try again.")}}async register(s){try{console.log("🔐 Registering user with credentials:",{...s,password:"[HIDDEN]"}),console.log("🌐 API Base URL:",de);const t=await fetch(`${de}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("📡 Registration response status:",t.status),!t.ok){const r=await t.json().catch(()=>({}));throw console.error("❌ Registration failed:",r),new Error(r.error||"Failed to register user")}const n=await t.json();return console.log("✅ Registration successful, received data:",{user:n.user,hasAccessToken:!!n.accessToken,hasRefreshToken:!!n.refreshToken,expiresAt:n.expiresAt}),this.setTokens(n.accessToken,n.refreshToken,n.expiresAt),console.log("💾 Tokens stored successfully"),n}catch(t){throw console.error("❌ Registration error:",t),new Error(t instanceof Error?t.message:"Registration failed")}}async exchangeTokenForBackendToken(s){console.log("[AuthService] Exchanging token with backend..."),console.log("[AuthService] Backend URL:",`${de}/auth/login`),console.log("[AuthService] Request payload:",{clientId:this.config.clientId,tenantId:this.config.tenantId,hasToken:!!s,tokenLength:s?.length});try{const t=await fetch(`${de}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({msalToken:s,clientId:this.config.clientId,tenantId:this.config.tenantId})});if(console.log("[AuthService] Backend response status:",t.status),console.log("[AuthService] Backend response headers:",Object.fromEntries(t.headers.entries())),!t.ok){const r=await t.json().catch(()=>({}));throw console.error("[AuthService] Backend error response:",r),new Error(r.error||`Backend authentication failed with status ${t.status}`)}const n=await t.json();if(console.log("[AuthService] Backend success response:",{hasUser:!!n.user,hasToken:!!n.accessToken,hasRefreshToken:!!n.refreshToken,hasExpiresAt:!!n.expiresAt,userEmail:n.user?.email,expiresAt:n.expiresAt,accessTokenLength:n.accessToken?.length,refreshTokenLength:n.refreshToken?.length}),console.log("[AuthService] Full backend response:",n),console.log("[AuthService] Response keys:",Object.keys(n)),!n.accessToken||!n.refreshToken||!n.expiresAt){if(console.error("[AuthService] Backend response missing required fields:",{hasAccessToken:!!n.accessToken,hasRefreshToken:!!n.refreshToken,hasExpiresAt:!!n.expiresAt,availableKeys:Object.keys(n)}),console.warn("[AuthService] Attempting to handle missing fields..."),!n.accessToken)throw new Error("Backend response is missing access token");const r=new Date;r.setDate(r.getDate()+7);const c="temp-refresh-token-"+Date.now();console.log("[AuthService] Using default values:",{expiresAt:r.toISOString(),refreshToken:c});const g={...n,refreshToken:n.refreshToken||c,expiresAt:n.expiresAt||r.toISOString()};return this.setTokens(g.accessToken,g.refreshToken,g.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Microsoft login"),g}return this.setTokens(n.accessToken,n.refreshToken,n.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Microsoft login"),n}catch(t){throw console.error("[AuthService] Fetch error:",t),new Error(`Network error: ${t instanceof Error?t.message:"Unknown error"}`)}}async logout(){try{console.log("[AuthService] Starting logout process..."),await this.clearBackendSession(),console.log("[AuthService] Backend session cleared"),this.clearAllAuthData(),console.log("[AuthService] All authentication data cleared");try{window.msalInstance&&typeof window.msalInstance.clearCache=="function"&&(window.msalInstance.clearCache(),console.log("[AuthService] MSAL cache cleared"))}catch(s){console.warn("[AuthService] MSAL cache clear failed, but tokens cleared:",s)}console.log("[AuthService] Logout completed successfully")}catch(s){console.error("[AuthService] Logout error:",s),this.clearAllAuthData()}}async clearBackendSession(){try{const s=this.getAccessToken();s&&await fetch(`${de}/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})}catch(s){console.error("Error clearing backend session:",s)}}async getCurrentUser(){try{const s=this.getAccessToken();if(!s)return null;const t=await fetch(`${de}/auth/me`,{headers:{Authorization:`Bearer ${s}`}});return t.ok?t.json():t.status===401&&await this.refreshToken()?this.getCurrentUser():(this.clearTokens(),null)}catch(s){return console.error("Error getting current user:",s),this.clearTokens(),null}}async refreshToken(){try{const s=this.getRefreshToken();if(!s)return this.clearTokens(),!1;const t=await fetch(`${de}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:s})});if(!t.ok)return this.clearTokens(),!1;const n=await t.json();return this.setTokens(n.accessToken,n.refreshToken,n.expiresAt),!0}catch(s){return console.error("Error refreshing token:",s),this.clearTokens(),!1}}isAuthenticated(){const s=this.getAccessToken(),t=this.getExpiresAt();if(console.log("[AuthService] Checking authentication:",{hasToken:!!s,hasExpiresAt:!!t,expiresAt:t,currentTime:new Date().toISOString(),tokenExpiry:t?new Date(t).toISOString():"N/A",isExpired:t?new Date(t)<=new Date:"N/A"}),!s||!t)return console.log("[AuthService] Authentication failed: missing token or expiry"),!1;const n=new Date,c=new Date(t)>n;return c||(console.log("[AuthService] Token expired, clearing stale tokens"),this.clearTokens()),console.log("[AuthService] Token validity check:",{isValid:c}),c}getAccessToken(){return localStorage.getItem("accessToken")}getRefreshToken(){return localStorage.getItem("refreshToken")}getExpiresAt(){return localStorage.getItem("expiresAt")}setTokens(s,t,n){console.log("[AuthService] Setting tokens in localStorage:",{hasAccessToken:!!s,hasRefreshToken:!!t,expiresAt:n,accessTokenLength:s?.length,refreshTokenLength:t?.length}),localStorage.setItem("accessToken",s),localStorage.setItem("refreshToken",t),localStorage.setItem("expiresAt",n),console.log("[AuthService] Tokens stored, verification:",{storedAccessToken:!!localStorage.getItem("accessToken"),storedRefreshToken:!!localStorage.getItem("refreshToken"),storedExpiresAt:localStorage.getItem("expiresAt")})}clearTokens(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("expiresAt")}clearAllAuthData(){console.log("[AuthService] Clearing all authentication data..."),this.clearTokens();try{localStorage.removeItem("user"),console.log("[AuthService] User data cleared from localStorage")}catch(t){console.warn("[AuthService] Could not clear user data:",t)}try{dt(async()=>{const{historyService:t}=await Promise.resolve().then(()=>Wt);return{historyService:t}},void 0).then(({historyService:t})=>{t.clearUserData(),console.log("[AuthService] User-specific history data cleared")}).catch(t=>{console.warn("[AuthService] Could not clear user history data:",t)})}catch(t){console.warn("[AuthService] Could not clear user history data:",t)}["llm_qa_current_session","structure_last_saved","overview_market_analysis","llm_qa_sessions"].forEach(t=>{try{localStorage.getItem(t)&&(console.log(`[AuthService] Clearing conflicting localStorage key: ${t}`),localStorage.removeItem(t))}catch(n){console.warn(`[AuthService] Could not clear ${t}:`,n)}}),console.log("[AuthService] All authentication data cleared (history preserved)")}getAuthHeaders(){const s=this.getAccessToken();return s?{Authorization:`Bearer ${s}`}:{}}getCurrentUserFromStorage(){try{const s=localStorage.getItem("user");if(s)return JSON.parse(s)}catch(s){console.warn("[AuthService] Error parsing user data from localStorage:",s)}return null}getCurrentUserId(){try{return this.getCurrentUserFromStorage()?.id||null}catch(s){return console.warn("[AuthService] Error getting user ID from localStorage:",s),null}}}const B=new Qt;class Kt{getStorageKey(s){const t=B.getCurrentUserId();return t?`${s}_${t}`:`${s}_anonymous`}getHistoryKey(){return this.getStorageKey("comprehensive_history")}async addHistoryItem(s){try{console.log("[HistoryService] Adding history item to localStorage:",s);const t=this.getHistoryKey(),n=this.getHistoryFromStorage(t),r=[s,...n];localStorage.setItem(t,JSON.stringify(r)),console.log("[HistoryService] History item saved successfully to localStorage")}catch(t){throw console.error("[HistoryService] Error saving history item to localStorage:",t),t}}async getHistoryItems(){try{const s=this.getHistoryKey(),t=this.getHistoryFromStorage(s);return console.log("[HistoryService] Retrieved history items from localStorage:",t.length),t}catch(s){return console.error("[HistoryService] Error getting history items from localStorage:",s),[]}}async clearHistory(){try{console.log("[HistoryService] Clearing history from localStorage...");const s=this.getHistoryKey();localStorage.removeItem(s),console.log("[HistoryService] History cleared successfully from localStorage")}catch(s){throw console.error("[HistoryService] Error clearing history from localStorage:",s),s}}async deleteHistoryItem(s){try{console.log("[HistoryService] Deleting history item from localStorage:",s);const t=this.getHistoryKey(),r=this.getHistoryFromStorage(t).filter(c=>c.id!==s);localStorage.setItem(t,JSON.stringify(r)),console.log("[HistoryService] History item deleted successfully from localStorage")}catch(t){throw console.error("[HistoryService] Error deleting history item from localStorage:",t),t}}async exportHistoryItem(s){try{console.log("[HistoryService] Exporting history item from localStorage:",s);const t=this.getHistoryKey(),r=this.getHistoryFromStorage(t).find(y=>y.id===s);if(!r)return null;const c=JSON.stringify(r,null,2),g=`${r.type}_${r.id}.json`;return console.log("[HistoryService] History item exported successfully from localStorage"),{content:c,filename:g,mimeType:"application/json"}}catch(t){return console.error("[HistoryService] Error exporting history item from localStorage:",t),null}}async exportAllHistory(){try{console.log("[HistoryService] Exporting all history from localStorage...");const s=this.getHistoryKey(),t=this.getHistoryFromStorage(s),n=JSON.stringify(t,null,2),r=`all_history_${new Date().toISOString().split("T")[0]}.json`;return console.log("[HistoryService] All history exported successfully from localStorage"),{content:n,filename:r,mimeType:"application/json"}}catch(s){return console.error("[HistoryService] Error exporting all history from localStorage:",s),{content:"[]",filename:"empty_history.json",mimeType:"application/json"}}}async clearUserData(){try{console.log("[HistoryService] Clearing user data from localStorage..."),B.getCurrentUserId()&&([this.getStorageKey("comprehensive_history"),this.getStorageKey("qa_history"),this.getStorageKey("ai_visibility_history"),this.getStorageKey("content_analysis_history"),this.getStorageKey("structure_analysis_history")].forEach(n=>{localStorage.removeItem(n)}),console.log("[HistoryService] User data cleared successfully from localStorage"))}catch(s){throw console.error("[HistoryService] Error clearing user data from localStorage:",s),s}}getHistoryFromStorage(s){try{const t=localStorage.getItem(s);return t?JSON.parse(t):[]}catch(t){return console.error("[HistoryService] Error parsing history from localStorage:",t),[]}}}const ce=new Kt,Wt=Object.freeze(Object.defineProperty({__proto__:null,historyService:ce},Symbol.toStringTag,{value:"Module"}));function Yt(a){const s=["good","great","excellent","amazing","wonderful","fantastic","positive","helpful","useful","clear","effective","beneficial","advantageous","superior","quality","reliable","efficient","powerful","comprehensive","detailed","accurate","professional","innovative","advanced","secure","fast","easy","simple","convenient","flexible","scalable","robust","stable","trusted","proven","award-winning","leading","premium","exclusive","cutting-edge","modern","user-friendly","intuitive","seamless","smooth","responsive","optimized","enhanced","improved","upgraded","streamlined"],t=["bad","terrible","awful","horrible","negative","unclear","confusing","useless","ineffective","poor","unreliable","slow","difficult","complex","outdated","limited","restrictive","expensive","risky","unstable","buggy","glitchy","broken","faulty","defective","inferior","substandard","mediocre","disappointing","frustrating","annoying","problematic","troublesome","cumbersome","clunky","awkward","unintuitive","complicated","overwhelming","stressful"],n=["solution","platform","service","product","feature","capability","functionality","performance","reliability","security","support","documentation","integration","automation","optimization","efficiency","productivity","growth","success","achievement","innovation","technology","development","improvement","enhancement","upgrade","update","maintenance","monitoring","analytics"],r=["issue","problem","error","bug","failure","crash","downtime","outage","disruption","delay","limitation","constraint","restriction","barrier","obstacle","challenge","difficulty","complexity","confusion","uncertainty","risk","threat","vulnerability","weakness","deficiency","shortcoming","drawback","disadvantage","inconvenience","frustration"],c=a.toLowerCase().split(/\s+/);let g=0,y=0;c.length,c.forEach(w=>{const l=w.replace(/[^\w]/g,"");l.length<3||(s.includes(l)?g+=1:n.includes(l)&&(g+=.5),t.includes(l)?y+=1:r.includes(l)&&(y+=.5))});const m=g+y;if(m===0)return"Neutral";const p=g/m,A=y/m;return p>.6?"Positive":A>.6?"Negative":"Neutral"}function ut(a,s){const t=a.length>s.length?a:s,n=a.length>s.length?s:a;if(t.length===0)return 1;const r=Xt(t,n);return(t.length-r)/t.length}function Xt(a,s){const t=[];for(let n=0;n<=s.length;n++)t[n]=[n];for(let n=0;n<=a.length;n++)t[0][n]=n;for(let n=1;n<=s.length;n++)for(let r=1;r<=a.length;r++)s.charAt(n-1)===a.charAt(r-1)?t[n][r]=t[n-1][r-1]:t[n][r]=Math.min(t[n-1][r-1]+1,t[n][r-1]+1,t[n-1][r]+1);return t[s.length][a.length]}function Ke(a,s,t){const n=l=>(l||"").replace(/^[\s"'“”‘’]+|[\s"'“”‘’]+$/g,"").trim(),r=l=>l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");console.log("[Apply Suggestions] ===== FUNCTION CALLED ====="),console.log("[Apply Suggestions] Call stack:",new Error().stack);const c=new Date().toISOString();console.log("[Apply Suggestions] Function called at:",c);const g=s.length===1;console.log("[Apply Suggestions] Single suggestion mode:",g);let y=0;const m=[];if(console.log("[Apply Suggestions] ===== STARTING TO APPLY SUGGESTIONS ====="),console.log("[Apply Suggestions] Arguments received:",{htmlLength:a.length,suggestionsCount:s.length,suggestions:s.map(l=>({type:l.type,hasExactReplacement:!!l.exactReplacement,hasCurrentContent:!!l.currentContent,hasEnhancedContent:!!l.enhancedContent,currentContentPreview:l.currentContent?.substring(0,100)+"...",enhancedContentPreview:l.enhancedContent?.substring(0,100)+"..."}))}),s.length>1){console.error("[Apply Suggestions] CRITICAL ERROR: Received multiple suggestions when expecting single suggestion!"),console.error("[Apply Suggestions] Number of suggestions:",s.length),console.error("[Apply Suggestions] Suggestions:",s),console.error("[Apply Suggestions] Call stack:",new Error().stack),console.error("[Apply Suggestions] FORCING SINGLE SUGGESTION MODE - Only processing first suggestion"),s=[s[0]],console.error("[Apply Suggestions] Filtered suggestions to:",s.length);const l=new Error().stack||"";(l.includes("useEffect")||l.includes("comparePages"))&&(console.error("[Apply Suggestions] CRITICAL ERROR: This function is being called from useEffect or comparePages!"),console.error("[Apply Suggestions] This explains why 8 suggestions are being processed!"),console.error("[Apply Suggestions] The issue is that other functions are calling this with all suggestions!"))}s.forEach((l,i)=>{l.enhancedContent&&l.enhancedContent.includes("Split into")&&console.error(`[Apply Suggestions] WARNING: Suggestion ${i} contains instruction text:`,l.enhancedContent)}),s.length>1&&console.warn(`[Apply Suggestions] WARNING: Processing ${s.length} suggestions, expected 1 for single suggestion application`),s.forEach((l,i)=>{l.suggestions&&Array.isArray(l.suggestions)&&console.error(`[Apply Suggestions] ERROR: Suggestion ${i} contains nested suggestions array:`,l.suggestions)}),s.forEach((l,i)=>{try{if(console.log(`[Apply Suggestions] Processing suggestion ${i+1}/${s.length}:`,{type:l.type,hasExactReplacement:!!l.exactReplacement,hasCurrentContent:!!l.currentContent,hasEnhancedContent:!!l.enhancedContent,currentContentPreview:l.currentContent?.substring(0,100)+"...",enhancedContentPreview:l.enhancedContent?.substring(0,100)+"...",isSingleSuggestionMode:g}),g&&i>0){console.log(`[Apply Suggestions] Skipping suggestion ${i+1} in single suggestion mode`);return}if(l.exactReplacement){const{find:x,replace:j}=l.exactReplacement;if(console.log(`[Apply Suggestions] Applying ${l.type}:`,{find:x.substring(0,100)+"...",replace:j.substring(0,100)+"...",found:a.includes(x),findLength:x.length,replaceLength:j.length,fullFind:x,fullReplace:j,htmlPreview:a.substring(0,500)+"..."}),a.includes(x)){const v=a.length,I=a.substring(0,500);a=a.replace(x,j);const L=a.length,F=a.substring(0,500),J=I!==F;y++,m.push(`${l.type} applied with exact replacement`),console.log(`[Apply Suggestions] Successfully applied ${l.type}:`,{beforeLength:v,afterLength:L,lengthChanged:v!==L,contentChanged:J,beforePreview:I.substring(0,100)+"...",afterPreview:F.substring(0,100)+"..."})}else{console.log(`[Apply Suggestions] Could not find exact pattern for ${l.type}:`,{searchPattern:x.substring(0,200)+"...",htmlContainsPattern:a.includes(x),htmlPreview:a.substring(0,500)+"..."});let v=!1;const I=x.toLowerCase(),L=a.toLowerCase();if(L.includes(I)){const F=L.indexOf(I),J=a.substring(F,F+x.length);a=a.replace(J,j),y++,m.push(`${l.type} applied with case-insensitive matching`),v=!0,console.log(`[Apply Suggestions] Applied ${l.type} with case-insensitive matching`)}if(!v&&x.length>50){const F=x.substring(0,Math.floor(x.length*.7));a.includes(F)&&(a=a.replace(F,j),y++,m.push(`${l.type} applied with partial matching`),v=!0,console.log(`[Apply Suggestions] Applied ${l.type} with partial matching`))}if(!v){const F=x.replace(/\s+/g," ").trim(),J=a.replace(/\s+/g," ").trim();if(J.includes(F)){const W=J.indexOf(F),V=a.substring(W,W+x.length);a=a.replace(V,j),y++,m.push(`${l.type} applied with whitespace-normalized matching`),v=!0,console.log(`[Apply Suggestions] Applied ${l.type} with whitespace-normalized matching`)}}if(v||console.log(`[Apply Suggestions] All pattern matching attempts failed for ${l.type}`),l.type==="sentence_replacement"&&l.currentContent&&l.enhancedContent){console.log(`[Apply Suggestions] Trying alternative approach for ${l.type}...`);const F=n(l.currentContent.trim()),J=l.enhancedContent.trim();if(console.log("[Apply Suggestions] Alternative pattern details:",{altFind:F.substring(0,100)+"...",altReplace:J.substring(0,100)+"...",found:a.includes(F),fullAltFind:F}),a.includes(F))a=a.replace(F,J),y++,m.push(`${l.type} applied with alternative pattern`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with alternative pattern`);else if(console.log(`[Apply Suggestions] Alternative pattern also not found for ${l.type}`),a.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim().includes(F))console.log("[Apply Suggestions] Found exact match in HTML text, trying replacement:",{altFind:F.substring(0,100)+"...",altReplace:J.substring(0,100)+"..."}),a=a.replace(F,J),y++,m.push(`${l.type} applied with exact HTML text matching`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with exact HTML text matching`);else{const oe=a.split(/[.!?]+/).filter(_=>_.trim().length>10),k=Math.min(oe.length,20);let N=0,$=null,R=0;for(const _ of oe){if(N>=k){console.log(`[Apply Suggestions] Reached maximum sentence check limit (${k}) for exact replacement`);break}const U=_.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),q=F.replace(/\s+/g," ").trim(),ne=ut(U.toLowerCase(),q.toLowerCase());g&&N<5&&console.log(`[Apply Suggestions] Checking sentence similarity ${N+1}:`,{sentence:U.substring(0,50)+"...",target:q.substring(0,50)+"...",similarity:ne}),ne>R&&($=_.trim(),R=ne),N++}const E=R>.8?$:null;E?(console.log("[Apply Suggestions] Found high-similarity sentence, trying replacement:",{matchingSentence:E.substring(0,100)+"...",altReplace:J.substring(0,100)+"..."}),a=a.replace(E.trim(),J),y++,m.push(`${l.type} applied with high-similarity sentence matching`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with high-similarity sentence matching`)):console.log(`[Apply Suggestions] No high-similarity sentence found for ${l.type}`)}}if(l.type==="paragraph"&&l.currentContent&&l.enhancedContent){console.log(`[Apply Suggestions] Trying paragraph replacement for ${l.type}...`);const F=l.currentContent.trim(),J=l.enhancedContent.trim();if(console.log("[Apply Suggestions] Paragraph pattern details:",{paraFind:F.substring(0,100)+"...",paraReplace:J.substring(0,100)+"...",found:a.includes(F),fullParaFind:F}),a.includes(F))a=a.replace(F,J),y++,m.push(`${l.type} applied with paragraph replacement`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with paragraph replacement`);else{console.log(`[Apply Suggestions] Paragraph pattern not found for ${l.type}`);const W=a.match(/<p[^>]*>([^<]+)<\/p>/i);W?(console.log("[Apply Suggestions] Found paragraph tag, trying replacement:",{paragraphContent:W[1].substring(0,100)+"...",paraReplace:J.substring(0,100)+"..."}),a=a.replace(W[0],`<p>${J}</p>`),y++,m.push(`${l.type} applied with paragraph tag replacement`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with paragraph tag replacement`)):console.log(`[Apply Suggestions] No paragraph tag found for ${l.type}`)}}if(l.type==="content_structure"&&l.implementation){console.log(`[Apply Suggestions] Trying content structure addition for ${l.type}...`);const F=l.implementation;console.log("[Apply Suggestions] Content structure details:",{structureAddition:F.substring(0,100)+"...",hasBodyTag:a.includes("<body>"),fullStructureAddition:F}),a.includes("<body>")?(a=a.replace("<body>",`<body>
${F}`),y++,m.push(`${l.type} applied with structure addition`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with structure addition`)):(console.log(`[Apply Suggestions] No body tag found for ${l.type}`),a.includes("<html>")?(a=a.replace("<html>",`<html>
${F}`),y++,m.push(`${l.type} applied to html tag`),console.log(`[Apply Suggestions] Successfully applied ${l.type} to html tag`)):(a=F+`
`+a,y++,m.push(`${l.type} applied at beginning`),console.log(`[Apply Suggestions] Successfully applied ${l.type} at beginning`)))}if(l.sentenceReplacement){console.log(`[Apply Suggestions] Trying sentenceReplacement pattern for ${l.type}...`);const{find:F,replace:J}=l.sentenceReplacement;a.includes(F)?(a=a.replace(F,J),y++,m.push(`${l.type} applied with sentenceReplacement pattern`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with sentenceReplacement pattern`)):console.log(`[Apply Suggestions] sentenceReplacement pattern also not found for ${l.type}`)}}}}catch(x){console.warn(`Failed to apply exact replacement for ${l.type}:`,x)}});let p;try{if(p=new window.DOMParser().parseFromString(a,"text/html"),p.querySelector("parsererror"))return console.warn("[Apply Suggestions] HTML parsing errors detected, using fallback approach"),a}catch(l){return console.error("[Apply Suggestions] Error parsing HTML:",l),a}const A=(l,i,x)=>{if(!i||!x)return 0;let j=0;const v=l.createTreeWalker?l.createTreeWalker(l.body||l,NodeFilter.SHOW_TEXT):p.createTreeWalker(l.body||p.body,NodeFilter.SHOW_TEXT);let I;for(;I=v.nextNode();){if(!I.textContent)continue;const L=I.textContent;let F=L;if(L.includes(i))F=L.replaceAll(i,x);else{const J=r(i).replace(/\s+/g,"\\s+"),W=new RegExp(J,"gi");F=L.replace(W,x)}F!==L&&(I.textContent=F,j++)}return j};if(p.querySelectorAll('style, link[rel="stylesheet"]'),p.querySelectorAll("script"),p.querySelector("header, nav, .header, .navbar, .navigation"),p.querySelector("footer, .footer"),s.forEach(l=>{try{if(l.exactReplacement&&a.includes(l.exactReplacement.replace))return;if(l.type==="heading"){const i=(l.enhancedContent||l.implementation||"").trim(),x=(l.currentContent||"").trim();if(i.length>0){const j=Array.from(p.querySelectorAll("h1,h2,h3"));let v=!1;j.forEach(I=>{const L=(I.textContent||"").trim();(x&&L.includes(x)||!x&&I.tagName.toLowerCase()==="h1")&&(I.textContent=i,t?.highlight,v=!0)}),v&&(y++,m.push("Heading updated"))}}if(l.type==="paragraph"){const{currentContent:i,enhancedContent:x}=l;if(i&&x){let j=!1;p.querySelectorAll("p").forEach(I=>{I.textContent&&I.textContent.includes(i)&&(I.textContent=(I.textContent||"").replaceAll(i,x),t?.highlight,j=!0)}),j||(j=A(p,i,x)>0),j&&(y++,m.push("Paragraph content replaced"))}}if(l.type==="list"){const{currentContent:i,enhancedContent:x}=l;if(i&&x){const j=p.querySelectorAll("li");let v=!1;j.forEach(I=>{I.textContent&&I.textContent.includes(i)&&(I.textContent=I.textContent.replace(i,x),t?.highlight,v=!0)}),v||(v=A(p,i,x)>0),v&&(y++,m.push("List item content replaced"))}}if(l.type==="meta_description"){let i=p.querySelector('meta[name="description"]');i||(i=p.createElement("meta"),i.name="description",p.head.appendChild(i));const x=p.querySelector("p")?.textContent||"";i.content=x.substring(0,160)||"Improved meta description.",y++,m.push("Meta description updated")}if(l.type==="title"){let i=p.querySelector("title");i||(i=p.createElement("title"),p.head.appendChild(i));const x=p.querySelector("h1")?.textContent;i.textContent=x||"Improved Title",y++,m.push("Title updated")}if(l.type==="meta_keywords"){let i=p.querySelector('meta[name="keywords"]');i||(i=p.createElement("meta"),i.name="keywords",p.head.appendChild(i));const v=(p.body.textContent||"").split(/\s+/).filter(L=>L.length>4).reduce((L,F)=>(L[F.toLowerCase()]=(L[F.toLowerCase()]||0)+1,L),{}),I=Object.entries(v).sort(([,L],[,F])=>F-L).slice(0,5).map(([L])=>L);i.content=I.join(", "),y++,m.push("Meta keywords updated")}if(l.type==="meta_viewport"){let i=p.querySelector('meta[name="viewport"]');i||(i=p.createElement("meta"),i.name="viewport",p.head.appendChild(i)),i.content="width=device-width, initial-scale=1.0",y++,m.push("Meta viewport updated")}if(l.type==="og_title"){let i=p.querySelector('meta[property="og:title"]');i||(i=p.createElement("meta"),i.setAttribute("property","og:title"),p.head.appendChild(i)),i.content=p.querySelector("h1")?.textContent||p.querySelector("title")?.textContent||"",y++,m.push("Open Graph title added")}if(l.type==="og_description"){let i=p.querySelector('meta[property="og:description"]');i||(i=p.createElement("meta"),i.setAttribute("property","og:description"),p.head.appendChild(i)),i.content=p.querySelector('meta[name="description"]')?.getAttribute("content")||"",y++,m.push("Open Graph description added")}if(l.type==="canonical"){let i=p.querySelector('link[rel="canonical"]');i||(i=p.createElement("link"),i.rel="canonical",p.head.appendChild(i)),i.href=window.location.href,y++,m.push("Canonical URL added")}if(l.type==="lang_attribute"){const i=p.documentElement;i.lang="en",y++,m.push("Language attribute updated")}if(l.type==="keyword_optimization"){const i=l.enhancedContent||l.implementation||"",x=i.match(/Enhanced with keywords:\s*(.+)/i)||i.match(/Add keywords:\s*(.+)/i);if(x&&x[1]){let j=p.querySelector('meta[name="keywords"]');j||(j=p.createElement("meta"),j.name="keywords",p.head.appendChild(j)),j.content=x[1],y++,m.push("Meta keywords updated")}}if(l.type==="content_enhancement"){const i=p.querySelectorAll("p");if(i.length>0){const x=i[0],j=l.enhancedContent;j&&j.length>10&&(x.textContent=j,y++,m.push("Content enhanced for AI understanding"))}}if(l.type==="sentence_replacement"){const i=n(l.currentContent||""),x=l.enhancedContent;if(i&&x){let j=A(p,i,x);if(j===0&&i.length>0){const v=i.charAt(0).toLowerCase()+i.slice(1);j=A(p,v,x)}j>0&&(y++,m.push("Sentence replaced for better AI understanding"))}}if(l.type==="ai_content_restructure"){const{currentContent:i,enhancedContent:x}=l;i&&x&&A(p,i,x)>0&&(y++,m.push("Content restructured"))}}catch(i){console.warn(`Failed to apply suggestion ${l.type}:`,i)}}),y>0){const l=p.createElement("script");l.type="application/json",l.id="ai-change-summary",l.textContent=JSON.stringify({appliedCount:y,appliedSuggestions:m}),p.head.appendChild(l)}let w=p.documentElement.outerHTML;if(w.includes("viewport")||(w=w.replace("</head>",`    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>`)),y===0){console.log("[Apply Suggestions] No suggestions were applied, trying aggressive fallback...");let l=!1;s.forEach(i=>{if(!l){if(console.log(`[Apply Suggestions] Trying aggressive fallback for ${i.type}...`),i.type==="heading"&&i.enhancedContent){const x=w.match(/<h[1-6][^>]*>([^<]+)<\/h[1-6]>/i);x?(w=w.replace(x[0],i.enhancedContent),y++,m.push(`${i.type} applied with aggressive fallback`),l=!0,console.log(`[Apply Suggestions] Applied ${i.type} with aggressive fallback`)):w.includes("<body>")&&(w=w.replace("<body>",`<body>
    ${i.enhancedContent}`),y++,m.push(`${i.type} added to body with aggressive fallback`),l=!0,console.log(`[Apply Suggestions] Added ${i.type} to body with aggressive fallback`))}if(i.type==="paragraph"&&i.enhancedContent){const x=w.match(/<p[^>]*>([^<]+)<\/p>/i);x&&(w=w.replace(x[0],i.enhancedContent),y++,m.push(`${i.type} applied with aggressive fallback`),l=!0,console.log(`[Apply Suggestions] Applied ${i.type} with aggressive fallback`))}if(i.type==="sentence_replacement"&&i.currentContent&&i.enhancedContent)if(w.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim().includes(i.currentContent))w=w.replace(i.currentContent,i.enhancedContent),y++,m.push(`${i.type} applied with exact text matching`),l=!0,console.log(`[Apply Suggestions] Applied ${i.type} with exact text matching`);else{const v=w.split(/[.!?]+/).filter(V=>V.trim().length>10),I=Math.min(v.length,20);let L=0,F=null,J=0;for(const V of v){if(L>=I){console.log(`[Apply Suggestions] Reached maximum sentence check limit (${I})`);break}const oe=V.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),k=i.currentContent.replace(/\s+/g," ").trim(),N=ut(oe.toLowerCase(),k.toLowerCase());g&&L<5&&console.log(`[Apply Suggestions] Aggressive fallback similarity check ${L+1}:`,{sentence:oe.substring(0,50)+"...",target:k.substring(0,50)+"...",similarity:N}),N>J&&(F=V.trim(),J=N),L++}const W=J>.9?F:null;W&&(w=w.replace(W.trim(),i.enhancedContent),y++,m.push(`${i.type} applied with high-similarity aggressive matching`),l=!0,console.log(`[Apply Suggestions] Applied ${i.type} with high-similarity aggressive matching`))}!l&&i.enhancedContent&&w.includes("<body>")&&(w=w.replace("<body>",`<body>
    ${i.enhancedContent}`),y++,m.push(`${i.type} added to body with aggressive fallback`),l=!0,console.log(`[Apply Suggestions] Added ${i.type} to body with aggressive fallback`))}}),y===0&&(console.log("[Apply Suggestions] No suggestions were applied successfully"),console.log("[Apply Suggestions] Available suggestions:",s.map(i=>({type:i.type,description:i.description,hasCurrentContent:!!i.currentContent,hasEnhancedContent:!!i.enhancedContent}))))}return console.log("[Apply Suggestions] Final result:",{originalHtmlLength:a.length,finalHtmlLength:w.length,appliedCount:y,appliedSuggestions:m,htmlChanged:w!==a,lengthChanged:w.length!==a.length}),w.includes("<!DOCTYPE html>")||(w=`<!DOCTYPE html>
`+w),w}const gt="statistics_state";function As({sessions:a,currentSession:s}){const[t,n]=S.useState("7d"),[r,c]=S.useState("questions"),[g,y]=S.useState([]),[m,p]=S.useState(0),[A,w]=S.useState([]),[l]=S.useState(!1);S.useEffect(()=>{(async()=>{try{const N=await ce.getHistoryItems();y(N);const $=JSON.parse(localStorage.getItem("sessions")||"[]");w($);const R=localStorage.getItem("llm_qa_current_session");if(R)try{const E=JSON.parse(R);console.log("[Statistics] Current session loaded:",{id:E.id,qaDataLength:E.qaData?.length||0})}catch(E){console.error("[Statistics] Error parsing current session:",E)}}catch(N){console.error("[Statistics] Error loading history items:",N),y([])}})()},[m,a.length,s]),S.useEffect(()=>{s&&(console.log("[Statistics] Current session prop changed:",{id:s.id,qaDataLength:s.qaData?.length||0,timestamp:s.timestamp}),p(k=>k+1))},[s?.id,s?.qaData?.length,s?.timestamp]),S.useEffect(()=>{const k=E=>{(E.key==="comprehensive_history"||E.key==="sessions"||E.key==="llm_qa_current_session")&&(console.log("[Statistics] Storage changed:",E.key,"refreshing statistics"),p(_=>_+1))};window.addEventListener("storage",k);const $=setInterval(()=>{const E=localStorage.getItem("llm_qa_current_session");if(E)try{const U=JSON.parse(E).qaData?.length||0;if(s&&s.qaData){const q=s.qaData.length;U!==q&&(console.log("[Statistics] Current session QA count changed:",q,"->",U),p(ne=>ne+1))}}catch(_){console.error("[Statistics] Error checking current session changes:",_)}},1e3),R=setInterval(async()=>{try{const E=await ce.getHistoryItems(),_=JSON.parse(localStorage.getItem("sessions")||"[]");(E.length!==g.length||_.length!==A.length)&&(console.log("[Statistics] Data changed, refreshing statistics"),p(U=>U+1))}catch(E){console.error("[Statistics] Error checking for data changes:",E)}},2e3);return()=>{window.removeEventListener("storage",k),clearInterval($),clearInterval(R)}},[g.length,A.length,s]);const i=()=>{const k=[...a,...A];g.forEach(b=>{if(b.type==="qa"){const P=b;k.push(P.sessionData)}});const $=g.filter(b=>b.type==="ai-visibility").map(b=>b),E=g.filter(b=>b.type==="content-analysis").map(b=>b),U=g.filter(b=>b.type==="structure-analysis").map(b=>b);console.log("[Statistics] Analysis types found:",{qaSessions:k.length,aiVisibilityAnalyses:$.length,contentAnalyses:E.length,structureAnalyses:U.length});const q=k.filter((b,P,fe)=>P===fe.findIndex(xe=>xe.id===b.id));if(console.log("[Statistics] Total sessions for calculation:",q.length),console.log("[Statistics] Sessions from prop:",a.length),console.log("[Statistics] Sessions from localStorage:",A.length),console.log("[Statistics] QA items from history:",g.filter(b=>b.type==="qa").length),q.forEach((b,P)=>{console.log(`[Statistics] Session ${P+1}:`,{id:b.id,qaCount:b.qaData.length,totalCost:b.statistics?.totalCost,timestamp:b.timestamp})}),!(q.length>0||$.length>0||E.length>0||U.length>0))return{totalQuestions:0,totalCost:0,totalTokens:0,avgAccuracy:0,totalSessions:0,avgQuestionsPerSession:0,successRate:0,providerDistribution:{},questionsPerDay:[],inputTokens:0,outputTokens:0,avgResponseTime:0,weeklyGrowth:0,dailyAverage:0,peakDay:"",sentimentDistribution:{positive:0,negative:0,neutral:0},geoScoreAverage:0,semanticRelevanceAverage:0,vectorSimilarityAverage:0,totalAIVisibilityAnalyses:0,totalContentAnalyses:0,totalStructureAnalyses:0,averageVisibilityScore:0,averageSEOScore:0,averageReadabilityScore:0,totalSuggestions:0};const ee=q.reduce((b,P)=>b+P.qaData.length,0),re=q.reduce((b,P)=>b+parseFloat(P.statistics?.totalCost||"0"),0),Q=q.reduce((b,P)=>b+P.qaData.reduce((fe,xe)=>fe+xe.totalTokens,0),0),K=q.reduce((b,P)=>b+P.qaData.reduce((fe,xe)=>fe+xe.inputTokens,0),0),Z=q.reduce((b,P)=>b+P.qaData.reduce((fe,xe)=>fe+xe.outputTokens,0),0),ue=$.length,be=$.length>0?$.reduce((b,P)=>b+(P.analysis.summary.averageVisibilityScore||0),0)/$.length:0,Fe=E.length,ve=E.length>0?E.reduce((b,P)=>b+(P.analysis.seoScore||0),0)/E.length:0,we=E.length>0?E.reduce((b,P)=>b+(P.analysis.readabilityScore||0),0)/E.length:0,he=U.length,me=U.reduce((b,P)=>b+(P.analysis.suggestions?.length||0),0);console.log("[Statistics] Calculated metrics:",{totalQuestions:ee,totalCost:re.toFixed(5),totalTokens:Q,sessionCount:k.length});const pe=q.flatMap(b=>b.qaData),f=pe.map(b=>parseFloat(b.accuracy||"0")).filter(b=>!isNaN(b)&&b>0),T=f.length>0?f.reduce((b,P)=>b+P,0)/f.length:0;console.log("[Statistics] Accuracy calculation:",{totalQAItems:pe.length,itemsWithAccuracy:f.length,avgAccuracy:T.toFixed(1)+"%",accuracyValues:f.slice(0,5)});const d={};["openai","gemini","perplexity"].forEach(b=>{d[b]=0}),pe.forEach(b=>{const P=b.provider||"Unknown";d.hasOwnProperty(P)?d[P]++:d[P]=(d[P]||0)+1});const G={positive:0,negative:0,neutral:0},ie=q[0]?.blogContent||"";if(ie)try{const b=Yt(ie);b==="Negative"?(G.positive=0,G.negative=0,G.neutral=80):b==="Positive"?(G.positive=70,G.negative=0,G.neutral=30):(G.positive=0,G.negative=0,G.neutral=100)}catch(b){console.error("Error calculating sentiment:",b),G.positive=0,G.negative=0,G.neutral=100}else G.positive=0,G.negative=0,G.neutral=100;const te=pe.map(b=>b.geoScore||0).filter(b=>b>0),le=te.length>0?te.reduce((b,P)=>b+P,0)/te.length:0,X=pe.map(b=>parseFloat(b.semanticRelevance||"0")).filter(b=>!isNaN(b)&&b>0),ge=X.length>0?X.reduce((b,P)=>b+P,0)/X.length:0,Se=pe.map(b=>{const P=b.vectorSimilarity;return typeof P=="string"&&P.includes("%")?parseFloat(P.replace("%","")):parseFloat(P||"0")}).filter(b=>!isNaN(b)&&b>0),De=Se.length>0?Se.reduce((b,P)=>b+P,0)/Se.length:0,Le=new Date,ye=new Date(Le.getTime()-7*24*60*60*1e3),He=new Date(Le.getTime()-14*24*60*60*1e3),Pe=q.filter(b=>new Date(b.timestamp)>=ye),Oe=q.filter(b=>new Date(b.timestamp)>=He&&new Date(b.timestamp)<ye),qe=Pe.reduce((b,P)=>b+P.qaData.length,0),Ne=Oe.reduce((b,P)=>b+P.qaData.length,0),Be=Ne>0?(qe-Ne)/Ne*100:0,Je=ee/7,Ae=x(k,7),Ge=Ae.indexOf(Math.max(...Ae)),ze=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][Ge]||"Unknown",Ve=q.filter(b=>b.qaData.some(P=>P.answer&&P.answer.trim()!=="")),$e=q.length>0?Ve.length/q.length*100:0,Re=q.length>0?ee/q.length:0,_e=Q>0?Q/1e3*2.5:0;return{totalQuestions:ee,totalCost:re,totalTokens:Q,avgAccuracy:T,totalSessions:q.length,avgQuestionsPerSession:Re,successRate:$e,providerDistribution:d,questionsPerDay:Ae,inputTokens:K,outputTokens:Z,avgResponseTime:_e,weeklyGrowth:Be,dailyAverage:Je,peakDay:ze,sentimentDistribution:G,geoScoreAverage:le,semanticRelevanceAverage:ge,vectorSimilarityAverage:De,totalAIVisibilityAnalyses:ue,totalContentAnalyses:Fe,totalStructureAnalyses:he,averageVisibilityScore:be,averageSEOScore:ve,averageReadabilityScore:we,totalSuggestions:me}},x=(k,N)=>{const $=new Date,R=[];for(let E=N-1;E>=0;E--){const _=new Date($);_.setDate(_.getDate()-E);const q=k.filter(ne=>{const ee=new Date(ne.timestamp);return ee.getFullYear()===_.getFullYear()&&ee.getMonth()===_.getMonth()&&ee.getDate()===_.getDate()}).reduce((ne,ee)=>ne+ee.qaData.length,0);R.push(q)}return R},j=()=>{const k=new Date,N=[],$=[],R=["#000000","#333333","#666666","#999999","#cccccc","#e6e6e6","#f0f0f0","#1a1a1a","#404040","#595959","#737373","#8c8c8c","#a6a6a6","#bfbfbf","#d9d9d9","#e6e6e6","#f2f2f2","#f5f5f5","#f8f8f8","#fafafa","#fcfcfc","#000000","#1a1a1a","#333333","#4d4d4d","#666666","#808080","#999999"],E=[...a];switch(g.forEach(_=>{if(_.type==="qa"){const U=_;E.push(U.sessionData)}}),t){case"7d":console.log("[Statistics] Generating 7-day chart data...");for(let _=6;_>=0;_--){const U=new Date(k);U.setDate(U.getDate()-_);const q=U.toLocaleDateString("en-US",{weekday:"short"});N.push(q),console.log(`[Statistics] Day ${_}: ${q} - ${U.toISOString()}`),new Date(U).setHours(0,0,0,0),new Date(U).setHours(23,59,59,999);const re=E.filter(Q=>{try{const K=new Date(Q.timestamp);if(isNaN(K.getTime()))return console.warn("[Statistics] Invalid session timestamp:",Q.timestamp),!1;const Z=K.getFullYear()*1e4+(K.getMonth()+1)*100+K.getDate(),ue=U.getFullYear()*1e4+(U.getMonth()+1)*100+U.getDate();return Z===ue}catch(K){return console.error("[Statistics] Error parsing session timestamp:",Q.timestamp,K),!1}});if(r==="questions"){const Q=re.reduce((K,Z)=>K+Z.qaData.length,0);console.log(`[Statistics] Day ${N[N.length-1]}: ${re.length} sessions, ${Q} questions`),$.push(Q)}else if(r==="cost"){const Q=re.reduce((K,Z)=>K+parseFloat(Z.statistics?.totalCost||"0"),0);$.push(Q)}else r==="sessions"&&$.push(re.length)}break;case"30d":console.log("[Statistics] Generating 30-day chart data...");for(let _=29;_>=0;_--){const U=new Date(k);U.setDate(U.getDate()-_);const q=U.toLocaleDateString("en-US",{month:"short",day:"numeric"});N.push(q),console.log(`[Statistics] Day ${_}: ${q} - ${U.toISOString()}`),new Date(U).setHours(0,0,0,0),new Date(U).setHours(23,59,59,999);const re=E.filter(Q=>{try{const K=new Date(Q.timestamp);if(isNaN(K.getTime()))return console.warn("[Statistics] Invalid session timestamp:",Q.timestamp),!1;const Z=K.getFullYear()*1e4+(K.getMonth()+1)*100+K.getDate(),ue=U.getFullYear()*1e4+(U.getMonth()+1)*100+U.getDate();return Z===ue}catch(K){return console.error("[Statistics] Error parsing session timestamp:",Q.timestamp,K),!1}});if(r==="questions"){const Q=re.reduce((K,Z)=>K+Z.qaData.length,0);console.log(`[Statistics] Day ${N[N.length-1]}: ${re.length} sessions, ${Q} questions`),$.push(Q)}else if(r==="cost"){const Q=re.reduce((K,Z)=>K+parseFloat(Z.statistics?.totalCost||"0"),0);$.push(Q)}else r==="sessions"&&$.push(re.length)}break}return{labels:N,values:$,colors:R}},v=i(),I=j(),L=[...a];if(g.forEach(k=>{if(k.type==="qa"){const N=k;L.push(N.sessionData)}}),L.length>0){const k=L[0];console.log("[Statistics] Sample session structure:",{id:k.id,timestamp:k.timestamp,qaDataLength:k.qaData.length,qaDataSample:k.qaData.slice(0,2).map(N=>({question:N.question.substring(0,50)+"...",hasAnswer:!!N.answer}))})}console.log("[Statistics] Sessions from prop:",a.length),console.log("[Statistics] QA items from history:",g.filter(k=>k.type==="qa").length),console.log("[Statistics] Total sessions for stats:",L.length),console.log("[Statistics] Current session QA count:",s?.qaData.length||0),console.log("[Statistics] Chart data:",I),console.log("[Statistics] Provider distribution:",v.providerDistribution),s&&console.log("[Statistics] Current session active:",{id:s.id,qaDataLength:s.qaData?.length||0}),L.length>0&&console.log("[Statistics] Sample session timestamps:",L.slice(0,3).map(k=>({id:k.id,timestamp:k.timestamp,qaDataLength:k.qaData.length,date:new Date(k.timestamp).toLocaleDateString()})));const F=I.values.length>0?Math.max(...I.values,1):1;if(!I.values.some(k=>k>0)&&L.length>0)if(console.log("[Statistics] No data found in chart, showing fallback data"),s&&s.qaData.length>0){const k=s.qaData.length,N=Math.ceil(k/7);I.values=I.values.map(($,R)=>R===0?Math.floor(N*.8):R===1?Math.floor(N*1.2):R===2?Math.floor(N*1):R===3?Math.floor(N*.9):R===4?Math.floor(N*1.1):R===5?Math.floor(N*.7):R===6?Math.floor(N*.6):0)}else{const k=a.reduce((N,$)=>N+$.qaData.length,0);if(k>0){const N=Math.ceil(k/7);I.values=I.values.map(($,R)=>R===0?Math.floor(N*.8):R===1?Math.floor(N*1.2):R===2?Math.floor(N*1):R===3?Math.floor(N*.9):R===4?Math.floor(N*1.1):R===5?Math.floor(N*.7):R===6?Math.floor(N*.6):0)}}const W=v.providerDistribution,V=["#000000","#333333","#666666","#999999","#cccccc","#e6e6e6"],oe=k=>({openai:"ChatGPT",gemini:"Gemini",perplexity:"Perplexity",Unknown:"Unknown"})[k]||k;return S.useEffect(()=>{const k=localStorage.getItem(gt);if(k)try{const N=JSON.parse(k);N.timeRange&&n(N.timeRange),N.selectedMetric&&c(N.selectedMetric)}catch{}},[]),S.useEffect(()=>{localStorage.setItem(gt,JSON.stringify({timeRange:t,selectedMetric:r}))},[t,r]),e.jsxs("div",{className:"w-full max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-black",children:"Live Analytics Dashboard"})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-black",children:v.totalQuestions}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Total Questions"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-black",children:v.totalAIVisibilityAnalyses+v.totalContentAnalyses+v.totalStructureAnalyses}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Total Analyses"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-black",children:[v.avgAccuracy.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Avg Accuracy"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-black",children:["$",parseFloat(v.totalCost).toFixed(5)]}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Total Cost"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rt,{className:"w-6 h-6 text-black"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[r==="questions"?"Questions Generated":r==="cost"?"Cost Analysis":"Sessions Created"," - ",t==="7d"?"Last 7 Days":"Last 30 Days",t==="30d"&&e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(Scroll to see all days)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t,onChange:k=>n(k.target.value),className:"bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-black",children:[e.jsx("option",{value:"7d",children:"7 Days"}),e.jsx("option",{value:"30d",children:"30 Days"})]}),e.jsxs("select",{value:r,onChange:k=>c(k.target.value),className:"bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-black",children:[e.jsx("option",{value:"questions",children:"Questions"}),e.jsx("option",{value:"cost",children:"Cost"}),e.jsx("option",{value:"sessions",children:"Sessions"})]})]})]}),e.jsx("div",{className:`h-64 bg-gray-50 rounded-lg w-full ${t==="30d"?"overflow-x-auto":"overflow-hidden"}`,style:{...t==="30d"&&{scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"}},children:e.jsxs("div",{className:"relative h-full flex items-end w-full",children:[t==="7d"&&e.jsx("div",{className:"absolute inset-0 flex items-end justify-between px-4 pb-8",children:I.values.map((k,N)=>e.jsxs("div",{className:"flex flex-col justify-end items-center h-full w-16",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 font-medium",children:r==="cost"?parseFloat(k).toFixed(5):k}),e.jsx("div",{className:"w-full rounded-t-lg transition-all duration-500 hover:opacity-80",style:{height:`${k/F*180}px`,backgroundColor:I.colors[N%I.colors.length],minHeight:"4px"}}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 text-center font-medium w-full truncate",children:I.labels[N]})]},N))}),t==="30d"&&e.jsx("div",{className:"flex items-end h-full gap-2 px-6 min-w-[1320px] pb-8",children:I.values.map((k,N)=>e.jsxs("div",{className:"flex flex-col justify-end items-center h-full w-14",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 font-medium",children:r==="cost"?parseFloat(k).toFixed(5):k}),e.jsx("div",{className:"w-full rounded-t-lg transition-all duration-500 hover:opacity-80",style:{height:`${k/F*180}px`,backgroundColor:I.colors[N%I.colors.length],minHeight:"4px"}}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 text-center font-medium w-full truncate",children:I.labels[N]})]},N))})]})}),t==="30d"&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("div",{className:"text-xs text-gray-500",children:"← Scroll horizontally to see all 30 days →"})})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(We,{className:"w-6 h-6 text-black"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Provider Distribution"})]}),Object.keys(W).length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"relative w-48 h-48",children:[e.jsx("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:Object.entries(W).map(([k,N],$)=>{const R=Object.values(W).reduce((re,Q)=>re+Q,0),E=R>0?N/R*100:0,_=40,U=2*Math.PI*_,q=E/100*U,ne=U-q,ee=$/Object.keys(W).length*360;return e.jsx("circle",{cx:"50",cy:"50",r:_,fill:"none",stroke:V[$%V.length],strokeWidth:"8",strokeDasharray:U,strokeDashoffset:ne,transform:`rotate(${ee} 50 50)`,className:"transition-all duration-500"},k)})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:Object.values(W).reduce((k,N)=>k+N,0)}),e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:"Total"})]})})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mt-6",children:Object.entries(W).map(([k,N],$)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:V[$%V.length]}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:oe(k)}),e.jsx("span",{className:"text-sm font-bold text-black ml-auto",children:N})]},k))})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-lg font-medium",children:"No provider data available"}),e.jsx("div",{className:"text-sm",children:"Generate some questions to see provider distribution"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Dt,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Token Usage"})]}),e.jsx("div",{className:"text-3xl font-bold text-black mb-2",children:v.totalTokens.toLocaleString()}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Total Tokens Used"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Input Tokens"}),e.jsx("span",{className:"text-black font-semibold",children:v.inputTokens.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Output Tokens"}),e.jsx("span",{className:"text-black font-semibold",children:v.outputTokens.toLocaleString()})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ye,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Performance"})]}),e.jsx("div",{className:"text-3xl font-bold text-black mb-2",children:v.avgQuestionsPerSession.toFixed(1)}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Avg Questions/Session"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Success Rate"}),e.jsxs("span",{className:"text-black font-semibold",children:[v.successRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Avg Response Time"}),e.jsxs("span",{className:"text-black font-semibold",children:[v.avgResponseTime.toFixed(1),"s"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(rt,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Trends"})]}),e.jsxs("div",{className:"text-3xl font-bold text-black mb-2",children:[v.weeklyGrowth>=0?"+":"",v.weeklyGrowth.toFixed(1),"%"]}),e.jsx("div",{className:"text-gray-600 font-medium",children:"This Week"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Daily Avg"}),e.jsx("span",{className:"text-black font-semibold",children:v.dailyAverage.toFixed(0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Peak Day"}),e.jsx("span",{className:"text-black font-semibold",children:v.peakDay})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Lt,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Sentiment Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:v.sentimentDistribution.positive}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Positive"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:v.sentimentDistribution.negative}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Negative"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:v.sentimentDistribution.neutral}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Neutral"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ye,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Quality Metrics"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"GEO Score Avg"}),e.jsxs("span",{className:"text-black font-semibold",children:[v.geoScoreAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Semantic Relevance"}),e.jsxs("span",{className:"text-black font-semibold",children:[v.semanticRelevanceAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Vector Similarity"}),e.jsxs("span",{className:"text-black font-semibold",children:[v.vectorSimilarityAverage.toFixed(1),"%"]})]})]})]})]})]})}const Zt=()=>{console.log("🧹 Clearing analysis data for fresh session..."),["llm_qa_current_work","enhance_content_state","ai_visibility_current_session","ai_visibility_analysis_data","content_analysis_current_session","content_analysis_data","structure_analysis_current_session","structure_analysis_data","llm_competitor_urls","session_index","session_manager_sessions","statistics_state","current_analysis_session","analysis_data","analysis_results"].forEach(t=>{try{localStorage.removeItem(t),console.log(`🧹 Cleared: ${t}`)}catch(n){console.warn(`🧹 Failed to clear ${t}:`,n)}}),["enhance_content_cache_","analysis_cache_","ai_visibility_","content_analysis_","structure_analysis_"].forEach(t=>{try{Object.keys(localStorage).forEach(r=>{r.startsWith(t)&&(localStorage.removeItem(r),console.log(`🧹 Cleared prefixed key: ${r}`))})}catch(n){console.warn(`🧹 Failed to clear keys with prefix ${t}:`,n)}}),console.log("🧹 Analysis data clearing completed")},es=a=>{console.log("🧹 Clearing user-specific data..."),console.log("🧹 User-specific data clearing completed")},ts=()=>{console.log("🧹 Clearing analysis state...");try{sessionStorage.clear(),console.log("🧹 Cleared sessionStorage")}catch(a){console.warn("🧹 Failed to clear sessionStorage:",a)}console.log("🧹 Analysis state clearing completed")},ht=a=>{console.log("🧹 Performing analysis cleanup for fresh session..."),Zt(),es(),ts(),console.log("🧹 Analysis cleanup completed - ready for fresh analysis")},ss={isAuthenticated:!1,user:null,isLoading:!0,error:null};function ns(a,s){switch(s.type){case"AUTH_START":return{...a,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...a,isAuthenticated:!0,user:s.payload.user,isLoading:!1,error:null};case"AUTH_FAILURE":return{...a,isAuthenticated:!1,user:null,isLoading:!1,error:s.payload};case"AUTH_LOGOUT":return{...a,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...a,error:null};default:return a}}const wt=S.createContext(void 0);function ks({children:a}){const[s,t]=S.useReducer(ns,ss);S.useEffect(()=>{s.isAuthenticated&&s.user&&!s.isLoading&&console.log("🔐 AuthContext: User authenticated, should redirect to overview")},[s.isAuthenticated,s.user,s.isLoading]),S.useEffect(()=>{(async()=>{try{console.log("🔐 AuthContext: Checking authentication status on mount..."),t({type:"AUTH_START"});const p=new Date,A=B.getExpiresAt();if(A&&new Date(A)<=p){console.log("🔐 AuthContext: Token expired, clearing stale tokens"),B.clearTokens(),t({type:"AUTH_FAILURE",payload:null});return}if(B.isAuthenticated()){console.log("🔐 AuthContext: User is authenticated, getting user info...");const w=await B.getCurrentUser();if(w){console.log("🔐 AuthContext: User info retrieved, dispatching AUTH_SUCCESS");try{localStorage.setItem("user",JSON.stringify(w)),console.log("🔐 AuthContext: User data stored in localStorage on startup:",w)}catch(l){console.warn("🔐 AuthContext: Failed to store user data in localStorage on startup:",l)}t({type:"AUTH_SUCCESS",payload:{user:w,token:B.getAccessToken()}})}else console.log("🔐 AuthContext: Failed to get user info, clearing tokens"),B.clearTokens(),t({type:"AUTH_FAILURE",payload:"Failed to get user information"})}else console.log("🔐 AuthContext: User is not authenticated"),t({type:"AUTH_FAILURE",payload:null})}catch(p){console.error("🔐 AuthContext: Auth check error:",p),B.clearTokens(),t({type:"AUTH_FAILURE",payload:p instanceof Error?p.message:"Authentication failed"})}})()},[]);const y={...s,login:async(m="microsoft",p)=>{try{console.log("🔐 AuthContext: Starting login with method:",m),ht(),console.log("🔐 AuthContext: Clearing stale authentication data..."),B.clearTokens(),["llm_qa_current_session","structure_last_saved","overview_market_analysis"].forEach(x=>{try{localStorage.getItem(x)&&(console.log(`🔐 AuthContext: Clearing conflicting localStorage key: ${x}`),localStorage.removeItem(x))}catch(j){console.warn(`🔐 AuthContext: Could not clear ${x}:`,j)}}),t({type:"AUTH_START"});let w;switch(m){case"local":console.log("🔐 AuthContext: Using local login"),w=await B.localLogin(p);break;case"register":console.log("🔐 AuthContext: Using register method"),w=await B.register(p);break;case"google":console.log("🔐 AuthContext: Using Google login"),w=await B.googleLogin();break;case"microsoft":default:console.log("🔐 AuthContext: Using Microsoft login"),w=await B.login();break}console.log("✅ AuthContext: Login successful, dispatching AUTH_SUCCESS with:",{user:w.user,hasToken:!!w.accessToken}),console.log("🔐 AuthContext: Verifying token storage..."),await new Promise(x=>setTimeout(x,100));const l=B.isAuthenticated(),i=B.getAccessToken();if(console.log("🔐 AuthContext: Token verification:",{isAuthValid:l,hasStoredToken:!!i,tokenMatches:i===w.accessToken}),!l||!i){console.error("🔐 AuthContext: Token storage verification failed, clearing tokens and retrying..."),B.clearTokens(),B.setTokens(w.accessToken,w.refreshToken,w.expiresAt),await new Promise(v=>setTimeout(v,100));const x=B.isAuthenticated(),j=B.getAccessToken();if(console.log("🔐 AuthContext: Retry verification:",{isAuthValid:x,hasStoredToken:!!j,tokenMatches:j===w.accessToken}),!x||!j)throw new Error("Failed to store authentication tokens")}console.log("🔐 AuthContext: Dispatching AUTH_SUCCESS with user:",w.user);try{localStorage.setItem("user",JSON.stringify(w.user)),console.log("🔐 AuthContext: User data stored in localStorage:",w.user)}catch(x){console.warn("🔐 AuthContext: Failed to store user data in localStorage:",x)}t({type:"AUTH_SUCCESS",payload:{user:w.user,token:w.accessToken}}),console.log("🔐 AuthContext: AUTH_SUCCESS dispatched"),setTimeout(()=>{console.log("🔐 AuthContext: State after dispatch:",{isAuthenticated:B.isAuthenticated(),hasToken:!!B.getAccessToken(),user:B.getCurrentUser()})},100)}catch(A){console.error("❌ AuthContext: Login failed:",A),B.clearTokens(),t({type:"AUTH_FAILURE",payload:A instanceof Error?A.message:"Login failed"})}},logout:async()=>{try{await B.logout(),ht();try{localStorage.removeItem("user"),console.log("🔐 AuthContext: User data cleared from localStorage on logout")}catch(m){console.warn("🔐 AuthContext: Failed to clear user data from localStorage on logout:",m)}t({type:"AUTH_LOGOUT"})}catch(m){console.error("Logout error:",m),B.clearTokens();try{localStorage.removeItem("user"),console.log("🔐 AuthContext: User data cleared from localStorage on logout failure")}catch(p){console.warn("🔐 AuthContext: Failed to clear user data from localStorage on logout failure:",p)}t({type:"AUTH_LOGOUT"})}},clearError:()=>{t({type:"CLEAR_ERROR"})},refreshUser:async()=>{try{const m=await B.getCurrentUser();if(m){try{localStorage.setItem("user",JSON.stringify(m)),console.log("🔐 AuthContext: User data refreshed in localStorage:",m)}catch(p){console.warn("🔐 AuthContext: Failed to store refreshed user data in localStorage:",p)}t({type:"AUTH_SUCCESS",payload:{user:m,token:B.getAccessToken()}})}else B.clearTokens(),t({type:"AUTH_FAILURE",payload:"Failed to refresh user information"})}catch(m){B.clearTokens(),t({type:"AUTH_FAILURE",payload:m instanceof Error?m.message:"Failed to refresh user"})}}};return e.jsx(wt.Provider,{value:y,children:a})}function rs(){const a=S.useContext(wt);if(a===void 0)throw new Error("useAuth must be used within an AuthProvider");return a}const St=/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F900}-\u{1F9FF}]|[\u{1F018}-\u{1F270}]|[\u{238C}-\u{2454}]|[\u{20D0}-\u{20FF}]|[\u{FE00}-\u{FE0F}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F64F}]|[\u{1F910}-\u{1F96B}]|[\u{1F980}-\u{1F9E0}]|[\u{1FA70}-\u{1FA93}]|[\u{1FAB0}-\u{1FABD}]|[\u{1FAC0}-\u{1FAF0}]|[\u{1FB00}-\u{1FB4B}]|[\u{1FB50}-\u{1FBAF}]|[\u{1FBB0}-\u{1FBCA}]|[\u{1FBD0}-\u{1FBEF}]|[\u{1FBF0}-\u{1FBFF}]|[\u{1FC00}-\u{1FC23}]|[\u{1FC30}-\u{1FC56}]|[\u{1FC60}-\u{1FC78}]|[\u{1FC80}-\u{1FC9C}]|[\u{1FCA0}-\u{1FCA4}]|[\u{1FCC0}-\u{1FCC4}]|[\u{1FCD0}-\u{1FCD4}]|[\u{1FCE0}-\u{1FCE4}]|[\u{1FCF0}-\u{1FCF4}]|[\u{1FD00}-\u{1FD23}]|[\u{1FD30}-\u{1FD56}]|[\u{1FD60}-\u{1FD78}]|[\u{1FD80}-\u{1FD9C}]|[\u{1FDA0}-\u{1FDA4}]|[\u{1FDB0}-\u{1FDB4}]|[\u{1FDC0}-\u{1FDC4}]|[\u{1FDD0}-\u{1FDD4}]|[\u{1FDE0}-\u{1FDE4}]|[\u{1FDF0}-\u{1FDF4}]|[\u{1FE00}-\u{1FE23}]|[\u{1FE30}-\u{1FE56}]|[\u{1FE60}-\u{1FE78}]|[\u{1FE80}-\u{1FE9C}]|[\u{1FEA0}-\u{1FEA4}]|[\u{1FEB0}-\u{1FEB4}]|[\u{1FEC0}-\u{1FEC4}]|[\u{1FED0}-\u{1FED4}]|[\u{1FEE0}-\u{1FEE4}]|[\u{1FEF0}-\u{1FEF4}]|[\u{1FF00}-\u{1FF23}]|[\u{1FF30}-\u{1FF56}]|[\u{1FF60}-\u{1FF78}]|[\u{1FF80}-\u{1FF9C}]|[\u{1FFA0}-\u{1FFA4}]|[\u{1FFB0}-\u{1FFB4}]|[\u{1FFC0}-\u{1FFC4}]|[\u{1FFD0}-\u{1FFD4}]|[\u{1FFE0}-\u{1FFE4}]|[\u{1FFF0}-\u{1FFF4}]/gu,At=a=>!a||typeof a!="string"?a:a.replace(St,""),kt=(a,s)=>{const t=At(a.target.value);return a.target.value=t,s(t),a.target.dispatchEvent(new Event("input",{bubbles:!0})),t},jt=(a,s)=>{a.preventDefault();const t=a.clipboardData.getData("text"),n=At(t),r=a.target;return r.value=n,s(n),r.dispatchEvent(new Event("input",{bubbles:!0})),n},Ct=a=>{if(a.key==="Backspace"||a.key==="Delete"||a.key==="ArrowLeft"||a.key==="ArrowRight"||a.key==="ArrowUp"||a.key==="ArrowDown"||a.key==="Tab"||a.key==="Enter"||a.key==="Escape"||a.key==="Home"||a.key==="End"||a.key==="PageUp"||a.key==="PageDown"||a.key==="Shift"||a.key==="Control"||a.key==="Alt"||a.key==="Meta")return!0;const s=a.key;return s.length===1&&St.test(s)||(a.ctrlKey||a.metaKey||a.altKey)&&(s==="."||s===";"||s==="=")||s.length>1&&(s.includes("Emoji")||s.includes("emoji"))?(a.preventDefault(),!1):!0};function tt(a,s){const[t,n]=S.useState(()=>{try{const c=window.localStorage.getItem(a);return c?JSON.parse(c):s}catch(c){return console.error(`Error loading ${a} from localStorage:`,c),s}});return[t,c=>{try{n(c),window.localStorage.setItem(a,JSON.stringify(c))}catch(g){console.error(`Error saving ${a} to localStorage:`,g)}}]}const se="http://localhost:5000/api";class os{async request(s,t={}){const n=`${se}${s}`;console.log("[ApiService] Making request to:",n);const r=await fetch(n,{headers:{"Content-Type":"application/json",...B.getAuthHeaders(),...t.headers},...t});if(console.log("[ApiService] Response status:",r.status),console.log("[ApiService] Response headers:",r.headers),r.status===403)if(console.log("[ApiService] 403 Forbidden - attempting token refresh"),await B.refreshToken()){console.log("[ApiService] Token refreshed successfully, retrying request");const y=await fetch(n,{headers:{"Content-Type":"application/json",...B.getAuthHeaders(),...t.headers},...t});if(!y.ok){const p=await y.json().catch(()=>({}));throw new Error(p.error||`HTTP error! status: ${y.status}`)}const m=y.headers.get("content-type");if(!m||!m.includes("application/json")){const p=await y.text();throw console.error("[ApiService] Non-JSON response received on retry:",p.substring(0,200)),new Error(`Expected JSON response but got: ${m}`)}return y.json()}else throw console.log("[ApiService] Token refresh failed, redirecting to login"),B.logout(),window.location.href="/login",new Error("Session expired. Please log in again.");if(!r.ok){const g=await r.json().catch(()=>({}));throw new Error(g.error||`HTTP error! status: ${r.status}`)}const c=r.headers.get("content-type");if(!c||!c.includes("application/json")){const g=await r.text();throw console.error("[ApiService] Non-JSON response received:",g.substring(0,200)),new Error(`Expected JSON response but got: ${c}`)}return r.json()}async getLLMProviders(){return this.request("/llm/providers")}async generateQuestions(s){return this.request("/llm/generate-questions",{method:"POST",body:JSON.stringify(s)})}async generateAnswers(s){return this.request("/llm/generate-answers",{method:"POST",body:JSON.stringify(s)})}async generateAnswersWeb(s){return this.request("/llm/generate-answers-web",{method:"POST",body:JSON.stringify(s)})}async generateAIFAQs(s){return this.request("/llm/generate-ai-faqs",{method:"POST",body:JSON.stringify(s)})}async calculateConfidence(s,t,n,r){return this.request("/llm/calculate-confidence",{method:"POST",body:JSON.stringify({question:s,content:t,provider:n,model:r})})}async compareQuestions(s,t,n,r){return this.request("/llm/compare-questions",{method:"POST",body:JSON.stringify({question1:s,question2:t,provider:n,model:r})})}async saveSession(s){return this.request("/sessions",{method:"POST",body:JSON.stringify(s)})}async getSessionsByType(s){return this.request(`/sessions/${s}`)}async getSessionsWithFilters(s,t){const n=new URLSearchParams;t.fromDate&&n.append("fromDate",t.fromDate),t.toDate&&n.append("toDate",t.toDate),t.llmProvider&&n.append("llmProvider",t.llmProvider),t.llmModel&&n.append("llmModel",t.llmModel),t.blogLink&&n.append("blogLink",t.blogLink),t.search&&n.append("search",t.search);const r=n.toString(),c=r?`/sessions/${s}?${r}`:`/sessions/${s}`;return this.request(c)}async getSessionsByDateRange(s,t,n){const r=new URLSearchParams({fromDate:t,toDate:n});return this.request(`/sessions/${s}/range?${r}`)}async getSessionById(s){return this.request(`/sessions/question/${s}`)}async deleteSession(s){return this.request(`/sessions/${s}`,{method:"DELETE"})}async getSessionStats(s){return this.request(`/stats/${s}`)}async bulkSaveSessions(s){return this.request("/sessions/bulk",{method:"POST",body:JSON.stringify({sessions:s})})}async exportSessions(s,t="json"){const n=await fetch(`${se}/export/${s}?format=${t}`);if(!n.ok){const r=await n.json().catch(()=>({}));throw new Error(r.error||`HTTP error! status: ${n.status}`)}return n.blob()}async healthCheck(){return this.request("/health")}async migrateFromLocalStorage(s){const t=Object.values(s);return this.bulkSaveSessions(t)}async checkQuestionRelevance(s,t,n,r,c){return this.request("/questions/check-relevance",{method:"POST",body:JSON.stringify({sourceUrls:s,blogUrl:t,questionText:n,currentProvider:r,currentModel:c})})}async calculateCitationLikelihood({answer:s,content:t,provider:n,model:r}){console.log("[Frontend] Calling /api/citation-likelihood/calculate with:",{answer:s,content:t,provider:n,model:r});const c=await fetch(`${se}/citation-likelihood/calculate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:s,content:t,provider:n,model:r})});let g;try{g=await c.json()}catch(y){throw console.error("[Frontend] Failed to parse JSON from /api/citation-likelihood/calculate:",y),new Error("Failed to parse JSON from /api/citation-likelihood/calculate")}if(console.log("[Frontend] /api/citation-likelihood/calculate response:",g),!c.ok)throw new Error("Failed to calculate citation likelihood: "+(g.error||c.status));return g}async calculateAccuracy({answer:s,content:t,provider:n,model:r}){console.log("[Frontend] Calling /api/accuracy/calculate with:",{answer:s,content:t,provider:n,model:r});const c=await fetch(`${se}/accuracy/calculate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:s,content:t,provider:n,model:r})});let g;try{g=await c.json()}catch(y){throw console.error("[Frontend] Failed to parse JSON from /api/accuracy/calculate:",y),new Error("Failed to parse JSON from /api/accuracy/calculate")}if(console.log("[Frontend] /api/accuracy/calculate response:",g),!c.ok)throw new Error("Failed to calculate accuracy: "+(g.error||c.status));return g}async calculateGeminiAccuracy({answer:s,content:t,model:n}){console.log("[Frontend] Calling /api/accuracy/gemini with:",{answer:s,content:t,model:n});const r=await fetch(`${se}/accuracy/gemini`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:s,content:t,model:n})});let c;try{c=await r.json()}catch(g){throw console.error("[Frontend] Failed to parse JSON from /api/accuracy/gemini:",g),new Error("Failed to parse JSON from /api/accuracy/gemini")}if(console.log("[Frontend] /api/accuracy/gemini response:",c),!r.ok)throw new Error("Failed to calculate Gemini accuracy: "+(c.error||r.status));return c}async calculateGeoScoreBackend(s){const t=await fetch(`${se}/geo-score`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify(s)});let n;try{n=await t.json()}catch(r){throw console.error("[Frontend] Failed to parse JSON from /api/geo-score:",r),new Error("Failed to parse JSON from /api/geo-score")}if(console.log("[Frontend] /api/geo-score response:",n),!t.ok)throw new Error("Failed to calculate GEO score: "+(n.error||t.status));return n}async getGEOFanoutAnalysis(s){const t=s?`${se}/geo-fanout/analysis?sessionId=${s}`:`${se}/geo-fanout/analysis`;console.log("[Frontend] Calling GEO fanout analysis:",t);const n=await fetch(t,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}});let r;try{r=await n.json()}catch(c){throw console.error("[Frontend] Failed to parse JSON from GEO fanout analysis:",c),new Error("Failed to parse JSON from GEO fanout analysis")}if(console.log("[Frontend] GEO fanout analysis response:",r),!n.ok)throw new Error("Failed to get GEO fanout analysis: "+(r.error||n.status));return r}async analyzeCompetitor(s,t){const n=await fetch(`${se}/competitor/analyze`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({domain:s,userContent:t})}),r=await n.json();if(!n.ok)throw new Error("Failed to analyze competitor: "+(r.error||n.status));return r}async analyzeMultipleCompetitors(s,t){const n=await fetch(`${se}/competitor/analyze-multiple`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({domains:s,userContent:t})}),r=await n.json();if(!n.ok)throw new Error("Failed to analyze competitors: "+(r.error||n.status));return r}async getCompetitorAnalyses(){const s=await fetch(`${se}/competitor/analyses`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),t=await s.json();if(!s.ok)throw new Error("Failed to get competitor analyses: "+(t.error||s.status));return t}async getCompetitorAnalysis(s){const t=await fetch(`${se}/competitor/analysis/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),n=await t.json();if(!t.ok)throw new Error("Failed to get competitor analysis: "+(n.error||t.status));return n}async deleteCompetitorAnalysis(s){const t=await fetch(`${se}/competitor/analysis/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),n=await t.json();if(!t.ok)throw new Error("Failed to delete competitor analysis: "+(n.error||t.status));return n}async extractContentFromUrl(s){return console.log("[API Service] Extracting content from URL:",s),console.log("[API Service] API_BASE_URL:",se),console.log("[API Service] Access token:",localStorage.getItem("accessToken")?"Present":"Missing"),this.request("/extract-content",{method:"POST",body:JSON.stringify({url:s})})}async crawlWebsite(s,t){return console.log("[API Service] Crawling website:",s,"with options:",t),this.request("/crawl-website",{method:"POST",body:JSON.stringify({url:s,options:t})})}async extractFullPageHtml(s){return console.log("[API Service] Extracting full page HTML from URL:",s),this.request("/extract/fullpage",{method:"POST",body:JSON.stringify({url:s})})}async getOffsiteSignals(s){return this.request("/ecommerce-content/offsite-signals",{method:"POST",body:JSON.stringify(s)})}async getCompetitors(s){return this.request("/ecommerce-content/competitors",{method:"POST",body:JSON.stringify(s)})}async getSerpTop(s,t=10){return this.request("/ecommerce-content/serp-top",{method:"POST",body:JSON.stringify({query:s,num:t})})}async fetchBatchHtml(s){return this.request("/ecommerce-content/fetch-batch",{method:"POST",body:JSON.stringify({urls:s})})}async getSmartAnalyses(){const s=await fetch(`${se}/competitor/smart-analyses`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),t=await s.json();if(!s.ok)throw new Error("Failed to get smart analyses: "+(t.error||s.status));return t}async getSmartAnalysis(s){const t=await fetch(`${se}/competitor/smart-analysis/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),n=await t.json();if(!t.ok)throw new Error("Failed to get smart analysis: "+(n.error||t.status));return n}async createSmartAnalysis(s){const t=await fetch(`${se}/competitor/smart-analysis`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify(s)}),n=await t.json();if(!t.ok)throw new Error("Failed to create smart analysis: "+(n.error||t.status));return n}async deleteSmartAnalysis(s){const t=await fetch(`${se}/competitor/smart-analysis/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),n=await t.json();if(!t.ok)throw new Error("Failed to delete smart analysis: "+(n.error||t.status));return n}async analyzeContentStructure(s,t){return console.log("[API Service] Analyzing content structure for:",t?`URL: ${t}`:`Content length: ${s.length}`),t?(console.log("[API Service] Using dedicated structural content crawler for URL"),this.request("/structural-content/crawl",{method:"POST",body:JSON.stringify({url:t})})):this.request("/content/analyze-structure",{method:"POST",body:JSON.stringify({content:s,url:t})})}async saveLastStructureAnalysis(s){return this.request("/structure/last",{method:"POST",body:JSON.stringify({analysis:s})})}async getLastStructureAnalysis(s){const t=s?`?url=${encodeURIComponent(s)}`:"";return this.request(`/structure/last${t}`,{method:"GET"})}async getGA4PageMetrics(s){return this.request("/analytics/ga4",{method:"POST",body:JSON.stringify(s)})}async getSearchConsoleMetrics(s){return this.request("/analytics/search-console",{method:"POST",body:JSON.stringify(s)})}async getLLMVisibility(s){return this.request("/analytics/llm-visibility",{method:"POST",body:JSON.stringify(s)})}async applyStructureSuggestions(s,t){const n=await fetch(`${se}/content/apply-suggestions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({content:s,suggestions:t})}),r=await n.json();if(!n.ok)throw new Error("Failed to apply structure suggestions: "+(r.error||n.status));return r}async getAIVisibilityAnalysis(s,t,n){const r=new URLSearchParams;t&&r.append("industry",t),n?.fast&&r.append("fast","true");const c=r.toString(),g=c?`?${c}`:"";return this.request(`/ai-visibility/${encodeURIComponent(s)}${g}`,{signal:n?.signal})}async analyzeSingleCompetitor(s,t){return await this.request("/ai-visibility/analyze-competitor",{method:"POST",body:JSON.stringify({companyName:s,industry:t})})}async storeConnect(s){return this.request("/store/connect",{method:"POST",body:JSON.stringify(s)})}async storeTest(s){return this.request("/store/test",{method:"POST",body:JSON.stringify(s)})}async storeListProducts(s){const t=new URLSearchParams;s?.page&&t.append("page",String(s.page)),s?.limit&&t.append("limit",String(s.limit));const n=t.toString()?`?${t.toString()}`:"";return this.request(`/store/products${n}`,{method:"GET"})}async storeFetchProductHtml(s){const t=`?idOrUrl=${encodeURIComponent(s)}`;return this.request(`/store/product-html${t}`,{method:"GET"})}async getShopperBehaviorData(s,t){const n=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/shopper-behavior${n}`,{method:"GET"})}async getCartAbandonmentAnalysis(s,t){const n=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/cart-abandonment${n}`,{method:"GET"})}async getQueryIntentAnalysis(s,t){const n=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/query-intent${n}`,{method:"GET"})}async getEngagementFunnel(s,t){const n=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/engagement-funnel${n}`,{method:"GET"})}async getRealTimeMetrics(s){const t=`?storeId=${encodeURIComponent(s)}`;return this.request(`/ecommerce/real-time-metrics${t}`,{method:"GET"})}async getAIInsights(s,t){const n=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/ai-insights${n}`,{method:"GET"})}async generateEcommerceContent(s){return this.request("/ecommerce/generate-content",{method:"POST",body:JSON.stringify(s)})}}const Ie=new os;class as{SESSION_PREFIX="kabini_analysis_session_";SESSION_EXPIRY_DAYS=7;MAX_SESSIONS_PER_TYPE=5;saveAnalysisSession(s,t,n,r,c,g,y){const m=this.generateSessionId(s),p=Date.now(),A=p+this.SESSION_EXPIRY_DAYS*24*60*60*1e3,w={id:m,type:s,data:t,timestamp:p,expiresAt:A,userId:y,inputValue:n,analysisType:r,inputType:c,industry:g};return localStorage.setItem(this.SESSION_PREFIX+m,JSON.stringify(w)),this.updateSessionIndex(s,m),this.cleanupOldSessions(s),console.log(`[SessionManager] Saved ${s} session:`,m),m}getLatestAnalysisSession(s,t){const n=this.getSessionIndex(s);if(n.length===0)return null;const r=n[n.length-1],c=localStorage.getItem(this.SESSION_PREFIX+r);if(!c)return null;try{const g=JSON.parse(c);return g.expiresAt<Date.now()?(this.removeSession(g.id),null):t&&g.userId&&g.userId!==t?null:g}catch(g){return console.error("[SessionManager] Error parsing session data:",g),this.removeSession(r),null}}getAllActiveSessions(s){const t=[];return["overview","ai-visibility","content-structure","competitor"].forEach(r=>{this.getSessionIndex(r).forEach(g=>{const y=localStorage.getItem(this.SESSION_PREFIX+g);if(y)try{const m=JSON.parse(y);if(m.expiresAt<Date.now()){this.removeSession(m.id);return}if(s&&m.userId&&m.userId!==s)return;t.push(m)}catch(m){console.error("[SessionManager] Error parsing session data:",m),this.removeSession(g)}})}),t.sort((r,c)=>c.timestamp-r.timestamp)}clearSessionsByType(s){this.getSessionIndex(s).forEach(n=>{this.removeSession(n)}),localStorage.removeItem(`kabini_session_index_${s}`),console.log(`[SessionManager] Cleared all ${s} sessions`)}clearAllSessions(s){this.getAllActiveSessions(s).forEach(r=>{this.removeSession(r.id)}),["overview","ai-visibility","content-structure","competitor"].forEach(r=>{localStorage.removeItem(`kabini_session_index_${r}`)}),console.log("[SessionManager] Cleared all sessions")}removeSession(s){localStorage.removeItem(this.SESSION_PREFIX+s),["overview","ai-visibility","content-structure","competitor"].forEach(n=>{const c=this.getSessionIndex(n).filter(g=>g!==s);this.setSessionIndex(n,c)})}generateSessionId(s){return`${s}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getSessionIndex(s){try{const t=localStorage.getItem(`kabini_session_index_${s}`);return t?JSON.parse(t):[]}catch{return[]}}setSessionIndex(s,t){localStorage.setItem(`kabini_session_index_${s}`,JSON.stringify(t))}updateSessionIndex(s,t){const r=this.getSessionIndex(s).filter(c=>c!==t);r.push(t),r.length>this.MAX_SESSIONS_PER_TYPE&&r.splice(0,r.length-this.MAX_SESSIONS_PER_TYPE),this.setSessionIndex(s,r)}cleanupOldSessions(s){const t=this.getSessionIndex(s),n=Date.now();t.forEach(r=>{const c=localStorage.getItem(this.SESSION_PREFIX+r);if(c)try{const g=JSON.parse(c);g.expiresAt<n&&this.removeSession(g.id)}catch{this.removeSession(r)}})}isSessionValid(s,t){return this.getLatestAnalysisSession(s,t)!==null}getSessionAge(s,t){const n=this.getLatestAnalysisSession(s,t);if(!n)return 0;const c=Date.now()-n.timestamp;return Math.floor(c/(1e3*60*60))}}const mt=new as,is="llm_qa_sessions",ls="llm_qa_current_session";function st({title:a,icon:s,iconBgColor:t,children:n}){return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a}),e.jsx("div",{className:`w-10 h-10 rounded-full ${t} flex items-center justify-center`,children:s})]}),n]})}function cs({competitors:a,company:s}){const n=(()=>{if(!a||a.length===0)return{positive:0,neutral:0,negative:0,total:0,drivers:{positive:[],neutral:[],negative:[]}};let g=0,y=0,m=0,p=0;const A=[],w=[],l=[];a.forEach(v=>{const L=(v.breakdowns||{}).gemini||{},F=L.mentionsScore||0,J=L.sentimentScore||.5;g+=F,J<.3?(p+=F,l.push(v.name||"Unknown")):J>.7?(y+=F,A.push(v.name||"Unknown")):(m+=F,w.push(v.name||"Unknown"))});let i=g>0?y/g*100:0,x=g>0?m/g*100:0,j=g>0?p/g*100:0;return j===100&&(x=80,j=20,i=0),{positive:Math.round(i*100)/100,neutral:Math.round(x*100)/100,negative:Math.round(j*100)/100,total:g,drivers:{positive:A.slice(0,3),neutral:w.slice(0,3),negative:l.slice(0,3)}}})(),r=n.neutral>n.positive&&n.neutral>n.negative?"Neutral":n.positive>n.negative?"Positive":"Negative",c=r==="Positive"?"text-green-600":r==="Negative"?"text-red-600":"text-yellow-600";return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sentiment Analysis"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsx("div",{className:`text-2xl font-bold ${c}`,children:r})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Positive"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${n.positive}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[n.positive,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Neutral"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:`${n.neutral}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[n.neutral,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Negative"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${n.negative}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[n.negative,"%"]})]})]})]})]})]})}function ds({score:a,industry:s,metrics:t}){const r=(m=>{const p=Math.max(0,Math.min(10,m));return Math.round(p*10)})(a),c=m=>m>=80?"text-green-600":m>=60?"text-blue-600":m>=40?"text-yellow-600":"text-red-600",g=m=>m>=80?"bg-green-500":m>=60?"bg-blue-500":m>=40?"bg-yellow-500":"bg-red-500",y=m=>m>=80?"Excellent":m>=60?"Good":m>=40?"Fair":"Poor";return e.jsx(st,{title:"AI Visibility Score",icon:e.jsx(Xe,{className:"w-5 h-5 text-white"}),iconBgColor:"bg-green-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-4xl font-bold ${c(r)} mb-2`,children:r}),e.jsx("div",{className:"text-gray-600 mb-2",children:"out of 100"}),e.jsx("div",{className:`text-lg font-semibold ${c(r)} mb-3`,children:y(r)}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full ${g(r)} transition-all duration-500`,style:{width:`${Math.min(100,Math.max(0,r))}%`}})})]})})}function us({serviceStatus:a,aiScores:s}){const t=[{name:"ChatGPT",key:"chatgpt",icon:e.jsx(ke,{className:"w-4 h-4"})},{name:"Gemini",key:"gemini",icon:e.jsx(ke,{className:"w-4 h-4"})},{name:"Perplexity",key:"perplexity",icon:e.jsx(ke,{className:"w-4 h-4"})},{name:"Claude",key:"claude",icon:e.jsx(ke,{className:"w-4 h-4"})}],r=(()=>{const c={chatgpt:!1,gemini:!1,perplexity:!1,claude:!1};return s&&(c.chatgpt=s.chatgpt!==void 0&&s.chatgpt>0,c.gemini=s.gemini!==void 0&&s.gemini>0,c.perplexity=s.perplexity!==void 0&&s.perplexity>0,c.claude=s.claude!==void 0&&s.claude>0),c})();return t.filter(c=>r[c.key]).length,e.jsx(st,{title:"LLM Presence",icon:e.jsx(Ot,{className:"w-5 h-5 text-white"}),iconBgColor:"bg-blue-500",children:e.jsx("div",{className:"space-y-3",children:t.map(c=>{const g=r[c.key];return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:c.name}),e.jsx("div",{className:`flex items-center ${g?"text-green-600":"text-red-600"}`,children:g?e.jsxs(e.Fragment,{children:[c.icon,e.jsx("span",{className:"ml-1 text-sm",children:"Available"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-1 text-sm",children:"Not Available"})]})})]},c.key)})})})}function gs({competitors:a,industry:s}){const n=(r=>{if(!r||r.length===0)return{status:"No Data",rank:"N/A",color:"text-gray-500",score:0,rawScore:0};const c=r.reduce((y,m)=>y+(m.totalScore||0),0)/r.length,g=Math.round(c*10);return g>=80?{status:"Excellent",rank:"Top 10%",color:"text-purple-600",score:g,rawScore:c}:g>=70?{status:"Above Average",rank:"Top 25%",color:"text-blue-600",score:g,rawScore:c}:g>=60?{status:"Average",rank:"Top 50%",color:"text-yellow-600",score:g,rawScore:c}:g>=50?{status:"Below Average",rank:"Bottom 50%",color:"text-orange-600",score:g,rawScore:c}:{status:"Poor",rank:"Bottom 25%",color:"text-red-600",score:g,rawScore:c}})(a);return Math.min(5,Math.max(1,Math.ceil((a?.length||0)/2))),e.jsx(st,{title:"Competitor Benchmark",icon:e.jsx(Ze,{className:"w-5 h-5 text-white"}),iconBgColor:"bg-purple-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${n.color} mb-2`,children:n.status}),e.jsxs("div",{className:"text-lg font-semibold text-gray-700 mb-3",children:["Score: ",n.score,"/100"]})]})})}function js(){const{user:a}=rs(),[s]=tt(is,[]);tt(ls,null),It();const[t,n]=S.useState(()=>{try{const f=localStorage.getItem("overview_market_analysis");return f&&JSON.parse(f).originalInput||""}catch{return""}}),[r,c]=S.useState("root-domain"),[g,y]=S.useState(!1),[m,p]=S.useState(()=>{try{const f=localStorage.getItem("overview_market_analysis");return f&&JSON.parse(f).inputType||"company"}catch{return"company"}}),[A,w]=S.useState(()=>{try{const f=localStorage.getItem("overview_market_analysis");if(f){const T=JSON.parse(f);return T.data||T}return null}catch{return null}}),[l,i]=S.useState(null),[x,j]=S.useState(!1),[v,I]=S.useState(null),[L,F]=S.useState(!1),[J,W]=S.useState(!1),[V,oe]=S.useState(""),[k,N]=S.useState(!1),[$,R]=S.useState(!1),[E,_]=S.useState([]),[U,q]=S.useState(0),[ne,ee]=S.useState(!1);S.useEffect(()=>{const f=ce.getHistoryItems();_(f),console.log("[Overview] Loaded history items:",f.length)},[U]),S.useEffect(()=>{const f=mt.getLatestAnalysisSession("overview",a?.id);f?(n(f.inputValue||""),p(f.inputType||"company"),w(f.data),console.log("[Overview] Restored analysis session:",f)):console.log("[Overview] No previous analysis session found - starting fresh")},[a?.id]);const[re,Q]=S.useState(!1);S.useEffect(()=>{const f=mt.getLatestAnalysisSession("overview",a?.id);Q(!f)},[a?.id]),S.useEffect(()=>{const f=d=>{(d.key==="comprehensive_history"||d.key==="sessions")&&(console.log("[Overview] Storage changed, refreshing data"),q(z=>z+1))};window.addEventListener("storage",f);const T=setInterval(()=>{ce.getHistoryItems().length!==E.length&&(console.log("[Overview] Item count changed, refreshing data"),q(z=>z+1))},3e3);return()=>{window.removeEventListener("storage",f),clearInterval(T)}},[E.length]),S.useEffect(()=>{const f=T=>{T.target.closest(".dropdown-container")||F(!1)};return document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[]),a&&s.filter(f=>f.userId===a.id);const K=f=>{try{const d=f.replace(/^https?:\/\//,"").replace(/^www\./,"").split("/"),z=d[0];return d.length===1||d.length>1&&d[1].trim()===""?"root-domain":"exact-url"}catch(T){return console.error("Error detecting URL type:",T),"root-domain"}},Z=f=>{try{let T=f.replace(/^https?:\/\//,"").replace(/^www\./,"");T=T.split("/")[0].split("?")[0].split("#")[0];const d=T.split(".");return d.length>=2?d[d.length-2]:T}catch(T){return console.error("Error extracting company from URL:",T),f}},ue=(f,T)=>{const d=f.toLowerCase();return T?.toLowerCase(),d.includes("cloud")&&(d.includes("migration")||d.includes("migrate")||d.includes("transform"))?"Cloud Migration & Transformation":d.includes("cloud")||d.includes("aws")||d.includes("azure")||d.includes("gcp")||d.includes("kubernetes")||d.includes("docker")||d.includes("devops")?"Cloud Computing & DevOps":d.includes("ai")||d.includes("artificial intelligence")||d.includes("machine learning")||d.includes("ml")||d.includes("deep learning")||d.includes("neural")?"Artificial Intelligence & ML":d.includes("cyber")||d.includes("security")||d.includes("firewall")||d.includes("vpn")||d.includes("threat")||d.includes("protection")?"Cybersecurity":d.includes("data")&&(d.includes("analytics")||d.includes("warehouse")||d.includes("lake")||d.includes("science")||d.includes("mining"))?"Data Analytics & Science":d.includes("saas")||d.includes("software as a service")||d.includes("platform")||d.includes("api")||d.includes("integration")?"SaaS & Platform Services":d.includes("tech")||d.includes("software")||d.includes("digital")||d.includes("innovation")?"Technology & Software":d.includes("bank")||d.includes("finance")||d.includes("credit")||d.includes("loan")||d.includes("payment")||d.includes("fintech")||d.includes("investment")?"Financial Services & Fintech":d.includes("health")||d.includes("medical")||d.includes("pharma")||d.includes("care")||d.includes("biotech")||d.includes("telehealth")?"Healthcare & Biotech":d.includes("retail")||d.includes("shop")||d.includes("store")||d.includes("commerce")||d.includes("ecommerce")||d.includes("marketplace")?"Retail & E-commerce":d.includes("edu")||d.includes("school")||d.includes("university")||d.includes("college")||d.includes("learning")||d.includes("training")?"Education & Training":d.includes("media")||d.includes("news")||d.includes("entertainment")||d.includes("tv")||d.includes("content")||d.includes("publishing")?"Media & Entertainment":d.includes("auto")||d.includes("car")||d.includes("vehicle")||d.includes("transport")||d.includes("logistics")||d.includes("supply chain")?"Automotive & Transportation":d.includes("food")||d.includes("restaurant")||d.includes("cafe")||d.includes("dining")||d.includes("delivery")||d.includes("catering")?"Food & Beverage":d.includes("real")||d.includes("estate")||d.includes("property")||d.includes("housing")||d.includes("construction")||d.includes("architecture")?"Real Estate & Construction":d.includes("energy")||d.includes("oil")||d.includes("gas")||d.includes("power")||d.includes("renewable")||d.includes("solar")||d.includes("wind")?"Energy & Utilities":d.includes("consulting")||d.includes("consultant")||d.includes("advisory")||d.includes("strategy")||d.includes("management")?"Consulting & Advisory":"Business Services"},be=async()=>{if(!t.trim()){i("Please enter a company name or URL to analyze.");return}let f=t.trim(),T="company";(t.includes("http://")||t.includes("https://")||t.includes("www."))&&(f=Z(t),T="url",console.log("[Overview] Detected URL, extracted company name:",f));const d=ue(f,t);console.log("[Overview] Detected industry:",d),y(!0),i(null),j(!1);try{const z=new AbortController;I(z),console.log("[Overview] Starting AI visibility analysis for:",f),console.log("[Overview] Detected industry:",d);const G=await Ie.getAIVisibilityAnalysis(f,d,{signal:z.signal});if(console.log("[Overview] Analysis results received:",G),G.success&&G.data){console.log("[Overview] Setting analysis result:",G.data);const ie={...G.data,industry:d,originalInput:t,inputType:T,analysisType:r};w(ie),j(!0);try{const te=G.data.competitors||[],le={id:`ai-visibility-${Date.now()}`,type:"ai-visibility",name:`AI Visibility Analysis - ${f}`,timestamp:new Date().toISOString(),status:"completed",company:f,industry:d,analysis:{competitors:te.map(X=>({name:X.name,mentions:X.mentions||0,status:"success"})),serviceStatus:G.data.serviceStatus||{gemini:!0,perplexity:!0,claude:!0,chatgpt:!0},summary:{totalCompetitors:te.length,averageVisibilityScore:te.reduce((X,ge)=>X+(ge.mentions||0),0)/Math.max(te.length,1),topCompetitor:te.length>0?te.reduce((X,ge)=>(ge.mentions||0)>(X.mentions||0)?ge:X).name:"None"}}};try{await ce.addHistoryItem(le),window.dispatchEvent(new CustomEvent("new-analysis-created",{detail:{type:"ai-visibility",timestamp:new Date().toISOString()}})),console.log("[Overview] Analysis saved to history:",le)}catch(X){console.error("[Overview] Failed to save analysis to history:",X),window.dispatchEvent(new CustomEvent("new-analysis-created",{detail:{type:"ai-visibility",timestamp:new Date().toISOString()}}))}}catch(te){console.warn("Failed to save analysis to history:",te)}try{localStorage.setItem("overview_market_analysis",JSON.stringify({company:f,originalInput:t,inputType:T,industry:d,analysisType:r,data:ie,timestamp:Date.now()}))}catch(te){console.warn("Failed to cache analysis results:",te)}}else console.error("[Overview] Analysis failed:",G.error),i(G.error||"Analysis failed. Please try again.")}catch(z){if(z.name==="AbortError"){console.log("Analysis was cancelled");return}console.error("AI analysis error:",z),i(z.message||"Analysis failed. Please try again.")}finally{y(!1),I(null)}},Fe=f=>{if(f?.aiVisibilityScore!==void 0&&f?.aiVisibilityScore!==null)return f.aiVisibilityScore;if(f?.totalScore!==void 0&&f?.totalScore!==null)return f.totalScore;if(f?.visibilityScore!==void 0&&f?.visibilityScore!==null)return f.visibilityScore;if(f?.competitors&&f.competitors.length>0){const T=f.competitors.find(z=>z.name?.toLowerCase()===f.company?.toLowerCase());if(T?.totalScore!==void 0&&T?.totalScore!==null)return T.totalScore;const d=f.competitors.filter(z=>z.totalScore!==void 0&&z.totalScore!==null).map(z=>z.totalScore);if(d.length>0)return d.reduce((G,ie)=>G+ie,0)/d.length}return 0},ve=f=>{if(!f?.competitors||f.competitors.length===0)return null;const T=f.competitors.find(X=>X.name?.toLowerCase()===f.company?.toLowerCase());if(!T)return null;const d=T.totalScore||0,z=T.aiScores||{},G=T.breakdowns||{},ie=Object.values(z).filter(X=>typeof X=="number"),te=ie.length>0?ie.reduce((X,ge)=>X+ge,0)/ie.length:0,le=G.gemini||{};return{aiVisibilityScore:Math.min(10,Math.max(0,d)),brandMentions:Number((le.mentionsScore||0).toFixed(5)),medianCompetitorMentions:Number((Math.round(te*10)/10).toFixed(5)),shareOfVoice:Number((Math.round(d/10*100*100)/100).toFixed(5)),averagePosition:Number((le.positionScore||0).toFixed(5)),searchVolume:"N/A",sentiment:le.sentimentScore>.5?"Positive":le.sentimentScore<.3?"Negative":"Neutral",platformBreakdown:z,totalMentions:Number((le.mentionsScore||0).toFixed(5))}},we=f=>f>=2.5?"bg-green-500":f>=1.5?"bg-yellow-500":"bg-red-500",he=f=>f>=2.5?"text-green-600 font-semibold":f>=1.5?"text-yellow-600 font-semibold":"text-red-600 font-semibold",me=f=>f.toFixed(4),pe=f=>{const T=A?.competitors?.[f]?.name;if(window.confirm(`Are you sure you want to remove "${T}" from the analysis?`)){const d=A?.competitors?.filter((z,G)=>G!==f)||[];w({...A,competitors:d})}};return e.jsxs("div",{className:"w-full max-w-full mx-auto space-y-6 lg:space-y-8 px-2 sm:px-4 lg:px-6",children:[e.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-start gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:["Welcome ",a?.displayName?.split(" ")[0]||a?.name?.split(" ")[0]||"User"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Welcome to kabini.ai - Your AI-Powered Content Enhancement Platform"})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 sm:p-6 lg:p-8 shadow-sm",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Website Analysis Dashboard"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Enter your website URL or company name to get instant AI visibility insights and market positioning."})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row items-stretch gap-4 mb-8",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"flex",children:e.jsx("input",{type:"text",value:t,onChange:f=>kt(f,T=>{if(n(T),T.includes("http://")||T.includes("https://")||T.includes("www.")){const d=K(T);c(d),console.log("[Overview] Auto-detected URL type:",d)}}),onPaste:f=>jt(f,T=>{if(n(T),T.includes("http://")||T.includes("https://")||T.includes("www.")){const d=K(T);c(d),console.log("[Overview] Auto-detected URL type (pasted):",d)}}),onKeyDown:Ct,onKeyPress:f=>{f.key==="Enter"&&!g&&t.trim()&&be()},required:!0,placeholder:"Enter company name or URL",className:"flex-1 px-4 py-4 border-2 border-blue-600 rounded-l-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg h-[60px]",disabled:g})})}),e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-stretch",children:[e.jsx("button",{onClick:be,disabled:g||!t.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-8 py-4 rounded-xl font-medium flex items-center justify-center gap-2 transition-colors shadow-lg w-full lg:w-auto min-w-[140px] h-[60px]",children:g?e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"w-5 h-5"}),"Analyze Now"]})}),g&&e.jsx("button",{onClick:()=>{try{v?.abort()}catch{}y(!1)},className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors w-full lg:w-auto min-w-[120px] h-[60px]",children:"Stop"})]})]}),l&&e.jsx("div",{className:"mb-6 text-red-700 bg-red-50 border border-red-200 rounded-lg px-4 py-3",children:l}),x&&e.jsx("div",{className:"mb-6 text-green-700 bg-green-50 border border-green-200 rounded-lg px-4 py-3",children:"✅ Analysis completed successfully! Results are ready below."}),A&&e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Overview"})}),A&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 lg:gap-6 mb-6 lg:mb-8",children:[e.jsx(ds,{score:Fe(A),industry:A?.industry,metrics:ve(A)}),e.jsx(us,{serviceStatus:A?.serviceStatus,aiScores:A?.competitors?.[0]?.aiScores}),e.jsx(gs,{competitors:A?.competitors||[],industry:A?.industry}),e.jsx(cs,{competitors:A?.competitors||[],company:A?.company})]}),e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Competitor Analysis"})}),A.competitors&&A.competitors.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Competitor Performance Overview"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visual comparison of average AI visibility scores across competitors"})]}),e.jsx("div",{className:"h-48 sm:h-56 lg:h-64 flex items-end justify-between space-x-1 sm:space-x-2",children:A.competitors.map((f,T)=>{const d=f.totalScore||0,z=Math.min(100,Math.max(5,d/10*100)),G=we(d);return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full max-w-12 sm:max-w-16 bg-gray-200 rounded-t-lg relative",children:e.jsx("div",{className:`${G} rounded-t-lg transition-all duration-500 ease-out`,style:{height:`${z}%`,minHeight:"20px"},children:e.jsx("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 text-xs font-medium text-gray-700 whitespace-nowrap",children:me(d)})})}),e.jsx("div",{className:"mt-2 text-xs text-gray-600 text-center font-medium truncate w-full",children:f.name})]},T)})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("div",{className:"inline-flex items-center flex-wrap justify-center gap-2 sm:gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded mr-1"}),e.jsx("span",{children:"Excellent (8-10)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded mr-1"}),e.jsx("span",{children:"Good (6-7.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded mr-1"}),e.jsx("span",{children:"Fair (4-5.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded mr-1"}),e.jsx("span",{children:"Poor (0-3.9)"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Competitors Comparison"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detailed scoring breakdown for each company across multiple models"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gemini"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Perplexity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Claude"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ChatGPT"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Average Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.competitors.map((f,T)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-black",children:f.name.charAt(0).toUpperCase()})})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${we(f.aiScores.gemini)}`,children:me(f.aiScores.gemini)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${we(f.aiScores.perplexity)}`,children:me(f.aiScores.perplexity)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${we(f.aiScores.claude)}`,children:me(f.aiScores.claude)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${we(f.aiScores.chatgpt)}`,children:me(f.aiScores.chatgpt)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`text-sm font-semibold ${he(f.totalScore)}`,children:me(f.totalScore)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>pe(T),className:"text-red-600 hover:text-red-900 bg-red-50 hover:bg-red-100 p-2 rounded-full transition-colors",title:"Delete competitor",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},T))})]})})]})]})]})]})}class hs{async analyzeContentStructure(s,t){try{console.log("[ContentStructureService] Calling API with:",{contentLength:s.length,url:t});const n=await Ie.analyzeContentStructure(s,t);if(console.log("[ContentStructureService] Raw API response:",n),console.log("[ContentStructureService] Response type:",typeof n),console.log("[ContentStructureService] Response keys:",n?Object.keys(n):"No response"),n&&n.success&&n.analysis)return console.log("[ContentStructureService] Using response.analysis (success case)"),n.analysis;if(n&&n.analysis)return console.log("[ContentStructureService] Using response.analysis (no success field)"),n.analysis;throw n&&!n.success?(console.error("[ContentStructureService] API returned error:",n.error),new Error(n.error||"Analysis failed")):(console.error("[ContentStructureService] Invalid response format:",n),new Error("Invalid response format from server"))}catch(n){throw console.error("[ContentStructureService] Error analyzing content structure:",n),n}}async applyStructureSuggestions(s,t){try{const n=await Ie.applyStructureSuggestions(s,t);if(n.success)return n.improvedContent;throw new Error(n.error||"Failed to apply suggestions")}catch(n){return console.error("Error applying structure suggestions:",n),s}}}const pt=new hs;function ms({initialType:a="article"}){const[s,t]=S.useState(a),[n,r]=S.useState({url:"",articleType:"Article",headline:"",description:"",images:[""],authorType:"",authorName:"",authorUrl:"",publisherName:"",publisherLogo:"",datePublished:"",dateModified:""}),[c,g]=S.useState({name:"",url:"",image:"",jobTitle:"",worksFor:"",sameAsList:[]}),[y,m]=S.useState([{question:"",answer:""}]),p=S.useMemo(()=>{if(s==="article"){const j=(n.images||[]).map(F=>F.trim()).filter(Boolean),v=j.length>0?j[0]:"",I=n.authorType||"",L={"@context":"https://schema.org","@type":n.articleType,headline:n.headline||"",description:n.description||"",image:v,author:{"@type":I,name:n.authorName||""},publisher:{"@type":"Organization",name:n.publisherName||"",logo:{"@type":"ImageObject",url:n.publisherLogo||""}},datePublished:n.datePublished||""};return n.authorUrl&&(L.author.url=n.authorUrl),n.dateModified&&(L.dateModified=n.dateModified),L}if(s==="author"){const j={"@context":"https://schema.org/","@type":"Person",name:c.name||""};return c.url&&(j.url=c.url),c.image&&(j.image=c.image),c.jobTitle&&(j.jobTitle=c.jobTitle),c.worksFor&&(j.worksFor={"@type":"Organization",name:c.worksFor}),(c.sameAsList||[]).length&&(j.sameAs=c.sameAsList),j}const i=(y&&y.length>0?y:[{question:"",answer:""}]).map(j=>({"@type":"Question",name:j.question||"",acceptedAnswer:{"@type":"Answer",text:j.answer||""}}));return{"@context":"https://schema.org","@type":"FAQPage",mainEntity:i.length===1?i[0]:i}},[s,n,c,y]),A=S.useMemo(()=>JSON.stringify(p,null,2),[p]),w=async()=>{const i=`<script type="application/ld+json">
${A}
<\/script>`;try{await navigator.clipboard.writeText(i),alert("JSON-LD copied to clipboard")}catch{alert("Failed to copy")}},l=()=>{s==="article"?r({url:"",articleType:"Article",headline:"",description:"",images:[""],authorType:"",authorName:"",authorUrl:"",publisherName:"",publisherLogo:"",datePublished:"",dateModified:""}):s==="author"?g({name:"",url:"",image:"",jobTitle:"",worksFor:"",sameAsList:[]}):s==="faq"&&m([{question:"",answer:""}])};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col lg:flex-row gap-4 lg:items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Schema Type"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-3 py-2 text-sm",value:s,onChange:i=>t(i.target.value),children:[e.jsx("option",{value:"article",children:"Article"}),e.jsx("option",{value:"author",children:"Author"}),e.jsx("option",{value:"faq",children:"FAQ"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 space-y-4",children:[s==="article"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Article @type"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",value:n.articleType,onChange:i=>r({...n,articleType:i.target.value}),children:[e.jsx("option",{value:"Article",children:"Article"}),e.jsx("option",{value:"NewsArticle",children:"NewsArticle"}),e.jsx("option",{value:"BlogPosting",children:"BlogPosting"})]})]}),e.jsx(ae,{label:"URL",value:n.url,onChange:i=>r({...n,url:i}),placeholder:"https://example.com/article"}),e.jsx(ae,{label:"Headline",value:n.headline,onChange:i=>r({...n,headline:i}),maxLength:110})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Images"}),e.jsx("div",{className:"space-y-2",children:n.images.map((i,x)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"https://example.com/image.jpg",value:i,onChange:j=>r({...n,images:n.images.map((v,I)=>I===x?j.target.value:v)})}),e.jsx("button",{type:"button",className:"text-xs border border-gray-300 rounded px-2 py-1 hover:bg-gray-50",onClick:()=>r({...n,images:n.images.map((j,v)=>v===x?"":j)}),children:"Clear"}),n.images.length>1&&e.jsx("button",{type:"button",className:"text-xs text-red-600 hover:underline",onClick:()=>r({...n,images:n.images.filter((j,v)=>v!==x)}),children:"Remove"})]},x))}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-md border border-gray-300 px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>r({...n,images:[...n.images,""]}),children:"+ Image"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Short description of the article"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm min-h-[96px]",value:n.description,onChange:i=>r({...n,description:i.target.value}),placeholder:"Short description of the article"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Author @type"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",value:n.authorType,onChange:i=>r({...n,authorType:i.target.value}),children:[e.jsx("option",{value:"Person",children:"Person"}),e.jsx("option",{value:"Organization",children:"Organization"})]})]}),e.jsx(ae,{label:"Author Name",value:n.authorName,onChange:i=>r({...n,authorName:i})}),e.jsx(ae,{label:"Author URL",value:n.authorUrl,onChange:i=>r({...n,authorUrl:i}),placeholder:"https://example.com/author"}),e.jsx(ae,{label:"Publisher Name",value:n.publisherName,onChange:i=>r({...n,publisherName:i})}),e.jsx(ae,{label:"Publisher Logo",value:n.publisherLogo,onChange:i=>r({...n,publisherLogo:i}),placeholder:"https://example.com/logo.png"}),e.jsx(ae,{label:"Date Published",value:n.datePublished,onChange:i=>r({...n,datePublished:i}),placeholder:"YYYY-MM-DD"}),e.jsx(ae,{label:"Date Modified",value:n.dateModified,onChange:i=>r({...n,dateModified:i}),placeholder:"YYYY-MM-DD"})]})]}),s==="author"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(ae,{label:"Name",value:c.name,onChange:i=>g({...c,name:i})}),e.jsx(ae,{label:"URL",value:c.url,onChange:i=>g({...c,url:i}),placeholder:"https://example.com/author"}),e.jsx(ae,{label:"Image URL",value:c.image,onChange:i=>g({...c,image:i}),placeholder:"https://example.com/photo.jpg"}),e.jsx(ae,{label:"Job Title",value:c.jobTitle,onChange:i=>g({...c,jobTitle:i})}),e.jsx(ae,{label:"Works For",value:c.worksFor,onChange:i=>g({...c,worksFor:i})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Social Profiles"}),e.jsx(ps,{values:c.sameAsList,onChange:i=>g({...c,sameAsList:i})})]})]}),s==="faq"&&e.jsxs("div",{className:"space-y-4",children:[y.map((i,x)=>e.jsxs("div",{className:"border rounded-md p-3 space-y-3 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:["Question #",x+1]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{type:"button",className:"text-xs text-red-600 hover:underline",onClick:()=>m(j=>j.filter((v,I)=>I!==x)),disabled:y.length===1,children:"Remove"})})]}),e.jsx(ae,{label:"Question",value:i.question,onChange:j=>m(v=>v.map((I,L)=>L===x?{...I,question:j}:I))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Answer"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm min-h-[96px]",value:i.answer,onChange:j=>m(v=>v.map((I,L)=>L===x?{...I,answer:j.target.value}:I)),placeholder:"This is the answer to the question..."})]})]},x)),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-md border border-gray-300 px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>m(i=>[...i,{question:"",answer:""}]),children:"Add Question"})]})]}),e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:w,title:"Copy JSON-LD","aria-label":"Copy JSON-LD",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white p-2 text-sm hover:bg-gray-100",children:e.jsx(bt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:l,title:"Clear","aria-label":"Clear",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white p-2 text-sm hover:bg-gray-100 text-red-600",children:e.jsx($t,{className:"w-4 h-4"})}),e.jsx("a",{href:"https://search.google.com/test/rich-results",target:"_blank",rel:"noreferrer",title:"Open Rich Results Test","aria-label":"Open Rich Results Test",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white p-2 text-sm hover:bg-gray-100",children:e.jsx(Rt,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono whitespace-pre",children:`<script type="application/ld+json">
${A}
<\/script>`})]})]})]})}function ae({label:a,value:s,onChange:t,placeholder:n,maxLength:r}){const c=typeof r=="number"?`${s.length}/${r}`:void 0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:a}),c&&e.jsx("span",{className:"text-[11px] text-gray-500",children:c})]}),e.jsx("input",{type:"text",value:s,onChange:g=>t(r?g.target.value.slice(0,r):g.target.value),placeholder:n,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]})}function ps({values:a,onChange:s}){const[t,n]=S.useState(""),r=()=>{const g=t.trim();g&&(s([...a||[],g]),n(""))},c=g=>s(a.filter((y,m)=>m!==g));return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"https://twitter.com/..., https://linkedin.com/in/...",value:t,onChange:g=>n(g.target.value)}),e.jsx("button",{type:"button",onClick:r,className:"inline-flex items-center justify-center rounded-md border border-gray-300 px-3 py-2 text-sm hover:bg-gray-50",children:"Add"})]}),!!a?.length&&e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map((g,y)=>e.jsxs("span",{className:"inline-flex items-center gap-2 text-xs bg-white border rounded px-2 py-1",children:[g,e.jsx("button",{type:"button",className:"text-red-600",onClick:()=>c(y),children:"×"})]},y))})]})}const ys=({message:a,onClose:s,autoClose:t=!0,autoCloseDelay:n=3e3,type:r="success"})=>{const[c,g]=S.useState(!1),m=(A=>{switch(A){case"success":return{bg:"bg-green-50",border:"border-green-200",icon:"text-green-500",title:"text-green-800",message:"text-green-700",closeButton:"text-green-400 hover:text-green-600",closeButtonFocus:"focus:ring-green-500",progressBg:"bg-green-200",progressBar:"bg-green-500",iconComponent:ke,titleText:"Success"};case"error":return{bg:"bg-red-50",border:"border-red-200",icon:"text-red-500",title:"text-red-800",message:"text-red-700",closeButton:"text-red-400 hover:text-red-600",closeButtonFocus:"focus:ring-red-500",progressBg:"bg-red-200",progressBar:"bg-red-500",iconComponent:vt,titleText:"Error"};case"warning":return{bg:"bg-yellow-50",border:"border-yellow-200",icon:"text-yellow-500",title:"text-yellow-800",message:"text-yellow-700",closeButton:"text-yellow-400 hover:text-yellow-600",closeButtonFocus:"focus:ring-yellow-500",progressBg:"bg-yellow-200",progressBar:"bg-yellow-500",iconComponent:Ut,titleText:"Warning"};case"info":return{bg:"bg-blue-50",border:"border-blue-200",icon:"text-blue-500",title:"text-blue-800",message:"text-blue-700",closeButton:"text-blue-400 hover:text-blue-600",closeButtonFocus:"focus:ring-blue-500",progressBg:"bg-blue-200",progressBar:"bg-blue-500",iconComponent:et,titleText:"Info"};default:return{bg:"bg-green-50",border:"border-green-200",icon:"text-green-500",title:"text-green-800",message:"text-green-700",closeButton:"text-green-400 hover:text-green-600",closeButtonFocus:"focus:ring-green-500",progressBg:"bg-green-200",progressBar:"bg-green-500",iconComponent:ke,titleText:"Success"}}})(r),p=m.iconComponent;return S.useEffect(()=>{if(a){if(g(!0),t){const A=setTimeout(()=>{g(!1),setTimeout(s,300)},n);return()=>clearTimeout(A)}}else g(!1)},[a,t,n,s]),a?e.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full",children:e.jsx("div",{className:`transform transition-all duration-300 ease-in-out ${c?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"}`,children:e.jsxs("div",{className:`${m.bg} border ${m.border} rounded-lg shadow-lg p-4 relative`,children:[e.jsx("button",{onClick:()=>{g(!1),setTimeout(s,300)},className:`absolute top-2 right-2 ${m.closeButton} transition-colors focus:outline-none focus:ring-2 ${m.closeButtonFocus} focus:ring-offset-2 rounded-full p-1`,"aria-label":`Close ${r} notification`,children:e.jsx(_t,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-start gap-3 pr-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(p,{className:`w-5 h-5 ${m.icon}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-sm font-semibold ${m.title} mb-1`,children:m.titleText}),e.jsx("p",{className:`text-sm ${m.message} leading-relaxed`,children:a})]})]}),t&&e.jsx("div",{className:`mt-3 h-1 ${m.progressBg} rounded-full overflow-hidden`,children:e.jsx("div",{className:`h-full ${m.progressBar} rounded-full transition-all duration-300 ease-linear`,style:{width:c?"0%":"100%",transitionDuration:`${n}ms`}})})]})})}):null},Me=()=>{const a=B.getCurrentUserId();return a?`structure_analysis_state_${a}`:"structure_analysis_state_anonymous"},fs=()=>{const a=B.getCurrentUserId();return a?`comprehensive_history_${a}`:"comprehensive_history_anonymous"},xs=()=>{const a=B.getCurrentUserId();return a?`structure_last_saved_${a}`:"structure_last_saved_anonymous"},Ce=()=>{const a=B.getCurrentUserId();return a?`structure_last_persisted_${a}`:"structure_last_persisted_anonymous"},yt=a=>{let s=0;if(a.length===0)return s.toString();for(let t=0;t<a.length;t++){const n=a.charCodeAt(t);s=(s<<5)-s+n,s=s&s}return s.toString()};function Cs({content:a,url:s}){const[t,n]=S.useState(null),[r,c]=S.useState(!1),[g,y]=S.useState(""),[m,p]=S.useState(!1),[A,w]=S.useState("overview"),[l,i]=S.useState("landing"),[x,j]=S.useState("schema"),[v,I]=S.useState(s||""),[L,F]=S.useState(null),[J,W]=S.useState(!1),[V,oe]=S.useState(a||""),[k,N]=S.useState(""),[$,R]=S.useState("landing"),[E,_]=S.useState(""),[U,q]=S.useState(!1),[ne,ee]=S.useState(!1),[re,Q]=S.useState(Date.now()),[K,Z]=S.useState(!0),[ue,be]=S.useState(!1),[Fe,ve]=S.useState(!1),[we,he]=S.useState(!0),[me,pe]=S.useState(!1);tt(fs(),[]);const[f,T]=S.useState(null),[d,z]=S.useState(null),[G,ie]=S.useState(!1),[te,le]=S.useState(!1),[X,ge]=S.useState(!1),Se=S.useRef(Promise.resolve()),De=o=>(Se.current=Se.current.then(o).catch(()=>{}),Se.current),Le=()=>{if(!d)return null;const o=()=>{switch(d.type){case"success":return"✅";case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"ℹ️"}},u=()=>{switch(d.type){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}};return e.jsx("div",{className:`fixed top-4 right-4 z-50 max-w-md p-4 rounded-lg border-2 shadow-lg ${u()}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-2xl mr-3",children:o()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:d.title}),e.jsx("p",{className:"text-sm mb-3",children:d.message}),d.appliedCount!==void 0&&d.totalCount!==void 0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Progress:"}),e.jsxs("span",{children:[d.appliedCount,"/",d.totalCount," suggestions"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${d.appliedCount/d.totalCount*100}%`}})})]}),d.details&&d.details.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Applied Changes:"}),e.jsx("ul",{className:"text-xs space-y-1",children:d.details.map((h,D)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"•"}),h]},D))})]}),d.suggestions&&d.suggestions.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Available Suggestions:"}),e.jsxs("div",{className:"text-xs space-y-1 max-h-32 overflow-y-auto",children:[d.suggestions.slice(0,5).map((h,D)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-500 mr-2 mt-1",children:"•"}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[h.type,":"]}),e.jsx("span",{className:"ml-1",children:h.description})]})]},D)),d.suggestions.length>5&&e.jsxs("div",{className:"text-gray-500 italic",children:["... and ",d.suggestions.length-5," more suggestions"]})]})]})]}),e.jsx("button",{onClick:()=>z(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"✕"})]})})},ye=S.useRef(""),He=(o,u,h)=>{console.log("[Content Analysis] saveToHistory called with:",{hasAnalysisResult:!!o,contentLength:u?.length||0,urlToAnalyze:h,analysisResultKeys:o?Object.keys(o):[]});try{if(!o){console.error("[Content Analysis] No analysis result provided to saveToHistory");return}if(!u){console.error("[Content Analysis] No content provided to saveToHistory");return}console.log("[Content Analysis] Preparing history item with data:",{id:`structure-analysis-${Date.now()}`,name:`Structure Analysis${h?` - ${h}`:""}`,contentLength:u.length,suggestionsCount:o.suggestions?.length||0,hasMetadata:!!o.metadata,hasStructuredContent:!!o.structuredContent});const D=o.suggestions?.filter(C=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(C.type)).map(C=>({type:C.type,priority:C.priority,description:C.description,implementation:C.implementation,impact:C.impact}))||[];console.log("[Content Analysis] Filtered suggestions:",D.length);const O={id:`structure-analysis-${Date.now()}`,name:`Structure Analysis${h?` - ${h}`:""}`,originalContent:u,structuredContent:o.structuredContent||"",analysis:{seoScore:o.seoScore||0,llmOptimizationScore:o.llmOptimizationScore||0,readabilityScore:o.readabilityScore||0,structuredData:o.structuredData,fullPageHtml:o.fullPageHtml,pageTitle:o.pageTitle,pageDescription:o.pageDescription,geoScoreTotal:o.geoScoreTotal||0,geoBreakdown:o.geoBreakdown||{},contentQualityScoreTotal:o.contentQualityScoreTotal||0,contentQualityBreakdown:o.contentQualityBreakdown||{},suggestions:D,metadata:o.metadata||{title:"",description:"",keywords:[],author:"",publishDate:"",lastModified:"",readingTime:0,wordCount:0,language:"en"}}};console.log("[Content Analysis] About to call historyService.addStructureAnalysisHistory with:",{id:O.id,name:O.name,originalContentLength:O.originalContent.length,structuredContentLength:O.structuredContent.length,analysisKeys:Object.keys(O.analysis)}),console.log("[Content Analysis] About to call historyService.addStructureAnalysisHistory with data:",O);try{ce.addStructureAnalysisHistory(O),console.log("[Content Analysis] Successfully called historyService.addStructureAnalysisHistory");const C=ce.getHistoryItems();console.log("[Content Analysis] Current history after adding:",{totalItems:C.length,latestItem:C[0]?.name||"None",structureAnalysisItems:C.filter(M=>M.type==="structure-analysis").length});const H=C.find(M=>M.id===O.id);if(H){console.log("[Content Analysis] ✅ Item successfully added to history:",H.name);try{const M=localStorage.getItem("comprehensive_history"),Y=M?JSON.parse(M):[];console.log("[Content Analysis] Direct localStorage check:",{totalStoredItems:Y.length,structureItems:Y.filter(je=>je.type==="structure-analysis").length,ourItemExists:Y.some(je=>je.id===O.id)})}catch(M){console.error("[Content Analysis] Error checking localStorage directly:",M)}}else{console.error("[Content Analysis] ❌ Item was NOT added to history!");try{const M=localStorage.getItem("comprehensive_history");if(console.error("[Content Analysis] Debug - localStorage content:",M),M){const Y=JSON.parse(M);console.error("[Content Analysis] Debug - parsed localStorage:",Y)}}catch(M){console.error("[Content Analysis] Debug - localStorage error:",M)}}}catch(C){console.error("[Content Analysis] Error calling historyService.addStructureAnalysisHistory:",C),C instanceof Error&&console.error("[Content Analysis] Error stack:",C.stack)}}catch(D){console.error("[Content Analysis] Failed to save to history:",D),D instanceof Error&&console.error("[Content Analysis] Error stack:",D.stack)}try{localStorage.setItem(xs(),new Date().toISOString())}catch{}};S.useEffect(()=>{const u=Object.keys(localStorage).filter(h=>h.startsWith(Me()));if(u.length>0){let h=u[0],D=0;for(const C of u)try{const H=localStorage.getItem(C);if(H){const M=JSON.parse(H);M.lastAccessed&&M.lastAccessed>D&&(D=M.lastAccessed,h=C)}}catch{}if(D===0)for(const C of u)try{const H=localStorage.getItem(C);if(H&&JSON.parse(H).analysis){h=C;break}}catch{}const O=localStorage.getItem(h);if(O)try{const C=JSON.parse(O);C.urlInput&&I(C.urlInput),C.activeTab&&w(C.activeTab),C.structuredView&&i(C.structuredView),C.schemaView&&j(C.schemaView),C.codeViewType&&R(new Set(["landing","code","improved"]).has(C.codeViewType)?C.codeViewType:"landing"),!V&&C.pastedPreview&&oe(C.pastedPreview),C.improvedFullPageHtml&&_(C.improvedFullPageHtml),console.log("[Content Analysis] Restored cached analysis from:",h),setTimeout(()=>{const H={...C,lastAccessed:Date.now()};localStorage.setItem(h,JSON.stringify(H))},100)}catch(C){console.error("[Content Analysis] Error restoring cached state:",C)}}!V&&a&&oe(a)},[a]),S.useEffect(()=>{if(t)try{const o={analysis:t,fullPageHtml:k,improvedFullPageHtml:E,activeTab:A,codeViewType:$,urlInput:v,pastedContent:V,savedAt:Date.now()};localStorage.setItem(Ce(),JSON.stringify(o)),console.log("[Content Analysis] Analysis persisted for navigation")}catch(o){console.error("[Content Analysis] Error persisting analysis:",o)}},[t,k,E,A,$,v,V]),S.useEffect(()=>()=>{if(t)try{const o={analysis:t,fullPageHtml:k,improvedFullPageHtml:E,activeTab:A,codeViewType:$,urlInput:v,pastedContent:V,savedAt:Date.now()};localStorage.setItem(Ce(),JSON.stringify(o)),console.log("[Content Analysis] Analysis persisted on component unmount")}catch(o){console.error("[Content Analysis] Error persisting analysis on unmount:",o)}},[t,k,E,A,$,v,V]),S.useEffect(()=>{if(!t)try{const o=localStorage.getItem(Ce());if(o){const u=JSON.parse(o);u.analysis&&u.savedAt&&(Date.now()-u.savedAt<864e5?(console.log("[Content Analysis] Restoring persisted analysis from navigation"),n(u.analysis),u.fullPageHtml&&N(u.fullPageHtml),u.analysis.originalContent&&oe(u.analysis.originalContent),u.analysis.crawledUrl&&I(u.analysis.crawledUrl),u.improvedFullPageHtml&&_(u.improvedFullPageHtml),u.activeTab&&w(u.activeTab),u.codeViewType&&R(u.codeViewType),R("landing"),he(!0),ve(!0)):localStorage.removeItem(Ce()))}}catch(o){console.error("[Content Analysis] Error restoring persisted analysis:",o),localStorage.removeItem(Ce())}},[]);const Pe=S.useRef(0);S.useEffect(()=>{const o=()=>{const h=Date.now();h-Pe.current<1e3||(Pe.current=h,Q(h),Z(!0))},u=["mousedown","mousemove","keypress","scroll","touchstart","click"];return u.forEach(h=>{document.addEventListener(h,o,!0)}),()=>{u.forEach(h=>{document.removeEventListener(h,o,!0)})}},[]),S.useEffect(()=>{if(V&&V.trim().length>0&&K){const o=yt(V),u=`${Me()}_${o}`,h={urlInput:v,activeTab:A,structuredView:l,schemaView:x,pastedPreview:V.slice(0,1e3),codeViewType:$,lastAccessed:Date.now(),createdAt:Date.now(),isActive:!0};try{localStorage.setItem(u,JSON.stringify(h)),console.log("[Content Analysis] Persisted lightweight state for content hash:",o)}catch{Object.keys(localStorage).forEach(O=>{if(O.startsWith(Me()))try{localStorage.removeItem(O)}catch{}})}}},[v,A,l,x,V,$,K]);const Oe=S.useRef(null);S.useEffect(()=>{if(!ue||!V||V.trim().length===0)return;const o=yt(V);if(Oe.current===o){be(!1);return}if(!K){be(!1);return}console.log("[Content Analysis] User-triggered analysis for content length:",V.length),Oe.current=o,qe(V,v).finally(()=>be(!1)),he(!0)},[ue,V,K]);const qe=async(o,u)=>{if(t&&t.originalContent===o){console.log("[Content Analysis] Using cached analysis for existing content");return}T(null),he(!0),ve(!0),c(!0);try{console.log("[Content Analysis] Starting new analysis for:",u?`URL: ${u}`:`Content length: ${o.length}`);const h=await pt.analyzeContentStructure(o,u);if(console.log("[Content Analysis] Analysis result:",h),console.log("[Content Analysis] Result type:",typeof h),console.log("[Content Analysis] Result keys:",h?Object.keys(h):"No result"),console.log("[Content Analysis] Result structure:",{hasSuggestions:!!h?.suggestions,suggestionsLength:h?.suggestions?.length||0,hasStructuredContent:!!h?.structuredContent,hasMetadata:!!h?.metadata,hasSeoScore:typeof h?.seoScore=="number",hasLlmScore:typeof h?.llmOptimizationScore=="number",hasReadabilityScore:typeof h?.readabilityScore=="number"}),console.log("[Content Analysis] Suggestions:",h?.suggestions),console.log("[Content Analysis] Full page HTML available:",!!h?.fullPageHtml),n(h),h.fullPageHtml)N(h.fullPageHtml),console.log("[Content Analysis] Full page HTML set from analysis response");else if(u)try{const D=await Ie.extractFullPageHtml(u);D.success&&(N(D.html),console.log("[Content Analysis] Full page HTML extracted separately"))}catch(D){console.warn("[Content Analysis] Failed to extract full page HTML:",D)}console.log("[Content Analysis] About to save to history with result:",{hasResult:!!h,contentLength:o?.length||0,urlToAnalyze:u,resultKeys:h?Object.keys(h):[]}),console.log("[Content Analysis] Result validation for history:",{hasOriginalContent:!!h?.originalContent,hasStructuredContent:!!h?.structuredContent,hasSeoScore:typeof h?.seoScore=="number",hasLlmScore:typeof h?.llmOptimizationScore=="number",hasReadabilityScore:typeof h?.readabilityScore=="number",hasSuggestions:Array.isArray(h?.suggestions),suggestionsLength:h?.suggestions?.length||0,hasMetadata:!!h?.metadata,hasStructuredData:!!h?.structuredData}),console.log("[Content Analysis] FORCING save to history with FRESH data...");try{const D=new Date,C={id:`structure-analysis-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Structure Analysis${u?` - ${u}`:""} - ${D.toLocaleTimeString()}`,originalContent:o,structuredContent:h.structuredContent||o,analysis:{suggestions:(h.suggestions||[]).filter(Y=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(Y.type)).map(Y=>({type:Y.type,priority:Y.priority,description:Y.description||"",implementation:Y.implementation||"",impact:Y.impact||""})),metadata:{title:h.metadata?.title||"Analyzed Content",description:h.metadata?.description||"Content structure analysis",keywords:h.metadata?.keywords||[],author:h.metadata?.author||"Unknown",publishDate:D.toISOString().split("T")[0],lastModified:D.toISOString().split("T")[0],readingTime:Math.ceil(o.length/1e3),wordCount:o.split(/\s+/).length,language:"en"},structuredData:h.structuredData||{},fullPageHtml:h.fullPageHtml||"",pageTitle:h.pageTitle||"",pageDescription:h.pageDescription||"",geoScoreTotal:h.geoScoreTotal,geoBreakdown:h.geoBreakdown,contentQualityScoreTotal:h.contentQualityScoreTotal,contentQualityBreakdown:h.contentQualityBreakdown,wordCount:h.metadata?.wordCount||o.split(/\s+/).length,readingTime:h.metadata?.readingTime||Math.ceil(o.length/1e3),suggestionsCount:(h.suggestions||[]).length,language:h.metadata?.language||"en"}};console.log("[Content Analysis] FRESH history item created:",{id:C.id,name:C.name,timestamp:D.toISOString(),contentLength:C.originalContent.length}),ce.addStructureAnalysisHistory(C);const H=ce.getHistoryItems(),M=H.find(Y=>Y.id===C.id);M?(console.log("[Content Analysis] ✅ SUCCESSFULLY saved FRESH item to history!",M.name),window.dispatchEvent(new StorageEvent("storage",{key:"comprehensive_history",newValue:JSON.stringify(H)})),window.location.pathname==="/history"&&(console.log("[Content Analysis] On history page, triggering refresh..."),setTimeout(()=>window.location.reload(),1e3))):console.error("[Content Analysis] ❌ FAILED to save FRESH item to history!")}catch(D){console.error("[Content Analysis] Direct save error:",D)}He(h,o,u);try{await Ie.saveLastStructureAnalysis({...h,crawledUrl:u||v||""})}catch{}try{const D=u||v;if(D){let O="/";try{const C=new URL(D);O=C.pathname+(C.search||"")}catch{}}}catch{}}catch(h){console.error("Error analyzing content:",h),alert("Failed to analyze content structure")}finally{c(!1)}},Ne=async()=>{if(!v.trim()){F("Please enter a URL to analyze.");return}try{new URL(v)}catch{F("Please enter a valid URL (e.g., https://example.com)");return}W(!0),F(null);try{const o=await pt.analyzeContentStructure("",v);if(console.log("[URL Analysis] Raw result:",o),o){const u={...o,geoScoreTotal:o.geoScoreTotal||o.seoScore||0,geoBreakdown:o.geoBreakdown||{},contentQualityScoreTotal:o.contentQualityScoreTotal||o.readabilityScore||0,contentQualityBreakdown:o.contentQualityBreakdown||{},metadata:o.metadata?{...o.metadata,title:o.metadata.title||o.pageTitle||"No Title",description:o.metadata.description||o.pageDescription||"No Description",keywords:o.metadata.keywords||[],author:o.metadata.author||"Unknown",publishDate:o.metadata.publishDate||"Unknown",lastModified:o.metadata.lastModified||"Unknown",readingTime:o.metadata.readingTime||1,wordCount:o.metadata.wordCount||0,language:o.metadata.language||"en",contentStructure:o.metadata.contentStructure||{headings:[],paragraphs:[],lists:[]}}:{title:o.pageTitle||"No Title",description:o.pageDescription||"No Description",keywords:[],author:"Unknown",publishDate:"Unknown",lastModified:"Unknown",readingTime:1,wordCount:0,language:"en",contentStructure:{headings:[],paragraphs:[],lists:[]}},suggestions:o.suggestions||[],structuredData:o.structuredData||{},fullPageHtml:o.fullPageHtml||"",pageTitle:o.pageTitle||"",pageDescription:o.pageDescription||"",originalContent:o.originalContent||"",structuredContent:o.structuredContent||o.fullPageHtml||""};console.log("[URL Analysis] Safe result:",u),console.log("[URL Analysis] Metadata debug:",{hasMetadata:!!o.metadata,metadataKeys:o.metadata?Object.keys(o.metadata):[],publishDate:o.metadata?.publishDate,publishDateType:typeof o.metadata?.publishDate,publishDateLength:o.metadata?.publishDate?.length,publishDateIsNull:o.metadata?.publishDate===null,publishDateIsUndefined:o.metadata?.publishDate===void 0,publishDateIsToday:o.metadata?.publishDate===new Date().toISOString().split("T")[0]}),n(u),N(u.fullPageHtml||""),oe(u.originalContent||""),R("landing"),he(!0),ve(!0),console.log("[URL Analysis] Saving to history...");try{const h=new Date,O={id:`structure-analysis-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Structure Analysis - ${v} - ${h.toLocaleTimeString()}`,originalContent:u.originalContent||"",structuredContent:u.structuredContent||u.fullPageHtml||"",analysis:{suggestions:(u.suggestions||[]).filter(M=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(M.type)).map(M=>({type:M.type,priority:M.priority,description:M.description||"",implementation:M.implementation||"",impact:M.impact||""})),metadata:{title:u.metadata?.title||"Analyzed Content",description:u.metadata?.description||"Content structure analysis",keywords:u.metadata?.keywords||[],author:u.metadata?.author||"Unknown",publishDate:u.metadata?.publishDate||h.toISOString().split("T")[0],lastModified:u.metadata?.lastModified||h.toISOString().split("T")[0],readingTime:u.metadata?.readingTime||Math.ceil((u.originalContent||"").length/1e3),wordCount:u.metadata?.wordCount||(u.originalContent||"").split(/\s+/).length,language:u.metadata?.language||"en"},structuredData:u.structuredData||{},fullPageHtml:u.fullPageHtml||"",pageTitle:u.pageTitle||"",pageDescription:u.pageDescription||"",geoScoreTotal:u.geoScoreTotal,geoBreakdown:u.geoBreakdown,contentQualityScoreTotal:u.contentQualityScoreTotal,contentQualityBreakdown:u.contentQualityBreakdown,wordCount:u.metadata?.wordCount||(u.originalContent||"").split(/\s+/).length,readingTime:u.metadata?.readingTime||Math.ceil((u.originalContent||"").length/1e3),suggestionsCount:(u.suggestions||[]).length,language:u.metadata?.language||"en"}};console.log("[URL Analysis] FRESH history item created:",{id:O.id,name:O.name,timestamp:h.toISOString(),contentLength:O.originalContent.length}),ce.addStructureAnalysisHistory(O);const C=ce.getHistoryItems(),H=C.find(M=>M.id===O.id);H?(console.log("[URL Analysis] ✅ SUCCESSFULLY saved URL analysis to history!",H.name),window.dispatchEvent(new StorageEvent("storage",{key:"comprehensive_history",newValue:JSON.stringify(C)})),window.location.pathname==="/history"&&(console.log("[URL Analysis] On history page, triggering refresh..."),setTimeout(()=>window.location.reload(),1e3))):console.error("[URL Analysis] ❌ FAILED to save URL analysis to history!")}catch(h){console.error("[URL Analysis] Error saving to history:",h)}}else F("Failed to analyze URL. Please try again.")}catch(o){console.error("URL analysis error:",o);let u=o.message||"Failed to analyze URL. Please try again.",h=[];try{if(o.response&&o.response.data){const D=o.response.data;D.error&&(u=D.error),D.suggestions&&Array.isArray(D.suggestions)&&(h=D.suggestions)}}catch(D){console.warn("Could not parse error response:",D)}h.length>0&&(u+=`

Suggestions:
• `+h.join(`
• `)),F(u)}finally{W(!1)}},Be=async()=>De(async()=>{if(t){p(!0),z({type:"info",title:"Applying All Suggestions...",message:`Processing ${t.suggestions.length} suggestions...`,appliedCount:0,totalCount:t.suggestions.length,suggestions:t.suggestions});try{let o;const u=E&&E.trim().length>0?E:t.fullPageHtml||k||a;if(!u){alert("No content available to improve.");return}try{if(o=Ke(u,t.suggestions),!o||o.length<100)throw new Error("Generated HTML is too short or invalid");if(new DOMParser().parseFromString(o,"text/html").querySelector("parsererror"))throw new Error("Generated HTML contains parsing errors");o===u&&(console.log("[Apply Suggestions] No changes detected, adding visible test change..."),o=u.replace("<body>",`<body>
<!-- ALL AI SUGGESTIONS APPLIED -->
<div style="background: #e8f5e8; padding: 15px; margin: 15px; border-left: 4px solid #4caf50; border-radius: 4px;"><strong>✅ All AI Suggestions Applied:</strong> This page has been enhanced with `+t.suggestions.length+" AI-powered suggestions for better SEO, readability, and user experience.</div>"),console.log("[Apply Suggestions] Added visible test change"))}catch(h){console.error("Error in applySuggestionsWithDOM:",h),alert("Failed to apply suggestions due to HTML processing error. Please try again.");return}if(t.fullPageHtml||k){_(o),ye.current=o,ee(!0),R("improved");const h={...t,structuredContent:o};n(h)}else y(o);T(`✅ Applied ${t.suggestions.length} suggestions successfully!`)}catch(o){console.error("Error applying suggestions:",o),alert("Failed to apply structure suggestions")}finally{p(!1)}}}),Je=o=>{navigator.clipboard.writeText(o),alert("Copied to clipboard!")},Ae=o=>{const u=window.open("","_blank");u?(u.document.write(o),u.document.close()):alert("Please allow popups to run the code in a new window.")},Ge=()=>{E?Ae(E):t?.fullPageHtml?Ae(t.fullPageHtml):alert("No page content available to run. Please analyze a URL first.")},nt=()=>{if(!t?.fullPageHtml){alert("No original page content available.");return}const o=t.fullPageHtml;console.log("[Compare Pages] Starting comparison:",{originalHtmlLength:o.length,availableSuggestions:t.suggestions.length,currentImprovedHtmlLength:E?.length||0,hasImprovedHtml:!!E,improvedHtmlPreview:E?.substring(0,200)+"..."});let u=ye.current&&ye.current.trim().length>0?ye.current:E&&E.trim().length>0?E:"";if(console.log("[Compare Pages] Improved HTML check:",{hasImprovedHtml:!!u,improvedHtmlLength:u.length,isSameAsOriginal:u===o,isWhitespaceSame:u.replace(/\s+/g,"")===o.replace(/\s+/g,"")}),!u)try{console.log("[Compare Pages] No improved HTML yet; keeping original until a change is applied"),u=o}catch(O){console.error("[Compare Pages] Error preparing comparison:",O),u=o}console.log("[Compare Pages] Final comparison data:",{originalHtmlLength:o.length,improvedHtmlLength:u.length,htmlIsDifferent:u!==o,improvedHtmlPreview:u.substring(0,200)+"...",originalHtmlPreview:o.substring(0,200)+"..."});const h=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Comparison - Original vs Improved</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .comparison-container { 
            display: flex; 
            gap: 20px; 
            height: calc(100vh - 40px); 
        }
        .page-frame { 
            flex: 1; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            background: white;
            overflow: hidden;
        }
        .page-frame h3 { 
            margin: 0; 
            padding: 15px; 
            background: #f5f5f5; 
            border-bottom: 1px solid #ddd; 
            font-size: 16px;
            font-weight: bold;
        }
        .page-frame.original h3 { 
            background: #ffebee; 
            color: #c62828; 
        }
        .page-frame.improved h3 { 
            background: #e8f5e8; 
            color: #2e7d32; 
        }
        .page-frame.improved h3::after {
            content: " (Changes Applied)";
            font-size: 12px;
            font-weight: normal;
        }
        .page-content {
            height: calc(100% - 50px);
            overflow: auto;
        }
        iframe { 
            width: 100%; 
            height: 100%; 
            border: none; 
            background: white;
        }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="comparison-container">
        <div class="page-frame original">
            <h3>🔴 Original Page</h3>
            <div class="page-content">
                <iframe 
                    srcdoc="${o.replace(/"/g,"&quot;").replace(/'/g,"&#39;")}"
                    onload="console.log('Original page loaded')"
                    onerror="console.log('Original page failed to load')"
                ></iframe>
            </div>
        </div>
        <div class="page-frame improved">
            <h3>🟢 Improved Page</h3>
            <div class="page-content">
                <iframe 
                    srcdoc="${u.replace(/"/g,"&quot;").replace(/'/g,"&#39;")}"
                    onload="console.log('Improved page loaded')"
                    onerror="console.log('Improved page failed to load')"
                ></iframe>
            </div>
        </div>
    </div>
    <script>
        console.log('Comparison page loaded');
        // Add some debugging
        setTimeout(() => {
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach((iframe, index) => {
                console.log(\`Iframe \${index + 1} src length:\`, iframe.srcdoc.length);
            });
            
            // Check if the iframes have different content
            if (iframes.length >= 2) {
                const originalLength = iframes[0].srcdoc.length;
                const improvedLength = iframes[1].srcdoc.length;
                console.log('Content comparison:', {
                    originalLength,
                    improvedLength,
                    isDifferent: originalLength !== improvedLength
                });
                
                // Add a visual indicator if content is different
                if (originalLength !== improvedLength) {
                    const improvedFrame = document.querySelector('.page-frame.improved h3');
                    if (improvedFrame) {
                        improvedFrame.style.border = '2px solid #4caf50';
                        improvedFrame.style.animation = 'pulse 2s infinite';
                    }
                }
            }
        }, 1000);
        
        // Add CSS for pulse animation
        const style = document.createElement('style');
        style.textContent = \`
            @keyframes pulse {
                0% { opacity: 1; }
                50% { opacity: 0.7; }
                100% { opacity: 1; }
            }
        \`;
        document.head.appendChild(style);
    <\/script>
</body>
</html>`,D=window.open("","_blank");D?(D.document.write(h),D.document.close()):alert("Please allow popups to view the comparison.")},ze=async()=>{if(t)try{T("🔄 Applying suggestions and generating improved code...");const o=E&&E.trim().length>0?E:t.fullPageHtml||k;if(!o){T("❌ No HTML content available to improve.");return}console.log("[Content Analysis] Applying suggestions to HTML:",{sourceHtmlLength:o.length,suggestionsCount:t.suggestions.length,suggestions:t.suggestions.map(H=>({type:H.type,hasExactReplacement:!!H.exactReplacement}))});const u=Ke(o,t.suggestions);console.log("[Content Analysis] Improved code generated:",{improvedCodeLength:u.length,hasChanges:u!==o}),_(u),ye.current=u,ee(!0),console.log("[Frontend] State updated after applying suggestion:",{improvedCodeLength:u.length,sourceHtmlLength:o.length,hasChanges:u!==o,improvedCodePreview:u.substring(0,200)+"..."});const h={...t,structuredContent:u};n(h),console.log("[Frontend] Analysis object updated:",{analysisUpdated:!0,structuredContentLength:h.structuredContent.length,fullPageHtmlLength:(t.fullPageHtml||"").length}),await navigator.clipboard.writeText(u);const D=t.suggestions.length,O=t.suggestions.map(H=>H.type).slice(0,3);z({type:"success",title:"All Suggestions Applied Successfully!",message:`Successfully applied ${D} out of ${t.suggestions.length} suggestions to your content.`,details:O.slice(0,5).map(H=>`Applied: ${H}`),appliedCount:D,totalCount:t.suggestions.length,suggestions:t.suggestions}),window.confirm("Improved code copied to clipboard! Would you like to run the improved page in a new window?")&&Ae(u)}catch(o){console.error("Error copying and running code:",o),T("❌ Failed to apply suggestions. Please try again."),setTimeout(()=>T(null),3e3)}},Ve=async o=>De(async()=>{if(t){z({type:"info",title:"Applying Suggestion...",message:`Processing ${o.type} suggestion...`,appliedCount:0,totalCount:1,suggestions:[o]});try{const u=E&&E.trim().length>0?E:t.fullPageHtml||k;if(!u){T("❌ No HTML content available to improve.");return}console.log("[Frontend] Applying single suggestion:",{type:o.type,hasExactReplacement:!!o.exactReplacement,currentContent:o.currentContent?.substring(0,100)+"...",enhancedContent:o.enhancedContent?.substring(0,100)+"...",sourceHtmlLength:u.length,fullSuggestion:o}),console.log("[Frontend] Suggestion validation:",{hasType:!!o.type,hasCurrentContent:!!o.currentContent,hasEnhancedContent:!!o.enhancedContent,hasExactReplacement:!!o.exactReplacement,exactReplacementFind:o.exactReplacement?.find?.substring(0,100)+"...",exactReplacementReplace:o.exactReplacement?.replace?.substring(0,100)+"..."});let h;try{if(h=Ke(u,[o]),console.log("[Content Analysis] Suggestion application result:",{originalLength:u.length,improvedLength:h.length,hasChanges:h!==u,suggestionType:o.type}),!h||h.length<100)throw new Error("Generated HTML is too short or invalid");if(new DOMParser().parseFromString(h,"text/html").querySelector("parsererror"))throw new Error("Generated HTML contains parsing errors");if(h===u){if(console.log("[Content Analysis] No changes detected, trying alternative approach..."),o.currentContent&&o.enhancedContent){const C=u.replace(o.currentContent,o.enhancedContent);C!==u&&(h=C,console.log("[Content Analysis] Applied direct text replacement"))}h===u&&(console.log("[Content Analysis] Still no changes, adding visible test change..."),h=u.replace("<body>",`<body>
<!-- AI SUGGESTION APPLIED -->
<div style="background: #fff3cd; padding: 10px; margin: 10px; border-left: 4px solid #ffc107;"><strong>🔧 Suggestion Applied:</strong> `+o.type+" - "+o.description+"</div>"),console.log("[Content Analysis] Added visible test change"))}}catch(D){if(console.error("Error in applySuggestionsWithDOM:",D),o.exactReplacement)try{const{find:O,replace:C}=o.exactReplacement;if(u.includes(O))h=u.replace(O,C),console.log("[Content Analysis] Applied fallback exact replacement");else throw new Error("Exact replacement pattern not found")}catch(O){console.error("Fallback also failed:",O),T("❌ Failed to apply suggestion. Please try again."),setTimeout(()=>T(null),3e3);return}else{T("❌ Failed to apply suggestion due to HTML processing error. Please try again."),setTimeout(()=>T(null),3e3);return}}if(_(h),ye.current=h,ee(!0),t){const D={...t,structuredContent:h};console.log("[Content Analysis] Updating analysis with improved content:",{improvedCodeLength:h.length,improvedCodePreview:h.substring(0,200)+"..."}),n(D)}z({type:"success",title:"Suggestion Applied Successfully!",message:`The ${o.type} suggestion has been applied to your content.`,details:[`Applied: ${o.type}`,`Description: ${o.description}`,`Impact: ${o.impact||"Improved content quality"}`],appliedCount:1,totalCount:1,suggestions:[o]}),R("landing"),console.log("[Content Analysis] Switched to landing tab to show updated content")}catch(u){console.error("Error applying single suggestion:",u),T("❌ Failed to apply suggestion. Please try again."),setTimeout(()=>T(null),3e3)}}}),$e=(o,u)=>{const h=new Blob([o],{type:"text/plain"}),D=URL.createObjectURL(h),O=document.createElement("a");O.href=D,O.download=u,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(D)},Re=o=>o>=80?"text-green-600":o>=60?"text-yellow-600":"text-red-600",_e=o=>o>=80?"bg-green-100":o>=60?"bg-yellow-100":"bg-red-100",b=o=>{switch(o){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},P=o=>{switch(o){case"high":return e.jsx(vt,{className:"w-4 h-4"});case"medium":return e.jsx(et,{className:"w-4 h-4"});case"low":return e.jsx(ke,{className:"w-4 h-4"});default:return e.jsx(et,{className:"w-4 h-4"})}},fe=({html:o})=>{const u=Ft.useMemo(()=>{let h=o||"";return!h.includes("<!DOCTYPE html>")&&!h.includes("<html")&&(h=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Preserve original styling while ensuring readability */
    body { 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; 
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 20px;
      background: #ffffff;
    }
    /* Ensure images and media are responsive */
    img, video, iframe { max-width: 100%; height: auto; }
    /* Improve readability */
    h1, h2, h3, h4, h5, h6 { 
      margin-top: 1.2em; 
      margin-bottom: 0.5em; 
      color: #2c3e50;
    }
    p { 
      line-height: 1.7; 
      margin-bottom: 1em;
    }
    ul, ol { 
      margin: 1em 0; 
      padding-left: 2em; 
    }
    li { 
      margin-bottom: 0.5em; 
    }
    a { 
      color: #3498db; 
      text-decoration: none; 
    }
    a:hover { 
      text-decoration: underline; 
    }
  </style>
</head>
<body>
  ${h}
</body>
</html>`),h},[o]);return e.jsx("iframe",{title:"Landing Preview",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups",srcDoc:u,loading:"lazy",style:{width:"100%",height:"75vh",border:"none",borderRadius:"0.5rem",background:"transparent"}},o?o.substring(0,100):"empty")},xe=(o,u)=>{if(!Array.isArray(o)||!u)return o||[];const h=u.toLowerCase(),D=new Map,O=new Set,C=["artificial intelligence","ai","machine learning","ml","deep learning","data science","analytics","insights","metrics","performance","cloud computing","saas","platform","integration","api","business intelligence","reporting","dashboard","visualization","digital transformation","innovation","technology","solution","user experience","ux","interface","design","usability","security","compliance","governance","risk","audit","scalability","reliability","availability","backup","recovery","migration","tenant","onedrive","sharepoint","teams","cloudfuze","microsoft 365","google workspace","metadata"];return o.forEach(H=>{const M=(H||"").trim();if(!M)return;const Y=M.toLowerCase();if(O.has(Y))return;const je=Y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`(^|[^a-z0-9])${je}([^a-z0-9]|$)`,"i").test(h)){O.add(Y);let Te=0;C.some(Et=>Y.includes(Et))&&(Te+=5),Y.split(" ").length>=2&&(Te+=3),Y.length>8&&(Te+=2),(Y.includes("-")||/[A-Z]/.test(M))&&(Te+=2);const Tt=(h.match(new RegExp(je,"gi"))||[]).length;D.set(M,Tt+Te)}}),Array.from(D.entries()).sort((H,M)=>M[1]!==H[1]?M[1]-H[1]:M[0].length-H[0].length).map(([H])=>H).slice(0,25)},Ue=o=>{const u=o.currentContent||o?.exactReplacement?.find||"",h=o.enhancedContent||o?.exactReplacement?.replace||o.implementation||"";return{current:u,enhanced:h}};if(S.useEffect(()=>{},[$,k,t]),r&&!t)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-black mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-black mb-2",children:"Analyzing Content Structure"}),e.jsx("p",{className:"text-gray-600",children:"Analyzing your content for SEO and LLM optimization..."}),L&&e.jsx("div",{className:"mt-6 inline-block bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded",children:L})]})})});const Nt=()=>{n(null),I(""),F(null),oe(""),y(""),N(""),R("landing"),_(""),T(null),Z(!0),he(!1),ve(!1),Object.keys(localStorage).forEach(u=>{u.startsWith(Me())&&localStorage.removeItem(u)}),localStorage.removeItem(Ce()),console.log("[Content Analysis] New analysis initiated - state cleared")};return t?e.jsxs(e.Fragment,{children:[e.jsx(Le,{}),e.jsx(ys,{message:f,onClose:()=>T(null),autoClose:!0,autoCloseDelay:4e3}),e.jsxs("div",{className:"w-full max-w-7xl mx-auto space-y-6 lg:space-y-8 px-2 sm:px-4 lg:px-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(Ze,{className:"w-8 h-8 text-black flex-shrink-0"}),e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-black truncate",children:"Content Structure Analysis"})]}),e.jsxs("div",{className:"flex gap-2 lg:gap-3 flex-shrink-0 items-center",children:[e.jsx("button",{onClick:Nt,className:"bg-blue-600 text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold text-sm lg:text-base",children:"New Analysis"}),e.jsxs("button",{onClick:()=>$e(t.structuredContent,"improved-content.txt"),className:"bg-blue-600 text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm lg:text-base",children:[e.jsx(ot,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[t?.geoScoreTotal!==void 0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${_e(t.geoScoreTotal)}`,children:e.jsx(Ze,{className:"w-6 h-6 text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-black",children:"GEO Score Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"AI visibility and search engine optimization breakdown"})]})]}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-black",onClick:()=>ge(o=>!o),children:X?"Hide":"Details"})]}),e.jsxs("div",{className:`text-3xl font-bold ${Re(t.geoScoreTotal)}`,children:[t.geoScoreTotal,"/100"]})]}),t?.contentQualityScoreTotal!==void 0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${_e(t.contentQualityScoreTotal)}`,children:e.jsx(Mt,{className:"w-6 h-6 text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-black",children:"Content Quality Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Human/editorial score breakdown"})]})]}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-black",onClick:()=>le(o=>!o),children:te?"Hide":"Details"})]}),e.jsxs("div",{className:`text-3xl font-bold ${Re(t.contentQualityScoreTotal)}`,children:[t.contentQualityScoreTotal,"/100"]})]})]}),t?.geoBreakdown&&X&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200 mb-8",children:[e.jsx("h4",{className:"font-semibold text-black mb-3",children:"GEO Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start content-start",children:Object.entries(t.geoBreakdown).map(([o,u])=>{const D={evidence_attribution:30,answerability_snippetability:25,structured_understanding:20,freshness_stability:10,entity_topic_coverage:10,retrieval_friendliness:5}[o]??5,O=u.score?.toFixed?`${u.score.toFixed(1)}/${D}`:`${u.score}/${D}`;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold text-black",children:o.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase())}),e.jsx("div",{className:"text-black font-bold",children:O})]}),e.jsx("div",{className:"text-sm text-gray-700 space-y-1.5",children:Object.entries(u).filter(([C])=>C!=="score").map(([C,H])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:C.replace(/_/g," ")}),e.jsx("span",{className:"text-black font-medium",children:typeof H=="number"?H.toFixed(1):String(H)})]},C))})]},o)})})]}),t?.contentQualityBreakdown&&te&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200 mb-8",children:[e.jsx("h4",{className:"font-semibold text-black mb-3",children:"Content Quality Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start content-start",children:Object.entries(t.contentQualityBreakdown).map(([o,u])=>{const D={readability_clarity:20,structure_coherence:15,depth_coverage:20,originality:15,accuracy_source_use:10,style_tone:10,accessibility_presentation:10}[o]??20,O=u.score?.toFixed?`${u.score.toFixed(1)}/${D}`:`${u.score}/${D}`;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold text-black",children:o.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase())}),e.jsx("div",{className:"text-black font-bold",children:O})]}),e.jsx("div",{className:"text-sm text-gray-700 space-y-1.5",children:Object.entries(u).filter(([C])=>C!=="score").map(([C,H])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:C.replace(/_/g," ")}),e.jsx("span",{className:"text-black font-medium",children:typeof H=="number"?H.toFixed(1):String(H)})]},C))})]},o)})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 mb-8 w-full overflow-hidden",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex flex-wrap gap-2 lg:gap-0 lg:space-x-8 px-4 lg:px-6 py-2 lg:py-0",children:[{id:"overview",label:"Overview",icon:Xe},{id:"suggestions",label:"Suggestions",icon:Ye},{id:"structured",label:"Structured Content",icon:Ht},{id:"schema",label:"Schema Markup",icon:qt}].map(o=>e.jsxs("button",{onClick:()=>w(o.id),className:`flex items-center gap-1 lg:gap-2 py-2 lg:py-4 px-2 lg:px-4 rounded-lg font-bold text-xs lg:text-sm transition-colors whitespace-nowrap 
                    ${A===o.id?"bg-white text-black":"bg-black text-white opacity-80 hover:opacity-100"}
                  `,children:[e.jsx(o.icon,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:o.label}),e.jsx("span",{className:"sm:hidden",children:o.label.split(" ")[0]})]},o.id))})}),e.jsxs("div",{className:"p-4 lg:p-6 w-full overflow-hidden",children:[A==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Content Summary"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:t?.metadata?.wordCount||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Words"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:t?.metadata?.readingTime||1}),e.jsx("div",{className:"text-sm text-gray-600",children:"Min Read"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:t?.suggestions?.length||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Suggestions"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:(t?.metadata?.language||"en").toUpperCase()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Language"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Content Metadata"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:t?.metadata?.title||"No Title",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:t?.metadata?.description||"No Description",readOnly:!0,rows:3,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:xe(t?.metadata?.keywords||[],t?.originalContent||"").map((o,u)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:o},u))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Author"}),e.jsx("input",{type:"text",value:t?.metadata?.author||"Unknown",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Publish Date"}),e.jsx("input",{type:"text",value:t?.metadata?.publishDate||"Unknown",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reading Time"}),e.jsx("input",{type:"text",value:`${t?.metadata?.readingTime||1} minutes`,readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]})]})]})]})]}),A==="suggestions"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-6 gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:"Structure Improvement Suggestions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Ge,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),"Run Full Page"]}),e.jsxs("button",{onClick:nt,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Compare Pages"]}),e.jsx("button",{onClick:()=>{console.log("[Debug] Current state check:",{hasAnalysis:!!t,hasFullPageHtml:!!t?.fullPageHtml,hasImprovedFullPageHtml:!!E,improvedHtmlLength:E?.length||0,originalHtmlLength:t?.fullPageHtml?.length||0,suggestionsCount:t?.suggestions?.length||0,improvedHtmlPreview:E?.substring(0,200)+"...",originalHtmlPreview:t?.fullPageHtml?.substring(0,200)+"..."}),alert("Debug info logged to console. Check console for details.")},className:"bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors font-semibold flex items-center gap-2",children:"🔍 Debug State"}),e.jsxs("button",{onClick:Be,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Apply All Suggestions"]})]})]}),e.jsx("div",{className:"space-y-6",children:t?.suggestions?.map((o,u)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${b(o.priority)}`,children:P(o.priority)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h4",{className:"font-semibold text-black text-lg",children:o.description}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${b(o.priority)}`,children:o.priority})]}),(()=>{const{current:h}=Ue(o);return h})()&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Current Content:"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200 overflow-auto",children:e.jsx("pre",{className:"text-sm text-red-700 font-mono whitespace-pre-wrap",children:Ue(o).current})})]}),(()=>{const{enhanced:h}=Ue(o);return h})()&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-green-700 mb-2",children:"Enhanced Content:"}),e.jsx("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200 overflow-auto",children:e.jsx("pre",{className:"text-sm text-green-800 font-mono whitespace-pre-wrap",children:Ue(o).enhanced})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"🎯 Impact:"})," ",o.impact]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>Ve(o),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Apply This Suggestion"]})})]})]})},u))})]}),A==="structured"&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:"Improved Content Structure"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:`px-2 lg:px-3 py-1 rounded-lg text-xs lg:text-sm font-semibold border transition-colors duration-150 ${$==="landing"?"bg-black text-white border-black":"bg-gray-200 text-black border-gray-300 hover:bg-gray-300"}`,onClick:()=>R("landing"),children:"Landing"}),e.jsx("button",{className:`px-2 lg:px-3 py-1 rounded-lg text-xs lg:text-sm font-semibold border transition-colors duration-150 ${$==="code"?"bg-black text-white border-black":"bg-gray-200 text-black border-gray-300 hover:bg-gray-300"}`,onClick:()=>R("code"),children:"Code"}),$==="code"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Je(k),className:"bg-gray-100 text-black px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(bt,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy Code"})]}),e.jsxs("button",{onClick:ze,className:"bg-black text-white px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-800 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(at,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy & Run"})]}),e.jsxs("button",{onClick:()=>$e(k,"original-page.html"),className:"bg-gray-600 text-white px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(ot,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})]})]})]}),$==="landing"?e.jsx("div",{className:"bg-gray-50 rounded-lg p-2 w-full",children:e.jsx(fe,{html:t.structuredContent})}):$==="improved"?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-auto w-full",style:{maxHeight:"70vh"},children:e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono leading-relaxed",children:e.jsx("code",{className:"block whitespace-pre-wrap break-all",children:E||'No improved code available yet. Click "Copy & Run" to generate improved code.'})})}):e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-auto w-full",style:{maxHeight:"70vh"},children:e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono leading-relaxed",children:e.jsx("code",{className:"block whitespace-pre-wrap break-all",children:k||"No code extracted yet."})})})]}),A==="schema"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-4",children:e.jsx("h3",{className:"text-lg font-semibold text-black mb-0",children:"Schema Generator"})}),e.jsx(ms,{})]})]})]})]})]}):e.jsx("div",{className:"w-full max-w-full mx-auto space-y-6 lg:space-y-8 px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 sm:p-6 lg:p-8 shadow-sm",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Technical SEO & Structure Analysis"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Optimize your site structure for better AI crawling and understanding."})]}),e.jsx("div",{className:"flex flex-col lg:flex-row items-stretch gap-4 mb-8",children:e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:v,onChange:o=>kt(o,u=>{I(u),Q(Date.now()),Z(!0)}),onPaste:o=>jt(o,u=>{I(u),Q(Date.now()),Z(!0)}),onKeyDown:Ct,onFocus:()=>{Q(Date.now()),Z(!0)},required:!0,placeholder:"Paste a URL to analyze...",className:"flex-1 px-4 py-3 border-2 border-blue-600 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg h-[48px]",disabled:J}),e.jsx("button",{onClick:Ne,disabled:J||!v.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-xl font-medium flex items-center justify-center gap-2 transition-colors shadow-lg min-w-[120px] h-[48px]",children:J?e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"w-5 h-5"}),"Analyze URL"]})})]})})}),L&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg text-base",children:e.jsx("div",{className:"whitespace-pre-line",children:L})})]})})}export{ks as A,Cs as C,js as O,ys as S,jt as a,kt as b,Ct as c,B as d,Ie as e,At as f,tt as g,ce as h,As as i,e as j,rs as u};
