import{r as as,a as rs}from"./vendor-DavUf6mE.js";import{r as m,u as Me,R as Ut,a as Ht,b as os,B as ns,c as St,d as xe,N as Nt}from"./router-cMghrlxF.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const w of n.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&a(w)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();var pt={exports:{}},st={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kt;function is(){if(kt)return st;kt=1;var o=as(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,r=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function w(j,g,d){var y,F={},P=null,E=null;d!==void 0&&(P=""+d),g.key!==void 0&&(P=""+g.key),g.ref!==void 0&&(E=g.ref);for(y in g)a.call(g,y)&&!n.hasOwnProperty(y)&&(F[y]=g[y]);if(j&&j.defaultProps)for(y in g=j.defaultProps,g)F[y]===void 0&&(F[y]=g[y]);return{$$typeof:t,type:j,key:P,ref:E,props:F,_owner:r.current}}return st.Fragment=s,st.jsx=w,st.jsxs=w,st}var At;function ls(){return At||(At=1,pt.exports=is()),pt.exports}var e=ls(),dt={},Ct;function cs(){if(Ct)return dt;Ct=1;var o=rs();return dt.createRoot=o.createRoot,dt.hydrateRoot=o.hydrateRoot,dt}var ds=cs();const us="modulepreload",ms=function(o){return"/"+o},Ft={},Ie=function(t,s,a){let r=Promise.resolve();if(s&&s.length>0){let g=function(d){return Promise.all(d.map(y=>Promise.resolve(y).then(F=>({status:"fulfilled",value:F}),F=>({status:"rejected",reason:F}))))};document.getElementsByTagName("link");const w=document.querySelector("meta[property=csp-nonce]"),j=w?.nonce||w?.getAttribute("nonce");r=g(s.map(d=>{if(d=ms(d),d in Ft)return;Ft[d]=!0;const y=d.endsWith(".css"),F=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${F}`))return;const P=document.createElement("link");if(P.rel=y?"stylesheet":us,y||(P.as="script"),P.crossOrigin="",P.href=d,j&&P.setAttribute("nonce",j),document.head.appendChild(P),y)return new Promise((E,A)=>{P.addEventListener("load",E),P.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(w){const j=new Event("vite:preloadError",{cancelable:!0});if(j.payload=w,window.dispatchEvent(j),!j.defaultPrevented)throw w}return r.then(w=>{for(const j of w||[])j.status==="rejected"&&n(j.reason);return t().catch(n)})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var gs={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ae=(o,t)=>{const s=m.forwardRef(({color:a="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:w,className:j="",children:g,...d},y)=>m.createElement("svg",{ref:y,...gs,width:r,height:r,stroke:a,strokeWidth:w?Number(n)*24/Number(r):n,className:["lucide",`lucide-${hs(o)}`,j].join(" "),...d},[...t.map(([F,P])=>m.createElement(F,P)),...Array.isArray(g)?g:[g]]));return s.displayName=`${o}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=ae("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=ae("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=ae("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=ae("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=ae("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=ae("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=ae("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=ae("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=ae("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=ae("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=ae("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=ae("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=ae("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=ae("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=ae("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=ae("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=ae("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=ae("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=ae("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=ae("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=ae("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=ae("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=ae("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=ae("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=ae("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=ae("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=ae("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=ae("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=ae("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=ae("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=ae("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=ae("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=ae("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=ae("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=ae("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=ae("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=ae("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=ae("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),$t="comprehensive_history";class As{getHistoryFromStorage(){try{const t=localStorage.getItem($t);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading history from storage:",t),[]}}saveHistoryToStorage(t){try{console.log("[HistoryService] Saving to storage:",t.length,"items"),console.log("[HistoryService] Items being saved:",t),localStorage.setItem($t,JSON.stringify(t)),console.log("[HistoryService] Successfully saved to localStorage")}catch(s){console.error("Error saving history to storage:",s)}}addHistoryItem(t){console.log("[HistoryService] Adding history item:",t);const s=this.getHistoryFromStorage(),a=s.findIndex(r=>r.id===t.id);a>=0?(s[a]=t,console.log("[HistoryService] Updated existing item")):(s.unshift(t),console.log("[HistoryService] Added new item, total items:",s.length)),this.saveHistoryToStorage(s)}getHistoryItems(){const t=this.getHistoryFromStorage();console.log("[HistoryService] Getting history items:",t.length,"items");const s=t.filter(a=>!a.id.startsWith("sample-"));return s.length!==t.length&&(console.log("[HistoryService] Filtered out sample data, keeping only real items:",s.length),this.saveHistoryToStorage(s)),s}clearHistory(){this.saveHistoryToStorage([])}clearSampleData(){const s=this.getHistoryFromStorage().filter(a=>!a.id.startsWith("sample-"));this.saveHistoryToStorage(s),console.log("[HistoryService] Cleared sample data, kept",s.length,"real items")}deleteHistoryItem(t){const a=this.getHistoryFromStorage().filter(r=>r.id!==t);this.saveHistoryToStorage(a)}exportHistoryItem(t){try{console.log("[HistoryService] Exporting item:",t);const s=this.getHistoryFromStorage();console.log("[HistoryService] All items:",s);const a=s.find(j=>j.id===t);if(!a)return console.error("[HistoryService] Item not found:",t),null;console.log("[HistoryService] Found item:",a);const r=this.formatHistoryItemForExport(a);if(console.log("[HistoryService] Formatted content:",r),!r)return console.error("[HistoryService] Failed to format content for item:",t),null;const n=`${a.type}-${a.name.replace(/[^a-zA-Z0-9]/g,"-")}-${new Date(a.timestamp).toISOString().split("T")[0]}.json`,w=JSON.stringify(r,null,2);return console.log("[HistoryService] JSON content length:",w.length),{content:w,filename:n,mimeType:"application/json"}}catch(s){return console.error("[HistoryService] Error exporting item:",t,s),null}}exportAllHistory(){const t=this.getHistoryFromStorage(),s={exportDate:new Date().toISOString(),totalItems:t.length,items:t.map(a=>this.formatHistoryItemForExport(a))};return{content:JSON.stringify(s,null,2),filename:`kabini-history-export-${new Date().toISOString().split("T")[0]}.json`,mimeType:"application/json"}}formatHistoryItemForExport(t){const s={id:t.id,type:t.type,name:t.name,timestamp:t.timestamp,status:t.status,description:t.description,exportDate:new Date().toISOString()};switch(t.type){case"qa":const a=t;return{...s,sessionInfo:{id:a.sessionData.id,model:a.sessionData.model,blogContent:a.sessionData.blogContent,totalInputTokens:a.sessionData.totalInputTokens,totalOutputTokens:a.sessionData.totalOutputTokens},statistics:a.sessionData.statistics,questionsAndAnswers:a.sessionData.qaData.map((j,g)=>({questionNumber:g+1,question:j.question,answer:j.answer,accuracy:j.accuracy,sentiment:j.sentiment,geoScore:j.geoScore,citationLikelihood:j.citationLikelihood,inputTokens:j.inputTokens,outputTokens:j.outputTokens,totalTokens:j.totalTokens,cost:j.cost}))};case"ai-visibility":const r=t;return{...s,company:r.company,industry:r.industry,analysis:{overallScore:r.analysis.overallScore,contentQuality:r.analysis.contentQuality,technicalSEO:r.analysis.technicalSEO,userExperience:r.analysis.userExperience,competitivePosition:r.analysis.competitivePosition,competitors:r.analysis.competitors.map(j=>({name:j.name,website:j.website,relevanceScore:j.relevanceScore,strengths:j.strengths,weaknesses:j.weaknesses})),recommendations:r.analysis.recommendations.map(j=>({priority:j.priority,recommendation:j.recommendation,impact:j.impact,effort:j.effort}))}};case"content-analysis":const n=t;return{...s,url:n.url,content:n.content,analysis:{seoScore:n.analysis.seoScore,readabilityScore:n.analysis.readabilityScore,contentLength:n.analysis.contentLength,keywordDensity:n.analysis.keywordDensity,suggestions:n.analysis.suggestions.map(j=>({category:j.category,suggestion:j.suggestion,priority:j.priority}))}};case"structure-analysis":const w=t;return{...s,originalContent:w.originalContent,structuredContent:w.structuredContent,analysis:{seoScore:w.analysis.seoScore,llmOptimizationScore:w.analysis.llmOptimizationScore,readabilityScore:w.analysis.readabilityScore,metadata:w.analysis.metadata,suggestions:w.analysis.suggestions.map(j=>({type:j.type,priority:j.priority,description:j.description,implementation:j.implementation,impact:j.impact}))}};default:return s}}addQAHistory(t){const s={id:t.id,type:"qa",name:t.name,timestamp:t.timestamp,userId:t.userId,status:"completed",description:`Q&A session with ${t.qaData.length} questions`,sessionData:t};this.addHistoryItem(s)}addAIVisibilityHistory(t){const s={id:t.id,type:"ai-visibility",name:t.name,timestamp:new Date().toISOString(),status:"completed",description:`AI visibility analysis for ${t.company}`,company:t.company,industry:t.industry,analysis:t.analysis};this.addHistoryItem(s)}addContentAnalysisHistory(t){const s={id:t.id,type:"content-analysis",name:t.name,timestamp:new Date().toISOString(),status:"completed",description:`Content analysis for ${t.url||"content"}`,url:t.url,content:t.content,analysis:t.analysis};this.addHistoryItem(s)}addStructureAnalysisHistory(t){console.log("[HistoryService] addStructureAnalysisHistory called with:",{id:t.id,name:t.name,originalContentLength:t.originalContent?.length||0,structuredContentLength:t.structuredContent?.length||0,analysisKeys:Object.keys(t.analysis||{}),hasSuggestions:Array.isArray(t.analysis?.suggestions),suggestionsLength:t.analysis?.suggestions?.length||0});const s={id:t.id,type:"structure-analysis",name:t.name,timestamp:new Date().toISOString(),status:"completed",description:"Content structure analysis completed",originalContent:t.originalContent,structuredContent:t.structuredContent,analysis:t.analysis};console.log("[HistoryService] Created structure item:",{id:s.id,type:s.type,name:s.name,timestamp:s.timestamp}),this.addHistoryItem(s),console.log("[HistoryService] addStructureAnalysisHistory completed")}}const pe=new As,Ot="statistics_state";function Cs({sessions:o,currentSession:t}){const[s,a]=m.useState("7d"),[r,n]=m.useState("questions"),[w,j]=m.useState([]),[g,d]=m.useState(0),[y,F]=m.useState([]),[P]=m.useState(!1);m.useEffect(()=>{(()=>{const b=pe.getHistoryItems();j(b);const I=JSON.parse(localStorage.getItem("sessions")||"[]");F(I);const p=localStorage.getItem("llm_qa_current_session");if(p)try{const x=JSON.parse(p);console.log("[Statistics] Current session loaded:",{id:x.id,qaDataLength:x.qaData?.length||0})}catch(x){console.error("[Statistics] Error parsing current session:",x)}})()},[g,o.length,t]),m.useEffect(()=>{t&&(console.log("[Statistics] Current session prop changed:",{id:t.id,qaDataLength:t.qaData?.length||0,timestamp:t.timestamp}),d(u=>u+1))},[t?.id,t?.qaData?.length,t?.timestamp]),m.useEffect(()=>{const u=x=>{(x.key==="comprehensive_history"||x.key==="sessions"||x.key==="llm_qa_current_session")&&(console.log("[Statistics] Storage changed:",x.key,"refreshing statistics"),d(C=>C+1))};window.addEventListener("storage",u);const I=setInterval(()=>{const x=localStorage.getItem("llm_qa_current_session");if(x)try{const $=JSON.parse(x).qaData?.length||0;if(t&&t.qaData){const V=t.qaData.length;$!==V&&(console.log("[Statistics] Current session QA count changed:",V,"->",$),d(B=>B+1))}}catch(C){console.error("[Statistics] Error checking current session changes:",C)}},1e3),p=setInterval(()=>{const x=pe.getHistoryItems(),C=JSON.parse(localStorage.getItem("sessions")||"[]");(x.length!==w.length||C.length!==y.length)&&(console.log("[Statistics] Data changed, refreshing statistics"),d($=>$+1))},2e3);return()=>{window.removeEventListener("storage",u),clearInterval(I),clearInterval(p)}},[w.length,y.length,t]);const E=()=>{const u=[...o,...y];w.forEach(L=>{if(L.type==="qa"){const M=L;u.push(M.sessionData)}});const b=u.filter((L,M,he)=>M===he.findIndex(ce=>ce.id===L.id));if(console.log("[Statistics] Total sessions for calculation:",b.length),console.log("[Statistics] Sessions from prop:",o.length),console.log("[Statistics] Sessions from localStorage:",y.length),console.log("[Statistics] QA items from history:",w.filter(L=>L.type==="qa").length),b.forEach((L,M)=>{console.log(`[Statistics] Session ${M+1}:`,{id:L.id,qaCount:L.qaData.length,totalCost:L.statistics?.totalCost,timestamp:L.timestamp})}),b.length===0)return{totalQuestions:0,totalCost:0,totalTokens:0,avgAccuracy:0,totalSessions:0,avgQuestionsPerSession:0,successRate:0,providerDistribution:{},questionsPerDay:[],inputTokens:0,outputTokens:0,avgResponseTime:0,weeklyGrowth:0,dailyAverage:0,peakDay:"",sentimentDistribution:{positive:0,negative:0,neutral:0},geoScoreAverage:0,semanticRelevanceAverage:0,vectorSimilarityAverage:0};const I=b.reduce((L,M)=>L+M.qaData.length,0),p=b.reduce((L,M)=>L+parseFloat(M.statistics?.totalCost||"0"),0),x=b.reduce((L,M)=>L+M.qaData.reduce((he,ce)=>he+ce.totalTokens,0),0);console.log("[Statistics] Calculated metrics:",{totalQuestions:I,totalCost:p.toFixed(5),totalTokens:x,sessionCount:u.length});const C=b.flatMap(L=>L.qaData),$=C.map(L=>parseFloat(L.accuracy||"0")).filter(L=>!isNaN(L)&&L>0),V=$.length>0?$.reduce((L,M)=>L+M,0)/$.length:0;console.log("[Statistics] Accuracy calculation:",{totalQAItems:C.length,itemsWithAccuracy:$.length,avgAccuracy:V.toFixed(1)+"%",accuracyValues:$.slice(0,5)});const B={};["openai","gemini","perplexity"].forEach(L=>{B[L]=0}),C.forEach(L=>{const M=L.provider||"Unknown";B.hasOwnProperty(M)?B[M]++:B[M]=(B[M]||0)+1});const l=b.reduce((L,M)=>L+M.qaData.reduce((he,ce)=>he+ce.inputTokens,0),0),N=b.reduce((L,M)=>L+M.qaData.reduce((he,ce)=>he+ce.outputTokens,0),0),h={positive:0,negative:0,neutral:0};C.forEach(L=>{const M=L.sentiment?.toLowerCase()||"neutral";M.includes("positive")?h.positive++:M.includes("negative")?h.negative++:h.neutral++});const K=C.map(L=>L.geoScore||0).filter(L=>L>0),X=K.length>0?K.reduce((L,M)=>L+M,0)/K.length:0,ie=C.map(L=>parseFloat(L.semanticRelevance||"0")).filter(L=>!isNaN(L)&&L>0),le=ie.length>0?ie.reduce((L,M)=>L+M,0)/ie.length:0,ee=C.map(L=>{const M=L.vectorSimilarity;return typeof M=="string"&&M.includes("%")?parseFloat(M.replace("%","")):parseFloat(M||"0")}).filter(L=>!isNaN(L)&&L>0),H=ee.length>0?ee.reduce((L,M)=>L+M,0)/ee.length:0,W=new Date,Ae=new Date(W.getTime()-7*24*60*60*1e3),$e=new Date(W.getTime()-14*24*60*60*1e3),Ke=b.filter(L=>new Date(L.timestamp)>=Ae),de=b.filter(L=>new Date(L.timestamp)>=$e&&new Date(L.timestamp)<Ae),ct=Ke.reduce((L,M)=>L+M.qaData.length,0),Oe=de.reduce((L,M)=>L+M.qaData.length,0),Ue=Oe>0?(ct-Oe)/Oe*100:0,We=I/7,Ee=A(u,7),Ye=Ee.indexOf(Math.max(...Ee)),D=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][Ye]||"Unknown",O=b.filter(L=>L.qaData.some(M=>M.answer&&M.answer.trim()!=="")),oe=b.length>0?O.length/b.length*100:0,ne=b.length>0?I/b.length:0,J=x>0?x/1e3*2.5:0;return{totalQuestions:I,totalCost:p,totalTokens:x,avgAccuracy:V,totalSessions:b.length,avgQuestionsPerSession:ne,successRate:oe,providerDistribution:B,questionsPerDay:Ee,inputTokens:l,outputTokens:N,avgResponseTime:J,weeklyGrowth:Ue,dailyAverage:We,peakDay:D,sentimentDistribution:h,geoScoreAverage:X,semanticRelevanceAverage:le,vectorSimilarityAverage:H}},A=(u,b)=>{const I=new Date,p=[];for(let x=b-1;x>=0;x--){const C=new Date(I);C.setDate(C.getDate()-x);const V=u.filter(B=>{const i=new Date(B.timestamp);return i.getFullYear()===C.getFullYear()&&i.getMonth()===C.getMonth()&&i.getDate()===C.getDate()}).reduce((B,i)=>B+i.qaData.length,0);p.push(V)}return p},q=()=>{const u=new Date,b=[],I=[],p=["#00ff88","#00d4aa","#00b8cc","#009cee","#0080ff","#0064ff","#0048ff","#ff6b6b","#ffa726","#ffcc02","#66bb6a","#26a69a","#42a5f5","#ab47bc","#ec407a","#ff7043","#ffca28","#8bc34a","#26c6da","#5c6bc0","#7e57c2","#ef5350","#ff9800","#ffc107","#4caf50","#00bcd4","#3f51b5","#9c27b0","#f44336","#ff5722","#ffeb3b","#8bc34a","#00bcd4","#2196f3","#9c27b0"],x=[...o];switch(w.forEach(C=>{if(C.type==="qa"){const $=C;x.push($.sessionData)}}),s){case"7d":console.log("[Statistics] Generating 7-day chart data...");for(let C=6;C>=0;C--){const $=new Date(u);$.setDate($.getDate()-C);const V=$.toLocaleDateString("en-US",{weekday:"short"});b.push(V),console.log(`[Statistics] Day ${C}: ${V} - ${$.toISOString()}`),new Date($).setHours(0,0,0,0),new Date($).setHours(23,59,59,999);const l=x.filter(N=>{try{const h=new Date(N.timestamp);if(isNaN(h.getTime()))return console.warn("[Statistics] Invalid session timestamp:",N.timestamp),!1;const K=h.getFullYear()*1e4+(h.getMonth()+1)*100+h.getDate(),X=$.getFullYear()*1e4+($.getMonth()+1)*100+$.getDate();return K===X}catch(h){return console.error("[Statistics] Error parsing session timestamp:",N.timestamp,h),!1}});if(r==="questions"){const N=l.reduce((h,K)=>h+K.qaData.length,0);console.log(`[Statistics] Day ${b[b.length-1]}: ${l.length} sessions, ${N} questions`),I.push(N)}else if(r==="cost"){const N=l.reduce((h,K)=>h+parseFloat(K.statistics?.totalCost||"0"),0);I.push(N)}else r==="sessions"&&I.push(l.length)}break;case"30d":console.log("[Statistics] Generating 30-day chart data...");for(let C=29;C>=0;C--){const $=new Date(u);$.setDate($.getDate()-C);const V=$.toLocaleDateString("en-US",{month:"short",day:"numeric"});b.push(V),console.log(`[Statistics] Day ${C}: ${V} - ${$.toISOString()}`),new Date($).setHours(0,0,0,0),new Date($).setHours(23,59,59,999);const l=x.filter(N=>{try{const h=new Date(N.timestamp);if(isNaN(h.getTime()))return console.warn("[Statistics] Invalid session timestamp:",N.timestamp),!1;const K=h.getFullYear()*1e4+(h.getMonth()+1)*100+h.getDate(),X=$.getFullYear()*1e4+($.getMonth()+1)*100+$.getDate();return K===X}catch(h){return console.error("[Statistics] Error parsing session timestamp:",N.timestamp,h),!1}});if(r==="questions"){const N=l.reduce((h,K)=>h+K.qaData.length,0);console.log(`[Statistics] Day ${b[b.length-1]}: ${l.length} sessions, ${N} questions`),I.push(N)}else if(r==="cost"){const N=l.reduce((h,K)=>h+parseFloat(K.statistics?.totalCost||"0"),0);I.push(N)}else r==="sessions"&&I.push(l.length)}break}return{labels:b,values:I,colors:p}},R=E(),U=q(),Z=[...o];if(w.forEach(u=>{if(u.type==="qa"){const b=u;Z.push(b.sessionData)}}),Z.length>0){const u=Z[0];console.log("[Statistics] Sample session structure:",{id:u.id,timestamp:u.timestamp,qaDataLength:u.qaData.length,qaDataSample:u.qaData.slice(0,2).map(b=>({question:b.question.substring(0,50)+"...",hasAnswer:!!b.answer}))})}console.log("[Statistics] Sessions from prop:",o.length),console.log("[Statistics] QA items from history:",w.filter(u=>u.type==="qa").length),console.log("[Statistics] Total sessions for stats:",Z.length),console.log("[Statistics] Current session QA count:",t?.qaData.length||0),console.log("[Statistics] Chart data:",U),console.log("[Statistics] Provider distribution:",R.providerDistribution),t&&console.log("[Statistics] Current session active:",{id:t.id,qaDataLength:t.qaData?.length||0}),Z.length>0&&console.log("[Statistics] Sample session timestamps:",Z.slice(0,3).map(u=>({id:u.id,timestamp:u.timestamp,qaDataLength:u.qaData.length,date:new Date(u.timestamp).toLocaleDateString()})));const re=U.values.length>0?Math.max(...U.values,1):1;if(!U.values.some(u=>u>0)&&Z.length>0)if(console.log("[Statistics] No data found in chart, showing fallback data"),t&&t.qaData.length>0){const u=t.qaData.length,b=Math.ceil(u/7);U.values=U.values.map((I,p)=>p===0?Math.floor(b*.8):p===1?Math.floor(b*1.2):p===2?Math.floor(b*1):p===3?Math.floor(b*.9):p===4?Math.floor(b*1.1):p===5?Math.floor(b*.7):p===6?Math.floor(b*.6):0)}else{const u=o.reduce((b,I)=>b+I.qaData.length,0);if(u>0){const b=Math.ceil(u/7);U.values=U.values.map((I,p)=>p===0?Math.floor(b*.8):p===1?Math.floor(b*1.2):p===2?Math.floor(b*1):p===3?Math.floor(b*.9):p===4?Math.floor(b*1.1):p===5?Math.floor(b*.7):p===6?Math.floor(b*.6):0)}}const T=R.providerDistribution,f=["#00ff88","#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57"],S=u=>({openai:"ChatGPT",gemini:"Gemini",perplexity:"Perplexity",Unknown:"Unknown"})[u]||u;return m.useEffect(()=>{const u=localStorage.getItem(Ot);if(u)try{const b=JSON.parse(u);b.timeRange&&a(b.timeRange),b.selectedMetric&&n(b.selectedMetric)}catch{}},[]),m.useEffect(()=>{localStorage.setItem(Ot,JSON.stringify({timeRange:s,selectedMetric:r}))},[s,r]),e.jsxs("div",{className:"w-full max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-black",children:"Live Analytics Dashboard"})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-700",children:(()=>{let u=null,b=0;const I=["llm_qa_current_session","current_session","qa_session","enhance_content_state"];for(const p of I)try{const x=localStorage.getItem(p);if(x){const C=JSON.parse(x);console.log(`[Statistics] Found data in ${p}:`,{hasQaData:!!C.qaData,qaDataLength:C.qaData?.length,hasQaItems:!!C.qaItems,qaItemsLength:C.qaItems?.length}),C.qaData&&Array.isArray(C.qaData)&&C.qaData.length>0?(b=Math.max(b,C.qaData.length),u=C):C.qaItems&&Array.isArray(C.qaItems)&&C.qaItems.length>0&&(b=Math.max(b,C.qaItems.length),u=C)}}catch(x){console.error(`[Statistics] Error parsing ${p}:`,x)}if(console.log("[Statistics] Current Questions Debug:",{hasCurrentSession:!!t,currentSessionId:t?.id,propQaDataLength:t?.qaData?.length,hasStorageSession:!!u,totalQuestionsFound:b,overallStats:R.totalQuestions}),b>0)return console.log("[Statistics] Using localStorage session data:",b,"questions"),b;if(t&&t.qaData&&Array.isArray(t.qaData))return console.log("[Statistics] Using current session prop data:",t.qaData.length,"questions"),t.qaData.length;try{const p=Object.keys(localStorage).filter(x=>x.startsWith("enhance_content_cache_"));for(const x of p){const C=JSON.parse(localStorage.getItem(x)||"{}");if(C.qaItems&&Array.isArray(C.qaItems)&&C.qaItems.length>0)return console.log("[Statistics] Using cached enhance content data:",C.qaItems.length,"questions"),C.qaItems.length}}catch(p){console.error("[Statistics] Error checking enhance content cache:",p)}return console.log("[Statistics] Using overall stats fallback:",R.totalQuestions,"questions"),R.totalQuestions})()}),e.jsx("div",{className:"text-xs sm:text-sm text-blue-600 font-medium",children:(()=>{let u=!1;t&&t.qaData&&Array.isArray(t.qaData)&&t.qaData.length>0&&(u=!0);const b=["llm_qa_current_session","current_session","qa_session","enhance_content_state"];for(const I of b)try{const p=localStorage.getItem(I);if(p){const x=JSON.parse(p);if(x.qaData&&Array.isArray(x.qaData)&&x.qaData.length>0||x.qaItems&&Array.isArray(x.qaItems)&&x.qaItems.length>0){u=!0;break}}}catch{}try{const I=Object.keys(localStorage).filter(p=>p.startsWith("enhance_content_cache_"));for(const p of I){const x=JSON.parse(localStorage.getItem(p)||"{}");if(x.qaItems&&Array.isArray(x.qaItems)&&x.qaItems.length>0){u=!0;break}}}catch{}return u?"Current Questions":"Total Questions"})()}),(()=>{let u=!1;t&&t.qaData&&Array.isArray(t.qaData)&&t.qaData.length>0&&(u=!0);const b=["llm_qa_current_session","current_session","qa_session","enhance_content_state"];for(const I of b)try{const p=localStorage.getItem(I);if(p){const x=JSON.parse(p);if(x.qaData&&Array.isArray(x.qaData)&&x.qaData.length>0||x.qaItems&&Array.isArray(x.qaItems)&&x.qaItems.length>0){u=!0;break}}}catch{}return u?e.jsx("div",{className:"text-xs text-blue-500 mt-1",children:"Live Session"}):null})()]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-700",children:(()=>{let u=null,b=0,I=0;const p=["llm_qa_current_session","current_session","qa_session","enhance_content_state"];for(const x of p)try{const C=localStorage.getItem(x);if(C){const $=JSON.parse(C);console.log(`[Statistics] Accuracy - Found data in ${x}:`,{hasQaData:!!$.qaData,qaDataLength:$.qaData?.length,hasQaItems:!!$.qaItems,qaItemsLength:$.qaItems?.length});const V=$.qaData||$.qaItems;if(V&&Array.isArray(V)&&V.length>0){const B=V.filter(i=>i.answer&&i.answer.trim()!=="");if(console.log(`[Statistics] Accuracy - Found ${B.length} answered questions in ${x}`),B.length>0){let i=0,l=0;if(B.forEach(N=>{if(console.log("[Statistics] Accuracy - Processing QA:",{hasAnswer:!!N.answer,accuracyType:typeof N.accuracy,accuracyValue:N.accuracy,geoScore:N.geoScore}),N.accuracy!==void 0&&N.accuracy!==null){let h=0;typeof N.accuracy=="string"?h=parseFloat(N.accuracy.replace("%","")):typeof N.accuracy=="number"?h=N.accuracy:N.accuracy&&typeof N.accuracy=="object"&&N.accuracy.accuracy!==void 0&&(h=parseFloat(N.accuracy.accuracy.toString().replace("%",""))),isNaN(h)||(i+=h,l++,console.log(`[Statistics] Accuracy - Valid accuracy found: ${h}%`))}}),l>0){const N=i/l;console.log(`[Statistics] Accuracy - Session average: ${N.toFixed(1)}%`),b+=i,I+=l,u=$}}}}}catch(C){console.error(`[Statistics] Error parsing ${x} for accuracy:`,C)}try{const x=Object.keys(localStorage).filter(C=>C.startsWith("enhance_content_cache_"));for(const C of x){const $=JSON.parse(localStorage.getItem(C)||"{}");if($.qaItems&&Array.isArray($.qaItems)&&$.qaItems.length>0){const V=$.qaItems.filter(B=>B.answer&&B.answer.trim()!=="");if(console.log(`[Statistics] Accuracy - Found ${V.length} answered questions in cache ${C}`),V.length>0){let B=0,i=0;if(V.forEach(l=>{if(l.accuracy!==void 0&&l.accuracy!==null){let N=0;typeof l.accuracy=="string"?N=parseFloat(l.accuracy.replace("%","")):typeof l.accuracy=="number"?N=l.accuracy:l.accuracy&&typeof l.accuracy=="object"&&l.accuracy.accuracy!==void 0&&(N=parseFloat(l.accuracy.accuracy.toString().replace("%",""))),isNaN(N)||(B+=N,i++)}}),i>0){const l=B/i;console.log(`[Statistics] Accuracy - Cache average: ${l.toFixed(1)}%`),b+=B,I+=i}}}}}catch(x){console.error("[Statistics] Error checking enhance content cache for accuracy:",x)}if(console.log("[Statistics] Accuracy Debug:",{hasCurrentSession:!!t,currentSessionId:t?.id,propQaDataLength:t?.qaData?.length,hasStorageSession:!!u,totalAccuracyFound:b,validAccuracyCount:I,overallStats:R.averageAccuracy}),I>0){const x=b/I;return console.log("[Statistics] Using localStorage accuracy data:",x.toFixed(1)+"%"),x.toFixed(1)}if(t&&t.qaData&&Array.isArray(t.qaData)&&t.qaData.length>0){const x=t.qaData.filter($=>$.answer&&$.answer.trim()!=="");if(x.length>0){let $=0,V=0;if(x.forEach(B=>{if(B.accuracy!==void 0&&B.accuracy!==null){let i=0;typeof B.accuracy=="string"?i=parseFloat(B.accuracy.replace("%","")):typeof B.accuracy=="number"?i=B.accuracy:B.accuracy&&typeof B.accuracy=="object"&&B.accuracy.accuracy!==void 0&&(i=parseFloat(B.accuracy.accuracy.toString().replace("%",""))),isNaN(i)||($+=i,V++)}}),V>0){const B=$/V;return console.log("[Statistics] Using current session prop accuracy data:",B.toFixed(1)+"%"),B.toFixed(1)}}const C=t.qaData.filter($=>$.geoScore!==void 0&&$.geoScore!==null);if(C.length>0){const B=(C.reduce((i,l)=>i+(l.geoScore||0),0)/C.length*20).toFixed(1);return console.log("[Statistics] Using geoScore fallback accuracy:",B+"%"),B}return console.log("[Statistics] Using default accuracy for answered questions: 75.0%"),"75.0"}return console.log("[Statistics] Using overall stats accuracy fallback:",R.averageAccuracy||"0"),R.averageAccuracy||"0"})()}),e.jsx("div",{className:"text-xs sm:text-sm text-green-600 font-medium",children:(()=>{let u=!1;t&&t.qaData&&Array.isArray(t.qaData)&&t.qaData.length>0&&(u=!0);const b=["llm_qa_current_session","current_session","qa_session","enhance_content_state"];for(const I of b)try{const p=localStorage.getItem(I);if(p){const x=JSON.parse(p);if(x.qaData&&Array.isArray(x.qaData)&&x.qaData.length>0||x.qaItems&&Array.isArray(x.qaItems)&&x.qaItems.length>0){u=!0;break}}}catch{}try{const I=Object.keys(localStorage).filter(p=>p.startsWith("enhance_content_cache_"));for(const p of I){const x=JSON.parse(localStorage.getItem(p)||"{}");if(x.qaItems&&Array.isArray(x.qaItems)&&x.qaItems.length>0){u=!0;break}}}catch{}return u?"Current Accuracy":"Avg Accuracy"})()}),(()=>{let u=!1;t&&t.qaData&&Array.isArray(t.qaData)&&t.qaData.length>0&&(u=!0);const b=["llm_qa_current_session","current_session","qa_session","enhance_content_state"];for(const I of b)try{const p=localStorage.getItem(I);if(p){const x=JSON.parse(p);if(x.qaData&&Array.isArray(x.qaData)&&x.qaData.length>0||x.qaItems&&Array.isArray(x.qaItems)&&x.qaItems.length>0){u=!0;break}}}catch{}return u?e.jsx("div",{className:"text-xs text-green-500 mt-1",children:"Live Session"}):null})()]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-purple-700",children:["$",t&&t.qaData&&Array.isArray(t.qaData)&&t.qaData.length>0?t.qaData.reduce((b,I)=>b+(I.cost||0),0).toFixed(5):parseFloat(R.totalCost).toFixed(5)]}),e.jsx("div",{className:"text-xs sm:text-sm text-purple-600 font-medium",children:t&&t.qaData&&Array.isArray(t.qaData)?"Current Cost":"Total Cost"}),t&&t.qaData&&Array.isArray(t.qaData)&&e.jsx("div",{className:"text-xs text-purple-500 mt-1",children:"Live Session"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-orange-700",children:t&&t.qaData&&Array.isArray(t.qaData)&&t.qaData.length>0?t.qaData.reduce((b,I)=>b+(I.totalTokens||0),0).toLocaleString():R.totalTokens.toLocaleString()}),e.jsx("div",{className:"text-xs sm:text-sm text-orange-600 font-medium",children:t&&t.qaData&&Array.isArray(t.qaData)?"Current Tokens":"Total Tokens"}),t&&t.qaData&&Array.isArray(t.qaData)&&e.jsx("div",{className:"text-xs text-orange-500 mt-1",children:"Live Session"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pt,{className:"w-6 h-6 text-blue-600"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[r==="questions"?"Questions Generated":r==="cost"?"Cost Analysis":"Sessions Created"," - ",s==="7d"?"Last 7 Days":"Last 30 Days",s==="30d"&&e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(Scroll to see all days)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s,onChange:u=>a(u.target.value),className:"bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"7d",children:"7 Days"}),e.jsx("option",{value:"30d",children:"30 Days"})]}),e.jsxs("select",{value:r,onChange:u=>n(u.target.value),className:"bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"questions",children:"Questions"}),e.jsx("option",{value:"cost",children:"Cost"}),e.jsx("option",{value:"sessions",children:"Sessions"})]})]})]}),e.jsx("div",{className:`h-64 bg-gray-50 rounded-lg w-full ${s==="30d"?"overflow-x-auto":"overflow-hidden"}`,style:{...s==="30d"&&{scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"}},children:e.jsxs("div",{className:"relative h-full flex items-end w-full",children:[s==="7d"&&e.jsx("div",{className:"absolute inset-0 flex items-end justify-between px-4 pb-8",children:U.values.map((u,b)=>e.jsxs("div",{className:"flex flex-col justify-end items-center h-full w-16",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 font-medium",children:r==="cost"?parseFloat(u).toFixed(5):u}),e.jsx("div",{className:"w-full rounded-t-lg transition-all duration-500 hover:opacity-80",style:{height:`${u/re*180}px`,backgroundColor:U.colors[b%U.colors.length],minHeight:"4px"}}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 text-center font-medium w-full truncate",children:U.labels[b]})]},b))}),s==="30d"&&e.jsx("div",{className:"flex items-end h-full gap-2 px-6 min-w-[1320px] pb-8",children:U.values.map((u,b)=>e.jsxs("div",{className:"flex flex-col justify-end items-center h-full w-14",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 font-medium",children:r==="cost"?parseFloat(u).toFixed(5):u}),e.jsx("div",{className:"w-full rounded-t-lg transition-all duration-500 hover:opacity-80",style:{height:`${u/re*180}px`,backgroundColor:U.colors[b%U.colors.length],minHeight:"4px"}}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 text-center font-medium w-full truncate",children:U.labels[b]})]},b))})]})}),s==="30d"&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("div",{className:"text-xs text-gray-500",children:"← Scroll horizontally to see all 30 days →"})})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(_e,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Provider Distribution"})]}),Object.keys(T).length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"relative w-48 h-48",children:[e.jsx("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:Object.entries(T).map(([u,b],I)=>{const p=Object.values(T).reduce((l,N)=>l+N,0),x=p>0?b/p*100:0,C=40,$=2*Math.PI*C,V=x/100*$,B=$-V,i=I/Object.keys(T).length*360;return e.jsx("circle",{cx:"50",cy:"50",r:C,fill:"none",stroke:f[I%f.length],strokeWidth:"8",strokeDasharray:$,strokeDashoffset:B,transform:`rotate(${i} 50 50)`,className:"transition-all duration-500"},u)})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Object.values(T).reduce((u,b)=>u+b,0)}),e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:"Total"})]})})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mt-6",children:Object.entries(T).map(([u,b],I)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:f[I%f.length]}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:S(u)}),e.jsx("span",{className:"text-sm font-bold text-blue-600 ml-auto",children:b})]},u))})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-lg font-medium",children:"No provider data available"}),e.jsx("div",{className:"text-sm",children:"Generate some questions to see provider distribution"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ys,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Token Usage"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:R.totalTokens.toLocaleString()}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Total Tokens Used"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Input Tokens"}),e.jsx("span",{className:"text-blue-600 font-semibold",children:R.inputTokens.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Output Tokens"}),e.jsx("span",{className:"text-blue-600 font-semibold",children:R.outputTokens.toLocaleString()})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ot,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Performance"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:R.avgQuestionsPerSession.toFixed(1)}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Avg Questions/Session"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Success Rate"}),e.jsxs("span",{className:"text-green-600 font-semibold",children:[R.successRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Avg Response Time"}),e.jsxs("span",{className:"text-blue-600 font-semibold",children:[R.avgResponseTime.toFixed(1),"s"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Pt,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Trends"})]}),e.jsxs("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:[R.weeklyGrowth>=0?"+":"",R.weeklyGrowth.toFixed(1),"%"]}),e.jsx("div",{className:"text-gray-600 font-medium",children:"This Week"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Daily Avg"}),e.jsx("span",{className:"text-purple-600 font-semibold",children:R.dailyAverage.toFixed(0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Peak Day"}),e.jsx("span",{className:"text-purple-600 font-semibold",children:R.peakDay})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Bt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Sentiment Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:R.sentimentDistribution.positive}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Positive"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:R.sentimentDistribution.negative}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Negative"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:R.sentimentDistribution.neutral}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Neutral"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ot,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Quality Metrics"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"GEO Score Avg"}),e.jsxs("span",{className:"text-orange-600 font-semibold",children:[R.geoScoreAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Semantic Relevance"}),e.jsxs("span",{className:"text-orange-600 font-semibold",children:[R.semanticRelevanceAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Vector Similarity"}),e.jsxs("span",{className:"text-orange-600 font-semibold",children:[R.vectorSimilarityAverage.toFixed(1),"%"]})]})]})]})]})]})}const je="http://localhost:5000/api";class Fs{config={clientId:"8d042e34-5a5f-40f5-a019-ee56de49b64e",tenantId:"c16b04b5-b78c-4cce-b3f8-93686f221d09",redirectUri:"http://localhost:5173/auth/callback",scopes:["openid","profile","email","User.Read"]};constructor(){this.config.clientId||console.error("[AuthService] Azure Client ID is not configured"),this.config.tenantId||console.error("[AuthService] Azure Tenant ID is not configured"),console.log("[AuthService] Configuration loaded:",{clientId:this.config.clientId?"Configured":"Missing",tenantId:this.config.tenantId?"Configured":"Missing",redirectUri:this.config.redirectUri})}async initializeMSAL(){try{if(typeof window<"u"&&!window.msalInstance){console.log("[AuthService] Initializing MSAL with config:",{clientId:this.config.clientId,tenantId:this.config.tenantId,redirectUri:this.config.redirectUri}),console.log("[AuthService] Importing @azure/msal-browser...");const{PublicClientApplication:t}=await Ie(async()=>{const{PublicClientApplication:s}=await import("./index-CIVusHlu.js");return{PublicClientApplication:s}},[]);console.log("[AuthService] MSAL imported successfully"),console.log("[AuthService] Creating MSAL instance..."),window.msalInstance=new t({auth:{clientId:this.config.clientId,authority:`https://login.microsoftonline.com/${this.config.tenantId}`,redirectUri:this.config.redirectUri},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}}),console.log("[AuthService] MSAL instance created"),console.log("[AuthService] Initializing MSAL instance..."),await window.msalInstance.initialize(),console.log("[AuthService] MSAL instance initialized successfully")}else console.log("[AuthService] MSAL instance already exists");return window.msalInstance}catch(t){throw console.error("[AuthService] Error initializing MSAL:",t),new Error(`Failed to initialize Microsoft Authentication: ${t instanceof Error?t.message:"Unknown error"}`)}}async testMSALConfiguration(){try{console.log("[AuthService] Testing MSAL configuration...");const t=await this.initializeMSAL();return console.log("[AuthService] MSAL configuration test successful"),!0}catch(t){return console.error("[AuthService] MSAL configuration test failed:",t),!1}}async clearActiveInteractions(t){try{console.log("[AuthService] Clearing active interactions..."),await t.clearCache(),t.browserStorage&&await t.browserStorage.clear();const s=[];for(let a=0;a<localStorage.length;a++){const r=localStorage.key(a);r&&r.includes("msal")&&s.push(r)}s.forEach(a=>localStorage.removeItem(a)),console.log("[AuthService] Active interactions cleared")}catch(s){console.warn("[AuthService] Warning clearing interactions:",s)}}resetMSALInstance(){try{console.log("[AuthService] Resetting MSAL instance..."),window.msalInstance&&delete window.msalInstance,console.log("[AuthService] MSAL instance reset")}catch(t){console.warn("[AuthService] Warning resetting MSAL instance:",t)}}async login(){try{if(console.log("[AuthService] Starting Microsoft login..."),console.log("[AuthService] Config:",this.config),!this.config.clientId||this.config.clientId==="your_azure_client_id_here")throw new Error("Azure Client ID not configured. Please set VITE_REACT_APP_AZURE_CLIENT_ID in your environment variables.");if(!this.config.tenantId||this.config.tenantId==="your_azure_tenant_id_here")throw new Error("Azure Tenant ID not configured. Please set VITE_REACT_APP_AZURE_TENANT_ID in your environment variables.");const t=await this.initializeMSAL();console.log("[AuthService] MSAL instance ready, starting login popup..."),await this.clearActiveInteractions(t);const s={scopes:this.config.scopes,prompt:"select_account"};console.log("[AuthService] Login request config:",s),console.log("[AuthService] About to call loginPopup...");let a;try{if(console.log("[AuthService] About to call MSAL loginPopup..."),a=await t.loginPopup(s),console.log("[AuthService] MSAL login successful, got access token"),console.log("[AuthService] MSAL response:",{hasAccessToken:!!a.accessToken,hasAccount:!!a.account,accountName:a.account?.name,accountUsername:a.account?.username}),!a.accessToken)throw console.error("[AuthService] MSAL login succeeded but no access token received"),new Error("MSAL login succeeded but no access token received");console.log("[AuthService] MSAL access token confirmed:",{tokenLength:a.accessToken.length,tokenPreview:a.accessToken.substring(0,20)+"..."}),console.log("[AuthService] MSAL login completed successfully, proceeding to backend exchange..."),console.log("[AuthService] Checking configuration before backend call:",{hasClientId:!!this.config.clientId,hasTenantId:!!this.config.tenantId,clientId:this.config.clientId,tenantId:this.config.tenantId})}catch(n){if(console.error("[AuthService] Popup error:",n),n.errorCode==="interaction_in_progress"){console.log("[AuthService] Interaction in progress, clearing cache and retrying..."),await this.clearActiveInteractions(t),await new Promise(w=>setTimeout(w,1e3));try{a=await t.loginPopup(s),console.log("[AuthService] MSAL login successful on retry, got access token")}catch(w){throw console.error("[AuthService] Retry failed:",w),w.errorCode==="interaction_in_progress"?(console.log("[AuthService] Persistent interaction issue, resetting MSAL instance..."),this.resetMSALInstance(),new Error("Authentication session is stuck. Please refresh the page and try again.")):w}}else throw n}console.log("[AuthService] Exchanging token with backend..."),console.log("[AuthService] MSAL access token received:",{hasToken:!!a.accessToken,tokenLength:a.accessToken?.length,tokenPreview:a.accessToken?.substring(0,20)+"..."}),console.log("[AuthService] About to start backend token exchange process...");let r;try{console.log("[AuthService] About to call exchangeTokenForBackendToken..."),console.log("[AuthService] Backend URL will be:",`${je}/auth/login`),console.log("[AuthService] Making backend request..."),r=await this.exchangeTokenForBackendToken(a.accessToken),console.log("[AuthService] Backend token exchange successful")}catch(n){throw console.error("[AuthService] Backend token exchange failed:",n),console.error("[AuthService] Backend error details:",{message:n.message,stack:n.stack}),n}if(console.log("[AuthService] Backend response received:",{type:typeof r,keys:Object.keys(r),hasAccessToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,hasExpiresAt:!!r.expiresAt}),console.log("[AuthService] About to store tokens:",{accessToken:!!r.accessToken,refreshToken:!!r.refreshToken,expiresAt:r.expiresAt,accessTokenLength:r.accessToken?.length,refreshTokenLength:r.refreshToken?.length}),!r.accessToken||!r.refreshToken||!r.expiresAt){if(console.error("[AuthService] Missing required token fields:",{accessToken:!!r.accessToken,refreshToken:!!r.refreshToken,expiresAt:!!r.expiresAt}),!r.accessToken)throw new Error("Backend response missing access token");const n=new Date;n.setDate(n.getDate()+7);const w="fallback-refresh-"+Date.now();console.log("[AuthService] Using fallback values:",{expiresAt:n.toISOString(),refreshToken:w}),r.refreshToken=r.refreshToken||w,r.expiresAt=r.expiresAt||n.toISOString()}return this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),console.log("[AuthService] Tokens stored successfully"),r}catch(t){throw console.error("[AuthService] Microsoft login error:",t),t instanceof Error?new Error(`Microsoft authentication failed: ${t.message}`):new Error("Failed to authenticate with Microsoft Entra ID")}}async googleLogin(){try{const t="1003899655255-ib2ru0fiq7apqbgt4ifk48rmka88kqf0.apps.googleusercontent.com";return await this.loadGoogleIdentityServices(),new Promise((s,a)=>{let r=!1;const n=setTimeout(()=>{r||(r=!0,a(new Error("Google authentication timed out. Please try again.")))},6e4);try{window.google.accounts.oauth2.initTokenClient({client_id:t,scope:"openid profile email",prompt:"select_account",callback:async y=>{try{if(r)return;if(clearTimeout(n),y.error){r=!0,a(new Error(`Google OAuth error: ${y.error}`));return}if(!y.access_token){r=!0,a(new Error("No access token received from Google"));return}console.log("✅ [AuthService] Google OAuth successful, got access token");const F=await this.exchangeGoogleTokenForBackendToken(y.access_token);this.setTokens(F.accessToken,F.refreshToken,F.expiresAt),r=!0,s(F)}catch(F){r||(r=!0,clearTimeout(n),a(F))}}}).requestAccessToken()}catch(d){r||(r=!0,clearTimeout(n),a(new Error(`Failed to initialize Google OAuth: ${d instanceof Error?d.message:"Unknown error"}`)))}const w=()=>{clearTimeout(n)},j=s,g=a;s=d=>{w(),j(d)},a=d=>{w(),g(d)}})}catch(t){throw console.error("Google login error:",t),new Error(`Failed to authenticate with Google: ${t instanceof Error?t.message:"Unknown error"}`)}}async loadGoogleIdentityServices(){return new Promise((t,s)=>{if(window.google){t();return}const a=document.createElement("script");a.src="https://accounts.google.com/gsi/client",a.async=!0,a.defer=!0,a.onload=()=>t(),a.onerror=()=>s(new Error("Failed to load Google Identity Services")),document.head.appendChild(a)})}async googleLoginOneTap(){try{return await this.loadGoogleIdentityServices(),new Promise((t,s)=>{window.google.accounts.id.initialize({client_id:"1003899655255-ib2ru0fiq7apqbgt4ifk48rmka88kqf0.apps.googleusercontent.com",callback:async a=>{try{if(a.error){s(new Error(a.error));return}const r=await this.exchangeGoogleTokenForBackendToken(a.credential);this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),t(r)}catch(r){s(r)}}}),window.google.accounts.id.prompt()})}catch(t){throw console.error("Google One Tap login error:",t),new Error("Failed to authenticate with Google")}}async exchangeGoogleTokenForBackendToken(t){try{const a=await(await fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${t}`)).json(),r=await fetch(`${je}/auth/google-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:t,userInfo:a})});if(!r.ok){const w=await r.json().catch(()=>({}));throw new Error(w.error||"Failed to authenticate with backend")}const n=await r.json();return console.log("✅ [AuthService] Google token exchange successful, received data:",{user:n.user,hasAccessToken:!!n.accessToken,hasRefreshToken:!!n.refreshToken,expiresAt:n.expiresAt}),this.setTokens(n.accessToken,n.refreshToken,n.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Google login"),n}catch(s){throw console.error("Error exchanging Google token:",s),new Error("Failed to authenticate with backend")}}async localLogin(t){try{if(console.log("🔐 [AuthService] Starting local login with credentials:",{email:t.email,passwordLength:t.password.length}),console.log("🌐 [AuthService] API Base URL:",je),!t.email||!t.password)throw new Error("Email and password are required");if(!t.email.includes("@"))throw new Error("Please enter a valid email address");if(t.password.length<6)throw new Error("Password must be at least 6 characters long");const s=await fetch(`${je}/auth/local-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("📡 [AuthService] Local login response status:",s.status),!s.ok){const r=await s.json().catch(()=>({}));throw console.error("❌ [AuthService] Local login failed:",r),s.status===401?new Error("Invalid email or password. Please check your credentials and try again."):s.status===404?new Error("User not found. Please check your email or sign up for a new account."):s.status===500?new Error("Server error. Please try again later or contact support."):new Error(r.error||`Login failed with status ${s.status}`)}const a=await s.json();if(console.log("✅ [AuthService] Local login successful, received data:",{user:a.user,hasAccessToken:!!a.accessToken,hasRefreshToken:!!a.refreshToken,expiresAt:a.expiresAt}),!a.accessToken||!a.refreshToken||!a.expiresAt)throw new Error("Invalid response from server. Missing authentication tokens.");return this.setTokens(a.accessToken,a.refreshToken,a.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for local login"),a}catch(s){throw console.error("❌ [AuthService] Local login error:",s),s instanceof Error?s:new Error("Local authentication failed. Please try again.")}}async register(t){try{console.log("🔐 Registering user with credentials:",{...t,password:"[HIDDEN]"}),console.log("🌐 API Base URL:",je);const s=await fetch(`${je}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("📡 Registration response status:",s.status),!s.ok){const r=await s.json().catch(()=>({}));throw console.error("❌ Registration failed:",r),new Error(r.error||"Failed to register user")}const a=await s.json();return console.log("✅ Registration successful, received data:",{user:a.user,hasAccessToken:!!a.accessToken,hasRefreshToken:!!a.refreshToken,expiresAt:a.expiresAt}),this.setTokens(a.accessToken,a.refreshToken,a.expiresAt),console.log("💾 Tokens stored successfully"),a}catch(s){throw console.error("❌ Registration error:",s),new Error(s instanceof Error?s.message:"Registration failed")}}async exchangeTokenForBackendToken(t){console.log("[AuthService] Exchanging token with backend..."),console.log("[AuthService] Backend URL:",`${je}/auth/login`),console.log("[AuthService] Request payload:",{clientId:this.config.clientId,tenantId:this.config.tenantId,hasToken:!!t,tokenLength:t?.length});try{const s=await fetch(`${je}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({msalToken:t,clientId:this.config.clientId,tenantId:this.config.tenantId})});if(console.log("[AuthService] Backend response status:",s.status),console.log("[AuthService] Backend response headers:",Object.fromEntries(s.headers.entries())),!s.ok){const r=await s.json().catch(()=>({}));throw console.error("[AuthService] Backend error response:",r),new Error(r.error||`Backend authentication failed with status ${s.status}`)}const a=await s.json();if(console.log("[AuthService] Backend success response:",{hasUser:!!a.user,hasToken:!!a.accessToken,hasRefreshToken:!!a.refreshToken,hasExpiresAt:!!a.expiresAt,userEmail:a.user?.email,expiresAt:a.expiresAt,accessTokenLength:a.accessToken?.length,refreshTokenLength:a.refreshToken?.length}),console.log("[AuthService] Full backend response:",a),console.log("[AuthService] Response keys:",Object.keys(a)),!a.accessToken||!a.refreshToken||!a.expiresAt){if(console.error("[AuthService] Backend response missing required fields:",{hasAccessToken:!!a.accessToken,hasRefreshToken:!!a.refreshToken,hasExpiresAt:!!a.expiresAt,availableKeys:Object.keys(a)}),console.warn("[AuthService] Attempting to handle missing fields..."),!a.accessToken)throw new Error("Backend response is missing access token");const r=new Date;r.setDate(r.getDate()+7);const n="temp-refresh-token-"+Date.now();console.log("[AuthService] Using default values:",{expiresAt:r.toISOString(),refreshToken:n});const w={...a,refreshToken:a.refreshToken||n,expiresAt:a.expiresAt||r.toISOString()};return this.setTokens(w.accessToken,w.refreshToken,w.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Microsoft login"),w}return this.setTokens(a.accessToken,a.refreshToken,a.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Microsoft login"),a}catch(s){throw console.error("[AuthService] Fetch error:",s),new Error(`Network error: ${s instanceof Error?s.message:"Unknown error"}`)}}async logout(){try{console.log("[AuthService] Starting logout process..."),await this.clearBackendSession(),console.log("[AuthService] Backend session cleared"),this.clearAllAuthData(),console.log("[AuthService] All authentication data cleared");try{window.msalInstance&&typeof window.msalInstance.clearCache=="function"&&(window.msalInstance.clearCache(),console.log("[AuthService] MSAL cache cleared"))}catch(t){console.warn("[AuthService] MSAL cache clear failed, but tokens cleared:",t)}console.log("[AuthService] Logout completed successfully")}catch(t){console.error("[AuthService] Logout error:",t),this.clearAllAuthData()}}async clearBackendSession(){try{const t=this.getAccessToken();t&&await fetch(`${je}/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})}catch(t){console.error("Error clearing backend session:",t)}}async getCurrentUser(){try{const t=this.getAccessToken();if(!t)return null;const s=await fetch(`${je}/auth/me`,{headers:{Authorization:`Bearer ${t}`}});return s.ok?s.json():s.status===401&&await this.refreshToken()?this.getCurrentUser():(this.clearTokens(),null)}catch(t){return console.error("Error getting current user:",t),this.clearTokens(),null}}async refreshToken(){try{const t=this.getRefreshToken();if(!t)return this.clearTokens(),!1;const s=await fetch(`${je}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!s.ok)return this.clearTokens(),!1;const a=await s.json();return this.setTokens(a.accessToken,a.refreshToken,a.expiresAt),!0}catch(t){return console.error("Error refreshing token:",t),this.clearTokens(),!1}}isAuthenticated(){const t=this.getAccessToken(),s=this.getExpiresAt();if(console.log("[AuthService] Checking authentication:",{hasToken:!!t,hasExpiresAt:!!s,expiresAt:s,currentTime:new Date().toISOString(),tokenExpiry:s?new Date(s).toISOString():"N/A",isExpired:s?new Date(s)<=new Date:"N/A"}),!t||!s)return console.log("[AuthService] Authentication failed: missing token or expiry"),!1;const a=new Date,n=new Date(s)>a;return n||(console.log("[AuthService] Token expired, clearing stale tokens"),this.clearTokens()),console.log("[AuthService] Token validity check:",{isValid:n}),n}getAccessToken(){return localStorage.getItem("accessToken")}getRefreshToken(){return localStorage.getItem("refreshToken")}getExpiresAt(){return localStorage.getItem("expiresAt")}setTokens(t,s,a){console.log("[AuthService] Setting tokens in localStorage:",{hasAccessToken:!!t,hasRefreshToken:!!s,expiresAt:a,accessTokenLength:t?.length,refreshTokenLength:s?.length}),localStorage.setItem("accessToken",t),localStorage.setItem("refreshToken",s),localStorage.setItem("expiresAt",a),console.log("[AuthService] Tokens stored, verification:",{storedAccessToken:!!localStorage.getItem("accessToken"),storedRefreshToken:!!localStorage.getItem("refreshToken"),storedExpiresAt:localStorage.getItem("expiresAt")})}clearTokens(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("expiresAt")}clearAllAuthData(){console.log("[AuthService] Clearing all authentication data..."),this.clearTokens(),["llm_qa_current_session","structure_last_saved","overview_market_analysis","llm_qa_sessions","comprehensive_history"].forEach(s=>{try{localStorage.getItem(s)&&(console.log(`[AuthService] Clearing conflicting localStorage key: ${s}`),localStorage.removeItem(s))}catch(a){console.warn(`[AuthService] Could not clear ${s}:`,a)}}),console.log("[AuthService] All authentication data cleared")}getAuthHeaders(){const t=this.getAccessToken();return t?{Authorization:`Bearer ${t}`}:{}}}const se=new Fs,Es={isAuthenticated:!1,user:null,isLoading:!0,error:null};function Ts(o,t){switch(t.type){case"AUTH_START":return{...o,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...o,isAuthenticated:!0,user:t.payload.user,isLoading:!1,error:null};case"AUTH_FAILURE":return{...o,isAuthenticated:!1,user:null,isLoading:!1,error:t.payload};case"AUTH_LOGOUT":return{...o,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...o,error:null};default:return o}}const Gt=m.createContext(void 0);function Ds({children:o}){const[t,s]=m.useReducer(Ts,Es);m.useEffect(()=>{(async()=>{try{console.log("🔐 AuthContext: Checking authentication status on mount..."),s({type:"AUTH_START"});const d=new Date,y=se.getExpiresAt();if(y&&new Date(y)<=d){console.log("🔐 AuthContext: Token expired, clearing stale tokens"),se.clearTokens(),s({type:"AUTH_FAILURE",payload:null});return}if(se.isAuthenticated()){console.log("🔐 AuthContext: User is authenticated, getting user info...");const F=await se.getCurrentUser();F?(console.log("🔐 AuthContext: User info retrieved, dispatching AUTH_SUCCESS"),s({type:"AUTH_SUCCESS",payload:{user:F,token:se.getAccessToken()}})):(console.log("🔐 AuthContext: Failed to get user info, clearing tokens"),se.clearTokens(),s({type:"AUTH_FAILURE",payload:"Failed to get user information"}))}else console.log("🔐 AuthContext: User is not authenticated"),s({type:"AUTH_FAILURE",payload:null})}catch(d){console.error("🔐 AuthContext: Auth check error:",d),se.clearTokens(),s({type:"AUTH_FAILURE",payload:d instanceof Error?d.message:"Authentication failed"})}})()},[]);const j={...t,login:async(g="microsoft",d)=>{try{console.log("🔐 AuthContext: Starting login with method:",g),console.log("🔐 AuthContext: Clearing stale authentication data..."),se.clearTokens(),["llm_qa_current_session","structure_last_saved","overview_market_analysis"].forEach(A=>{try{localStorage.getItem(A)&&(console.log(`🔐 AuthContext: Clearing conflicting localStorage key: ${A}`),localStorage.removeItem(A))}catch(q){console.warn(`🔐 AuthContext: Could not clear ${A}:`,q)}}),s({type:"AUTH_START"});let F;switch(g){case"local":console.log("🔐 AuthContext: Using local login"),F=await se.localLogin(d);break;case"register":console.log("🔐 AuthContext: Using register method"),F=await se.register(d);break;case"google":console.log("🔐 AuthContext: Using Google login"),F=await se.googleLogin();break;case"microsoft":default:console.log("🔐 AuthContext: Using Microsoft login"),F=await se.login();break}console.log("✅ AuthContext: Login successful, dispatching AUTH_SUCCESS with:",{user:F.user,hasToken:!!F.accessToken}),console.log("🔐 AuthContext: Verifying token storage..."),await new Promise(A=>setTimeout(A,100));const P=se.isAuthenticated(),E=se.getAccessToken();if(console.log("🔐 AuthContext: Token verification:",{isAuthValid:P,hasStoredToken:!!E,tokenMatches:E===F.accessToken}),!P||!E){console.error("🔐 AuthContext: Token storage verification failed, clearing tokens and retrying..."),se.clearTokens(),se.setTokens(F.accessToken,F.refreshToken,F.expiresAt),await new Promise(R=>setTimeout(R,100));const A=se.isAuthenticated(),q=se.getAccessToken();if(console.log("🔐 AuthContext: Retry verification:",{isAuthValid:A,hasStoredToken:!!q,tokenMatches:q===F.accessToken}),!A||!q)throw new Error("Failed to store authentication tokens")}console.log("🔐 AuthContext: Dispatching AUTH_SUCCESS with user:",F.user),s({type:"AUTH_SUCCESS",payload:{user:F.user,token:F.accessToken}}),console.log("🔐 AuthContext: AUTH_SUCCESS dispatched"),setTimeout(()=>{console.log("🔐 AuthContext: State after dispatch:",{isAuthenticated:se.isAuthenticated(),hasToken:!!se.getAccessToken(),user:se.getCurrentUser()})},100)}catch(y){console.error("❌ AuthContext: Login failed:",y),se.clearTokens(),s({type:"AUTH_FAILURE",payload:y instanceof Error?y.message:"Login failed"})}},logout:async()=>{try{await se.logout(),s({type:"AUTH_LOGOUT"})}catch(g){console.error("Logout error:",g),se.clearTokens(),s({type:"AUTH_LOGOUT"})}},clearError:()=>{s({type:"CLEAR_ERROR"})},refreshUser:async()=>{try{const g=await se.getCurrentUser();g?s({type:"AUTH_SUCCESS",payload:{user:g,token:se.getAccessToken()}}):(se.clearTokens(),s({type:"AUTH_FAILURE",payload:"Failed to refresh user information"}))}catch(g){se.clearTokens(),s({type:"AUTH_FAILURE",payload:g instanceof Error?g.message:"Failed to refresh user"})}}};return e.jsx(Gt.Provider,{value:j,children:o})}function it(){const o=m.useContext(Gt);if(o===void 0)throw new Error("useAuth must be used within an AuthProvider");return o}const lt=({error:o,onClose:t,autoClose:s=!0,autoCloseDelay:a=5e3,type:r="error"})=>{const[n,w]=m.useState(!1);if(m.useEffect(()=>{if(o){if(console.log("🔔 [ErrorNotification] Error received:",o),w(!0),s){const d=setTimeout(()=>{console.log("🔔 [ErrorNotification] Auto-closing notification"),w(!1),setTimeout(t,300)},a);return()=>clearTimeout(d)}}else console.log("🔔 [ErrorNotification] No error, hiding notification"),w(!1)},[o,s,a,t]),!o)return null;const g={error:{container:"bg-red-50 border-red-200",icon:"text-red-500",title:"text-red-800",text:"text-red-700",closeButton:"text-red-400 hover:text-red-600",progressBg:"bg-red-200",progressBar:"bg-red-500",titleText:"Authentication Error"},warning:{container:"bg-yellow-50 border-yellow-200",icon:"text-yellow-500",title:"text-yellow-800",text:"text-yellow-700",closeButton:"text-yellow-400 hover:text-yellow-600",progressBg:"bg-yellow-200",progressBar:"bg-yellow-500",titleText:"Warning"},info:{container:"bg-blue-50 border-blue-200",icon:"text-blue-500",title:"text-blue-800",text:"text-blue-700",closeButton:"text-blue-400 hover:text-blue-600",progressBg:"bg-blue-200",progressBar:"bg-blue-500",titleText:"Information"}}[r];return e.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full",children:e.jsx("div",{className:`transform transition-all duration-300 ease-in-out ${n?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"}`,children:e.jsxs("div",{className:`border rounded-lg shadow-lg p-4 relative ${g.container}`,children:[e.jsx("button",{onClick:()=>{w(!1),setTimeout(t,300)},className:`absolute top-2 right-2 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 rounded-full p-1 ${g.closeButton}`,"aria-label":"Close notification",children:e.jsx(ht,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-start gap-3 pr-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(zt,{className:`w-5 h-5 ${g.icon}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-sm font-semibold mb-1 ${g.title}`,children:g.titleText}),e.jsx("p",{className:`text-sm leading-relaxed ${g.text}`,children:o})]})]}),s&&e.jsx("div",{className:`mt-3 h-1 rounded-full overflow-hidden ${g.progressBg}`,children:e.jsx("div",{className:`h-full rounded-full transition-all duration-300 ease-linear ${g.progressBar}`,style:{width:n?"0%":"100%",transitionDuration:`${a}ms`}})})]})})})},Jt=/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F900}-\u{1F9FF}]|[\u{1F018}-\u{1F270}]|[\u{238C}-\u{2454}]|[\u{20D0}-\u{20FF}]|[\u{FE00}-\u{FE0F}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F64F}]|[\u{1F910}-\u{1F96B}]|[\u{1F980}-\u{1F9E0}]|[\u{1FA70}-\u{1FA93}]|[\u{1FAB0}-\u{1FABD}]|[\u{1FAC0}-\u{1FAF0}]|[\u{1FB00}-\u{1FB4B}]|[\u{1FB50}-\u{1FBAF}]|[\u{1FBB0}-\u{1FBCA}]|[\u{1FBD0}-\u{1FBEF}]|[\u{1FBF0}-\u{1FBFF}]|[\u{1FC00}-\u{1FC23}]|[\u{1FC30}-\u{1FC56}]|[\u{1FC60}-\u{1FC78}]|[\u{1FC80}-\u{1FC9C}]|[\u{1FCA0}-\u{1FCA4}]|[\u{1FCC0}-\u{1FCC4}]|[\u{1FCD0}-\u{1FCD4}]|[\u{1FCE0}-\u{1FCE4}]|[\u{1FCF0}-\u{1FCF4}]|[\u{1FD00}-\u{1FD23}]|[\u{1FD30}-\u{1FD56}]|[\u{1FD60}-\u{1FD78}]|[\u{1FD80}-\u{1FD9C}]|[\u{1FDA0}-\u{1FDA4}]|[\u{1FDB0}-\u{1FDB4}]|[\u{1FDC0}-\u{1FDC4}]|[\u{1FDD0}-\u{1FDD4}]|[\u{1FDE0}-\u{1FDE4}]|[\u{1FDF0}-\u{1FDF4}]|[\u{1FE00}-\u{1FE23}]|[\u{1FE30}-\u{1FE56}]|[\u{1FE60}-\u{1FE78}]|[\u{1FE80}-\u{1FE9C}]|[\u{1FEA0}-\u{1FEA4}]|[\u{1FEB0}-\u{1FEB4}]|[\u{1FEC0}-\u{1FEC4}]|[\u{1FED0}-\u{1FED4}]|[\u{1FEE0}-\u{1FEE4}]|[\u{1FEF0}-\u{1FEF4}]|[\u{1FF00}-\u{1FF23}]|[\u{1FF30}-\u{1FF56}]|[\u{1FF60}-\u{1FF78}]|[\u{1FF80}-\u{1FF9C}]|[\u{1FFA0}-\u{1FFA4}]|[\u{1FFB0}-\u{1FFB4}]|[\u{1FFC0}-\u{1FFC4}]|[\u{1FFD0}-\u{1FFD4}]|[\u{1FFE0}-\u{1FFE4}]|[\u{1FFF0}-\u{1FFF4}]|[\u{2000}-\u{206F}]|[\u{2070}-\u{209F}]|[\u{20A0}-\u{20CF}]|[\u{20D0}-\u{20FF}]|[\u{2100}-\u{214F}]|[\u{2150}-\u{218F}]|[\u{2190}-\u{21FF}]|[\u{2200}-\u{22FF}]|[\u{2300}-\u{23FF}]|[\u{2400}-\u{243F}]|[\u{2440}-\u{245F}]|[\u{2460}-\u{24FF}]|[\u{2500}-\u{257F}]|[\u{2580}-\u{259F}]|[\u{25A0}-\u{25FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{27C0}-\u{27EF}]|[\u{27F0}-\u{27FF}]|[\u{2800}-\u{28FF}]|[\u{2900}-\u{297F}]|[\u{2980}-\u{29FF}]|[\u{2A00}-\u{2AFF}]|[\u{2B00}-\u{2BFF}]|[\u{2C00}-\u{2C5F}]|[\u{2C60}-\u{2C7F}]|[\u{2C80}-\u{2CFF}]|[\u{2D00}-\u{2D2F}]|[\u{2D30}-\u{2D7F}]|[\u{2D80}-\u{2DDF}]|[\u{2DE0}-\u{2DFF}]|[\u{2E00}-\u{2E7F}]|[\u{2E80}-\u{2EFF}]|[\u{2F00}-\u{2FDF}]|[\u{2FF0}-\u{2FFF}]|[\u{3000}-\u{303F}]|[\u{3040}-\u{309F}]|[\u{30A0}-\u{30FF}]|[\u{3100}-\u{312F}]|[\u{3130}-\u{318F}]|[\u{3190}-\u{319F}]|[\u{31A0}-\u{31BF}]|[\u{31C0}-\u{31EF}]|[\u{31F0}-\u{31FF}]|[\u{3200}-\u{32FF}]|[\u{3300}-\u{33FF}]|[\u{3400}-\u{4DBF}]|[\u{4DC0}-\u{4DFF}]|[\u{4E00}-\u{9FFF}]|[\u{A000}-\u{A48F}]|[\u{A490}-\u{A4CF}]|[\u{A4D0}-\u{A4FF}]|[\u{A500}-\u{A63F}]|[\u{A640}-\u{A69F}]|[\u{A6A0}-\u{A6FF}]|[\u{A700}-\u{A71F}]|[\u{A720}-\u{A7FF}]|[\u{A800}-\u{A82F}]|[\u{A830}-\u{A83F}]|[\u{A840}-\u{A87F}]|[\u{A880}-\u{A8DF}]|[\u{A8E0}-\u{A8FF}]|[\u{A900}-\u{A92F}]|[\u{A930}-\u{A95F}]|[\u{A960}-\u{A97F}]|[\u{A980}-\u{A9DF}]|[\u{A9E0}-\u{A9FF}]|[\u{AA00}-\u{AA5F}]|[\u{AA60}-\u{AA7F}]|[\u{AA80}-\u{AADF}]|[\u{AAE0}-\u{AAFF}]|[\u{AB00}-\u{AB2F}]|[\u{AB30}-\u{AB6F}]|[\u{AB70}-\u{ABBF}]|[\u{ABC0}-\u{ABFF}]|[\u{AC00}-\u{D7AF}]|[\u{D7B0}-\u{D7FF}]|[\u{D800}-\u{DB7F}]|[\u{DB80}-\u{DBFF}]|[\u{DC00}-\u{DFFF}]|[\u{E000}-\u{F8FF}]|[\u{F900}-\u{FAFF}]|[\u{FB00}-\u{FB4F}]|[\u{FB50}-\u{FDFF}]|[\u{FE00}-\u{FE0F}]|[\u{FE10}-\u{FE1F}]|[\u{FE20}-\u{FE2F}]|[\u{FE30}-\u{FE4F}]|[\u{FE50}-\u{FE6F}]|[\u{FE70}-\u{FEFF}]|[\u{FF00}-\u{FFEF}]|[\u{FFF0}-\u{FFFF}]|[\u{1B000}-\u{1B0FF}]|[\u{1B100}-\u{1B12F}]|[\u{1B130}-\u{1B16F}]|[\u{1B170}-\u{1B2FF}]|[\u{1B300}-\u{1B77F}]|[\u{1B780}-\u{1B7FF}]|[\u{1B800}-\u{1B8FF}]|[\u{1B900}-\u{1B9FF}]|[\u{1BA00}-\u{1BA6F}]|[\u{1BA70}-\u{1BAFF}]|[\u{1BB00}-\u{1BB6F}]|[\u{1BB70}-\u{1BBFF}]|[\u{1BC00}-\u{1BC9F}]|[\u{1BCA0}-\u{1BCAF}]|[\u{1BCB0}-\u{1BCFF}]|[\u{1BD00}-\u{1BD3F}]|[\u{1BD40}-\u{1BD7F}]|[\u{1BD80}-\u{1BDFF}]|[\u{1BE00}-\u{1BE6F}]|[\u{1BE70}-\u{1BEFF}]|[\u{1BF00}-\u{1BFFF}]|[\u{1C000}-\u{1C0FF}]|[\u{1C100}-\u{1C1FF}]|[\u{1C200}-\u{1C2FF}]|[\u{1C300}-\u{1C3FF}]|[\u{1C400}-\u{1C4FF}]|[\u{1C500}-\u{1C5FF}]|[\u{1C600}-\u{1C6FF}]|[\u{1C700}-\u{1C7FF}]|[\u{1C800}-\u{1C8FF}]|[\u{1C900}-\u{1C9FF}]|[\u{1CA00}-\u{1CAFF}]|[\u{1CB00}-\u{1CBFF}]|[\u{1CC00}-\u{1CCFF}]|[\u{1CD00}-\u{1CDFF}]|[\u{1CE00}-\u{1CEFF}]|[\u{1CF00}-\u{1CFFF}]|[\u{1D000}-\u{1D0FF}]|[\u{1D100}-\u{1D1FF}]|[\u{1D200}-\u{1D2FF}]|[\u{1D300}-\u{1D3FF}]|[\u{1D400}-\u{1D4FF}]|[\u{1D500}-\u{1D5FF}]|[\u{1D600}-\u{1D6FF}]|[\u{1D700}-\u{1D7FF}]|[\u{1D800}-\u{1D8FF}]|[\u{1D900}-\u{1D9FF}]|[\u{1DA00}-\u{1DAFF}]|[\u{1DB00}-\u{1DBFF}]|[\u{1DC00}-\u{1DFFF}]|[\u{1E000}-\u{1E02F}]|[\u{1E030}-\u{1E04F}]|[\u{1E050}-\u{1E06F}]|[\u{1E070}-\u{1E08F}]|[\u{1E090}-\u{1E0AF}]|[\u{1E0B0}-\u{1E0CF}]|[\u{1E0D0}-\u{1E0EF}]|[\u{1E0F0}-\u{1E0FF}]|[\u{1E100}-\u{1E12F}]|[\u{1E130}-\u{1E14F}]|[\u{1E150}-\u{1E16F}]|[\u{1E170}-\u{1E18F}]|[\u{1E190}-\u{1E1AF}]|[\u{1E1B0}-\u{1E1CF}]|[\u{1E1D0}-\u{1E1EF}]|[\u{1E1F0}-\u{1E1FF}]|[\u{1E200}-\u{1E22F}]|[\u{1E230}-\u{1E24F}]|[\u{1E250}-\u{1E26F}]|[\u{1E270}-\u{1E28F}]|[\u{1E290}-\u{1E2AF}]|[\u{1E2B0}-\u{1E2CF}]|[\u{1E2D0}-\u{1E2EF}]|[\u{1E2F0}-\u{1E2FF}]|[\u{1E300}-\u{1E32F}]|[\u{1E330}-\u{1E34F}]|[\u{1E350}-\u{1E36F}]|[\u{1E370}-\u{1E38F}]|[\u{1E390}-\u{1E3AF}]|[\u{1E3B0}-\u{1E3CF}]|[\u{1E3D0}-\u{1E3EF}]|[\u{1E3F0}-\u{1E3FF}]|[\u{1E400}-\u{1E42F}]|[\u{1E430}-\u{1E44F}]|[\u{1E450}-\u{1E46F}]|[\u{1E470}-\u{1E48F}]|[\u{1E490}-\u{1E4AF}]|[\u{1E4B0}-\u{1E4CF}]|[\u{1E4D0}-\u{1E4EF}]|[\u{1E4F0}-\u{1E4FF}]|[\u{1E500}-\u{1E52F}]|[\u{1E530}-\u{1E54F}]|[\u{1E550}-\u{1E56F}]|[\u{1E570}-\u{1E58F}]|[\u{1E590}-\u{1E5AF}]|[\u{1E5B0}-\u{1E5CF}]|[\u{1E5D0}-\u{1E5EF}]|[\u{1E5F0}-\u{1E5FF}]|[\u{1E600}-\u{1E62F}]|[\u{1E630}-\u{1E64F}]|[\u{1E650}-\u{1E66F}]|[\u{1E670}-\u{1E68F}]|[\u{1E690}-\u{1E6AF}]|[\u{1E6B0}-\u{1E6CF}]|[\u{1E6D0}-\u{1E6EF}]|[\u{1E6F0}-\u{1E6FF}]|[\u{1E700}-\u{1E72F}]|[\u{1E730}-\u{1E74F}]|[\u{1E750}-\u{1E76F}]|[\u{1E770}-\u{1E78F}]|[\u{1E790}-\u{1E7AF}]|[\u{1E7B0}-\u{1E7CF}]|[\u{1E7D0}-\u{1E7EF}]|[\u{1E7F0}-\u{1E7FF}]|[\u{1E800}-\u{1E82F}]|[\u{1E830}-\u{1E84F}]|[\u{1E850}-\u{1E86F}]|[\u{1E870}-\u{1E88F}]|[\u{1E890}-\u{1E8AF}]|[\u{1E8B0}-\u{1E8CF}]|[\u{1E8D0}-\u{1E8EF}]|[\u{1E8F0}-\u{1E8FF}]|[\u{1E900}-\u{1E92F}]|[\u{1E930}-\u{1E94F}]|[\u{1E950}-\u{1E96F}]|[\u{1E970}-\u{1E98F}]|[\u{1E990}-\u{1E9AF}]|[\u{1E9B0}-\u{1E9CF}]|[\u{1E9D0}-\u{1E9EF}]|[\u{1E9F0}-\u{1E9FF}]|[\u{1EA00}-\u{1EA2F}]|[\u{1EA30}-\u{1EA4F}]|[\u{1EA50}-\u{1EA6F}]|[\u{1EA70}-\u{1EA8F}]|[\u{1EA90}-\u{1EAAF}]|[\u{1EAB0}-\u{1EACF}]|[\u{1EAD0}-\u{1FAEF}]|[\u{1FAF0}-\u{1FAFF}]|[\u{1FB00}-\u{1FB4B}]|[\u{1FB50}-\u{1FBAF}]|[\u{1FBB0}-\u{1FBCA}]|[\u{1FBD0}-\u{1FBEF}]|[\u{1FBF0}-\u{1FBFF}]|[\u{1FC00}-\u{1FC23}]|[\u{1FC30}-\u{1FC56}]|[\u{1FC60}-\u{1FC78}]|[\u{1FC80}-\u{1FC9C}]|[\u{1FCA0}-\u{1FCA4}]|[\u{1FCC0}-\u{1FCC4}]|[\u{1FCD0}-\u{1FCD4}]|[\u{1FCE0}-\u{1FCE4}]|[\u{1FCF0}-\u{1FCF4}]|[\u{1FD00}-\u{1FD23}]|[\u{1FD30}-\u{1FD56}]|[\u{1FD60}-\u{1FD78}]|[\u{1FD80}-\u{1FD9C}]|[\u{1FDA0}-\u{1FDA4}]|[\u{1FDB0}-\u{1FDB4}]|[\u{1FDC0}-\u{1FDC4}]|[\u{1FDD0}-\u{1FDD4}]|[\u{1FDE0}-\u{1FDE4}]|[\u{1FDF0}-\u{1FDF4}]|[\u{1FE00}-\u{1FE23}]|[\u{1FE30}-\u{1FE56}]|[\u{1FE60}-\u{1FE78}]|[\u{1FE80}-\u{1FE9C}]|[\u{1FEA0}-\u{1FEA4}]|[\u{1FEB0}-\u{1FEB4}]|[\u{1FEC0}-\u{1FEC4}]|[\u{1FED0}-\u{1FED4}]|[\u{1FEE0}-\u{1FEE4}]|[\u{1FEF0}-\u{1FEF4}]|[\u{1FF00}-\u{1FF23}]|[\u{1FF30}-\u{1FF56}]|[\u{1FF60}-\u{1FF78}]|[\u{1FF80}-\u{1FF9C}]|[\u{1FFA0}-\u{1FFA4}]|[\u{1FFB0}-\u{1FFB4}]|[\u{1FFC0}-\u{1FFC4}]|[\u{1FFD0}-\u{1FFD4}]|[\u{1FFE0}-\u{1FFE4}]|[\u{1FFF0}-\u{1FFF4}]/gu,Kt=o=>!o||typeof o!="string"?o:o.replace(Jt,""),Le=(o,t)=>{const s=Kt(o.target.value);return t(s),s},Se=(o,t)=>{o.preventDefault();const s=o.clipboardData.getData("text"),a=Kt(s),r=o.target;return r.value=a,t(a),r.dispatchEvent(new Event("input",{bubbles:!0})),a},Ne=o=>{if(o.key==="Backspace"||o.key==="Delete"||o.key==="ArrowLeft"||o.key==="ArrowRight"||o.key==="ArrowUp"||o.key==="ArrowDown"||o.key==="Tab"||o.key==="Enter"||o.key==="Escape"||o.key==="Home"||o.key==="End"||o.key==="PageUp"||o.key==="PageDown")return!0;const t=o.key;return t.length===1&&Jt.test(t)?(o.preventDefault(),!1):!0},me={localPart:{minLength:1,maxLength:64,allowedChars:/^[a-zA-Z0-9._%+-]+$/,startEndRules:/^[a-zA-Z0-9].*[a-zA-Z0-9]$/,consecutiveDots:/\.{2,}/,consecutiveSpecial:/[._%+-]{2,}/},domain:{minLength:2,maxLength:63,allowedChars:/^[a-zA-Z0-9.-]+$/,startEndRules:/^[a-zA-Z0-9].*[a-zA-Z0-9]$/,consecutiveDots:/\.{2,}/,consecutiveHyphens:/-{2,}/,tldMinLength:2,tldMaxLength:10},overall:{maxLength:254}},Wt=o=>{const t=[],s=[];if(!o||typeof o!="string")return{isValid:!1,errors:["Email address is required"]};o.length>me.overall.maxLength&&t.push(`Email address is too long (maximum ${me.overall.maxLength} characters)`);const a=(o.match(/@/g)||[]).length;if(a===0?t.push("Email address must contain an @ symbol"):a>1&&t.push("Email address can only contain one @ symbol"),a!==1)return{isValid:!1,errors:t,suggestions:s};const[r,n]=o.split("@");return!r||r.length===0?t.push("Email address must have a local part (before @)"):Ls(r,t,s),!n||n.length===0?t.push("Email address must have a domain part (after @)"):Ps(n,t,s),{isValid:t.length===0,errors:t,suggestions:s.length>0?s:void 0}},ke=o=>o.toLowerCase().endsWith("@gmail.com")?Is(o):Wt(o),Is=o=>{const t=[],s=[];if(!o||typeof o!="string")return{isValid:!1,errors:["Email address is required"]};const a=o.split("@")[0];a.length<6&&t.push("Gmail local part must be at least 6 characters long"),a.length>30&&t.push("Gmail local part cannot exceed 30 characters"),(a.startsWith(".")||a.endsWith("."))&&t.push("Gmail local part must start and end with a letter or number"),/\.{2,}/.test(a)&&t.push("Gmail local part cannot contain consecutive dots");const r=Wt(o);return t.push(...r.errors),{isValid:t.length===0,errors:t,suggestions:s.length>0?s:void 0}},Ls=(o,t,s)=>{o.length<me.localPart.minLength&&t.push(`Local part must be at least ${me.localPart.minLength} characters long`),o.length>me.localPart.maxLength&&t.push(`Local part cannot exceed ${me.localPart.maxLength} characters`),me.localPart.allowedChars.test(o)||(t.push("Local part can only contain letters, numbers, and the following characters: . _ % + -"),s.push("Remove any special characters that are not allowed")),me.localPart.startEndRules.test(o)||(t.push("Local part must start and end with a letter or number"),s.push("Ensure the local part starts and ends with a letter or number")),me.localPart.consecutiveDots.test(o)&&(t.push("Local part cannot contain consecutive dots"),s.push("Remove consecutive dots from the local part")),me.localPart.consecutiveSpecial.test(o)&&(t.push("Local part cannot contain consecutive special characters"),s.push("Remove consecutive special characters from the local part")),(o.toLowerCase()==="gmail"||o.toLowerCase()==="google")&&(t.push("This local part is not allowed by Gmail"),s.push("Choose a different local part for your email address")),["admin","administrator","postmaster","abuse","webmaster","support","info"].includes(o.toLowerCase())&&s.push("This local part might be reserved. Consider using a different one.")},Ps=(o,t,s)=>{o.length<me.domain.minLength&&t.push(`Domain must be at least ${me.domain.minLength} characters long`),o.length>me.domain.maxLength&&t.push(`Domain cannot exceed ${me.domain.maxLength} characters`),me.domain.allowedChars.test(o)||(t.push("Domain can only contain letters, numbers, dots, and hyphens"),s.push("Remove any special characters that are not allowed in the domain")),me.domain.startEndRules.test(o)||(t.push("Domain must start and end with a letter or number"),s.push("Ensure the domain starts and ends with a letter or number")),me.domain.consecutiveDots.test(o)&&(t.push("Domain cannot contain consecutive dots"),s.push("Remove consecutive dots from the domain")),me.domain.consecutiveHyphens.test(o)&&(t.push("Domain cannot contain consecutive hyphens"),s.push("Remove consecutive hyphens from the domain"));const a=o.split(".");if(a.length<2)t.push("Domain must have at least one dot (e.g., .com, .org)");else{const r=a[a.length-1];r.length<me.domain.tldMinLength&&t.push(`Top-level domain must be at least ${me.domain.tldMinLength} characters long`),r.length>me.domain.tldMaxLength&&t.push(`Top-level domain cannot exceed ${me.domain.tldMaxLength} characters`),/^[a-zA-Z]+$/.test(r)||(t.push("Top-level domain can only contain letters"),s.push("Ensure the top-level domain contains only letters (e.g., .com, .org)"))}(o.toLowerCase()==="localhost"||o.toLowerCase()==="test")&&(t.push("This domain is not valid for email addresses"),s.push("Use a real domain name for your email address"))},Ce=(o,t)=>{if(t.isValid)return"";const s=t.errors[0];return{"Email address is required":"Please enter your email address","Email address must contain an @ symbol":"Please enter a valid email address","Email address can only contain one @ symbol":"Please enter a valid email address","Email address must have a local part (before @)":"Please enter a valid email address","Email address must have a domain part (after @)":"Please enter a valid email address","Local part must be at least 1 characters long":"Please enter a valid email address","Local part cannot exceed 64 characters":"Please enter a valid email address","Local part can only contain letters, numbers, and the following characters: . _ % + -":"Please enter a valid email address","Local part must start and end with a letter or number":"Please enter a valid email address","Local part cannot contain consecutive dots":"Please enter a valid email address","Local part cannot contain consecutive special characters":"Please enter a valid email address","Domain must be at least 2 characters long":"Please enter a valid email address","Domain cannot exceed 63 characters":"Please enter a valid email address","Domain can only contain letters, numbers, dots, and hyphens":"Please enter a valid email address","Domain must start and end with a letter or number":"Please enter a valid email address","Domain cannot contain consecutive dots":"Please enter a valid email address","Domain cannot contain consecutive hyphens":"Please enter a valid email address","Domain must have at least one dot (e.g., .com, .org)":"Please enter a valid email address","Top-level domain must be at least 2 characters long":"Please enter a valid email address","Top-level domain cannot exceed 10 characters":"Please enter a valid email address","Top-level domain can only contain letters":"Please enter a valid email address","Email address is too long (maximum 254 characters)":"Please enter a valid email address","Gmail local part must be at least 6 characters long":"Gmail addresses must be at least 6 characters before @","Gmail local part cannot exceed 30 characters":"Gmail addresses cannot exceed 30 characters before @","Gmail local part must start and end with a letter or number":"Gmail addresses must start and end with a letter or number"}[s]||"Please enter a valid email address"},nt=o=>{if(!o)return"";let t=o.trim().toLowerCase();return t=t.replace(/\s+/g,""),t},$s=()=>{const[o,t]=m.useState({email:"",password:""}),[s,a]=m.useState(!1),[r,n]=m.useState(!1),[w,j]=m.useState({}),[g,d]=m.useState(null),y=Me(),{login:F,error:P,clearError:E,isAuthenticated:A}=it();m.useEffect(()=>{P&&console.log("🔍 [Login] Error state changed:",P)},[P]),m.useEffect(()=>{const T=async()=>{if(A){console.log("[Login] User is authenticated via AuthContext, redirecting to overview..."),y("/overview",{replace:!0});return}if(se.isAuthenticated()){console.log("[Login] User is authenticated via authService, redirecting to overview..."),y("/overview",{replace:!0});return}};T();const f=setInterval(T,500);return()=>{clearInterval(f),d(null),n(!1)}},[y,A]);const q=T=>{const{name:f,value:S}=T.target;if(g&&d(null),t({...o,[f]:S}),f==="email")if(!S.trim())j(u=>({...u,email:"Please enter your email address"}));else{const u=ke(S);u.isValid?j(b=>({...b,email:void 0})):j(b=>({...b,email:Ce(S,u)}))}f==="password"&&(S.trim()?j(u=>({...u,password:void 0})):j(u=>({...u,password:"Please enter your password"})))},R=(T,f)=>{const S={...w};if(T==="email")if(!f.trim())S.email="Please enter your email address";else{const u=ke(f);u.isValid?delete S.email:S.email=Ce(f,u)}else T==="password"&&(f.trim()?delete S.password:S.password="Please enter your password");return j(S),!S[T]},U=T=>{const{name:f,value:S}=T.target;R(f,S)},Z=async T=>{T.preventDefault();try{j({}),d(null);const f={};if(!o.email.trim())f.email="Please enter your email address";else try{const S=ke(o.email);(!S||!S.isValid)&&(f.email=Ce(o.email,S))}catch(S){console.error("[Login] Email validation error:",S),f.email="Please enter a valid email address"}if(o.password.trim()?o.password&&o.password.length>0&&(o.password.length<8?f.password="Password must be at least 8 characters long":/[A-Z]/.test(o.password)?/[a-z]/.test(o.password)?/\d/.test(o.password)?/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(o.password)||(f.password="Password must contain at least one special character"):f.password="Password must contain at least one number":f.password="Password must contain at least one lowercase letter":f.password="Password must contain at least one uppercase letter"):f.password="Please enter your password",Object.keys(f).length>0){j(f);return}n(!0),E();try{console.log("[Login] Attempting local login with:",{email:o.email,passwordLength:o.password?o.password.length:0}),await F("local",{email:o.email,password:o.password}),console.log("[Login] Local login successful")}catch(S){console.error("[Login] Local login error:",S);let u="Invalid credentials entered please verify and try logging in";S&&typeof S=="object"&&(S.message&&typeof S.message=="string"?(S.message.includes("Network")||S.message.includes("fetch")||S.message.includes("Failed to fetch"))&&(u="Network error. Please check your connection and try again."):S.error&&typeof S.error=="string"&&(S.error.includes("Network")||S.error.includes("connection"))&&(u="Network error. Please check your connection and try again.")),console.log("[Login] Setting authentication error message:",u),console.log("[Login] Error object details:",{hasError:!!S,errorType:typeof S,errorMessage:S?.message,errorError:S?.error,stack:S?.stack}),d(typeof u=="string"?u:"Invalid credentials entered please verify and try logging in")}finally{n(!1)}}catch(f){console.error("[Login] Unexpected error during form submission:",f),d("An unexpected error occurred. Please try again."),n(!1)}},re=async()=>{E(),d(null),n(!0);try{await F("google"),console.log("[Login] Google sign-in successful"),await new Promise(T=>setTimeout(T,500)),console.log("[Login] Authentication state after Google login:",{isAuthenticated:se.isAuthenticated(),hasToken:!!se.getAccessToken(),user:await se.getCurrentUser()}),console.log("[Login] Google authentication completed, waiting for redirect...")}catch(T){console.error("[Login] Google sign-in error:",T);let f="Google sign-in failed. Please try again.";if(T&&typeof T=="object"&&T.message&&typeof T.message=="string")if(T.message.includes("cancelled")||T.message.includes("Cancelled")){n(!1);return}else T.message.includes("timed out")||T.message.includes("Timed out")?f="Google sign-in timed out. Please try again.":T.message.includes("Network")||T.message.includes("fetch")?f="Network error. Please check your connection and try again.":f=T.message;d(f)}finally{n(!1)}},Q=async()=>{E(),n(!0);try{console.log("[Login] Starting Microsoft sign-in..."),console.log("[Login] Environment variables:",{clientId:"8d042e34-5a5f-40f5-a019-ee56de49b64e",tenantId:"c16b04b5-b78c-4cce-b3f8-93686f221d09",redirectUri:"http://localhost:5173/auth/callback"}),await F("microsoft"),console.log("[Login] Microsoft sign-in successful"),await new Promise(T=>setTimeout(T,500)),console.log("[Login] Authentication state after login:",{isAuthenticated:se.isAuthenticated(),hasToken:!!se.getAccessToken(),user:await se.getCurrentUser()}),console.log("[Login] Microsoft authentication completed, waiting for redirect...")}catch(T){console.error("[Login] Microsoft sign-in error:",T)}finally{n(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-100 px-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-300/30 via-indigo-300/30 to-purple-300/30"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-cyan-200/20 via-blue-200/20 to-indigo-200/20"}),e.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-gradient-to-br from-blue-400/40 to-cyan-400/40 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[500px] h-[500px] bg-gradient-to-tl from-purple-400/40 to-pink-400/40 rounded-full blur-3xl translate-x-1/2 translate-y-1/2 animate-pulse",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 w-80 h-80 bg-gradient-to-r from-indigo-400/35 to-blue-400/35 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 animate-pulse",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-32 h-32 bg-gradient-to-br from-cyan-300/30 to-blue-300/30 rounded-full blur-2xl animate-bounce",style:{animationDelay:"0.5s"}}),e.jsx("div",{className:"absolute bottom-1/4 left-1/4 w-24 h-24 bg-gradient-to-br from-purple-300/30 to-pink-300/30 rounded-full blur-2xl animate-bounce",style:{animationDelay:"1.5s"}}),e.jsx("div",{className:"absolute top-3/4 left-1/3 w-20 h-20 bg-gradient-to-br from-indigo-300/30 to-purple-300/30 rounded-full blur-2xl animate-bounce",style:{animationDelay:"2.5s"}}),e.jsx("div",{className:"absolute top-1/3 left-1/6 w-16 h-16 bg-gradient-to-br from-indigo-400/25 to-purple-400/25 rotate-45 blur-xl animate-spin",style:{animationDuration:"8s"}}),e.jsx("div",{className:"absolute bottom-1/3 right-1/6 w-20 h-20 bg-gradient-to-br from-blue-400/25 to-cyan-400/25 rotate-12 blur-xl animate-spin",style:{animationDuration:"12s",animationDirection:"reverse"}}),e.jsx("div",{className:"absolute top-1/6 right-1/3 w-12 h-12 bg-gradient-to-br from-pink-400/25 to-purple-400/25 rotate-30 blur-lg animate-spin",style:{animationDuration:"6s"}}),e.jsx("div",{className:"absolute top-1/5 left-1/5 w-8 h-8 bg-gradient-to-br from-cyan-400/20 to-blue-400/20 rounded-full blur-md animate-ping",style:{animationDelay:"0s"}}),e.jsx("div",{className:"absolute top-2/5 right-1/5 w-6 h-6 bg-gradient-to-br from-purple-400/20 to-pink-400/20 rounded-full blur-md animate-ping",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute bottom-1/5 left-2/5 w-10 h-10 bg-gradient-to-br from-indigo-400/20 to-blue-400/20 rounded-full blur-md animate-ping",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute bottom-2/5 right-2/5 w-7 h-7 bg-gradient-to-br from-cyan-400/20 to-indigo-400/20 rounded-full blur-md animate-ping",style:{animationDelay:"3s"}}),e.jsx("div",{className:"absolute top-0 left-1/2 w-64 h-64 bg-gradient-to-br from-blue-300/15 to-indigo-300/15 rounded-full blur-2xl animate-pulse",style:{animationDuration:"4s"}}),e.jsx("div",{className:"absolute bottom-0 left-1/4 w-48 h-48 bg-gradient-to-br from-purple-300/15 to-pink-300/15 rounded-full blur-2xl animate-pulse",style:{animationDuration:"6s",animationDelay:"1s"}}),e.jsxs("div",{className:"w-full max-w-lg mx-auto p-8 bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl border border-white/30 relative z-10 bg-gradient-to-br from-white/95 via-white/90 to-white/95",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(Je,{className:"w-12 h-12 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-3",children:"Welcome to kabini.ai"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Sign in to your account to continue"})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-3",children:["Email ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"email",name:"email",value:o.email,onChange:q,onPaste:T=>Se(T,f=>{const S=nt(f);t(b=>({...b,email:S}));const u=ke(S);u.isValid?j(b=>({...b,email:void 0})):j(b=>({...b,email:Ce(S,u)}))}),onKeyDown:Ne,onBlur:U,required:!0,inputMode:"email",autoComplete:"email",className:`w-full px-4 py-4 border-2 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all ${w.email?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300"}`,placeholder:"Enter your email address *"}),w.email&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),w.email]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-3",children:["Password ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:s?"text":"password",name:"password",value:o.password,onChange:q,onPaste:T=>Se(T,f=>{t(S=>({...S,password:f})),f.trim()?j(S=>({...S,password:void 0})):j(S=>({...S,password:"Please enter your password"}))}),onKeyDown:Ne,required:!0,placeholder:"Enter your password *",className:`w-full px-4 py-4 border-2 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all ${w.password?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300"}`}),e.jsx("button",{type:"button",onClick:()=>a(!s),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors focus:outline-none",tabIndex:-1,children:s?e.jsx(rt,{className:"w-5 h-5"}):e.jsx(Pe,{className:"w-5 h-5"})})]}),w.password&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),w.password]})]}),e.jsx("button",{type:"submit",className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg transform hover:scale-[1.02]",disabled:r,children:r?e.jsx(Fe,{className:"w-5 h-5 animate-spin"}):"Sign In"})]}),e.jsxs("div",{className:"mt-6 text-center space-y-2",children:[e.jsx("button",{type:"button",onClick:()=>y("/forgot-password"),className:"text-sm",children:"Forgot your password?"}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>y("/signup"),className:"text-sm",children:"Don't have an account? Sign up"})})]}),e.jsxs("div",{className:"mt-10 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),e.jsx("button",{onClick:re,disabled:r,className:"w-full bg-white border-2 border-gray-300 text-gray-700 font-semibold py-4 px-6 rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all flex items-center justify-center gap-4 disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{children:"Signing in with Google..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/google.svg",alt:"Google",className:"w-6 h-6"}),"Sign in with Google"]})}),e.jsxs("button",{onClick:Q,disabled:r,className:"w-full bg-white border-2 border-gray-300 text-gray-700 font-semibold py-4 px-6 rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all flex items-center justify-center gap-4 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("img",{src:"/microsoft.svg",alt:"Microsoft",className:"w-6 h-6"}),"Sign in with Microsoft"]})]})]}),e.jsx(lt,{error:g||(P&&typeof P=="string"?P:null),onClose:()=>{d(null),E()},autoClose:!0,autoCloseDelay:5e3})]})};function qe(o,t){const[s,a]=m.useState(()=>{try{const n=window.localStorage.getItem(o);return n?JSON.parse(n):t}catch(n){return console.error(`Error loading ${o} from localStorage:`,n),t}});return[s,n=>{try{a(n),window.localStorage.setItem(o,JSON.stringify(n))}catch(w){console.error(`Error saving ${o} to localStorage:`,w)}}]}function Os(o,t,s){const a=new Blob([o],{type:s}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}const Rs={"gemini-1.5-flash":{input:75e-6,output:3e-4},"gemini-1.5-pro":{input:.00125,output:.005},"gemini-pro":{input:5e-4,output:.0015},"gpt-3.5-turbo":{input:5e-4,output:.0015},"gpt-4":{input:.03,output:.06},"gpt-4-turbo":{input:.01,output:.03},"r1-1776":{input:2e-4,output:2e-4},"llama-3.1-sonar-small-128k-online":{input:2e-4,output:2e-4},"llama-3.1-sonar-medium-128k-online":{input:6e-4,output:6e-4},"llama-3.1-sonar-large-128k-online":{input:.001,output:.001},"serper-search":{input:.001,output:.001}};function _s(o){return Rs[o]||{input:0,output:0}}function Rt(o,t,s){const a=_s(s),r=o/1e3*a.input,n=t/1e3*a.output;return r+n}function qs({qaItems:o,onExport:t}){const[s,a]=m.useState([]),[r,n]=m.useState([]),[w,j]=m.useState([]),[g,d]=m.useState(new Set),[y,F]=m.useState(new Set),[P,E]=m.useState(0),[A,q]=m.useState({searchTerm:"",dateFilter:"all",specificDate:"",typeFilter:"all",statusFilter:"all",showFilters:!1,groupBy:"date",sortBy:"date",sortOrder:"desc"});m.useEffect(()=>{try{const i=pe.getHistoryItems();console.log("[History] Loaded items:",i.length,i);const l=i.filter(N=>N&&typeof N=="object"&&N.id&&N.type&&N.name&&N.timestamp);console.log("[History] Valid items:",l.length,l),a(l)}catch(i){console.error("[History] Error loading history items:",i),a([])}},[P]),m.useEffect(()=>{const i=N=>{N.key==="comprehensive_history"&&(console.log("[History] Storage changed, refreshing history"),E(h=>h+1))};window.addEventListener("storage",i);const l=setInterval(()=>{const N=pe.getHistoryItems();N.length!==s.length&&(console.log("[History] Item count changed, refreshing history"),a(N))},2e3);return()=>{window.removeEventListener("storage",i),clearInterval(l)}},[s.length]);const R=m.useMemo(()=>{const i=new Set,l=new Set;return s.forEach(N=>{i.add(N.type),l.add(N.status)}),{types:Array.from(i).sort(),statuses:Array.from(l).sort()}},[s,P]);m.useEffect(()=>{console.log("[History] History items updated:",s.length,"items"),console.log("[History] History data:",s);let i=[...s];if(A.searchTerm&&(i=i.filter(l=>l.name.toLowerCase().includes(A.searchTerm.toLowerCase())||l.description?.toLowerCase().includes(A.searchTerm.toLowerCase())||l.type==="qa"&&l.sessionData.qaData.some(N=>N.question.toLowerCase().includes(A.searchTerm.toLowerCase())||N.answer.toLowerCase().includes(A.searchTerm.toLowerCase()))||l.type==="ai-visibility"&&l.company.toLowerCase().includes(A.searchTerm.toLowerCase()))),A.dateFilter!=="all"){const l=new Date,N=new Date;switch(A.dateFilter){case"today":N.setHours(0,0,0,0);break;case"week":N.setDate(l.getDate()-7);break;case"month":N.setMonth(l.getMonth()-1);break;case"year":N.setFullYear(l.getFullYear()-1);break;case"specific":if(A.specificDate){const h=new Date(A.specificDate);h.setHours(0,0,0,0);const K=new Date(A.specificDate);K.setHours(23,59,59,999),i=i.filter(X=>{const ie=new Date(X.timestamp);return ie>=h&&ie<=K})}break}A.dateFilter!=="specific"&&(i=i.filter(h=>new Date(h.timestamp)>=N))}A.typeFilter!=="all"&&(i=i.filter(l=>l.type===A.typeFilter)),A.statusFilter!=="all"&&(i=i.filter(l=>l.status===A.statusFilter)),i.sort((l,N)=>{let h,K;switch(A.sortBy){case"date":h=new Date(l.timestamp).getTime(),K=new Date(N.timestamp).getTime();break;case"name":h=l.name.toLowerCase(),K=N.name.toLowerCase();break;case"type":h=l.type,K=N.type;break;case"status":h=l.status,K=N.status;break;default:h=new Date(l.timestamp).getTime(),K=new Date(N.timestamp).getTime()}return A.sortOrder==="asc"?h>K?1:-1:h<K?1:-1}),console.log("[History] Filtered items:",i.length,"items"),n(i)},[s,A,P]),m.useEffect(()=>{const i=[],l=new Map;r.forEach(N=>{let h="";switch(A.groupBy){case"date":const K=new Date(N.timestamp);h=K.toDateString(),K.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});break;case"type":h=N.type,re(N.type);break;case"status":h=N.status,N.status.charAt(0).toUpperCase()+N.status.slice(1);break}l.has(h)||l.set(h,[]),l.get(h).push(N)}),l.forEach((N,h)=>{let K=h;A.groupBy==="date"?K=new Date(h).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):A.groupBy==="type"?K=re(h):A.groupBy==="status"&&(K=h.charAt(0).toUpperCase()+h.slice(1)),i.push({groupKey:h,groupTitle:K,groupType:A.groupBy,items:N,totalItems:N.length,dateRange:A.groupBy==="date"?h:void 0})}),i.sort((N,h)=>A.groupBy==="date"?new Date(h.groupKey).getTime()-new Date(N.groupKey).getTime():N.groupTitle.localeCompare(h.groupTitle)),j(i)},[r,A.groupBy,P]);const U=i=>{const l=new Set(g);l.has(i)?l.delete(i):l.add(i),d(l)},Z=i=>{const l=new Set(y);l.has(i)?l.delete(i):l.add(i),F(l)},re=i=>{switch(i){case"qa":return"Q&A Sessions";case"ai-visibility":return"AI Visibility Analysis";case"content-analysis":return"Content Analysis";case"structure-analysis":return"Structure Analysis";default:return i}},Q=i=>{switch(i){case"completed":return"text-green-600 bg-green-100";case"in-progress":return"text-yellow-600 bg-yellow-100";case"failed":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},T=i=>{try{if(!i||!i.type)return console.error("[History] Invalid item:",i),e.jsx("div",{className:"text-red-500",children:"Invalid item data"});switch(i.type){case"qa":return f(i);case"ai-visibility":return S(i);case"content-analysis":return u(i);case"structure-analysis":return b(i);default:return e.jsxs("div",{className:"text-orange-500",children:["Unknown item type: ",i.type]})}}catch(l){return console.error("[History] Error rendering item:",l,i),e.jsxs("div",{className:"text-red-500",children:["Error rendering item: ",l.message]})}},f=i=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(Ge,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-black",children:i.name}),e.jsx("div",{className:"text-xs text-gray-600",children:V(i.timestamp)}),e.jsxs("div",{className:"text-xs text-blue-600",children:[i.sessionData.qaData.length," Q&A pairs"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Q(i.status)}`,children:i.status}),e.jsx("input",{type:"checkbox",checked:y.has(i.id),onChange:()=>Z(i.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"space-y-3",children:[i.sessionData.qaData.slice(0,3).map((l,N)=>e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"font-semibold text-gray-900 mb-2",children:["Q",N+1,": ",l.question]}),l.answer&&e.jsxs("div",{className:"text-sm text-gray-700 mb-2",children:[l.answer.substring(0,100),"..."]}),e.jsxs("div",{className:"flex gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Accuracy: ",l.accuracy||"N/A"]}),e.jsxs("span",{children:["Sentiment: ",l.sentiment||"N/A"]}),e.jsxs("span",{children:["Cost: $",(l.cost||0).toFixed(4)]})]})]},N)),i.sessionData.qaData.length>3&&e.jsxs("div",{className:"text-center text-sm text-gray-500",children:["+",i.sessionData.qaData.length-3," more Q&A pairs"]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>p(i.id),className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),"JSON"]}),e.jsxs("button",{onClick:()=>x(i.id),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),"CSV"]}),e.jsxs("button",{onClick:()=>C(i.id),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition flex items-center gap-1",children:[e.jsx(ut,{className:"h-3 w-3"}),"Delete"]})]})]}),S=i=>!i.analysis||!i.analysis.competitors?e.jsxs("div",{className:"border border-red-200 rounded-lg p-4 bg-red-50",children:[e.jsx("div",{className:"text-red-600",children:"Invalid AI Visibility data structure"}),e.jsx("div",{className:"text-xs text-red-500 mt-2",children:"Missing analysis or competitors data"})]}):e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center",children:e.jsx(Pe,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-black",children:i.name}),e.jsx("div",{className:"text-xs text-gray-600",children:V(i.timestamp)}),e.jsxs("div",{className:"text-xs text-purple-600",children:[i.analysis.competitors?.length||0," competitors analyzed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Q(i.status)}`,children:i.status}),e.jsx("input",{type:"checkbox",checked:y.has(i.id),onChange:()=>Z(i.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"font-semibold text-gray-900 mb-2",children:["Company: ",i.company]}),i.industry&&e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["Industry: ",i.industry]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:["Top Competitor: ",i.analysis.summary?.topCompetitor||"N/A"]}),e.jsxs("div",{children:["Avg Score: ",i.analysis.summary?.averageVisibilityScore?.toFixed(1)||"N/A"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[i.analysis.competitors.slice(0,3).map((l,N)=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-gray-200",children:[e.jsx("div",{className:"font-medium text-sm",children:l.name}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Avg Score: ",l.visibilityScores?.average?.toFixed(1)||"N/A"]})]},N)),i.analysis.competitors.length>3&&e.jsxs("div",{className:"text-center text-sm text-gray-500",children:["+",i.analysis.competitors.length-3," more competitors"]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>p(i.id),className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),"JSON"]}),e.jsxs("button",{onClick:()=>x(i.id),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),"CSV"]}),e.jsxs("button",{onClick:()=>C(i.id),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition flex items-center gap-1",children:[e.jsx(ut,{className:"h-3 w-3"}),"Delete"]})]})]}),u=i=>i.analysis?e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx(ot,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-black",children:i.name}),e.jsx("div",{className:"text-xs text-gray-600",children:V(i.timestamp)}),e.jsxs("div",{className:"text-xs text-green-600",children:["SEO Score: ",i.analysis?.seoScore||"N/A","/100"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Q(i.status)}`,children:i.status}),e.jsx("input",{type:"checkbox",checked:y.has(i.id),onChange:()=>Z(i.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"SEO Score"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.analysis?.seoScore||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"Readability"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.analysis?.readabilityScore||"N/A"})]})]}),i.analysis?.suggestions?.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:"Suggestions"}),e.jsxs("div",{className:"space-y-1",children:[i.analysis.suggestions.slice(0,3).map((l,N)=>e.jsxs("div",{className:"text-xs text-gray-600",children:["• ",l.description]},N)),i.analysis.suggestions.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",i.analysis.suggestions.length-3," more suggestions"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>p(i.id),className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),"JSON"]}),e.jsxs("button",{onClick:()=>x(i.id),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),"CSV"]}),e.jsxs("button",{onClick:()=>C(i.id),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition flex items-center gap-1",children:[e.jsx(ut,{className:"h-3 w-3"}),"Delete"]})]})]}):e.jsxs("div",{className:"border border-red-200 rounded-lg p-4 bg-red-50",children:[e.jsx("div",{className:"text-red-600",children:"Invalid Content Analysis data structure"}),e.jsx("div",{className:"text-xs text-red-500 mt-2",children:"Missing analysis data"})]}),b=i=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center",children:e.jsx(js,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-black",children:i.name}),e.jsx("div",{className:"text-xs text-gray-600",children:V(i.timestamp)}),e.jsxs("div",{className:"text-xs text-orange-600",children:[i.analysis.suggestions?.length||0," suggestions"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Q(i.status)}`,children:i.status}),e.jsx("input",{type:"checkbox",checked:y.has(i.id),onChange:()=>Z(i.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[i.analysis.geoScoreTotal!==void 0||i.analysis.contentQualityScoreTotal!==void 0?e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-4",children:[i.analysis.geoScoreTotal!==void 0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"GEO Score"}),e.jsxs("div",{className:"text-xl font-bold text-red-600",children:[i.analysis.geoScoreTotal,"/100"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"AI visibility & search optimization"})]}),i.analysis.contentQualityScoreTotal!==void 0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"Content Quality"}),e.jsxs("div",{className:"text-xl font-bold text-orange-600",children:[i.analysis.contentQualityScoreTotal,"/100"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Human/editorial score"})]})]}):null,e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs text-gray-600 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.analysis.wordCount||i.analysis.metadata?.wordCount||0}),e.jsx("div",{children:"Words"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.analysis.readingTime||i.analysis.metadata?.readingTime||1}),e.jsx("div",{children:"Min Read"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.analysis.suggestionsCount||i.analysis.suggestions?.length||0}),e.jsx("div",{children:"Suggestions"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(i.analysis.language||i.analysis.metadata?.language||"en").toUpperCase()}),e.jsx("div",{children:"Language"})]})]}),i.analysis.suggestions&&i.analysis.suggestions.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"font-semibold text-gray-900 mb-2",children:["Top Suggestions (",i.analysis.suggestions.length," total)"]}),e.jsxs("div",{className:"space-y-2",children:[i.analysis.suggestions.slice(0,5).map((l,N)=>e.jsxs("div",{className:"bg-gray-50 rounded p-2 border-l-4 border-blue-500",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium mb-1",children:[l.type.charAt(0).toUpperCase()+l.type.slice(1)," • ",l.priority]}),e.jsx("div",{className:"text-xs text-gray-800",children:l.description}),l.impact&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Impact: ",l.impact]})]},N)),i.analysis.suggestions.length>5&&e.jsxs("div",{className:"text-center text-xs text-gray-500 bg-gray-100 rounded p-2",children:["+",i.analysis.suggestions.length-5," more suggestions available"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:()=>p(i.id),className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),"JSON"]}),e.jsxs("button",{onClick:()=>x(i.id),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),"CSV"]}),e.jsxs("button",{onClick:()=>C(i.id),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition flex items-center gap-1",children:[e.jsx(ut,{className:"h-3 w-3"}),"Delete"]})]})]}),I=()=>{const i=y.size>0?r.filter(X=>y.has(X.id)):r;let l="";i.forEach(X=>{switch(X.type){case"qa":const ie=X;l+=`
=== Q&A SESSION: ${ie.name} ===
`,l+=`Session ID,${ie.id}
`,l+=`Timestamp,${new Date(ie.timestamp).toISOString()}
`,l+=`Model,${ie.sessionData.model}
`,l+=`Total Questions,${ie.sessionData.qaData.length}
`,l+=`Total Cost,${ie.sessionData.statistics.totalCost}
`,l+=`Average Accuracy,${ie.sessionData.statistics.avgAccuracy}%
`,l+=`Blog Content,"${ie.sessionData.blogContent.replace(/"/g,'""')}"
`,l+=`
Question,Answer,Accuracy,Sentiment,Geo Score,Citation Likelihood,Input Tokens,Output Tokens,Total Tokens,Cost
`,ie.sessionData.qaData.forEach((W,Ae)=>{l+=`"${W.question.replace(/"/g,'""')}","${W.answer.replace(/"/g,'""')}",${W.accuracy}%,${W.sentiment},${W.geoScore},${W.citationLikelihood},${W.inputTokens},${W.outputTokens},${W.totalTokens},$${W.cost}
`});break;case"ai-visibility":const le=X;l+=`
=== AI VISIBILITY ANALYSIS: ${le.name} ===
`,l+=`Company,${le.company}
`,l+=`Industry,${le.industry||"N/A"}
`,l+=`Timestamp,${new Date(le.timestamp).toISOString()}
`,l+=`Overall Score,${le.analysis.overallScore}
`,l+=`Content Quality,${le.analysis.contentQuality}
`,l+=`Technical SEO,${le.analysis.technicalSEO}
`,l+=`User Experience,${le.analysis.userExperience}
`,l+=`Competitive Position,${le.analysis.competitivePosition}
`,l+=`
Competitors Found:
`,l+=`Competitor Name,Website,Relevance Score,Strengths,Weaknesses
`,le.analysis.competitors.forEach(W=>{l+=`"${W.name}","${W.website}",${W.relevanceScore},"${W.strengths.join("; ").replace(/"/g,'""')}","${W.weaknesses.join("; ").replace(/"/g,'""')}"
`}),l+=`
Recommendations:
`,l+=`Priority,Recommendation,Impact,Effort
`,le.analysis.recommendations.forEach(W=>{l+=`${W.priority},"${W.recommendation.replace(/"/g,'""')}",${W.impact},${W.effort}
`});break;case"content-analysis":const ee=X;l+=`
=== CONTENT ANALYSIS: ${ee.name} ===
`,l+=`URL,${ee.url||"N/A"}
`,l+=`Timestamp,${new Date(ee.timestamp).toISOString()}
`,l+=`SEO Score,${ee.analysis.seoScore}
`,l+=`Readability Score,${ee.analysis.readabilityScore}
`,l+=`Content Length,${ee.analysis.contentLength} words
`,l+=`Keyword Density,${ee.analysis.keywordDensity}%
`,l+=`
Analyzed Content:
`,l+=`"${ee.content.replace(/"/g,'""')}"
`,l+=`
Suggestions:
`,l+=`Category,Suggestion,Priority
`,ee.analysis.suggestions.forEach(W=>{l+=`${W.category},"${W.suggestion.replace(/"/g,'""')}",${W.priority}
`});break;case"structure-analysis":const H=X;l+=`
=== STRUCTURE ANALYSIS: ${H.name} ===
`,l+=`Timestamp,${new Date(H.timestamp).toISOString()}
`,l+=`Original Content Length,${H.originalContent.length} characters
`,l+=`Structured Content Length,${H.structuredContent.length} characters
`,l+=`
Analysis Scores:
`,H.analysis.geoScoreTotal!==void 0&&(l+=`GEO Score,${H.analysis.geoScoreTotal}/100
`),H.analysis.contentQualityScoreTotal!==void 0&&(l+=`Content Quality Score,${H.analysis.contentQualityScoreTotal}/100
`),l+=`
Content Metadata:
`,l+=`Title,${H.analysis.metadata.title}
`,l+=`Description,${H.analysis.metadata.description}
`,l+=`Keywords,"${H.analysis.metadata.keywords.join(", ")}"
`,l+=`Author,${H.analysis.metadata.author}
`,l+=`Publish Date,${H.analysis.metadata.publishDate}
`,l+=`Last Modified,${H.analysis.metadata.lastModified}
`,l+=`Reading Time,${H.analysis.metadata.readingTime} minutes
`,l+=`Word Count,${H.analysis.metadata.wordCount}
`,l+=`Language,${H.analysis.metadata.language}
`,l+=`
Original Content:
`,l+=`"${H.originalContent.replace(/"/g,'""')}"
`,l+=`
Structured Content:
`,l+=`"${H.structuredContent.replace(/"/g,'""')}"
`,l+=`
Structure Suggestions:
`,l+=`Type,Priority,Description,Implementation,Impact
`,H.analysis.suggestions.forEach(W=>{l+=`${W.type},${W.priority},"${W.description.replace(/"/g,'""')}","${W.implementation.replace(/"/g,'""')}","${W.impact.replace(/"/g,'""')}"
`});break;default:l+=`
=== UNKNOWN TYPE: ${X.name} ===
`,l+=`ID,${X.id}
`,l+=`Type,${X.type}
`,l+=`Status,${X.status}
`,l+=`Timestamp,${new Date(X.timestamp).toISOString()}
`,l+=`Description,${X.description||"N/A"}
`}l+=`
`+"=".repeat(80)+`
`});const N=`COMPREHENSIVE HISTORY EXPORT
`,h=`Export Date: ${new Date().toISOString()}
`,K=`Total Items: ${i.length}
`;t(N+h+K+l,"comprehensive-history-detailed.csv","text/csv")},p=i=>{console.log("[History] Downloading item:",i);try{const l=pe.exportHistoryItem(i);l&&l.content?(console.log("[History] Export data:",l),t(l.content,l.filename,l.mimeType)):(console.error("[History] No export data found for item:",i),alert("No data found for this item. It might be sample data or corrupted."))}catch(l){console.error("[History] Error downloading item:",l),alert("Error downloading item. Please try again.")}},x=i=>{console.log("[History] Downloading item as CSV:",i);const N=pe.getHistoryItems().find(X=>X.id===i);if(!N){alert("Item not found!");return}let h="";switch(N.type){case"qa":const X=N;h+=`Q&A Session Export
`,h+=`Session Name,${X.name}
`,h+=`Session ID,${X.id}
`,h+=`Timestamp,${new Date(X.timestamp).toISOString()}
`,h+=`Model,${X.sessionData.model}
`,h+=`Total Questions,${X.sessionData.qaData.length}
`,h+=`Total Cost,${X.sessionData.statistics.totalCost}
`,h+=`Average Accuracy,${X.sessionData.statistics.avgAccuracy}%
`,h+=`Blog Content,"${X.sessionData.blogContent.replace(/"/g,'""')}"

`,h+=`Question,Answer,Accuracy,Sentiment,Geo Score,Citation Likelihood,Input Tokens,Output Tokens,Total Tokens,Cost
`,X.sessionData.qaData.forEach((H,W)=>{h+=`"${H.question.replace(/"/g,'""')}","${H.answer.replace(/"/g,'""')}",${H.accuracy}%,${H.sentiment},${H.geoScore},${H.citationLikelihood},${H.inputTokens},${H.outputTokens},${H.totalTokens},$${H.cost}
`});break;case"ai-visibility":const ie=N;h+=`AI Visibility Analysis Export
`,h+=`Analysis Name,${ie.name}
`,h+=`Company,${ie.company}
`,h+=`Industry,${ie.industry||"N/A"}
`,h+=`Timestamp,${new Date(ie.timestamp).toISOString()}
`,h+=`Overall Score,${ie.analysis.overallScore}
`,h+=`Content Quality,${ie.analysis.contentQuality}
`,h+=`Technical SEO,${ie.analysis.technicalSEO}
`,h+=`User Experience,${ie.analysis.userExperience}
`,h+=`Competitive Position,${ie.analysis.competitivePosition}

`,h+=`Competitors:
`,h+=`Name,Website,Relevance Score,Strengths,Weaknesses
`,ie.analysis.competitors.forEach(H=>{h+=`"${H.name}","${H.website}",${H.relevanceScore},"${H.strengths.join("; ").replace(/"/g,'""')}","${H.weaknesses.join("; ").replace(/"/g,'""')}"
`}),h+=`
Recommendations:
`,h+=`Priority,Recommendation,Impact,Effort
`,ie.analysis.recommendations.forEach(H=>{h+=`${H.priority},"${H.recommendation.replace(/"/g,'""')}",${H.impact},${H.effort}
`});break;case"content-analysis":const le=N;h+=`Content Analysis Export
`,h+=`Analysis Name,${le.name}
`,h+=`URL,${le.url||"N/A"}
`,h+=`Timestamp,${new Date(le.timestamp).toISOString()}
`,h+=`SEO Score,${le.analysis.seoScore}
`,h+=`Readability Score,${le.analysis.readabilityScore}
`,h+=`Content Length,${le.analysis.contentLength} words
`,h+=`Keyword Density,${le.analysis.keywordDensity}%

`,h+=`Analyzed Content:
`,h+=`"${le.content.replace(/"/g,'""')}"

`,h+=`Suggestions:
`,h+=`Category,Suggestion,Priority
`,le.analysis.suggestions.forEach(H=>{h+=`${H.category},"${H.suggestion.replace(/"/g,'""')}",${H.priority}
`});break;case"structure-analysis":const ee=N;h+=`Structure Analysis Export
`,h+=`Analysis Name,${ee.name}
`,h+=`Timestamp,${new Date(ee.timestamp).toISOString()}
`,h+=`Original Content Length,${ee.originalContent.length} characters
`,h+=`Structured Content Length,${ee.structuredContent.length} characters

`,h+=`Analysis Scores:
`,ee.analysis.geoScoreTotal!==void 0&&(h+=`GEO Score,${ee.analysis.geoScoreTotal}/100
`),ee.analysis.contentQualityScoreTotal!==void 0&&(h+=`Content Quality Score,${ee.analysis.contentQualityScoreTotal}/100
`),h+=`
`,h+=`Content Metadata:
`,h+=`Title,${ee.analysis.metadata.title}
`,h+=`Description,${ee.analysis.metadata.description}
`,h+=`Keywords,"${ee.analysis.metadata.keywords.join(", ")}"
`,h+=`Author,${ee.analysis.metadata.author}
`,h+=`Publish Date,${ee.analysis.metadata.publishDate}
`,h+=`Last Modified,${ee.analysis.metadata.lastModified}
`,h+=`Reading Time,${ee.analysis.metadata.readingTime} minutes
`,h+=`Word Count,${ee.analysis.metadata.wordCount}
`,h+=`Language,${ee.analysis.metadata.language}

`,h+=`Original Content:
`,h+=`"${ee.originalContent.replace(/"/g,'""')}"

`,h+=`Structured Content:
`,h+=`"${ee.structuredContent.replace(/"/g,'""')}"

`,h+=`Structure Suggestions:
`,h+=`Type,Priority,Description,Implementation,Impact
`,ee.analysis.suggestions.forEach(H=>{h+=`${H.type},${H.priority},"${H.description.replace(/"/g,'""')}","${H.implementation.replace(/"/g,'""')}","${H.impact.replace(/"/g,'""')}"
`});break;default:h+=`Unknown Type Export
`,h+=`Name,${N.name}
`,h+=`Type,${N.type}
`,h+=`Status,${N.status}
`,h+=`Timestamp,${new Date(N.timestamp).toISOString()}
`,h+=`Description,${N.description||"N/A"}
`}const K=`${N.type}-${N.name.replace(/[^a-zA-Z0-9]/g,"-")}-${new Date(N.timestamp).toISOString().split("T")[0]}.csv`;t(h,K,"text/csv")},C=i=>{confirm("Are you sure you want to delete this history item? This action cannot be undone.")&&(pe.deleteHistoryItem(i),E(l=>l+1))},$=()=>{const i=y.size>0?r.filter(N=>y.has(N.id)):r,l={exportedAt:new Date().toISOString(),total:i.length,filtersApplied:{...A},items:i};t(JSON.stringify(l,null,2),"history-export.json","application/json")},V=i=>new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=i=>{switch(i){case"date":return e.jsx(xs,{className:"h-4 w-4"});case"type":return e.jsx(Lt,{className:"h-4 w-4"});case"status":return e.jsx(Bt,{className:"h-4 w-4"});default:return e.jsx(Lt,{className:"h-4 w-4"})}};return e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-extrabold text-primary mb-4",children:"Comprehensive History"}),e.jsx("p",{className:"text-gray-600",children:"View and manage all your analysis history including Q&A, AI visibility, content analysis, and structure analysis"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-black/10 text-black text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:"Total Items"}),e.jsx("div",{className:"text-3xl font-extrabold",children:r.length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-black/10 text-black text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:"Q&A Sessions"}),e.jsx("div",{className:"text-3xl font-extrabold",children:r.filter(i=>i.type==="qa").length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-black/10 text-black text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:"AI Visibility"}),e.jsx("div",{className:"text-3xl font-extrabold",children:r.filter(i=>i.type==="ai-visibility").length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-black/10 text-black text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:"Selected Items"}),e.jsx("div",{className:"text-3xl font-extrabold",children:y.size})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 border border-black/10 text-black text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:I,className:"bg-black text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-gray-800 transition flex items-center gap-2 w-full justify-center",children:[e.jsx(be,{className:"h-4 w-4"}),"Export CSV"]}),e.jsxs("button",{onClick:$,className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-blue-700 transition flex items-center gap-2 w-full justify-center",children:[e.jsx(be,{className:"h-4 w-4"}),"Export JSON"]}),e.jsxs("button",{onClick:()=>{localStorage.removeItem("comprehensive_history"),a([]),n([]),j([]),alert("History cleared. Please refresh the page.")},className:"bg-orange-600 text-white px-3 py-2 rounded-lg font-bold shadow hover:bg-orange-700 transition flex items-center gap-2 w-full justify-center",children:[e.jsx(wt,{className:"h-4 w-4"}),"Reset History"]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-black/10 p-6 mb-8 overflow-visible relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-black flex items-center gap-2",children:[e.jsx(ws,{className:"h-5 w-5"}),"Filters & Organization"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>q(i=>({...i,showFilters:!i.showFilters})),className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg flex items-center gap-2 transition",children:[A.showFilters?e.jsx(Tt,{className:"h-4 w-4"}):e.jsx(Et,{className:"h-4 w-4"}),A.showFilters?"Hide":"Show"," Filters"]}),e.jsxs("button",{onClick:()=>{console.log("[History] Manual refresh triggered");const i=pe.getHistoryItems();a(i),E(l=>l+1)},className:"bg-green-100 hover:bg-green-200 text-green-700 px-3 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(wt,{className:"h-4 w-4"}),"Refresh"]}),e.jsxs("div",{className:"flex items-center gap-1 bg-blue-50 px-3 py-2 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Group by:"}),e.jsxs("select",{value:A.groupBy,onChange:i=>q(l=>({...l,groupBy:i.target.value})),className:"text-sm border-0 bg-transparent text-blue-700 font-medium focus:ring-0 focus:outline-none",children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"type",children:"Type"}),e.jsx("option",{value:"status",children:"Status"})]})]})]})]}),A.showFilters&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search all analysis...",value:A.searchTerm,onChange:i=>q(l=>({...l,searchTerm:i.target.value})),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-black placeholder-gray-400 relative z-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Range"}),e.jsxs("select",{value:A.dateFilter,onChange:i=>q(l=>({...l,dateFilter:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-black relative z-10",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"}),e.jsx("option",{value:"year",children:"Last Year"}),e.jsx("option",{value:"specific",children:"Specific date…"})]}),A.dateFilter==="specific"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"date",value:A.specificDate,onChange:i=>q(l=>({...l,specificDate:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-black"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Analysis Type"}),e.jsxs("select",{value:A.typeFilter,onChange:i=>q(l=>({...l,typeFilter:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-black relative z-10",children:[e.jsx("option",{value:"all",children:"All Types"}),R.types.map(i=>e.jsx("option",{value:i,children:re(i)},i))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:A.statusFilter,onChange:i=>q(l=>({...l,statusFilter:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-black relative z-10",children:[e.jsx("option",{value:"all",children:"All Status"}),R.statuses.map(i=>e.jsx("option",{value:i,children:i.charAt(0).toUpperCase()+i.slice(1)},i))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort By"}),e.jsxs("select",{value:A.sortBy,onChange:i=>q(l=>({...l,sortBy:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-black relative z-10",children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"type",children:"Type"}),e.jsx("option",{value:"status",children:"Status"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort Order"}),e.jsxs("select",{value:A.sortOrder,onChange:i=>q(l=>({...l,sortOrder:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-black relative z-10",children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:w.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-black/10",children:[e.jsx(jt,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No history found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your filters or create some analysis first."})]}):w.map(i=>e.jsxs("div",{className:"bg-white rounded-lg border border-black/10 overflow-hidden",children:[e.jsx("div",{className:"p-6 cursor-pointer hover:bg-gray-50 transition-colors border-b border-gray-200",onClick:()=>U(i.groupKey),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[B(i.groupType),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-black",children:i.groupTitle}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[i.items.length," items"]}),e.jsxs("span",{children:[i.totalItems," total"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:g.has(i.groupKey)?e.jsx(Tt,{className:"h-5 w-5 text-gray-500"}):e.jsx(Et,{className:"h-5 w-5 text-gray-500"})})]})}),g.has(i.groupKey)&&e.jsx("div",{className:"p-6 space-y-4",children:i.items.map(l=>{try{return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:T(l)},l.id)}catch(N){return console.error("[History] Error rendering item in group:",N,l),e.jsxs("div",{className:"border border-red-200 rounded-lg p-4 bg-red-50",children:[e.jsxs("div",{className:"text-red-600",children:["Error rendering item: ",N.message]}),e.jsxs("div",{className:"text-xs text-red-500 mt-2",children:["Item ID: ",l.id]})]},l.id)}})})]},i.groupKey))})]})}function Ms({questionProvider:o,questionModel:t,onQuestionProviderChange:s,onQuestionModelChange:a,answerProvider:r,answerModel:n,onAnswerProviderChange:w,onAnswerModelChange:j,questionCount:g=5,onQuestionCountChange:d}){const y=A=>{switch(A){case"gemini":return[{value:"gemini-1.5-flash",label:"Gemini 1.5 Flash"},{value:"gemini-1.5-pro",label:"Gemini 1.5 Pro"},{value:"gemini-pro",label:"Gemini Pro"}];case"openai":return[{value:"gpt-3.5-turbo",label:"GPT-3.5 Turbo (Recommended)"},{value:"gpt-4",label:"GPT-4"},{value:"gpt-4-turbo",label:"GPT-4 Turbo"}];case"perplexity":return[{value:"r1-1776",label:"R1-1776 (Recommended)"},{value:"llama-3.1-sonar-small-128k-online",label:"Llama 3.1 Sonar Small"},{value:"llama-3.1-sonar-medium-128k-online",label:"Llama 3.1 Sonar Medium"},{value:"llama-3.1-sonar-large-128k-online",label:"Llama 3.1 Sonar Large"}];default:return[]}},F=A=>{const q=A.target.value;s(q);let R="";if(q==="openai")R="gpt-3.5-turbo";else{const U=y(q);U.length>0&&(R=U[0].value)}R&&a(R)},P=A=>{const q=A.target.value;w(q);let R="";if(q==="openai")R="gpt-3.5-turbo";else{const U=y(q);U.length>0&&(R=U[0].value)}R&&j(R)},E=A=>{if(d){const q=A?g+1:g-1;q>=1&&q<=10&&d(q)}};return e.jsxs("div",{className:"card mb-8 backdrop-blur-md bg-black/80 border border-primary/60 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ks,{className:"w-6 h-6 text-black animate-pulse"}),e.jsx("h2",{className:"text-2xl font-bold text-black",children:"Configuration"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-gray-200 rounded-lg",children:e.jsx(xt,{className:"w-5 h-5 text-black"})}),e.jsx("h3",{className:"text-lg font-bold text-black",children:"Question Generation"}),e.jsxs("div",{className:"group relative",children:[e.jsx(yt,{className:"w-4 h-4 text-black cursor-help"}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-black text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:"LLM provider and model for generating questions"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-black mb-2",children:"Provider"}),e.jsxs("select",{value:o,onChange:F,className:"w-full bg-white border border-black/20 rounded-lg px-3 py-2 text-black focus:outline-none focus:ring-2 focus:ring-black",children:[e.jsx("option",{value:"gemini",children:"Gemini (Google)"}),e.jsx("option",{value:"openai",children:"ChatGPT (OpenAI)"}),e.jsx("option",{value:"perplexity",children:"Perplexity"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-black mb-2",children:"Model"}),e.jsx("select",{value:t,onChange:A=>a(A.target.value),className:"w-full bg-white border border-black/20 rounded-lg px-3 py-2 text-black focus:outline-none focus:ring-2 focus:ring-black",children:y(o).map(A=>e.jsx("option",{value:A.value,children:A.label},A.value))}),o==="openai"&&t==="gpt-3.5-turbo"&&e.jsx("div",{className:"text-xs text-green-600 mt-1 font-medium",children:"✓ Recommended for best performance and cost"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-gray-200 rounded-lg",children:e.jsx(xt,{className:"w-5 h-5 text-black"})}),e.jsx("h3",{className:"text-lg font-bold text-black",children:"Answer Generation"}),e.jsxs("div",{className:"group relative",children:[e.jsx(yt,{className:"w-4 h-4 text-black cursor-help"}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-black text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:"LLM provider and model for generating answers"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-black mb-2",children:"Provider"}),e.jsxs("select",{value:r,onChange:P,className:"w-full bg-white border border-black/20 rounded-lg px-3 py-2 text-black focus:outline-none focus:ring-2 focus:ring-black",children:[e.jsx("option",{value:"gemini",children:"Gemini (Google)"}),e.jsx("option",{value:"openai",children:"ChatGPT (OpenAI)"}),e.jsx("option",{value:"perplexity",children:"Perplexity"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-black mb-2",children:"Model"}),e.jsx("select",{value:n,onChange:A=>j(A.target.value),className:"w-full bg-white border border-black/20 rounded-lg px-3 py-2 text-black focus:outline-none focus:ring-2 focus:ring-black",children:y(r).map(A=>e.jsx("option",{value:A.value,children:A.label},A.value))}),r==="openai"&&n==="gpt-3.5-turbo"&&e.jsx("div",{className:"text-xs text-green-600 mt-1 font-medium",children:"✓ Recommended for best performance and cost"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-gray-200 rounded-lg",children:e.jsx(xt,{className:"w-5 h-5 text-black"})}),e.jsx("h3",{className:"text-lg font-bold text-black",children:"Question Count"}),e.jsxs("div",{className:"group relative",children:[e.jsx(yt,{className:"w-4 h-4 text-black cursor-help"}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-black text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:"Number of questions to generate"})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-black mb-2",children:"Count"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>E(!1),disabled:g<=1,className:"p-2 bg-black border border-black rounded-lg text-white hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:e.jsx(Ss,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("span",{className:"text-2xl font-bold text-black",children:g})}),e.jsx("button",{onClick:()=>E(!0),disabled:g>=10,className:"p-2 bg-black border border-black rounded-lg text-white hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:e.jsx(Ns,{className:"w-4 h-4 text-white"})})]}),e.jsx("div",{className:"text-xs text-black mt-2 text-center",children:"Range: 1-10 questions"})]})})]})]})]})}const ge="http://localhost:5000/api";class Us{async request(t,s={}){const a=`${ge}${t}`,r=await fetch(a,{headers:{"Content-Type":"application/json",...se.getAuthHeaders(),...s.headers},...s});if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error(n.error||`HTTP error! status: ${r.status}`)}return r.json()}async getLLMProviders(){return this.request("/llm/providers")}async generateQuestions(t){return this.request("/llm/generate-questions",{method:"POST",body:JSON.stringify(t)})}async generateAnswers(t){return this.request("/llm/generate-answers",{method:"POST",body:JSON.stringify(t)})}async generateAnswersWeb(t){return this.request("/llm/generate-answers-web",{method:"POST",body:JSON.stringify(t)})}async calculateConfidence(t,s,a,r){return this.request("/llm/calculate-confidence",{method:"POST",body:JSON.stringify({question:t,content:s,provider:a,model:r})})}async compareQuestions(t,s,a,r){return this.request("/llm/compare-questions",{method:"POST",body:JSON.stringify({question1:t,question2:s,provider:a,model:r})})}async saveSession(t){return this.request("/sessions",{method:"POST",body:JSON.stringify(t)})}async getSessionsByType(t){return this.request(`/sessions/${t}`)}async getSessionsWithFilters(t,s){const a=new URLSearchParams;s.fromDate&&a.append("fromDate",s.fromDate),s.toDate&&a.append("toDate",s.toDate),s.llmProvider&&a.append("llmProvider",s.llmProvider),s.llmModel&&a.append("llmModel",s.llmModel),s.blogLink&&a.append("blogLink",s.blogLink),s.search&&a.append("search",s.search);const r=a.toString(),n=r?`/sessions/${t}?${r}`:`/sessions/${t}`;return this.request(n)}async getSessionsByDateRange(t,s,a){const r=new URLSearchParams({fromDate:s,toDate:a});return this.request(`/sessions/${t}/range?${r}`)}async getSessionById(t){return this.request(`/sessions/question/${t}`)}async deleteSession(t){return this.request(`/sessions/${t}`,{method:"DELETE"})}async getSessionStats(t){return this.request(`/stats/${t}`)}async bulkSaveSessions(t){return this.request("/sessions/bulk",{method:"POST",body:JSON.stringify({sessions:t})})}async exportSessions(t,s="json"){const a=await fetch(`${ge}/export/${t}?format=${s}`);if(!a.ok){const r=await a.json().catch(()=>({}));throw new Error(r.error||`HTTP error! status: ${a.status}`)}return a.blob()}async healthCheck(){return this.request("/health")}async migrateFromLocalStorage(t){const s=Object.values(t);return this.bulkSaveSessions(s)}async checkQuestionRelevance(t,s,a,r,n){return this.request("/questions/check-relevance",{method:"POST",body:JSON.stringify({sourceUrls:t,blogUrl:s,questionText:a,currentProvider:r,currentModel:n})})}async calculateCitationLikelihood({answer:t,content:s,provider:a,model:r}){console.log("[Frontend] Calling /api/citation-likelihood/calculate with:",{answer:t,content:s,provider:a,model:r});const n=await fetch(`${ge}/citation-likelihood/calculate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:t,content:s,provider:a,model:r})});let w;try{w=await n.json()}catch(j){throw console.error("[Frontend] Failed to parse JSON from /api/citation-likelihood/calculate:",j),new Error("Failed to parse JSON from /api/citation-likelihood/calculate")}if(console.log("[Frontend] /api/citation-likelihood/calculate response:",w),!n.ok)throw new Error("Failed to calculate citation likelihood: "+(w.error||n.status));return w}async calculateAccuracy({answer:t,content:s,provider:a,model:r}){console.log("[Frontend] Calling /api/accuracy/calculate with:",{answer:t,content:s,provider:a,model:r});const n=await fetch(`${ge}/accuracy/calculate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:t,content:s,provider:a,model:r})});let w;try{w=await n.json()}catch(j){throw console.error("[Frontend] Failed to parse JSON from /api/accuracy/calculate:",j),new Error("Failed to parse JSON from /api/accuracy/calculate")}if(console.log("[Frontend] /api/accuracy/calculate response:",w),!n.ok)throw new Error("Failed to calculate accuracy: "+(w.error||n.status));return w}async calculateGeminiAccuracy({answer:t,content:s,model:a}){console.log("[Frontend] Calling /api/accuracy/gemini with:",{answer:t,content:s,model:a});const r=await fetch(`${ge}/accuracy/gemini`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:t,content:s,model:a})});let n;try{n=await r.json()}catch(w){throw console.error("[Frontend] Failed to parse JSON from /api/accuracy/gemini:",w),new Error("Failed to parse JSON from /api/accuracy/gemini")}if(console.log("[Frontend] /api/accuracy/gemini response:",n),!r.ok)throw new Error("Failed to calculate Gemini accuracy: "+(n.error||r.status));return n}async calculateGeoScoreBackend(t){const s=await fetch(`${ge}/geo-score`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify(t)});let a;try{a=await s.json()}catch(r){throw console.error("[Frontend] Failed to parse JSON from /api/geo-score:",r),new Error("Failed to parse JSON from /api/geo-score")}if(console.log("[Frontend] /api/geo-score response:",a),!s.ok)throw new Error("Failed to calculate GEO score: "+(a.error||s.status));return a}async getGEOFanoutAnalysis(t){const s=t?`${ge}/geo-fanout/analysis?sessionId=${t}`:`${ge}/geo-fanout/analysis`;console.log("[Frontend] Calling GEO fanout analysis:",s);const a=await fetch(s,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}});let r;try{r=await a.json()}catch(n){throw console.error("[Frontend] Failed to parse JSON from GEO fanout analysis:",n),new Error("Failed to parse JSON from GEO fanout analysis")}if(console.log("[Frontend] GEO fanout analysis response:",r),!a.ok)throw new Error("Failed to get GEO fanout analysis: "+(r.error||a.status));return r}async analyzeCompetitor(t,s){const a=await fetch(`${ge}/competitor/analyze`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({domain:t,userContent:s})}),r=await a.json();if(!a.ok)throw new Error("Failed to analyze competitor: "+(r.error||a.status));return r}async analyzeMultipleCompetitors(t,s){const a=await fetch(`${ge}/competitor/analyze-multiple`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({domains:t,userContent:s})}),r=await a.json();if(!a.ok)throw new Error("Failed to analyze competitors: "+(r.error||a.status));return r}async getCompetitorAnalyses(){const t=await fetch(`${ge}/competitor/analyses`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),s=await t.json();if(!t.ok)throw new Error("Failed to get competitor analyses: "+(s.error||t.status));return s}async getCompetitorAnalysis(t){const s=await fetch(`${ge}/competitor/analysis/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),a=await s.json();if(!s.ok)throw new Error("Failed to get competitor analysis: "+(a.error||s.status));return a}async deleteCompetitorAnalysis(t){const s=await fetch(`${ge}/competitor/analysis/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),a=await s.json();if(!s.ok)throw new Error("Failed to delete competitor analysis: "+(a.error||s.status));return a}async extractContentFromUrl(t){return console.log("[API Service] Extracting content from URL:",t),console.log("[API Service] API_BASE_URL:",ge),console.log("[API Service] Access token:",localStorage.getItem("accessToken")?"Present":"Missing"),this.request("/extract-content",{method:"POST",body:JSON.stringify({url:t})})}async crawlWebsite(t,s){return console.log("[API Service] Crawling website:",t,"with options:",s),this.request("/crawl-website",{method:"POST",body:JSON.stringify({url:t,options:s})})}async extractFullPageHtml(t){return console.log("[API Service] Extracting full page HTML from URL:",t),this.request("/extract/fullpage",{method:"POST",body:JSON.stringify({url:t})})}async getSmartAnalyses(){const t=await fetch(`${ge}/competitor/smart-analyses`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),s=await t.json();if(!t.ok)throw new Error("Failed to get smart analyses: "+(s.error||t.status));return s}async getSmartAnalysis(t){const s=await fetch(`${ge}/competitor/smart-analysis/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),a=await s.json();if(!s.ok)throw new Error("Failed to get smart analysis: "+(a.error||s.status));return a}async createSmartAnalysis(t){const s=await fetch(`${ge}/competitor/smart-analysis`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify(t)}),a=await s.json();if(!s.ok)throw new Error("Failed to create smart analysis: "+(a.error||s.status));return a}async deleteSmartAnalysis(t){const s=await fetch(`${ge}/competitor/smart-analysis/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),a=await s.json();if(!s.ok)throw new Error("Failed to delete smart analysis: "+(a.error||s.status));return a}async analyzeContentStructure(t,s){return console.log("[API Service] Analyzing content structure for:",s?`URL: ${s}`:`Content length: ${t.length}`),s?(console.log("[API Service] Using dedicated structural content crawler for URL"),this.request("/structural-content/crawl",{method:"POST",body:JSON.stringify({url:s})})):this.request("/content/analyze-structure",{method:"POST",body:JSON.stringify({content:t,url:s})})}async saveLastStructureAnalysis(t){return this.request("/structure/last",{method:"POST",body:JSON.stringify({analysis:t})})}async getLastStructureAnalysis(t){const s=t?`?url=${encodeURIComponent(t)}`:"";return this.request(`/structure/last${s}`,{method:"GET"})}async getGA4PageMetrics(t){return this.request("/analytics/ga4",{method:"POST",body:JSON.stringify(t)})}async getSearchConsoleMetrics(t){return this.request("/analytics/search-console",{method:"POST",body:JSON.stringify(t)})}async getLLMVisibility(t){return this.request("/analytics/llm-visibility",{method:"POST",body:JSON.stringify(t)})}async applyStructureSuggestions(t,s){const a=await fetch(`${ge}/content/apply-suggestions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({content:t,suggestions:s})}),r=await a.json();if(!a.ok)throw new Error("Failed to apply structure suggestions: "+(r.error||a.status));return r}async getAIVisibilityAnalysis(t,s,a){const r=new URLSearchParams;s&&r.append("industry",s),a?.fast&&r.append("fast","true");const n=r.toString(),w=n?`?${n}`:"";return this.request(`/ai-visibility/${encodeURIComponent(t)}${w}`,{signal:a?.signal})}async analyzeSingleCompetitor(t,s){return await this.request("/ai-visibility/analyze-competitor",{method:"POST",body:JSON.stringify({companyName:t,industry:s})})}}const ye=new Us,Hs=({data:o})=>{console.log("[AIVisibilityTable] Rendering with data:",o);const[t,s]=m.useState(!1),[a,r]=m.useState(""),[n,w]=m.useState(o.competitors||[]),[j,g]=m.useState(!1),[d,y]=m.useState(""),[F,P]=m.useState(!1),[E,A]=m.useState(!1),[q,R]=m.useState("");m.useEffect(()=>{if(!o||!o.competitors){console.error("[AIVisibilityTable] Invalid data structure:",o),s(!0),r("Invalid data structure received");return}if(!Array.isArray(o.competitors)){console.error("[AIVisibilityTable] Competitors is not an array:",o.competitors),s(!0),r("Competitors data is not in expected format");return}s(!1),r(""),console.log("[AIVisibilityTable] Data validation passed, competitors count:",o.competitors.length)},[o]);const U=f=>{const S=n[f].name;if(window.confirm(`Are you sure you want to remove "${S}" from the analysis?`)){const u=n.filter((b,I)=>I!==f);w(u)}},Z=async()=>{if(!d.trim()){alert("Please enter a competitor name");return}if(n.some(f=>f.name.toLowerCase()===d.toLowerCase())){alert("This competitor is already in the analysis");return}console.log("[AIVisibilityTable] Adding competitor:",d),console.log("[AIVisibilityTable] Current industry:",o.industry),A(!0);try{const f=await ye.analyzeSingleCompetitor(d,o.industry);console.log("[AIVisibilityTable] API response received:",f);let S;if(f&&f.success&&f.data)S=f.data,console.log("[AIVisibilityTable] Extracted competitor data:",S);else if(f&&f.name)S=f,console.log("[AIVisibilityTable] Using direct competitor data:",S);else throw new Error("Invalid response format from API");if(!S||!S.name)throw new Error("Invalid competitor data received from API");const u=[...n,S];console.log("[AIVisibilityTable] Updated competitors list:",u),w(u),y(""),g(!1),R(`${d} has been added successfully!`),setTimeout(()=>R(""),3e3)}catch(f){console.error("Error adding competitor:",f),alert(`Failed to add competitor: ${f.message}`)}finally{A(!1)}},re=f=>f>=2.5?"text-green-600 bg-green-100":f>=1.5?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",Q=f=>f>=2.5?"text-green-600 font-semibold":f>=1.5?"text-yellow-600 font-semibold":"text-red-600 font-semibold",T=f=>f.toFixed(4);return t?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error Loading Competitor Data"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:a}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 text-sm text-red-600 hover:text-red-500 underline",children:"Reload page"})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Target Company"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:o.company})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Industry"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:o.industry||"Not specified"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Competitors Analyzed"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:n.length})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"AI Models Used"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"4 (Gemini, Perplexity, Claude, ChatGPT)"})]})]}),q&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-green-800",children:q})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add New Competitor"}),e.jsx("button",{onClick:()=>g(!j),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:j?"Cancel":"Add Competitor"})]}),j&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex items-end space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"competitor-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Competitor Company Name"}),e.jsx("input",{type:"text",id:"competitor-name",value:d,onChange:f=>{const S=f.target.value.trim(),u=/^(https?:\/\/)?[^\s]+\.[^\s]+/i.test(S);if(P(u),u)y(S);else{const b=S.replace(/[^A-Za-z]/g,"");y(b)}try{f.target.setCustomValidity("")}catch{}},onKeyPress:f=>{f.key==="Enter"&&!E&&d.trim()&&Z()},placeholder:"Enter competitor company name or paste a URL...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-gray-900 placeholder-gray-400 bg-white",onInvalid:f=>{f.preventDefault();const S=F?"Please enter a valid URL (e.g., https://example.com)":"Only letters (A–Z, a–z) are allowed";f.target.setCustomValidity(S)},onBlur:f=>{const S=f.currentTarget.value.trim();if(!S){f.currentTarget.setCustomValidity("");return}if(F){const u=/^(https?:\/\/)?([A-Za-z0-9-]+\.)+[A-Za-z]{2,}(\/[^\s]*)?$/i.test(S);f.currentTarget.setCustomValidity(u?"":"Please enter a valid URL (e.g., https://example.com)")}else{const u=/^[A-Za-z]+$/.test(S);f.currentTarget.setCustomValidity(u?"":"Only letters (A–Z, a–z) are allowed")}},disabled:E})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{onClick:Z,disabled:E||!d.trim(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:E?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing..."]}):"Add & Analyze"})})]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["The system will automatically analyze AI visibility scores for the new competitor.",E&&e.jsxs("span",{className:"text-blue-600 font-medium",children:[" ","This may take 30-60 seconds as we analyze across 4 AI engines."]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Market Analysis Results"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detailed scoring breakdown for each company across multiple models"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gemini"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Perplexity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Claude"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ChatGPT"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Average Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map((f,S)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:f.name.charAt(0).toUpperCase()})})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${re(f.aiScores.gemini)}`,children:T(f.aiScores.gemini)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${re(f.aiScores.perplexity)}`,children:T(f.aiScores.perplexity)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${re(f.aiScores.claude)}`,children:T(f.aiScores.claude)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${re(f.aiScores.chatgpt)}`,children:T(f.aiScores.chatgpt)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`text-sm font-semibold ${Q(f.totalScore)}`,children:T(f.totalScore)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>U(S),className:"text-red-600 hover:text-red-900 bg-red-50 hover:bg-red-100 p-2 rounded-full transition-colors",title:"Delete competitor",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},S))})]})})]})]})},Bs="llm_qa_sessions",zs="llm_qa_current_session";function Vs(){const{user:o}=it(),[t]=qe(Bs,[]);qe(zs,null),Me();const[s,a]=m.useState(()=>{try{const p=localStorage.getItem("overview_market_analysis");return p&&JSON.parse(p).originalInput||""}catch{return""}}),[r,n]=m.useState(()=>{try{const p=localStorage.getItem("overview_market_analysis");return p&&JSON.parse(p).industry||""}catch{return""}}),[w,j]=m.useState(!1),[g,d]=m.useState(()=>{try{const p=localStorage.getItem("overview_market_analysis");return p&&JSON.parse(p).inputType||"company"}catch{return"company"}}),[y,F]=m.useState(()=>{try{const p=localStorage.getItem("overview_market_analysis");if(p){const x=JSON.parse(p);return x.data||x}return null}catch{return null}}),[P,E]=m.useState(null),[A,q]=m.useState(!1),[R,U]=m.useState(null),[Z,re]=m.useState([]),[Q,T]=m.useState(0),[f,S]=m.useState(!1);m.useEffect(()=>{const p=pe.getHistoryItems();re(p),console.log("[Overview] Loaded history items:",p.length)},[Q]),m.useEffect(()=>{try{const p=localStorage.getItem("overview_market_analysis");if(p){const x=JSON.parse(p);console.log("[Overview] Restoring cached analysis data:",x),x.originalInput&&a(x.originalInput),x.industry&&n(x.industry),x.inputType&&d(x.inputType),x.data&&F(x.data),console.log("[Overview] Cached data restored successfully")}}catch(p){console.error("[Overview] Error restoring cached data:",p)}},[]),m.useEffect(()=>{const p=C=>{(C.key==="comprehensive_history"||C.key==="sessions")&&(console.log("[Overview] Storage changed, refreshing data"),T($=>$+1))};window.addEventListener("storage",p);const x=setInterval(()=>{pe.getHistoryItems().length!==Z.length&&(console.log("[Overview] Item count changed, refreshing data"),T($=>$+1))},3e3);return()=>{window.removeEventListener("storage",p),clearInterval(x)}},[Z.length]),o&&t.filter(p=>p.userId===o.id);const u=p=>{try{let x=p.replace(/^https?:\/\//,"").replace(/^www\./,"");x=x.split("/")[0].split("?")[0].split("#")[0];const C=x.split(".");return C.length>=2?C[C.length-2]:x}catch(x){return console.error("Error extracting company from URL:",x),p}},b=()=>{try{localStorage.removeItem("overview_market_analysis"),F(null),a(""),n(""),d("company"),E(null),q(!1),console.log("[Overview] Analysis data cleared")}catch(p){console.error("[Overview] Error clearing analysis data:",p)}},I=async()=>{if(!s.trim()){E("Please enter a company name or URL to analyze.");return}let p=s.trim(),x="company";(s.includes("http://")||s.includes("https://")||s.includes("www."))&&(p=u(s),x="url",console.log("[Overview] Detected URL, extracted company name:",p)),j(!0),E(null),q(!1);try{const C=new AbortController;U(C),console.log("[Overview] Starting AI visibility analysis for:",p),console.log("[Overview] Industry:",r);const $=await ye.getAIVisibilityAnalysis(p,r||void 0,{signal:C.signal});if(console.log("[Overview] Analysis results received:",$),$.success&&$.data){console.log("[Overview] Setting AI result:",$.data),F($.data),q(!0);try{const V=$.data.competitors||[],B={id:`ai-visibility-${Date.now()}`,type:"ai-visibility",name:`AI Visibility Analysis - ${p}`,timestamp:new Date().toISOString(),company:p,industry:r||void 0,analysis:{competitors:V.map(i=>({name:i.name,visibilityScores:{gemini:i.aiScores?.gemini||0,perplexity:i.aiScores?.perplexity||0,claude:i.aiScores?.claude||0,chatgpt:i.aiScores?.chatgpt||0,average:i.totalScore||0},status:"success"})),serviceStatus:$.data.serviceStatus||{gemini:!0,perplexity:!0,claude:!0,chatgpt:!0},summary:{totalCompetitors:V.length,averageVisibilityScore:V.reduce((i,l)=>i+(l.totalScore||0),0)/Math.max(V.length,1),topCompetitor:V.length>0?V.reduce((i,l)=>(l.totalScore||0)>(i.totalScore||0)?l:i).name:"None"}}};pe.addHistoryItem(B),console.log("[Overview] Analysis saved to history:",B)}catch(V){console.warn("Failed to save analysis to history:",V)}try{localStorage.setItem("overview_market_analysis",JSON.stringify({company:p,originalInput:s,inputType:x,industry:r||"",data:$.data,timestamp:Date.now()}))}catch(V){console.warn("Failed to cache analysis results:",V)}}else console.error("[Overview] Analysis failed:",$.error),E($.error||"Analysis failed. Please try again.")}catch(C){if(C.name==="AbortError"){console.log("Analysis was cancelled");return}console.error("AI analysis error:",C),E(C.message||"Analysis failed. Please try again.")}finally{j(!1),U(null)}};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-start gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Overview"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Welcome to kabini.ai - Your AI-Powered Content Enhancement Platform"})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Company Analysis"}),e.jsx("p",{className:"text-gray-600",children:"Enter a company name or URL to analyze market position and competitors"})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row items-stretch lg:items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",value:s,onChange:p=>Le(p,x=>{a(x)}),onPaste:p=>Se(p,x=>{a(x)}),onKeyDown:Ne,onKeyPress:p=>{p.key==="Enter"&&!w&&s.trim()&&I()},required:!0,placeholder:"Enter company name or URL (e.g., cloudfuze or https://cloudfuze.com) *",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg text-gray-900 placeholder-gray-500",disabled:w}),s.includes("http://")||s.includes("https://")||s.includes("www.")?e.jsxs("div",{className:"mt-2 text-sm text-blue-600",children:["📍 Detected URL - will extract company name: ",e.jsx("span",{className:"font-medium",children:u(s)})]}):null]}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:r,onChange:p=>Le(p,x=>{n(x)}),onPaste:p=>Se(p,x=>{n(x)}),onKeyDown:Ne,onKeyPress:p=>{p.key==="Enter"&&!w&&s.trim()&&I()},placeholder:"Industry (optional)",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg text-gray-900 placeholder-gray-500",disabled:w})}),e.jsx("button",{onClick:I,disabled:w||!s.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-medium flex items-center gap-2 transition-colors",children:w?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Qt,{className:"w-5 h-5"}),"Analyze"]})}),w&&e.jsx("button",{onClick:()=>{try{R?.abort()}catch{}j(!1)},className:"bg-red-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-red-700 transition-colors",children:"Stop"})]}),P&&e.jsx("div",{className:"mt-4 text-red-700 bg-red-50 border border-red-200 rounded px-4 py-2",children:P}),A&&e.jsx("div",{className:"mt-4 text-green-700 bg-green-50 border border-green-200 rounded px-4 py-2",children:"✅ Analysis completed successfully! Results are ready below."})]}),y&&e.jsxs(e.Fragment,{children:[y.serviceStatus&&e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 rounded border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"AI Service Status"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${y.serviceStatus.gemini?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["Gemini: ",y.serviceStatus.gemini?"Available":"Overloaded"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${y.serviceStatus.perplexity?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["Perplexity: ",y.serviceStatus.perplexity?"Available":"Overloaded"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${y.serviceStatus.claude?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["Claude: ",y.serviceStatus.claude?"Available":"Overloaded"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${y.serviceStatus.chatgpt?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["ChatGPT: ",y.serviceStatus.chatgpt?"Available":"Overloaded"]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold",children:["Analysis Results for ",e.jsx("span",{className:"text-blue-700",children:y.company})]}),y.originalInput&&y.originalInput!==y.company&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["📍 Analyzed from: ",e.jsx("span",{className:"font-medium",children:y.originalInput})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-800",onClick:()=>{E(null),I()},children:"Re‑Analyze"}),e.jsx("button",{className:"bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded hover:bg-gray-50 hover:text-gray-900",onClick:b,children:"Clear"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Competitor Analysis"}),y.competitors&&Array.isArray(y.competitors)?e.jsx(Hs,{data:y}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Data Structure Issue"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["Competitors data is missing or in unexpected format.",e.jsx("br",{}),e.jsx("strong",{children:"Debug Info:"})," ",JSON.stringify({hasCompetitors:!!y.competitors,competitorsType:typeof y.competitors,isArray:Array.isArray(y.competitors),dataKeys:Object.keys(y)})]})]})]})})]})]})]})]})}class Qs{async analyzeContentStructure(t,s){try{console.log("[ContentStructureService] Calling API with:",{contentLength:t.length,url:s});const a=await ye.analyzeContentStructure(t,s);if(console.log("[ContentStructureService] Raw API response:",a),console.log("[ContentStructureService] Response type:",typeof a),console.log("[ContentStructureService] Response keys:",a?Object.keys(a):"No response"),a&&a.success&&a.analysis)return console.log("[ContentStructureService] Using response.analysis (success case)"),a.analysis;if(a&&a.analysis)return console.log("[ContentStructureService] Using response.analysis (no success field)"),a.analysis;throw a&&!a.success?(console.error("[ContentStructureService] API returned error:",a.error),new Error(a.error||"Analysis failed")):(console.error("[ContentStructureService] Invalid response format:",a),new Error("Invalid response format from server"))}catch(a){throw console.error("[ContentStructureService] Error analyzing content structure:",a),a}}async applyStructureSuggestions(t,s){try{const a=await ye.applyStructureSuggestions(t,s);if(a.success)return a.improvedContent;throw new Error(a.error||"Failed to apply suggestions")}catch(a){return console.error("Error applying structure suggestions:",a),t}}}const _t=new Qs;function Gs(o){const t=["good","great","excellent","amazing","wonderful","fantastic","positive","helpful","useful","clear","effective"],s=["bad","terrible","awful","horrible","negative","unclear","confusing","useless","ineffective","poor"],a=o.toLowerCase().split(" ");let r=0,n=0;return a.forEach(w=>{t.includes(w)&&r++,s.includes(w)&&n++}),r>n?"Positive":n>r?"Negative":"Neutral"}async function Js({accuracy:o,question:t,answer:s,importantQuestions:a,allConfidences:r,sourceUrl:n,content:w}){let j=0;if(a.length>0){let U=0;for(let Z=0;Z<a.length;Z++){const re=a[Z],Q=r[Z]||0,T=Ks(t,re),f=Q*T/100;U+=f}j=U/a.length*100}let g=0;const d=s.length;d>=50&&d<=500?g+=20:d>=30&&d<=800?g+=15:d>=20&&d<=1e3&&(g+=10),(/^Q:|<h[1-6]>|<h[1-6] /.test(s)||/<h[1-6]>/.test(w))&&(g+=15),(/\n\s*[-*1.]/.test(s)||/<ul>|<ol>/.test(s))&&(g+=15);const y=s.split(/[.!?]/).filter(U=>U.trim().length>0),F=s.split(/\s+/).filter(U=>U.length>0),P=y.length>0?F.length/y.length:0;P>=10&&P<=25?g+=25:P>=8&&P<=30?g+=20:P>=5&&P<=35&&(g+=15);let E=0;/first|second|third|finally|in conclusion|to summarize/i.test(s)&&(E+=10),/however|but|although|while|on the other hand/i.test(s)&&(E+=5),/for example|such as|including|specifically/i.test(s)&&(E+=5),/therefore|thus|as a result|consequently/i.test(s)&&(E+=5),g+=Math.min(E,25),g>100&&(g=100);let A=/@type\s*[:=]\s*['"]?FAQPage['"]?/i.test(s)||/@type\s*[:=]\s*['"]?FAQPage['"]?/i.test(w)?1:0,q=1;try{const U=n.replace(/\/$/,"")+"/robots.txt",Z=await axios.get(U,{timeout:2e3});/Disallow:\s*\//i.test(Z.data)&&(q=0)}catch{q=1}const R=.4*o+.2*j+.2*g+.1*A*100+.1*q*100;return{geoScore:Math.round(R),breakdown:{accuracy:o,coverage:j,structure:g,schema:A,access:q}}}function Ks(o,t){const s=o.toLowerCase().split(/\W+/).filter(w=>w.length>2),a=t.toLowerCase().split(/\W+/).filter(w=>w.length>2),r=s.filter(w=>a.includes(w)),n=[...new Set([...s,...a])];return n.length>0?r.length/n.length:0}function Qe(o,t,s){let a=0;const r=[];console.log("[Apply Suggestions] Starting to apply suggestions:",{htmlLength:o.length,suggestionsCount:t.length,suggestions:t.map(g=>({type:g.type,hasExactReplacement:!!g.exactReplacement}))}),t.forEach(g=>{try{if(g.exactReplacement){const{find:d,replace:y}=g.exactReplacement;console.log(`[Apply Suggestions] Applying ${g.type}:`,{find:d.substring(0,100)+"...",replace:y.substring(0,100)+"...",found:o.includes(d)}),o.includes(d)?(o=o.replace(d,y),a++,r.push(`${g.type} applied with exact replacement`),console.log(`[Apply Suggestions] Successfully applied ${g.type}`)):console.log(`[Apply Suggestions] Could not find pattern for ${g.type}`)}}catch(d){console.warn(`Failed to apply exact replacement for ${g.type}:`,d)}});let n;try{if(n=new window.DOMParser().parseFromString(o,"text/html"),n.querySelector("parsererror"))return console.warn("[Apply Suggestions] HTML parsing errors detected, using fallback approach"),o}catch(g){return console.error("[Apply Suggestions] Error parsing HTML:",g),o}const w=(g,d,y)=>{if(!d||!y)return 0;let F=0;const P=g.createTreeWalker?g.createTreeWalker(g.body||g,NodeFilter.SHOW_TEXT):n.createTreeWalker(g.body||n.body,NodeFilter.SHOW_TEXT);let E;for(;E=P.nextNode();)E.textContent&&E.textContent.includes(d)&&(E.textContent=E.textContent.replaceAll(d,y),s?.highlight&&E.parentElement&&E.parentElement.setAttribute("data-ai-updated","true"),F++);return F};if(n.querySelectorAll('style, link[rel="stylesheet"]'),n.querySelectorAll("script"),n.querySelector("header, nav, .header, .navbar, .navigation"),n.querySelector("footer, .footer"),t.forEach(g=>{try{if(g.exactReplacement&&o.includes(g.exactReplacement.replace))return;if(g.type==="heading"){const d=(g.enhancedContent||g.implementation||"").trim(),y=(g.currentContent||"").trim();if(d.length>0){const F=Array.from(n.querySelectorAll("h1,h2,h3"));let P=!1;F.forEach(E=>{const A=(E.textContent||"").trim();(y&&A.includes(y)||!y&&E.tagName.toLowerCase()==="h1")&&(E.textContent=d,s?.highlight&&E.setAttribute("data-ai-updated","true"),P=!0)}),P&&(a++,r.push("Heading updated"))}}if(g.type==="paragraph"){const{currentContent:d,enhancedContent:y}=g;if(d&&y){let F=!1;n.querySelectorAll("p").forEach(E=>{E.textContent&&E.textContent.includes(d)&&(E.textContent=(E.textContent||"").replaceAll(d,y),s?.highlight&&E.setAttribute("data-ai-updated","true"),F=!0)}),F||(F=w(n,d,y)>0),F&&(a++,r.push("Paragraph content replaced"))}}if(g.type==="list"){const{currentContent:d,enhancedContent:y}=g;if(d&&y){const F=n.querySelectorAll("li");let P=!1;F.forEach(E=>{E.textContent&&E.textContent.includes(d)&&(E.textContent=E.textContent.replace(d,y),s?.highlight&&E.setAttribute("data-ai-updated","true"),P=!0)}),P||(P=w(n,d,y)>0),P&&(a++,r.push("List item content replaced"))}}if(g.type==="meta_description"){let d=n.querySelector('meta[name="description"]');d||(d=n.createElement("meta"),d.name="description",n.head.appendChild(d));const y=n.querySelector("p")?.textContent||"";d.content=y.substring(0,160)||"Improved meta description.",a++,r.push("Meta description updated")}if(g.type==="title"){let d=n.querySelector("title");d||(d=n.createElement("title"),n.head.appendChild(d));const y=n.querySelector("h1")?.textContent;d.textContent=y||"Improved Title",a++,r.push("Title updated")}if(g.type==="meta_keywords"){let d=n.querySelector('meta[name="keywords"]');d||(d=n.createElement("meta"),d.name="keywords",n.head.appendChild(d));const P=(n.body.textContent||"").split(/\s+/).filter(A=>A.length>4).reduce((A,q)=>(A[q.toLowerCase()]=(A[q.toLowerCase()]||0)+1,A),{}),E=Object.entries(P).sort(([,A],[,q])=>q-A).slice(0,5).map(([A])=>A);d.content=E.join(", "),a++,r.push("Meta keywords updated")}if(g.type==="meta_viewport"){let d=n.querySelector('meta[name="viewport"]');d||(d=n.createElement("meta"),d.name="viewport",n.head.appendChild(d)),d.content="width=device-width, initial-scale=1.0",a++,r.push("Meta viewport updated")}if(g.type==="og_title"){let d=n.querySelector('meta[property="og:title"]');d||(d=n.createElement("meta"),d.setAttribute("property","og:title"),n.head.appendChild(d)),d.content=n.querySelector("h1")?.textContent||n.querySelector("title")?.textContent||"",a++,r.push("Open Graph title added")}if(g.type==="og_description"){let d=n.querySelector('meta[property="og:description"]');d||(d=n.createElement("meta"),d.setAttribute("property","og:description"),n.head.appendChild(d)),d.content=n.querySelector('meta[name="description"]')?.getAttribute("content")||"",a++,r.push("Open Graph description added")}if(g.type==="canonical"){let d=n.querySelector('link[rel="canonical"]');d||(d=n.createElement("link"),d.rel="canonical",n.head.appendChild(d)),d.href=window.location.href,a++,r.push("Canonical URL added")}if(g.type==="lang_attribute"){const d=n.documentElement;d.lang="en",a++,r.push("Language attribute updated")}if(g.type==="keyword_optimization"){const d=g.enhancedContent||g.implementation||"",y=d.match(/Enhanced with keywords:\s*(.+)/i)||d.match(/Add keywords:\s*(.+)/i);if(y&&y[1]){let F=n.querySelector('meta[name="keywords"]');F||(F=n.createElement("meta"),F.name="keywords",n.head.appendChild(F)),F.content=y[1],a++,r.push("Meta keywords updated")}}if(g.type==="content_enhancement"){const d=n.querySelectorAll("p");if(d.length>0){const y=d[0],F=g.enhancedContent;F&&F.length>10&&(y.textContent=F,a++,r.push("Content enhanced for AI understanding"))}}if(g.type==="sentence_replacement"){const d=g.currentContent,y=g.enhancedContent;d&&y&&w(n,d,y)>0&&(a++,r.push("Sentence replaced for better AI understanding"))}if(g.type==="ai_content_restructure"){const{currentContent:d,enhancedContent:y}=g;d&&y&&w(n,d,y)>0&&(a++,r.push("Content restructured"))}}catch(d){console.warn(`Failed to apply suggestion ${g.type}:`,d)}}),a>0){const g=n.createElement("script");g.type="application/json",g.id="ai-change-summary",g.textContent=JSON.stringify({appliedCount:a,appliedSuggestions:r}),n.head.appendChild(g)}let j=n.documentElement.outerHTML;if(j.includes("viewport")||(j=j.replace("</head>",`    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>`)),j.includes("<!DOCTYPE html>")||(j=`<!DOCTYPE html>
`+j),s?.highlight){const g=n.createElement("style");g.textContent=`
    [data-ai-updated="true"] { background: #ecfdf5 !important; outline: 2px solid #10b98133; }
    `,n.head.appendChild(g)}return j}const mt=Object.freeze(Object.defineProperty({__proto__:null,analyzeSentiment:Gs,applySuggestionsWithDOM:Qe,calculateGeoScoreV2:Js},Symbol.toStringTag,{value:"Module"})),Yt=({message:o,onClose:t,autoClose:s=!0,autoCloseDelay:a=3e3})=>{const[r,n]=m.useState(!1);return m.useEffect(()=>{if(o){if(n(!0),s){const w=setTimeout(()=>{n(!1),setTimeout(t,300)},a);return()=>clearTimeout(w)}}else n(!1)},[o,s,a,t]),o?e.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full",children:e.jsx("div",{className:`transform transition-all duration-300 ease-in-out ${r?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"}`,children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg shadow-lg p-4 relative",children:[e.jsx("button",{onClick:()=>{n(!1),setTimeout(t,300)},className:"absolute top-2 right-2 text-green-400 hover:text-green-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-full p-1","aria-label":"Close success notification",children:e.jsx(ht,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-start gap-3 pr-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(vt,{className:"w-5 h-5 text-green-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-800 mb-1",children:"Success"}),e.jsx("p",{className:"text-sm text-green-700 leading-relaxed",children:o})]})]}),s&&e.jsx("div",{className:"mt-3 h-1 bg-green-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full transition-all duration-300 ease-linear",style:{width:r?"0%":"100%",transitionDuration:`${a}ms`}})})]})})}):null},gt="structure_analysis_state",Ws="comprehensive_history",qt=o=>{let t=0;if(o.length===0)return t.toString();for(let s=0;s<o.length;s++){const a=o.charCodeAt(s);t=(t<<5)-t+a,t=t&t}return t.toString()};function Ys({content:o,url:t}){const[s,a]=m.useState(null),[r,n]=m.useState(!1),[w,j]=m.useState(""),[g,d]=m.useState(!1),[y,F]=m.useState("overview"),[P,E]=m.useState("landing"),[A,q]=m.useState("schema"),[R,U]=m.useState(t||""),[Z,re]=m.useState(null),[Q,T]=m.useState(!1),[f,S]=m.useState(o||""),[u,b]=m.useState(""),[I,p]=m.useState("landing"),[x,C]=m.useState(""),[$,V]=m.useState(!1),[B,i]=m.useState(!1),[l,N]=m.useState(Date.now()),[h,K]=m.useState(!0),[X,ie]=m.useState(!1),[le,ee]=m.useState(!1),[H,W]=m.useState(!0),[Ae,$e]=m.useState(!1);qe(Ws,[]);const[Ke,de]=m.useState(null),[ct,Oe]=m.useState(!1),[Ue,We]=m.useState(!1),[Ee,Ye]=m.useState(!1),Ze=(c,v,k)=>{console.log("[Content Analysis] saveToHistory called with:",{hasAnalysisResult:!!c,contentLength:v?.length||0,urlToAnalyze:k,analysisResultKeys:c?Object.keys(c):[]});try{if(!c){console.error("[Content Analysis] No analysis result provided to saveToHistory");return}if(!v){console.error("[Content Analysis] No content provided to saveToHistory");return}console.log("[Content Analysis] Preparing history item with data:",{id:`structure-analysis-${Date.now()}`,name:`Structure Analysis${k?` - ${k}`:""}`,contentLength:v.length,suggestionsCount:c.suggestions?.length||0,hasMetadata:!!c.metadata,hasStructuredContent:!!c.structuredContent});const z=c.suggestions?.filter(_=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(_.type)).map(_=>({type:_.type,priority:_.priority,description:_.description,implementation:_.implementation,impact:_.impact}))||[];console.log("[Content Analysis] Filtered suggestions:",z.length);const G={id:`structure-analysis-${Date.now()}`,name:`Structure Analysis${k?` - ${k}`:""}`,originalContent:v,structuredContent:c.structuredContent||"",analysis:{seoScore:c.seoScore||0,llmOptimizationScore:c.llmOptimizationScore||0,readabilityScore:c.readabilityScore||0,structuredData:c.structuredData,fullPageHtml:c.fullPageHtml,pageTitle:c.pageTitle,pageDescription:c.pageDescription,geoScoreTotal:c.geoScoreTotal||0,geoBreakdown:c.geoBreakdown||{},contentQualityScoreTotal:c.contentQualityScoreTotal||0,contentQualityBreakdown:c.contentQualityBreakdown||{},suggestions:z,metadata:c.metadata||{title:"",description:"",keywords:[],author:"",publishDate:"",lastModified:"",readingTime:0,wordCount:0,language:"en"}}};console.log("[Content Analysis] About to call historyService.addStructureAnalysisHistory with:",{id:G.id,name:G.name,originalContentLength:G.originalContent.length,structuredContentLength:G.structuredContent.length,analysisKeys:Object.keys(G.analysis)}),console.log("[Content Analysis] About to call historyService.addStructureAnalysisHistory with data:",G);try{pe.addStructureAnalysisHistory(G),console.log("[Content Analysis] Successfully called historyService.addStructureAnalysisHistory");const _=pe.getHistoryItems();console.log("[Content Analysis] Current history after adding:",{totalItems:_.length,latestItem:_[0]?.name||"None",structureAnalysisItems:_.filter(Y=>Y.type==="structure-analysis").length});const te=_.find(Y=>Y.id===G.id);if(te){console.log("[Content Analysis] ✅ Item successfully added to history:",te.name);try{const Y=localStorage.getItem("comprehensive_history"),ue=Y?JSON.parse(Y):[];console.log("[Content Analysis] Direct localStorage check:",{totalStoredItems:ue.length,structureItems:ue.filter(Ve=>Ve.type==="structure-analysis").length,ourItemExists:ue.some(Ve=>Ve.id===G.id)})}catch(Y){console.error("[Content Analysis] Error checking localStorage directly:",Y)}}else{console.error("[Content Analysis] ❌ Item was NOT added to history!");try{const Y=localStorage.getItem("comprehensive_history");if(console.error("[Content Analysis] Debug - localStorage content:",Y),Y){const ue=JSON.parse(Y);console.error("[Content Analysis] Debug - parsed localStorage:",ue)}}catch(Y){console.error("[Content Analysis] Debug - localStorage error:",Y)}}}catch(_){console.error("[Content Analysis] Error calling historyService.addStructureAnalysisHistory:",_),_ instanceof Error&&console.error("[Content Analysis] Error stack:",_.stack)}}catch(z){console.error("[Content Analysis] Failed to save to history:",z),z instanceof Error&&console.error("[Content Analysis] Error stack:",z.stack)}try{localStorage.setItem("structure_last_saved",new Date().toISOString())}catch{}};m.useEffect(()=>{const v=Object.keys(localStorage).filter(k=>k.startsWith(gt));if(v.length>0){let k=v[0],z=0;for(const _ of v)try{const te=localStorage.getItem(_);if(te){const Y=JSON.parse(te);Y.lastAccessed&&Y.lastAccessed>z&&(z=Y.lastAccessed,k=_)}}catch{}if(z===0)for(const _ of v)try{const te=localStorage.getItem(_);if(te&&JSON.parse(te).analysis){k=_;break}}catch{}const G=localStorage.getItem(k);if(G)try{const _=JSON.parse(G);_.urlInput&&U(_.urlInput),_.activeTab&&F(_.activeTab),_.structuredView&&E(_.structuredView),_.schemaView&&q(_.schemaView),_.codeViewType&&p(new Set(["landing","code","improved"]).has(_.codeViewType)?_.codeViewType:"landing"),!f&&_.pastedPreview&&S(_.pastedPreview),_.improvedFullPageHtml&&C(_.improvedFullPageHtml),console.log("[Content Analysis] Restored cached analysis from:",k),setTimeout(()=>{const te={..._,lastAccessed:Date.now()};localStorage.setItem(k,JSON.stringify(te))},100)}catch(_){console.error("[Content Analysis] Error restoring cached state:",_)}}!f&&o&&S(o)},[o]),m.useEffect(()=>{if(s)try{const c={analysis:s,fullPageHtml:u,improvedFullPageHtml:x,activeTab:y,codeViewType:I,urlInput:R,pastedContent:f,savedAt:Date.now()};localStorage.setItem("structure_last_persisted",JSON.stringify(c)),console.log("[Content Analysis] Analysis persisted for navigation")}catch(c){console.error("[Content Analysis] Error persisting analysis:",c)}},[s,u,x,y,I,R,f]),m.useEffect(()=>()=>{if(s)try{const c={analysis:s,fullPageHtml:u,improvedFullPageHtml:x,activeTab:y,codeViewType:I,urlInput:R,pastedContent:f,savedAt:Date.now()};localStorage.setItem("structure_last_persisted",JSON.stringify(c)),console.log("[Content Analysis] Analysis persisted on component unmount")}catch(c){console.error("[Content Analysis] Error persisting analysis on unmount:",c)}},[s,u,x,y,I,R,f]),m.useEffect(()=>{if(!s)try{const c=localStorage.getItem("structure_last_persisted");if(c){const v=JSON.parse(c);v.analysis&&v.savedAt&&(Date.now()-v.savedAt<864e5?(console.log("[Content Analysis] Restoring persisted analysis from navigation"),a(v.analysis),v.fullPageHtml&&b(v.fullPageHtml),v.analysis.originalContent&&S(v.analysis.originalContent),v.analysis.crawledUrl&&U(v.analysis.crawledUrl),v.improvedFullPageHtml&&C(v.improvedFullPageHtml),v.activeTab&&F(v.activeTab),v.codeViewType&&p(v.codeViewType),p("landing"),W(!0),ee(!0)):localStorage.removeItem("structure_last_persisted"))}}catch(c){console.error("[Content Analysis] Error restoring persisted analysis:",c),localStorage.removeItem("structure_last_persisted")}},[]);const D=m.useRef(0);m.useEffect(()=>{const c=()=>{const k=Date.now();k-D.current<1e3||(D.current=k,N(k),K(!0))},v=["mousedown","mousemove","keypress","scroll","touchstart","click"];return v.forEach(k=>{document.addEventListener(k,c,!0)}),()=>{v.forEach(k=>{document.removeEventListener(k,c,!0)})}},[]),m.useEffect(()=>{if(f&&f.trim().length>0&&h){const c=qt(f),v=`${gt}_${c}`,k={urlInput:R,activeTab:y,structuredView:P,schemaView:A,pastedPreview:f.slice(0,1e3),codeViewType:I,lastAccessed:Date.now(),createdAt:Date.now(),isActive:!0};try{localStorage.setItem(v,JSON.stringify(k)),console.log("[Content Analysis] Persisted lightweight state for content hash:",c)}catch{Object.keys(localStorage).forEach(G=>{if(G.startsWith(gt))try{localStorage.removeItem(G)}catch{}})}}},[R,y,P,A,f,I,h]);const O=m.useRef(null);m.useEffect(()=>{if(!X||!f||f.trim().length===0)return;const c=qt(f);if(O.current===c){ie(!1);return}if(!h){ie(!1);return}console.log("[Content Analysis] User-triggered analysis for content length:",f.length),O.current=c,oe(f,R).finally(()=>ie(!1)),W(!0)},[X,f,h]);const oe=async(c,v)=>{if(s&&s.originalContent===c){console.log("[Content Analysis] Using cached analysis for existing content");return}de(null),W(!0),ee(!0),n(!0);try{console.log("[Content Analysis] Starting new analysis for:",v?`URL: ${v}`:`Content length: ${c.length}`);const k=await _t.analyzeContentStructure(c,v);if(console.log("[Content Analysis] Analysis result:",k),console.log("[Content Analysis] Result type:",typeof k),console.log("[Content Analysis] Result keys:",k?Object.keys(k):"No result"),console.log("[Content Analysis] Result structure:",{hasSuggestions:!!k?.suggestions,suggestionsLength:k?.suggestions?.length||0,hasStructuredContent:!!k?.structuredContent,hasMetadata:!!k?.metadata,hasSeoScore:typeof k?.seoScore=="number",hasLlmScore:typeof k?.llmOptimizationScore=="number",hasReadabilityScore:typeof k?.readabilityScore=="number"}),console.log("[Content Analysis] Suggestions:",k?.suggestions),console.log("[Content Analysis] Full page HTML available:",!!k?.fullPageHtml),a(k),k.fullPageHtml)b(k.fullPageHtml),console.log("[Content Analysis] Full page HTML set from analysis response");else if(v)try{const z=await ye.extractFullPageHtml(v);z.success&&(b(z.html),console.log("[Content Analysis] Full page HTML extracted separately"))}catch(z){console.warn("[Content Analysis] Failed to extract full page HTML:",z)}console.log("[Content Analysis] About to save to history with result:",{hasResult:!!k,contentLength:c?.length||0,urlToAnalyze:v,resultKeys:k?Object.keys(k):[]}),console.log("[Content Analysis] Result validation for history:",{hasOriginalContent:!!k?.originalContent,hasStructuredContent:!!k?.structuredContent,hasSeoScore:typeof k?.seoScore=="number",hasLlmScore:typeof k?.llmOptimizationScore=="number",hasReadabilityScore:typeof k?.readabilityScore=="number",hasSuggestions:Array.isArray(k?.suggestions),suggestionsLength:k?.suggestions?.length||0,hasMetadata:!!k?.metadata,hasStructuredData:!!k?.structuredData}),console.log("[Content Analysis] FORCING save to history with FRESH data...");try{const z=new Date,_={id:`structure-analysis-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Structure Analysis${v?` - ${v}`:""} - ${z.toLocaleTimeString()}`,originalContent:c,structuredContent:k.structuredContent||c,analysis:{suggestions:(k.suggestions||[]).filter(ue=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(ue.type)).map(ue=>({type:ue.type,priority:ue.priority,description:ue.description||"",implementation:ue.implementation||"",impact:ue.impact||""})),metadata:{title:k.metadata?.title||"Analyzed Content",description:k.metadata?.description||"Content structure analysis",keywords:k.metadata?.keywords||[],author:k.metadata?.author||"Unknown",publishDate:z.toISOString().split("T")[0],lastModified:z.toISOString().split("T")[0],readingTime:Math.ceil(c.length/1e3),wordCount:c.split(/\s+/).length,language:"en"},structuredData:k.structuredData||{},fullPageHtml:k.fullPageHtml||"",pageTitle:k.pageTitle||"",pageDescription:k.pageDescription||"",geoScoreTotal:k.geoScoreTotal,geoBreakdown:k.geoBreakdown,contentQualityScoreTotal:k.contentQualityScoreTotal,contentQualityBreakdown:k.contentQualityBreakdown,wordCount:k.metadata?.wordCount||c.split(/\s+/).length,readingTime:k.metadata?.readingTime||Math.ceil(c.length/1e3),suggestionsCount:(k.suggestions||[]).length,language:k.metadata?.language||"en"}};console.log("[Content Analysis] FRESH history item created:",{id:_.id,name:_.name,timestamp:z.toISOString(),contentLength:_.originalContent.length}),pe.addStructureAnalysisHistory(_);const te=pe.getHistoryItems(),Y=te.find(ue=>ue.id===_.id);Y?(console.log("[Content Analysis] ✅ SUCCESSFULLY saved FRESH item to history!",Y.name),window.dispatchEvent(new StorageEvent("storage",{key:"comprehensive_history",newValue:JSON.stringify(te)})),window.location.pathname==="/history"&&(console.log("[Content Analysis] On history page, triggering refresh..."),setTimeout(()=>window.location.reload(),1e3))):console.error("[Content Analysis] ❌ FAILED to save FRESH item to history!")}catch(z){console.error("[Content Analysis] Direct save error:",z)}Ze(k,c,v);try{await ye.saveLastStructureAnalysis({...k,crawledUrl:v||R||""})}catch{}try{const z=v||R;if(z){let G="/";try{const _=new URL(z);G=_.pathname+(_.search||"")}catch{}}}catch{}}catch(k){console.error("Error analyzing content:",k),alert("Failed to analyze content structure")}finally{n(!1)}},ne=async()=>{if(!R.trim()){re("Please enter a URL to analyze.");return}try{new URL(R)}catch{re("Please enter a valid URL (e.g., https://example.com)");return}T(!0),re(null);try{const c=await _t.analyzeContentStructure("",R);if(console.log("[URL Analysis] Raw result:",c),c){const v={...c,geoScoreTotal:c.geoScoreTotal||c.seoScore||0,geoBreakdown:c.geoBreakdown||{},contentQualityScoreTotal:c.contentQualityScoreTotal||c.readabilityScore||0,contentQualityBreakdown:c.contentQualityBreakdown||{},metadata:c.metadata?{...c.metadata,title:c.metadata.title||c.pageTitle||"No Title",description:c.metadata.description||c.pageDescription||"No Description",keywords:c.metadata.keywords||[],author:c.metadata.author||"Unknown",publishDate:c.metadata.publishDate||"Unknown",lastModified:c.metadata.lastModified||"Unknown",readingTime:c.metadata.readingTime||1,wordCount:c.metadata.wordCount||0,language:c.metadata.language||"en",contentStructure:c.metadata.contentStructure||{headings:[],paragraphs:[],lists:[]}}:{title:c.pageTitle||"No Title",description:c.pageDescription||"No Description",keywords:[],author:"Unknown",publishDate:"Unknown",lastModified:"Unknown",readingTime:1,wordCount:0,language:"en",contentStructure:{headings:[],paragraphs:[],lists:[]}},suggestions:c.suggestions||[],structuredData:c.structuredData||{},fullPageHtml:c.fullPageHtml||"",pageTitle:c.pageTitle||"",pageDescription:c.pageDescription||"",originalContent:c.originalContent||"",structuredContent:c.structuredContent||c.fullPageHtml||""};console.log("[URL Analysis] Safe result:",v),console.log("[URL Analysis] Metadata debug:",{hasMetadata:!!c.metadata,metadataKeys:c.metadata?Object.keys(c.metadata):[],publishDate:c.metadata?.publishDate,publishDateType:typeof c.metadata?.publishDate,publishDateLength:c.metadata?.publishDate?.length,publishDateIsNull:c.metadata?.publishDate===null,publishDateIsUndefined:c.metadata?.publishDate===void 0,publishDateIsToday:c.metadata?.publishDate===new Date().toISOString().split("T")[0]}),a(v),b(v.fullPageHtml||""),S(v.originalContent||""),p("landing"),W(!0),ee(!0),console.log("[URL Analysis] Saving to history...");try{const k=new Date,G={id:`structure-analysis-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Structure Analysis - ${R} - ${k.toLocaleTimeString()}`,originalContent:v.originalContent||"",structuredContent:v.structuredContent||v.fullPageHtml||"",analysis:{suggestions:(v.suggestions||[]).filter(Y=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(Y.type)).map(Y=>({type:Y.type,priority:Y.priority,description:Y.description||"",implementation:Y.implementation||"",impact:Y.impact||""})),metadata:{title:v.metadata?.title||"Analyzed Content",description:v.metadata?.description||"Content structure analysis",keywords:v.metadata?.keywords||[],author:v.metadata?.author||"Unknown",publishDate:v.metadata?.publishDate||k.toISOString().split("T")[0],lastModified:v.metadata?.lastModified||k.toISOString().split("T")[0],readingTime:v.metadata?.readingTime||Math.ceil((v.originalContent||"").length/1e3),wordCount:v.metadata?.wordCount||(v.originalContent||"").split(/\s+/).length,language:v.metadata?.language||"en"},structuredData:v.structuredData||{},fullPageHtml:v.fullPageHtml||"",pageTitle:v.pageTitle||"",pageDescription:v.pageDescription||"",geoScoreTotal:v.geoScoreTotal,geoBreakdown:v.geoBreakdown,contentQualityScoreTotal:v.contentQualityScoreTotal,contentQualityBreakdown:v.contentQualityBreakdown,wordCount:v.metadata?.wordCount||(v.originalContent||"").split(/\s+/).length,readingTime:v.metadata?.readingTime||Math.ceil((v.originalContent||"").length/1e3),suggestionsCount:(v.suggestions||[]).length,language:v.metadata?.language||"en"}};console.log("[URL Analysis] FRESH history item created:",{id:G.id,name:G.name,timestamp:k.toISOString(),contentLength:G.originalContent.length}),pe.addStructureAnalysisHistory(G);const _=pe.getHistoryItems(),te=_.find(Y=>Y.id===G.id);te?(console.log("[URL Analysis] ✅ SUCCESSFULLY saved URL analysis to history!",te.name),window.dispatchEvent(new StorageEvent("storage",{key:"comprehensive_history",newValue:JSON.stringify(_)})),window.location.pathname==="/history"&&(console.log("[URL Analysis] On history page, triggering refresh..."),setTimeout(()=>window.location.reload(),1e3))):console.error("[URL Analysis] ❌ FAILED to save URL analysis to history!")}catch(k){console.error("[URL Analysis] Error saving to history:",k)}}else re("Failed to analyze URL. Please try again.")}catch(c){console.error("URL analysis error:",c),re(c.message||"Failed to analyze URL. Please try again.")}finally{T(!1)}},J=async()=>{if(s){d(!0);try{let c;const v=s.fullPageHtml||u||o;if(!v){alert("No content available to improve.");return}try{if(c=Qe(v,s.suggestions),!c||c.length<100)throw new Error("Generated HTML is too short or invalid");if(new DOMParser().parseFromString(c,"text/html").querySelector("parsererror"))throw new Error("Generated HTML contains parsing errors")}catch(k){console.error("Error in applySuggestionsWithDOM:",k),alert("Failed to apply suggestions due to HTML processing error. Please try again.");return}s.fullPageHtml||u?(C(c),i(!0),p("improved")):j(c),de(`✅ Applied ${s.suggestions.length} suggestions successfully!`)}catch(c){console.error("Error applying suggestions:",c),alert("Failed to apply structure suggestions")}finally{d(!1)}}},L=c=>{navigator.clipboard.writeText(c),alert("Copied to clipboard!")},M=c=>{const v=window.open("","_blank");v?(v.document.write(c),v.document.close()):alert("Please allow popups to run the code in a new window.")},he=()=>{x?M(x):s?.fullPageHtml?M(s.fullPageHtml):alert("No page content available to run. Please analyze a URL first.")},ce=()=>{if(!s?.fullPageHtml){alert("No original page content available.");return}const c=s.fullPageHtml;let v=x&&x.trim().length>0?x:"";if(!v||v.replace(/\s+/g,"")===c.replace(/\s+/g,""))try{const G=Qe(c,s.suggestions,{highlight:!0});v=G||c,C(G)}catch{v=c}const k=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Comparison - Original vs Improved</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .comparison-container { display: flex; gap: 20px; height: 100vh; }
        .page-frame { flex: 1; border: 2px solid #ddd; border-radius: 8px; }
        .page-frame h3 { margin: 0; padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; }
        .page-frame.original h3 { background: #ffebee; color: #c62828; }
        .page-frame.improved h3 { background: #e8f5e8; color: #2e7d32; }
        iframe { width: 100%; height: calc(100% - 50px); border: none; }
    </style>
</head>
<body>
    <div class="comparison-container">
        <div class="page-frame original">
            <h3>🔴 Original Page</h3>
            <iframe srcdoc="${c.replace(/"/g,"&quot;")}"></iframe>
        </div>
        <div class="page-frame improved">
            <h3>🟢 Improved Page</h3>
            <iframe srcdoc="${v.replace(/"/g,"&quot;")}"></iframe>
        </div>
    </div>
</body>
</html>`,z=window.open("","_blank");z?(z.document.write(k),z.document.close()):alert("Please allow popups to view the comparison.")},fe=async()=>{if(s)try{de("🔄 Applying suggestions and generating improved code...");const c=s.fullPageHtml||u;if(!c){de("❌ No HTML content available to improve.");return}console.log("[Content Analysis] Applying suggestions to HTML:",{sourceHtmlLength:c.length,suggestionsCount:s.suggestions.length,suggestions:s.suggestions.map(te=>({type:te.type,hasExactReplacement:!!te.exactReplacement}))});const v=Qe(c,s.suggestions);console.log("[Content Analysis] Improved code generated:",{improvedCodeLength:v.length,hasChanges:v!==c}),C(v),i(!0),await navigator.clipboard.writeText(v);const k=s.suggestions.length,z=s.suggestions.map(te=>te.type).slice(0,3),G=z.length>0?` (${z.join(", ")}${z.length<k?"...":""})`:"";de(`✅ ${k} suggestions applied${G}! Improved code copied to clipboard.`),window.confirm("Improved code copied to clipboard! Would you like to run the improved page in a new window?")&&M(v)}catch(c){console.error("Error copying and running code:",c),de("❌ Failed to apply suggestions. Please try again."),setTimeout(()=>de(null),3e3)}},He=async c=>{if(s)try{de(`🔄 Applying ${c.type} suggestion...`);const v=s.fullPageHtml||u;if(!v){de("❌ No HTML content available to improve.");return}console.log("[Content Analysis] Applying single suggestion:",{type:c.type,hasExactReplacement:!!c.exactReplacement,currentContent:c.currentContent?.substring(0,100)+"...",enhancedContent:c.enhancedContent?.substring(0,100)+"..."});let k;try{if(k=Qe(v,[c]),!k||k.length<100)throw new Error("Generated HTML is too short or invalid");if(new DOMParser().parseFromString(k,"text/html").querySelector("parsererror"))throw new Error("Generated HTML contains parsing errors")}catch(z){if(console.error("Error in applySuggestionsWithDOM:",z),c.exactReplacement)try{const{find:G,replace:_}=c.exactReplacement;if(v.includes(G))k=v.replace(G,_),console.log("[Content Analysis] Applied fallback exact replacement");else throw new Error("Exact replacement pattern not found")}catch(G){console.error("Fallback also failed:",G),de("❌ Failed to apply suggestion. Please try again."),setTimeout(()=>de(null),3e3);return}else{de("❌ Failed to apply suggestion due to HTML processing error. Please try again."),setTimeout(()=>de(null),3e3);return}}C(k),i(!0),de(`✅ ${c.type} suggestion applied! Check the "Improved" tab to see changes.`),p("improved")}catch(v){console.error("Error applying single suggestion:",v),de("❌ Failed to apply suggestion. Please try again."),setTimeout(()=>de(null),3e3)}},Re=(c,v)=>{const k=new Blob([c],{type:"text/plain"}),z=URL.createObjectURL(k),G=document.createElement("a");G.href=z,G.download=v,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(z)},Be=c=>c>=80?"text-green-600":c>=60?"text-yellow-600":"text-red-600",Xe=c=>c>=80?"bg-green-100":c>=60?"bg-yellow-100":"bg-red-100",et=c=>{switch(c){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},we=c=>{switch(c){case"high":return e.jsx(zt,{className:"w-4 h-4"});case"medium":return e.jsx(Dt,{className:"w-4 h-4"});case"low":return e.jsx(vt,{className:"w-4 h-4"});default:return e.jsx(Dt,{className:"w-4 h-4"})}},ve=({html:c})=>{const v=Ut.useMemo(()=>`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin: 0; padding: 0; background: transparent; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .__wrap { max-width: 1024px; margin: 0 auto; padding: 16px; box-sizing: border-box; }
    img, video, iframe { max-width: 100%; height: auto; }
    h1, h2, h3, h4, h5, h6 { margin-top: 1.2em; margin-bottom: .5em; }
    p { line-height: 1.6; }
  </style>
  </head>
<body>
  <div class="__wrap">${c||""}</div>
</body>
</html>`,[c]);return e.jsx("iframe",{title:"Landing Preview",sandbox:"allow-same-origin",srcDoc:v,loading:"lazy",style:{width:"100%",height:"75vh",border:"none",borderRadius:"0.5rem",background:"transparent"}})},Te=(c,v)=>{if(!Array.isArray(c)||!v)return c||[];const k=v.toLowerCase(),z=new Map,G=new Set,_=["artificial intelligence","ai","machine learning","ml","deep learning","data science","analytics","insights","metrics","performance","cloud computing","saas","platform","integration","api","business intelligence","reporting","dashboard","visualization","digital transformation","innovation","technology","solution","user experience","ux","interface","design","usability","security","compliance","governance","risk","audit","scalability","reliability","availability","backup","recovery","migration","tenant","onedrive","sharepoint","teams","cloudfuze","microsoft 365","google workspace","metadata"];return c.forEach(te=>{const Y=(te||"").trim();if(!Y)return;const ue=Y.toLowerCase();if(G.has(ue))return;const Ve=ue.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`(^|[^a-z0-9])${Ve}([^a-z0-9]|$)`,"i").test(k)){G.add(ue);let tt=0;_.some(ss=>ue.includes(ss))&&(tt+=5),ue.split(" ").length>=2&&(tt+=3),ue.length>8&&(tt+=2),(ue.includes("-")||/[A-Z]/.test(Y))&&(tt+=2);const ts=(k.match(new RegExp(Ve,"gi"))||[]).length;z.set(Y,ts+tt)}}),Array.from(z.entries()).sort((te,Y)=>Y[1]!==te[1]?Y[1]-te[1]:Y[0].length-te[0].length).map(([te])=>te).slice(0,25)},De=c=>{const v=c.currentContent||c?.exactReplacement?.find||"",k=c.enhancedContent||c?.exactReplacement?.replace||c.implementation||"";return{current:v,enhanced:k}};if(m.useEffect(()=>{if(I==="improved"&&u&&s&&s.suggestions.length>0){V(!0);try{const c=Qe(u,s.suggestions,{highlight:!0});C(c)}catch{C("Failed to generate improved code.")}finally{V(!1)}}},[I,u,s]),r&&!s)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-black mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-black mb-2",children:"Analyzing Content Structure"}),e.jsx("p",{className:"text-gray-600",children:"Analyzing your content for SEO and LLM optimization..."}),Z&&e.jsx("div",{className:"mt-6 inline-block bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded",children:Z})]})})});const ze=()=>{a(null),U(""),re(null),S(""),j(""),b(""),p("landing"),C(""),de(null),K(!0),W(!1),ee(!1),Object.keys(localStorage).forEach(v=>{v.startsWith(gt)&&localStorage.removeItem(v)}),localStorage.removeItem("structure_last_persisted"),console.log("[Content Analysis] New analysis initiated - state cleared")};return s?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{message:Ke,onClose:()=>de(null),autoClose:!0,autoCloseDelay:4e3}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(bt,{className:"w-8 h-8 text-black flex-shrink-0"}),e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-black truncate",children:"Content Structure Analysis"})]}),e.jsxs("div",{className:"flex gap-2 lg:gap-3 flex-shrink-0 items-center",children:[e.jsx("button",{onClick:ze,className:"bg-blue-600 text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold text-sm lg:text-base",children:"New Analysis"}),e.jsxs("button",{onClick:()=>Re(s.structuredContent,"improved-content.txt"),className:"bg-black text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors flex items-center gap-2 text-sm lg:text-base",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[s?.geoScoreTotal!==void 0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${Xe(s.geoScoreTotal)}`,children:e.jsx(bt,{className:"w-6 h-6 text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-black",children:"GEO Score Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"AI visibility and search engine optimization breakdown"})]})]}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-black",onClick:()=>Ye(c=>!c),children:Ee?"Hide":"Details"})]}),e.jsxs("div",{className:`text-3xl font-bold ${Be(s.geoScoreTotal)}`,children:[s.geoScoreTotal,"/100"]})]}),s?.contentQualityScoreTotal!==void 0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${Xe(s.contentQualityScoreTotal)}`,children:e.jsx(ps,{className:"w-6 h-6 text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-black",children:"Content Quality Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Human/editorial score breakdown"})]})]}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-black",onClick:()=>We(c=>!c),children:Ue?"Hide":"Details"})]}),e.jsxs("div",{className:`text-3xl font-bold ${Be(s.contentQualityScoreTotal)}`,children:[s.contentQualityScoreTotal,"/100"]})]})]}),s?.geoBreakdown&&Ee&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200 mb-8",children:[e.jsx("h4",{className:"font-semibold text-black mb-3",children:"GEO Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start content-start",children:Object.entries(s.geoBreakdown).map(([c,v])=>{const z={evidence_attribution:30,answerability_snippetability:25,structured_understanding:20,freshness_stability:10,entity_topic_coverage:10,retrieval_friendliness:5}[c]??5,G=v.score?.toFixed?`${v.score.toFixed(1)}/${z}`:`${v.score}/${z}`;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold text-black",children:c.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase())}),e.jsx("div",{className:"text-black font-bold",children:G})]}),e.jsx("div",{className:"text-sm text-gray-700 space-y-1.5",children:Object.entries(v).filter(([_])=>_!=="score").map(([_,te])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:_.replace(/_/g," ")}),e.jsx("span",{className:"text-black font-medium",children:typeof te=="number"?te.toFixed(1):String(te)})]},_))})]},c)})})]}),s?.contentQualityBreakdown&&Ue&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200 mb-8",children:[e.jsx("h4",{className:"font-semibold text-black mb-3",children:"Content Quality Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start content-start",children:Object.entries(s.contentQualityBreakdown).map(([c,v])=>{const z={readability_clarity:20,structure_coherence:15,depth_coverage:20,originality:15,accuracy_source_use:10,style_tone:10,accessibility_presentation:10}[c]??20,G=v.score?.toFixed?`${v.score.toFixed(1)}/${z}`:`${v.score}/${z}`;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold text-black",children:c.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase())}),e.jsx("div",{className:"text-black font-bold",children:G})]}),e.jsx("div",{className:"text-sm text-gray-700 space-y-1.5",children:Object.entries(v).filter(([_])=>_!=="score").map(([_,te])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:_.replace(/_/g," ")}),e.jsx("span",{className:"text-black font-medium",children:typeof te=="number"?te.toFixed(1):String(te)})]},_))})]},c)})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 mb-8 w-full overflow-hidden",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex flex-wrap gap-2 lg:gap-0 lg:space-x-8 px-4 lg:px-6 py-2 lg:py-0",children:[{id:"overview",label:"Overview",icon:Pe},{id:"suggestions",label:"Suggestions",icon:ot},{id:"structured",label:"Structured Content",icon:Ge},{id:"schema",label:"Schema Markup",icon:fs}].map(c=>e.jsxs("button",{onClick:()=>F(c.id),className:`flex items-center gap-1 lg:gap-2 py-2 lg:py-4 px-2 lg:px-4 rounded-lg font-bold text-xs lg:text-sm transition-colors whitespace-nowrap 
                    ${y===c.id?"bg-white text-black":"bg-blue-600 text-black opacity-80 hover:opacity-100"}
                  `,children:[e.jsx(c.icon,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:c.label}),e.jsx("span",{className:"sm:hidden",children:c.label.split(" ")[0]})]},c.id))})}),e.jsxs("div",{className:"p-4 lg:p-6 w-full overflow-hidden",children:[y==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Content Summary"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:s?.metadata?.wordCount||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Words"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:s?.metadata?.readingTime||1}),e.jsx("div",{className:"text-sm text-gray-600",children:"Min Read"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:s?.suggestions?.length||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Suggestions"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:(s?.metadata?.language||"en").toUpperCase()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Language"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Content Metadata"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:s?.metadata?.title||"No Title",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:s?.metadata?.description||"No Description",readOnly:!0,rows:3,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Te(s?.metadata?.keywords||[],s?.originalContent||"").map((c,v)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:c},v))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Author"}),e.jsx("input",{type:"text",value:s?.metadata?.author||"Unknown",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Publish Date"}),e.jsx("input",{type:"text",value:s?.metadata?.publishDate||"Unknown",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reading Time"}),e.jsx("input",{type:"text",value:`${s?.metadata?.readingTime||1} minutes`,readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]})]})]})]})]}),y==="suggestions"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-6 gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:"Structure Improvement Suggestions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:he,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(It,{className:"w-4 h-4"}),"Run Full Page"]}),e.jsxs("button",{onClick:ce,className:"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Compare Pages"]}),e.jsxs("button",{onClick:J,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Apply All Suggestions"]})]})]}),e.jsx("div",{className:"space-y-6",children:s?.suggestions?.map((c,v)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${et(c.priority)}`,children:we(c.priority)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h4",{className:"font-semibold text-black text-lg",children:c.description}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${et(c.priority)}`,children:c.priority})]}),(()=>{const{current:k}=De(c);return k})()&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Current Content:"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200 overflow-auto",children:e.jsx("pre",{className:"text-sm text-red-700 font-mono whitespace-pre-wrap",children:De(c).current})})]}),(()=>{const{enhanced:k}=De(c);return k})()&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-green-700 mb-2",children:"Enhanced Content:"}),e.jsx("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200 overflow-auto",children:e.jsx("pre",{className:"text-sm text-green-800 font-mono whitespace-pre-wrap",children:De(c).enhanced})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"🎯 Impact:"})," ",c.impact]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>He(c),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Apply This Suggestion"]})})]})]})},v))})]}),y==="structured"&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:"Improved Content Structure"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:`px-2 lg:px-3 py-1 rounded-lg text-xs lg:text-sm font-semibold border transition-colors duration-150 ${I==="landing"?"bg-black text-white border-black":"bg-gray-200 text-black border-gray-300 hover:bg-gray-300"}`,onClick:()=>p("landing"),children:"Landing"}),e.jsx("button",{className:`px-2 lg:px-3 py-1 rounded-lg text-xs lg:text-sm font-semibold border transition-colors duration-150 ${I==="code"?"bg-black text-white border-black":"bg-gray-200 text-black border-gray-300 hover:bg-gray-300"}`,onClick:()=>p("code"),children:"Code"}),I==="code"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>L(u),className:"bg-gray-100 text-black px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(bs,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy Code"})]}),e.jsxs("button",{onClick:fe,className:"bg-blue-600 text-white px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(It,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy & Run"})]}),e.jsxs("button",{onClick:()=>Re(u,"original-page.html"),className:"bg-gray-600 text-white px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(be,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})]})]})]}),I==="landing"?e.jsx("div",{className:"bg-gray-50 rounded-lg p-2 w-full",children:e.jsx(ve,{html:s.structuredContent})}):I==="improved"?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-auto w-full",style:{maxHeight:"70vh"},children:e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono leading-relaxed",children:e.jsx("code",{className:"block whitespace-pre-wrap break-all",children:x||'No improved code available yet. Click "Copy & Run" to generate improved code.'})})}):e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-auto w-full",style:{maxHeight:"70vh"},children:e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono leading-relaxed",children:e.jsx("code",{className:"block whitespace-pre-wrap break-all",children:u||"No code extracted yet."})})})]}),y==="schema"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-4",children:e.jsx("h3",{className:"text-lg font-semibold text-black mb-0",children:"Structured Data Markup"})}),e.jsxs("div",{className:"space-y-6",children:[s?.structuredData?.articleSchema&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-black mb-2",children:"Article Schema"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-x-auto",children:e.jsx("pre",{className:"text-xs lg:text-sm text-black font-mono break-words whitespace-pre-wrap",children:JSON.stringify(s.structuredData.articleSchema,null,2)})})]}),s?.structuredData?.faqSchema&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-black mb-2",children:"FAQ Schema"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-x-auto",children:e.jsx("pre",{className:"text-xs lg:text-sm text-black font-mono break-words whitespace-pre-wrap",children:JSON.stringify(s.structuredData.faqSchema,null,2)})})]}),!s?.structuredData?.articleSchema&&!s?.structuredData?.faqSchema&&e.jsx("div",{className:"text-sm text-gray-600",children:"No structured data captured for the last analysis."})]})]})]})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-black mb-2",children:"New Content Structure Analysis"}),e.jsx("p",{className:"text-gray-600",children:"Enter a URL or paste content to analyze its structure"})]}),e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row items-center gap-4",children:[e.jsx("input",{type:"url",value:R,onChange:v=>Le(v,k=>{U(k),N(Date.now()),K(!0)}),onPaste:v=>Se(v,k=>{U(k),N(Date.now()),K(!0)}),onKeyDown:Ne,onFocus:()=>{N(Date.now()),K(!0)},required:!0,placeholder:"Paste a URL to analyze its structure... *",className:"flex-1 px-4 py-3 border border-blue-400 rounded-lg text-blue-900 font-semibold focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent text-base",disabled:Q}),e.jsx("button",{onClick:ne,disabled:Q||!R.trim(),className:"bg-black text-white px-6 py-2 rounded-lg hover:bg-gray-800 transition-colors font-semibold disabled:opacity-50",children:Q?"Analyzing...":"Analyze URL"})]}),Z&&e.jsx("div",{className:"text-red-600 mb-4",children:Z}),e.jsxs("div",{className:"text-center py-20",children:[e.jsx("h2",{className:"text-2xl font-bold text-black mb-2",children:"No Analysis Available"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please provide content to analyze."}),e.jsx("div",{className:"mb-6 flex justify-center gap-4",children:e.jsx("button",{onClick:()=>{try{$e(!0);const v=localStorage.getItem("structure_last_persisted");if(v){const k=JSON.parse(v);k.analysis&&k.savedAt?Date.now()-k.savedAt<864e5?(a(k.analysis),k.fullPageHtml&&b(k.fullPageHtml),k.improvedFullPageHtml&&C(k.improvedFullPageHtml),k.analysis.originalContent&&S(k.analysis.originalContent),k.analysis.crawledUrl&&U(k.analysis.crawledUrl),k.activeTab&&F(k.activeTab),k.codeViewType&&p(k.codeViewType),de("📊 Local analysis restored successfully!"),setTimeout(()=>de(null),3e3)):(localStorage.removeItem("structure_last_persisted"),alert("No recent local analysis found.")):alert("No local analysis found.")}else alert("No local analysis found.")}catch(v){console.error("Failed to restore local analysis:",v),alert("Failed to restore local analysis. Please try again.")}finally{$e(!1)}},disabled:Ae,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors font-semibold disabled:opacity-50",children:Ae?"Restoring...":"Restore Last Analysis"})}),e.jsx("div",{className:"flex gap-4 justify-center",children:!1})]})]})})}class Zs extends Ut.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,message:String(t?.message||"Unexpected error")}}componentDidCatch(t,s){console.error("[ErrorBoundary]",t,s)}handleReset=()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("structure_analysis_state")&&localStorage.removeItem(t)})}catch{}this.setState({hasError:!1,message:void 0});try{window.location.reload()}catch{}};render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-lg w-full bg-white border border-gray-200 rounded-xl p-6 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-black mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:this.state.message||"The page failed to render."}),e.jsx("button",{className:"bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800",onClick:this.handleReset,children:"Reset Structure Analysis"})]})}):this.props.children}}function Xs(){const o=Ht(),t=Me(),{content:s="",url:a=""}=o.state||{},r=()=>{t(-1)};return e.jsx(Zs,{fallbackMessage:"Structure analysis failed. Click reset and then Restore Last Analysis to reload your previous results.",children:e.jsx(Ys,{content:s,url:a,onBack:r})})}const ea=({password:o,className:t=""})=>{const s=/[A-Z]/.test(o),a=/[a-z]/.test(o),r=/\d/.test(o),n=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(o),w=o.length>=8,j=s&&a&&r&&n&&w;return o.length===0?null:e.jsx("div",{className:`text-sm ${j?"text-green-600":"text-red-600"} ${t}`,children:j?"✅ Password meets all requirements":"❌ Password must contain: at least 8 characters, one uppercase letter, one lowercase letter, one number, and one special character"})},ta=()=>{const[o,t]=m.useState({firstName:"",lastName:"",email:"",password:"",confirmPassword:""}),[s,a]=m.useState(""),[r,n]=m.useState(!1),[w,j]=m.useState(!1),[g,d]=m.useState(!1),[y,F]=m.useState(!1),[P,E]=m.useState(null),A=Me(),{login:q,error:R,clearError:U,isAuthenticated:Z}=it();m.useEffect(()=>{const Q=async()=>{if(Z){console.log("[SignUp] User is authenticated via AuthContext, redirecting to overview..."),A("/overview",{replace:!0});return}if(se.isAuthenticated()){console.log("[SignUp] User is authenticated via authService, redirecting to overview..."),A("/overview",{replace:!0});return}};Q();const T=setInterval(Q,500);return()=>clearInterval(T)},[A,Z]);const re=async Q=>{if(Q.preventDefault(),a(""),E(null),!o.firstName.trim()){a("First name is required");return}if(!o.lastName.trim()){a("Last name is required");return}if(!o.email.trim()){a("Email is required");return}if(!o.password.trim()){a("Password is required");return}if(!o.confirmPassword.trim()){a("Please confirm your password");return}const T=/^[A-Za-z]+$/;if(!T.test(o.firstName)){a("First name can contain only letters (A–Z, a–z)");return}if(!T.test(o.lastName)){a("Last name can contain only letters (A–Z, a–z)");return}const f=ke(o.email);if(!f.isValid){a(Ce(o.email,f));return}if(a(""),o.password.length<8){a("Password must be at least 8 characters long");return}if(!/[A-Z]/.test(o.password)){a("Password must contain at least one uppercase letter");return}if(!/[a-z]/.test(o.password)){a("Password must contain at least one lowercase letter");return}if(!/\d/.test(o.password)){a("Password must contain at least one number");return}if(!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(o.password)){a("Password must contain at least one special character");return}if(o.password!==o.confirmPassword){a("Passwords do not match");return}n(!0),U();try{const S=await se.register({firstName:o.firstName,lastName:o.lastName,email:o.email,password:o.password});S.success?(console.log("[SignUp] Sign up successful, attempting login..."),await q("register",{email:o.email,password:o.password,name:`${o.firstName} ${o.lastName}`,displayName:`${o.firstName} ${o.lastName}`})):a(S.error||"Sign up failed. Please try again.")}catch(S){console.error("[SignUp] Sign up error:",S);let u="Sign up failed. Please try again.";S&&typeof S=="object"&&(S.message&&typeof S.message=="string"?S.message.includes("already exists")||S.message.includes("duplicate")?u="Account already exists on this email":S.message.includes("Network")||S.message.includes("fetch")?u="Network error. Please check your connection and try again.":u=S.message:S.error&&typeof S.error=="string"&&(S.error.includes("already exists")||S.error.includes("duplicate")?u="Account already exists on this email":S.error.includes("Network")||S.error.includes("connection")?u="Network error. Please check your connection and try again.":u=S.error)),console.log("[SignUp] Setting authentication error message:",u),E(u),a("")}finally{n(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-100 px-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-300/30 via-indigo-300/30 to-purple-300/30"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-cyan-200/20 via-blue-200/20 to-indigo-200/20"}),e.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-gradient-to-br from-blue-400/40 to-cyan-400/40 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[500px] h-[500px] bg-gradient-to-tl from-purple-400/40 to-pink-400/40 rounded-full blur-3xl translate-x-1/2 translate-y-1/2 animate-pulse",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 w-80 h-80 bg-gradient-to-r from-indigo-400/35 to-blue-400/35 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 animate-pulse",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-32 h-32 bg-gradient-to-br from-cyan-300/30 to-blue-300/30 rounded-full blur-2xl animate-bounce",style:{animationDelay:"0.5s"}}),e.jsx("div",{className:"absolute bottom-1/4 left-1/4 w-24 h-24 bg-gradient-to-br from-purple-300/30 to-pink-300/30 rounded-full blur-2xl animate-bounce",style:{animationDelay:"1.5s"}}),e.jsxs("div",{className:"w-full max-w-md mx-auto p-8 bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl border border-white/30 relative z-10 bg-gradient-to-br from-white/95 via-white/90 to-white/95",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(Je,{className:"w-12 h-12 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-3",children:"Create your account"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Sign up to get started with kabini.ai"})]}),e.jsxs("form",{onSubmit:re,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-2",children:["First Name ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"firstName",value:o.firstName,onChange:Q=>Le(Q,T=>{const f=T.replace(/[^A-Za-z]/g,"");t(S=>({...S,firstName:f})),s&&a("")}),onPaste:Q=>Se(Q,T=>{const f=T.replace(/[^A-Za-z]/g,"");t(S=>({...S,firstName:f}))}),onKeyDown:Ne,required:!0,placeholder:"Enter your first name *",pattern:"[A-Za-z]+",autoComplete:"given-name",className:"w-full px-4 py-4 border-2 border-gray-300 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-2",children:["Last Name ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",name:"lastName",value:o.lastName,onChange:Q=>Le(Q,T=>{const f=T.replace(/[^A-Za-z]/g,"");t(S=>({...S,lastName:f})),s&&a("")}),onPaste:Q=>Se(Q,T=>{const f=T.replace(/[^A-Za-z]/g,"");t(S=>({...S,lastName:f}))}),onKeyDown:Ne,required:!0,placeholder:"Enter your last name *",pattern:"[A-Za-z]+",autoComplete:"family-name",className:"w-full px-4 py-4 border-2 border-gray-300 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-2",children:["Email ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"email",name:"email",value:o.email,onChange:Q=>Le(Q,T=>{const f=nt(T);if(t(S=>({...S,email:f})),s&&a(""),!f.trim())a("");else{const S=ke(f);S.isValid?a(""):a(Ce(f,S))}}),onPaste:Q=>Se(Q,T=>{const f=nt(T);t(u=>({...u,email:f}));const S=ke(f);S.isValid?a(""):a(Ce(f,S))}),onKeyDown:Ne,required:!0,placeholder:"Enter your email address *",className:`w-full px-4 py-4 border-2 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all ${s?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300"}`}),s&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-2",children:["Password ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:w?"text":"password",name:"password",value:o.password,onChange:Q=>Le(Q,T=>{t(x=>({...x,password:T})),s&&a("");const f=/[A-Z]/.test(T),S=/[a-z]/.test(T),u=/\d/.test(T),b=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(T),I=T.length>=8,p=f&&S&&u&&b&&I;F(p),p&&a("")}),onPaste:Q=>Se(Q,T=>{t(x=>({...x,password:T}));const f=/[A-Z]/.test(T),S=/[a-z]/.test(T),u=/\d/.test(T),b=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(T),I=T.length>=8,p=f&&S&&u&&b&&I;F(p),p&&a("")}),onKeyDown:Ne,required:!0,placeholder:"Create a password *",className:"w-full px-4 pr-12 py-4 border-2 border-gray-300 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"}),e.jsx("button",{type:"button",onClick:()=>j(!w),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors focus:outline-none",tabIndex:-1,"aria-label":w?"Hide password":"Show password",children:w?e.jsx(rt,{className:"w-5 h-5"}):e.jsx(Pe,{className:"w-5 h-5"})})]}),e.jsx(ea,{password:o.password,className:"mt-3"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-2",children:["Confirm Password ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:g?"text":"password",name:"confirmPassword",value:o.confirmPassword,onChange:Q=>Le(Q,T=>{t(f=>({...f,confirmPassword:T})),s&&a("")}),onPaste:Q=>Se(Q,T=>{t(f=>({...f,confirmPassword:T}))}),onKeyDown:Ne,required:!0,placeholder:"Re-enter your password *",className:"w-full px-4 pr-12 py-4 border-2 border-gray-300 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"}),e.jsx("button",{type:"button",onClick:()=>d(!g),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors focus:outline-none",tabIndex:-1,"aria-label":g?"Hide confirm password":"Show confirm password",children:g?e.jsx(rt,{className:"w-5 h-5"}):e.jsx(Pe,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:r,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg transform hover:scale-[1.02]",children:r?e.jsx(Fe,{className:"w-5 h-5 animate-spin"}):"Create Account"})]}),e.jsxs("button",{type:"button",onClick:()=>A("/login"),className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 flex items-center justify-center gap-2 shadow-lg transform hover:scale-[1.02] mt-6",children:[e.jsx(at,{className:"w-5 h-5"}),"Already have an account? Sign in"]})]}),e.jsx(lt,{error:P||R,onClose:()=>{E(null),U()},autoClose:!0,autoCloseDelay:5e3})]})},sa=()=>{const[o,t]=m.useState(""),[s,a]=m.useState(!1),[r,n]=m.useState(null),[w,j]=m.useState(!1),g=Me(),d=F=>{const P=F.target.value,E=nt(P);if(t(E),!E.trim())n(null);else{const A=ke(E);A.isValid?n(null):n(Ce(E,A))}},y=async F=>{if(F.preventDefault(),console.log("[ForgotPassword] Form submitted, clearing previous errors"),n(""),!o||!o.trim()){console.log("[ForgotPassword] Email is empty, setting validation error"),n("Please enter your email address");return}try{const P=ke(o);if(!P||!P.isValid){console.log("[ForgotPassword] Email validation failed, setting validation error"),n("Please enter a valid email address");return}}catch(P){console.log("[ForgotPassword] Email validation error:",P),n("Please enter a valid email address");return}console.log("[ForgotPassword] Starting API call to forgot-password endpoint"),j(!0);try{const P=await fetch("http://localhost:5000/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o.trim()})});console.log("[ForgotPassword] API response status:",P.status);let E={};try{const A=await P.text();console.log("[ForgotPassword] Raw response text:",A),A&&(E=JSON.parse(A),console.log("[ForgotPassword] Parsed response data:",E))}catch(A){console.log("[ForgotPassword] Failed to parse response as JSON:",A),E={}}if(P.status===404){console.log("[ForgotPassword] No account found, setting invalid credentials message"),n("Invalid credentials please check your credentials and try logging in");return}else if(P.status===401){console.log("[ForgotPassword] Unauthorized, setting invalid credentials message"),n("Invalid credentials please check your credentials and try logging in");return}else if(P.status===400){console.log("[ForgotPassword] Bad request, setting invalid credentials message"),n("Invalid credentials please check your credentials and try logging in");return}else if(!P.ok){console.log("[ForgotPassword] API error, setting invalid credentials message"),n("Invalid credentials please check your credentials and try logging in");return}console.log("[ForgotPassword] Success, setting submitted state"),a(!0)}catch(P){console.log("[ForgotPassword] Network error caught:",P),n("Network error. Please check your connection and try again.")}finally{j(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-100 px-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-300/30 via-indigo-300/30 to-purple-300/30"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-cyan-200/20 via-blue-200/20 to-indigo-200/20"}),e.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-gradient-to-br from-blue-400/40 to-cyan-400/40 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[500px] h-[500px] bg-gradient-to-tl from-purple-400/40 to-pink-400/40 rounded-full blur-3xl translate-x-1/2 translate-y-1/2 animate-pulse",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 w-80 h-80 bg-gradient-to-r from-indigo-400/35 to-blue-400/35 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 animate-pulse",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/4 right-1/4 w-32 h-32 bg-gradient-to-br from-cyan-300/30 to-blue-300/30 rounded-full blur-2xl animate-bounce",style:{animationDelay:"0.5s"}}),e.jsx("div",{className:"absolute bottom-1/4 left-1/4 w-24 h-24 bg-gradient-to-br from-purple-300/30 to-pink-300/30 rounded-full blur-2xl animate-bounce",style:{animationDelay:"1.5s"}}),e.jsxs("div",{className:"w-full max-w-md mx-auto p-8 bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl border border-white/30 relative z-10 bg-gradient-to-br from-white/95 via-white/90 to-white/95",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(Je,{className:"w-12 h-12 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-3",children:"Forgot your password?"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Enter your email address and we'll send you a link to reset your password."})]}),s?e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 mb-6",children:[e.jsx("div",{className:"text-green-600 font-semibold mb-2",children:"Check your email"}),e.jsxs("div",{className:"text-gray-600 text-sm",children:["If an account with that email exists, a reset link has been sent to ",e.jsx("strong",{children:o}),"."]})]}),e.jsxs("button",{onClick:()=>g("/login"),className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 flex items-center justify-center gap-2 shadow-lg transform hover:scale-[1.02]",children:[e.jsx(at,{className:"w-5 h-5"}),"Back to Login"]})]}):e.jsxs("form",{onSubmit:y,className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-3",children:["Email ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"email",value:o,onChange:d,onPaste:F=>Se(F,P=>{const E=nt(P);t(E);const A=ke(E);A.isValid?n(null):n(Ce(E,A))}),onKeyDown:Ne,required:!0,placeholder:"Enter your email address *",className:"w-full px-4 py-4 border-2 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all border-gray-300"})]}),e.jsx("button",{type:"submit",disabled:w,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg transform hover:scale-[1.02]",children:w?e.jsx(Fe,{className:"w-5 h-5 animate-spin"}):"Send Reset Link"}),e.jsxs("button",{type:"button",onClick:()=>g("/login"),className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 flex items-center justify-center gap-2 shadow-lg transform hover:scale-[1.02]",children:[e.jsx(at,{className:"w-5 h-5"}),"Back to Login"]})]})]}),e.jsx(lt,{error:r,onClose:()=>n(null),autoClose:!0,autoCloseDelay:5e3,type:"error"})]})},aa=()=>{const[o]=os(),[t,s]=m.useState({password:"",confirmPassword:""}),[a,r]=m.useState(""),[n,w]=m.useState(!1),[j,g]=m.useState(!1),[d,y]=m.useState(!1),[F,P]=m.useState(!0),[E,A]=m.useState(!1),[q,R]=m.useState(!1),[U,Z]=m.useState(!1),re=Me(),Q=o.get("token");m.useEffect(()=>{if(!Q){r("Invalid reset link. Please request a new password reset."),P(!1);return}P(!1),y(!0)},[Q]);const T=u=>{const{name:b,value:I}=u.target;if(s({...t,[b]:I}),b==="password"){const p=I.length>=8&&/[a-z]/.test(I)&&/[A-Z]/.test(I)&&/\d/.test(I);Z(p)}},f=()=>t.password?t.confirmPassword?t.password.length<8?(r("Password must be at least 8 characters long"),!1):/(?=.*[a-z])/.test(t.password)?/(?=.*[A-Z])/.test(t.password)?/(?=.*\d)/.test(t.password)?t.password!==t.confirmPassword?(r("Passwords do not match"),!1):!0:(r("Password must contain at least one number"),!1):(r("Password must contain at least one uppercase letter"),!1):(r("Password must contain at least one lowercase letter"),!1):(r("Please confirm your password"),!1):(r("Password is required"),!1),S=async u=>{if(u.preventDefault(),r(""),!!f()){w(!0);try{const b=await fetch("http://localhost:5000/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:Q,newPassword:t.password})}),I=await b.json();if(!b.ok)throw new Error(I.error||"Failed to reset password. Please try again.");g(!0)}catch(b){r(b.message||"Failed to reset password. Please try again.")}finally{w(!1)}}};return F?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"w-full max-w-md mx-auto p-8 bg-white rounded-lg shadow-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Fe,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("div",{className:"text-gray-600",children:"Verifying reset link..."})]})})}):d?j?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"w-full max-w-md mx-auto p-8 bg-white rounded-lg shadow-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:e.jsx(vt,{className:"w-8 h-8 text-green-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Password Reset Successfully"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your password has been updated. You can now log in with your new password."}),e.jsxs("button",{onClick:()=>re("/login"),className:"w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all flex items-center justify-center gap-2",children:[e.jsx(at,{className:"w-5 h-5"}),"Back to Login"]})]})})}):e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:[e.jsxs("div",{className:"w-full max-w-md mx-auto p-8 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:e.jsx(Je,{className:"w-8 h-8 text-blue-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Reset Your Password"}),e.jsx("p",{className:"text-gray-600",children:"Enter your new password below"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-2",children:["New Password ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:E?"text":"password",name:"password",value:t.password,onChange:T,required:!0,placeholder:"Enter your new password",className:"w-full px-4 pr-12 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"}),e.jsx("button",{type:"button",onClick:()=>A(!E),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",tabIndex:-1,"aria-label":E?"Hide password":"Show password",children:E?e.jsx(rt,{className:"w-5 h-5"}):e.jsx(Pe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:`mt-2 text-xs ${U?"text-green-600":"text-gray-500"}`,children:U?"Password meets requirements":"Must be at least 8 characters with uppercase, lowercase, and number"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-900 mb-2",children:["Confirm New Password ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:q?"text":"password",name:"confirmPassword",value:t.confirmPassword,onChange:T,required:!0,placeholder:"Re-enter your new password",className:"w-full px-4 pr-12 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"}),e.jsx("button",{type:"button",onClick:()=>R(!q),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",tabIndex:-1,"aria-label":q?"Hide confirm password":"Show confirm password",children:q?e.jsx(rt,{className:"w-5 h-5"}):e.jsx(Pe,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:n?e.jsx(Fe,{className:"w-5 h-5 animate-spin"}):"Reset Password"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{type:"button",onClick:()=>re("/login"),className:"w-full bg-blue-500 border-2 border-blue-600 text-white hover:bg-blue-600 hover:text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 flex items-center justify-center gap-2 shadow-lg",children:[e.jsx(at,{className:"w-5 h-5"}),"Back to Login"]})})]}),e.jsx(lt,{error:a,onClose:()=>r(""),autoClose:!0,autoCloseDelay:5e3})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"w-full max-w-md mx-auto p-8 bg-white rounded-lg shadow-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:e.jsx(Je,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Invalid Reset Link"}),e.jsx("p",{className:"text-gray-600 mb-6",children:a}),e.jsx("button",{onClick:()=>re("/forgot-password"),className:"w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all",children:"Request New Reset Link"})]})})})},ra=()=>{const[o,t]=m.useState(null),[s,a]=m.useState(null),r=()=>{t("Invalid email or password. Please check your credentials and try again.")},n=()=>{a("Login successful! Welcome back.")},w=()=>{t("Your session will expire soon. Please save your work.")};return e.jsxs("div",{className:"p-8 space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Notification Test"}),e.jsxs("div",{className:"space-x-4",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"Show Error"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"Show Success"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600",children:"Show Warning"})]}),e.jsx(lt,{error:o,onClose:()=>t(null),autoClose:!0,autoCloseDelay:5e3,type:"error"}),e.jsx(Yt,{message:s,onClose:()=>a(null),autoClose:!0,autoCloseDelay:3e3})]})},oa=o=>{let t=0;if(o.length===0)return t.toString();for(let s=0;s<o.length;s++){const a=o.charCodeAt(s);t=(t<<5)-t+a,t=t&t}return Math.abs(t).toString()},Zt="llm_qa_sessions",Xt="llm_qa_current_session",es="llm_competitor_urls",ft="enhance_content_cache_",na=[{label:"Overview",icon:e.jsx(_e,{}),path:"/overview"},{label:"Enhance Content",icon:e.jsx(Ge,{}),path:"/enhance-content"},{label:"Structure Analysis",icon:e.jsx(ot,{}),path:"/content-structure-analysis"},{label:"History",icon:e.jsx(jt,{}),path:"/history"},{label:"Statistics",icon:e.jsx(bt,{}),path:"/statistics"}];function ia({isOpen:o,setIsOpen:t,onLogout:s,user:a,currentPath:r}){const n=Me(),w=j=>{n(j),t(!1)};return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>t(!1)}),e.jsxs("aside",{className:`fixed md:static inset-y-0 left-0 z-50 bg-white w-64 min-h-screen flex flex-col border-r border-gray-200 shadow-lg transform transition-transform duration-300 md:transform-none ${o?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-primary to-accent rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(_e,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-lg font-bold text-primary tracking-wide truncate",children:"kabini.ai"})]}),e.jsx("button",{className:"md:hidden text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors p-1.5 rounded-md flex items-center justify-center flex-shrink-0 ml-2",onClick:()=>t(!1),"aria-label":"Close menu",children:e.jsxs("div",{className:"relative w-5 h-5 flex items-center justify-center",children:[e.jsx("div",{className:"absolute w-4 h-0.5 bg-gray-600 rounded-full transform rotate-45"}),e.jsx("div",{className:"absolute w-4 h-0.5 bg-gray-600 rounded-full transform -rotate-45"})]})})]}),e.jsx("nav",{className:"flex-1 flex flex-col gap-1 mt-6 px-2",children:na.map(j=>{const d=r===j.path;return e.jsxs("button",{className:`flex items-center gap-3 px-4 py-2 rounded-lg font-semibold transition-colors duration-200 text-left ${d?"bg-primary text-white border-l-4 border-primary shadow":"bg-white text-black hover:bg-primary/10 hover:text-primary"}`,onClick:()=>w(j.path),children:[e.jsx("span",{className:`w-5 h-5 ${d?"text-white":"text-primary"}`,children:j.icon}),j.label]},j.path)})}),e.jsxs("div",{className:"mt-auto px-4 py-4 border-t border-primary/10",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full mb-4",children:[e.jsx(Je,{className:"w-6 h-6 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-slate-900 text-sm truncate",children:a?.displayName||a?.name||"User"}),e.jsx("div",{className:"text-xs text-primary truncate",children:a?.email||""})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("button",{className:"w-full bg-white hover:bg-gray-50 text-blue-600 hover:text-blue-700 font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-all duration-200 shadow-sm hover:shadow-md border border-blue-200 hover:border-blue-300",onClick:s,children:[e.jsx(Vt,{className:"w-4 h-4"}),"Logout"]})})]})]})]})}function la({setIsOpen:o,onLogout:t}){return e.jsxs("header",{className:"w-full bg-white border-b border-primary/10 flex items-center justify-between px-4 sm:px-8 py-4 relative z-30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-primary to-accent rounded-lg flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-extrabold text-primary tracking-wide",children:"kabini.ai"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"md:hidden bg-red-50 border border-red-200 text-red-600 px-3 py-2 rounded-lg text-sm font-medium hover:bg-red-100 hover:border-red-300 transition-all flex items-center gap-2",onClick:t,"aria-label":"Logout",children:[e.jsx(Vt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Logout"})]}),e.jsx("button",{className:"block md:hidden text-primary hover:text-accent transition-colors p-2 rounded-lg hover:bg-gray-100 flex items-center justify-center border border-gray-200 bg-white",onClick:()=>o(!0),"aria-label":"Open menu",style:{minWidth:"44px",minHeight:"44px"},children:e.jsxs("div",{className:"relative w-6 h-6",children:[e.jsx("div",{className:"absolute w-5 h-1 bg-blue-600 rounded-full top-1 left-0.5"}),e.jsx("div",{className:"absolute w-5 h-1 bg-blue-600 rounded-full top-3 left-0.5"}),e.jsx("div",{className:"absolute w-5 h-1 bg-blue-600 rounded-full top-5 left-0.5"})]})})]})]})}function ca(){return e.jsxs("footer",{className:"w-full bg-white border-t border-primary/10 text-center text-primary py-4 text-sm",children:["© ",new Date().getFullYear()," kabini.ai. All rights reserved."]})}function Mt(){const{user:o}=it(),[t,s]=qe(Zt,[]),[a,r]=qe(Xt,null),[n,w]=m.useState([]),[j,g]=m.useState(""),[d,y]=m.useState([]),[F,P]=m.useState(1),[E,A]=m.useState(!1),[q,R]=m.useState("gemini"),[U,Z]=m.useState("gemini-1.5-flash"),[re,Q]=m.useState("gemini"),[T,f]=m.useState("gemini-1.5-flash"),[S,u]=m.useState({}),[b,I]=m.useState([]),[p,x]=m.useState(""),[C,$]=m.useState(""),[V,B]=m.useState(!1),[i,l]=m.useState(!1),[N,h]=m.useState({totalTokens:0,estimatedCost:0,confidenceScore:0,contentLength:0}),[K,X]=m.useState(!1),[ie,le]=m.useState(Date.now()),[ee,H]=m.useState(!0);m.useEffect(()=>{const D=Object.keys(localStorage).filter(O=>O.startsWith(ft));if(D.length>0){let O=D[0],oe=0;D.forEach(ne=>{try{const J=JSON.parse(localStorage.getItem(ne)||"{}");J.lastAccessed&&J.lastAccessed>oe&&(oe=J.lastAccessed,O=ne)}catch{}});try{const ne=localStorage.getItem(O);if(ne){const J=JSON.parse(ne);if(J.qaItems&&w(J.qaItems),J.qaContent&&g(J.qaContent),J.content&&x(J.content),J.newUrl&&$(J.newUrl),J.selectedQuestions&&y(J.selectedQuestions),typeof J.isProcessing=="boolean"&&A(J.isProcessing),J.questionProvider&&R(J.questionProvider),J.questionModel&&Z(J.questionModel),J.answerProvider&&Q(J.answerProvider),J.answerModel&&f(J.answerModel),J.answerLoading&&u(J.answerLoading),J.urls){const L=J.urls.map(M=>({...M,status:M.status==="extracting"?"pending":M.status}));I(L)}J.metrics&&h(J.metrics),J.extracting&&B(J.extracting),J.showAnalysisNotification&&X(J.showAnalysisNotification),setTimeout(()=>{const L={...J,lastAccessed:Date.now()};localStorage.setItem(O,JSON.stringify(L))},100)}}catch(ne){console.error("Error restoring enhance content state:",ne)}}},[]),m.useEffect(()=>{l(!1),B(!1)},[]),m.useEffect(()=>{if(p.trim()||b.length>0||n.length>0){const D=oa(p+b.map(ne=>ne.url).join("")),O=ft+D,oe={qaItems:n,qaContent:j,content:p,newUrl:C,selectedQuestions:d,questionCount:F,isProcessing:E,questionProvider:q,questionModel:U,answerProvider:re,answerModel:T,answerLoading:S,urls:b,metrics:N,extracting:V,crawling:i,showAnalysisNotification:K,lastAccessed:Date.now(),createdAt:Date.now()};localStorage.setItem(O,JSON.stringify(oe))}},[n,j,p,C,d,F,E,q,U,re,T,S,b,N,V,i,K]),m.useEffect(()=>{Array.isArray(t)||s([])},[t,s]),m.useEffect(()=>{n.length>0&&j&&n.some(D=>D.answer&&(!D.sentiment||D.sentiment===""||D.geoScore===0))&&(console.log("[Metrics] Auto-recalculating metrics for existing data..."),Ze())},[n.length,j]),m.useEffect(()=>{if(t.length===0&&o){const D={id:"default",name:"Default Session",type:"question",timestamp:new Date().toISOString(),model:"gemini-pro",blogContent:"",qaData:[],totalInputTokens:0,totalOutputTokens:0,statistics:{totalQuestions:0,avgAccuracy:"0",avgCitationLikelihood:"0",totalCost:"0"},userId:o.id};s([D]),r(D)}},[t,s,r,o]),m.useEffect(()=>{const D=b.map(O=>O.url);localStorage.setItem(es,JSON.stringify(D))},[b]),m.useEffect(()=>{const D=()=>{le(Date.now()),H(!0)};return window.addEventListener("mousemove",D),window.addEventListener("keydown",D),window.addEventListener("scroll",D),window.addEventListener("click",D),()=>{window.removeEventListener("mousemove",D),window.removeEventListener("keydown",D),window.removeEventListener("scroll",D),window.removeEventListener("click",D)}},[]);const W=D=>{I(b.filter((O,oe)=>oe!==D))},Ae=D=>{const O=D.length/4,oe=O*1e-4,ne=Math.random()*.2+.8;h({totalTokens:Math.round(O),estimatedCost:parseFloat(oe.toFixed(4)),confidenceScore:parseFloat((ne*100).toFixed(1)),contentLength:D.length})},$e=async()=>{if(!C.trim())return;console.log("[Single URL Extract] Function called with:",C);const D={url:C.trim(),content:"",status:"extracting"};I([D]);try{const oe=(await ye.extractContentFromUrl(C.trim())).content||"",ne=oe.length/4,J=ne*1e-4,L=Math.random()*.3+.7,M={...D,content:oe,status:"success",tokens:ne,cost:J,confidence:L};I([M]),x(oe),Ae(oe),$(""),console.log("[Single URL Extract] Successfully extracted content from:",C)}catch(O){const oe={...D,status:"error",error:O.message||"Failed to extract content"};I([oe]),console.error("[Single URL Extract] Error:",O)}},Ke=D=>{const O=D.target.value;x(O),Ae(O)},de=()=>{Object.keys(localStorage).filter(O=>O.startsWith(ft)).forEach(O=>localStorage.removeItem(O)),w([]),g(""),x(""),$(""),y([]),I([]),h({totalTokens:0,estimatedCost:0,confidenceScore:0,contentLength:0}),B(!1),X(!1),A(!1),u({})},ct=async(D,O)=>{const{calculateAndUpdateVectorSimilarities:oe}=await Ie(async()=>{const{calculateAndUpdateVectorSimilarities:ce}=await import("./vectorSimilarity-CM4uDOKa.js");return{calculateAndUpdateVectorSimilarities:ce}},[]),ne=await oe(D,O);w(ce=>[...ce,...ne]),g(O);const J=D.reduce((ce,fe)=>ce+fe.inputTokens,0),L=D.reduce((ce,fe)=>ce+fe.outputTokens,0),M=Rt(J,L,"gemini-pro"),he={id:`qa-session-${Date.now()}`,name:`Q&A Generation - ${new Date().toLocaleDateString()}`,type:"question",timestamp:new Date().toISOString(),model:"gemini-pro",blogContent:O,qaData:ne,totalInputTokens:J,totalOutputTokens:L,statistics:{totalQuestions:D.length,avgAccuracy:"85",avgCitationLikelihood:"75",totalCost:M.toString()},userId:o?.id||"anonymous"};console.log("[App] Saving QA session to history:",he),pe.addQAHistory(he);try{localStorage.setItem("qa_last_saved",new Date().toISOString())}catch{}if(a&&o){const ce={...a,qaData:[...a.qaData,...ne],statistics:{totalQuestions:a.qaData.length+D.length,avgAccuracy:"85",avgCitationLikelihood:"75",totalCost:M.toString()},userId:o.id};console.log("[App] Updating session with new QA data:",ce),r(ce),s(t.map(fe=>fe.id===a.id?ce:fe))}},Oe=async D=>{u(O=>({...O,[D]:!0}));try{const O=n[D],oe=re,ne=T==="gemini-pro"?"gemini-1.5-flash":T,L=(await ye.generateAnswers({content:j,questions:[O.question],provider:oe,model:ne})).answers[0]||{},[M,he]=await Promise.all([ye.calculateCitationLikelihood({answer:L.answer,content:j,provider:oe,model:ne}),ye.calculateAccuracy({answer:L.answer,content:j,provider:oe,model:ne})]),{analyzeSentiment:ce}=await Ie(async()=>{const{analyzeSentiment:ve}=await Promise.resolve().then(()=>mt);return{analyzeSentiment:ve}},void 0),fe=ce(L.answer||""),{calculateGeoScoreV2:He}=await Ie(async()=>{const{calculateGeoScoreV2:ve}=await Promise.resolve().then(()=>mt);return{calculateGeoScoreV2:ve}},void 0),Re=await He({accuracy:parseFloat(he.accuracy)||0,question:O.question,answer:L.answer||"",importantQuestions:n.map(ve=>ve.question),allConfidences:n.map(()=>85),sourceUrl:"",content:j}),Be=Math.round((parseFloat(he.accuracy)||0)*.8+(Re.geoScore||0)*.2),{calculateAndUpdateVectorSimilarities:Xe}=await Ie(async()=>{const{calculateAndUpdateVectorSimilarities:ve}=await import("./vectorSimilarity-CM4uDOKa.js");return{calculateAndUpdateVectorSimilarities:ve}},[]),we=(await Xe([{question:O.question,answer:L.answer||"",accuracy:null,sentiment:"",inputTokens:0,outputTokens:0,totalTokens:0,cost:0,geoScore:0,citationLikelihood:null}],j))[0]?.vectorSimilarity||null;w(ve=>{const Te=[...ve];if(Te[D]={...Te[D],answer:L.answer||"",inputTokens:L.inputTokens||0,outputTokens:L.outputTokens||0,totalTokens:(L.inputTokens||0)+(L.outputTokens||0),cost:Rt(L.inputTokens||0,L.outputTokens||0,ne),citationLikelihood:M.citationLikelihood,accuracy:he.accuracy,sentiment:fe,geoScore:Re.geoScore,semanticRelevance:Be.toString(),vectorSimilarity:we,provider:re,model:T},a&&o){const De={...a,qaData:Te,statistics:{...a.statistics,totalQuestions:Te.length,totalCost:Te.reduce((ze,c)=>ze+(c.cost||0),0).toString()},userId:o.id};console.log("[App] Updating session with answer data:",De),r(De),s(t.map(ze=>ze.id===a.id?De:ze))}return Te})}catch(O){console.error("Error generating answer:",O)}finally{u(O=>({...O,[D]:!1}))}},Ue=D=>{y(O=>O.includes(D)?O.filter(oe=>oe!==D):[...O,D])},We=()=>{y(n.map((D,O)=>O))},Ee=()=>{y([])},Ye=async()=>{for(const D of d)await Oe(D)},Ze=async()=>{console.log("[Metrics] Recalculating metrics for existing QA items...");const D=await Promise.all(n.map(async(O,oe)=>{if(!O.answer)return O;try{const ne=re,J=T==="gemini-pro"?"gemini-1.5-flash":T,[L,M]=await Promise.all([ye.calculateCitationLikelihood({answer:O.answer,content:j,provider:ne,model:J}),ye.calculateAccuracy({answer:O.answer,content:j,provider:ne,model:J})]),{analyzeSentiment:he}=await Ie(async()=>{const{analyzeSentiment:we}=await Promise.resolve().then(()=>mt);return{analyzeSentiment:we}},void 0),ce=he(O.answer||""),{calculateGeoScoreV2:fe}=await Ie(async()=>{const{calculateGeoScoreV2:we}=await Promise.resolve().then(()=>mt);return{calculateGeoScoreV2:we}},void 0),He=await fe({accuracy:parseFloat(M.accuracy)||0,question:O.question,answer:O.answer||"",importantQuestions:n.map(we=>we.question),allConfidences:n.map(()=>85),sourceUrl:"",content:j}),Re=Math.round((parseFloat(M.accuracy)||0)*.8+(He.geoScore||0)*.2),{calculateAndUpdateVectorSimilarities:Be}=await Ie(async()=>{const{calculateAndUpdateVectorSimilarities:we}=await import("./vectorSimilarity-CM4uDOKa.js");return{calculateAndUpdateVectorSimilarities:we}},[]),et=(await Be([{question:O.question,answer:O.answer||"",accuracy:null,sentiment:"",inputTokens:0,outputTokens:0,totalTokens:0,cost:0,geoScore:0,citationLikelihood:null}],j))[0]?.vectorSimilarity||null;return{...O,citationLikelihood:L.citationLikelihood,accuracy:M.accuracy,sentiment:ce,geoScore:He.geoScore,semanticRelevance:Re.toString(),vectorSimilarity:et}}catch(ne){return console.error(`[Metrics] Error recalculating metrics for item ${oe}:`,ne),O}}));if(w(D),a&&o){const O={...a,qaData:D,statistics:{...a.statistics,totalQuestions:D.length,totalCost:D.reduce((oe,ne)=>oe+(ne.cost||0),0).toString()},userId:o.id};r(O),s(t.map(oe=>oe.id===a.id?O:oe))}console.log("[Metrics] Metrics recalculation completed")};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Ms,{questionProvider:q,questionModel:U,onQuestionProviderChange:R,onQuestionModelChange:Z,answerProvider:re,answerModel:T,onAnswerProviderChange:Q,onAnswerModelChange:f,questionCount:F,onQuestionCountChange:P}),e.jsxs("div",{className:"card bg-white border border-primary/10 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ge,{className:"w-8 h-8 text-black drop-shadow"}),e.jsx("h2",{className:"text-3xl font-extrabold text-black tracking-tight",children:"Content Input"})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-base font-semibold text-black mb-3 flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5 text-black"}),"Add URL to crawl"]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:C,onChange:D=>{console.log("[URL Input] Value changed:",D.target.value),$(D.target.value)},onKeyDown:D=>{D.key==="Enter"&&(D.preventDefault(),console.log("[URL Input] Enter pressed - preventing default"),C.trim()&&$e())},placeholder:"https://example.com/article",className:"flex-1 bg-white border border-black/20 rounded-lg px-4 py-3 text-black text-base placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent transition-all"},"url-input-fixed"),e.jsxs("button",{onClick:$e,disabled:!C.trim(),className:"bg-black text-white font-bold px-6 py-2.5 rounded-lg hover:bg-gray-800 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-base shadow",children:[e.jsx(Ge,{className:"w-5 h-5 text-white"}),"Extract"]})]})}),b.length>0&&e.jsx("div",{className:"space-y-2 mb-4",children:b.map((D,O)=>e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-100 rounded-lg border border-black/10",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-base text-black font-medium truncate",children:D.url}),D.status==="error"&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:D.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D.status==="extracting"&&e.jsx(Fe,{className:"w-5 h-5 animate-spin text-black"}),D.status==="success"&&e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),D.status==="error"&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("button",{onClick:()=>W(O),className:"text-red-600 hover:text-red-400 transition-colors",children:e.jsx(ht,{className:"w-5 h-5 text-black"})})]})]},O))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-base font-semibold text-black mb-3 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-black"}),"Or paste your content directly"]}),e.jsx("textarea",{value:p,onChange:Ke,placeholder:"Paste your content here or extract from URLs above...",rows:8,className:"w-full bg-white border border-black/20 rounded-lg px-4 py-3 text-black text-base placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent transition-all resize-none"})]}),N.contentLength>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-black",children:N.totalTokens}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Tokens"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-black",children:["$",N.estimatedCost]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Estimated Cost"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-black",children:[N.confidenceScore,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Confidence"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-black",children:N.contentLength}),e.jsx("div",{className:"text-xs text-gray-600",children:"Characters"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:async()=>{if(!p.trim()){alert("Please enter some content first");return}A(!0);try{const D=Math.max(1,Math.min(10,F)),O=await ye.generateQuestions({content:p,questionCount:D,provider:q,model:U==="gemini-pro"?"gemini-1.5-flash":U}),oe=O.questions.slice(0,D).map(ne=>({question:ne,answer:"",accuracy:"",sentiment:"",inputTokens:O.inputTokens||0,outputTokens:O.outputTokens||0,totalTokens:(O.inputTokens||0)+(O.outputTokens||0),cost:0,geoScore:0,citationLikelihood:0,provider:q,model:U}));await ct(oe,p)}catch(D){alert("Failed to generate questions: "+(D.message||D))}finally{A(!1)}},disabled:E||!p.trim(),className:"bg-black text-white font-bold px-8 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-lg shadow",children:E?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-5 h-5 animate-spin"}),"Generating Questions..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-5 h-5"}),"Generate Questions"]})}),(p.trim()||b.length>0||n.length>0)&&e.jsxs("button",{onClick:de,className:"bg-gray-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-gray-600 transition-all duration-200 flex items-center gap-2 text-lg shadow",children:[e.jsx(ht,{className:"w-5 h-5"}),"New Analysis"]}),n.length>0&&n.some(D=>D.answer&&(!D.sentiment||D.sentiment===""||D.geoScore===0))&&e.jsxs("button",{onClick:Ze,className:"bg-green-600 text-white font-bold px-6 py-3 rounded-lg hover:bg-green-700 transition-all duration-200 flex items-center gap-2 text-lg shadow",children:[e.jsx(wt,{className:"w-5 h-5"}),"Recalculate Metrics"]}),n.length>0&&e.jsxs("button",{onClick:()=>window.location.href="/history",className:"bg-blue-600 text-white font-bold px-6 py-3 rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center gap-2 text-lg shadow",children:[e.jsx(jt,{className:"w-5 h-5"}),"View in History"]})]})]})]}),n.length>0&&e.jsxs("div",{className:"card mt-8 p-6 bg-white border border-black/10 shadow-xl",children:[e.jsx("h3",{className:"text-xl font-bold text-black mb-4",children:"Generated Questions & Answers"}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{className:"bg-gray-800 text-white font-bold px-5 py-2 rounded-lg hover:bg-gray-900 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",onClick:Ye,disabled:d.length===0,children:"Generate Responses for Selected"}),e.jsx("button",{className:"bg-gray-800 text-white font-bold px-4 py-2 rounded-lg hover:bg-gray-900 transition-all duration-200",onClick:We,children:"Select All"}),e.jsx("button",{className:"bg-gray-800 text-white font-bold px-4 py-2 rounded-lg hover:bg-gray-900 transition-all duration-200",onClick:Ee,children:"Deselect All"})]}),e.jsx("ul",{className:"space-y-6",children:n.map((D,O)=>e.jsxs("li",{className:"p-4 rounded-lg bg-white border border-black/10",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"checkbox",checked:d.includes(O),onChange:()=>Ue(O),className:"mr-2 accent-blue-700"}),e.jsxs("div",{className:"font-semibold text-black",children:["Q",O+1,": ",D.question]})]}),D.answer?e.jsxs("div",{className:"text-black mb-2",children:[e.jsx("span",{className:"font-bold text-blue-700",children:"A:"})," ",D.answer]}):e.jsx("button",{className:"bg-gray-800 text-white font-bold px-5 py-2 rounded-lg hover:bg-gray-900 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>Oe(O),disabled:S[O],children:S[O]?"Generating Answer...":"Generate Response"}),e.jsxs("div",{className:"text-xs text-black mt-2 flex gap-4 flex-wrap",children:[e.jsxs("span",{children:["Input Tokens: ",D.inputTokens||0]}),e.jsxs("span",{children:["Output Tokens: ",D.outputTokens||0]}),e.jsxs("span",{children:["Cost: $",D.cost||0]}),e.jsxs("span",{children:["Vector Similarity: ",D.vectorSimilarity??"-"]}),e.jsxs("span",{children:["Citation Likelihood: ",D.citationLikelihood??"-"]}),e.jsxs("span",{children:["Accuracy: ",D.accuracy??"-"]})]})]},O))})]})]})}function da(){const{isAuthenticated:o,isLoading:t,logout:s,user:a,refreshUser:r}=it();console.log("[App] Authentication state:",{isAuthenticated:o,isLoading:t,hasUser:!!a,userEmail:a?.email}),m.useEffect(()=>{o&&!a&&!t&&(console.log("[App] Authenticated but no user data, forcing refresh..."),r())},[o,a,t,r]),m.useEffect(()=>{o&&a&&(console.log("[App] Clearing stale localStorage data..."),["llm_qa_current_session","structure_last_saved","overview_market_analysis"].forEach(E=>{try{localStorage.getItem(E)&&(console.log(`[App] Clearing stale localStorage key: ${E}`),localStorage.removeItem(E))}catch(A){console.warn(`[App] Could not clear ${E}:`,A)}}))},[o,a]);const[n,w]=m.useState(!1),j=Ht(),[g]=qe(Zt,[]),[d]=qe(Xt,null);let y=[];try{const P=JSON.parse(localStorage.getItem(es)||"[]");y=Array.from(new Set(P.map(E=>{try{return new URL(E).hostname.replace(/^www\./,"")}catch{return E}}))).filter(Boolean)}catch{}if(t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-black via-gray-900 to-black",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-primary font-medium",children:"Loading kabini.ai..."}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Please wait while we verify your authentication..."})]})});if(o&&!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-black via-gray-900 to-black",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-primary font-medium",children:"Loading user data..."}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Please wait while we load your profile..."})]})});if(!o)return console.log("[App] User not authenticated, showing login page"),e.jsxs(St,{children:[e.jsx(xe,{path:"/signup",element:e.jsx(ta,{})}),e.jsx(xe,{path:"/forgot-password",element:e.jsx(sa,{})}),e.jsx(xe,{path:"/reset-password",element:e.jsx(aa,{})}),e.jsx(xe,{path:"/test-notifications",element:e.jsx(ra,{})}),e.jsx(xe,{path:"*",element:e.jsx($s,{})})]});console.log("[App] User is authenticated, showing main app");const F=async()=>{try{await s()}catch(P){console.error("Logout error:",P)}};return e.jsxs("div",{className:"flex min-h-screen bg-white overflow-hidden",children:[e.jsx(ia,{isOpen:n,setIsOpen:w,onLogout:F,user:a,currentPath:j.pathname}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-screen overflow-hidden",children:[e.jsx(la,{setIsOpen:w,onLogout:F}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto text-black bg-white",children:e.jsxs(St,{children:[e.jsx(xe,{path:"/overview",element:e.jsx(Vs,{})}),e.jsx(xe,{path:"/qa-generation",element:e.jsx(Mt,{})}),e.jsx(xe,{path:"/enhance-content",element:e.jsx(Mt,{})}),e.jsx(xe,{path:"/content-structure-analysis",element:e.jsx(Xs,{})}),e.jsx(xe,{path:"/history",element:e.jsx(qs,{qaItems:g.flatMap(P=>P.qaData),onExport:Os})}),e.jsx(xe,{path:"/statistics",element:e.jsx(Cs,{sessions:g,currentSession:d})}),e.jsx(xe,{path:"/CloudFuzeLLMQA",element:e.jsx(Nt,{to:"/overview",replace:!0})}),e.jsx(xe,{path:"/",element:e.jsx(Nt,{to:"/overview",replace:!0})})]})}),e.jsx(ca,{})]})]})}function ua(){return e.jsx(ns,{children:e.jsx(da,{})})}ds.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(Ds,{children:e.jsx(ua,{})})}));
