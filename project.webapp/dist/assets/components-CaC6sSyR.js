import{r as f,u as Ut,R as Ke}from"./router-cMghrlxF.js";import{T as ut,Z as Re,C as qt,a as qe,A as Ht,L as He,F as Ct,X as Pe,U as gt,E as nt,B as Bt,S as Jt,b as kt,c as Gt,d as Qe,G as zt,P as Vt,e as Ee,f as Tt,g as at,h as Qt,H as Kt,i as It,j as Wt,k as Yt,I as it,l as Et,D as ht,m as Xt,n as Zt,o as mt}from"./ui-BrKuu7lB.js";import{r as es}from"./vendor-DavUf6mE.js";var tt={exports:{}},Ue={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pt;function ts(){if(pt)return Ue;pt=1;var n=es(),s=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function g(u,p,d){var b,j={},l=null,i=null;d!==void 0&&(l=""+d),p.key!==void 0&&(l=""+p.key),p.ref!==void 0&&(i=p.ref);for(b in p)r.call(p,b)&&!c.hasOwnProperty(b)&&(j[b]=p[b]);if(u&&u.defaultProps)for(b in p=u.defaultProps,p)j[b]===void 0&&(j[b]=p[b]);return{$$typeof:s,type:u,key:l,ref:i,props:j,_owner:o.current}}return Ue.Fragment=t,Ue.jsx=g,Ue.jsxs=g,Ue}var yt;function ss(){return yt||(yt=1,tt.exports=ts()),tt.exports}var e=ss();const rs="modulepreload",os=function(n){return"/"+n},ft={},xt=function(s,t,r){let o=Promise.resolve();if(t&&t.length>0){let p=function(d){return Promise.all(d.map(b=>Promise.resolve(b).then(j=>({status:"fulfilled",value:j}),j=>({status:"rejected",reason:j}))))};document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),u=g?.nonce||g?.getAttribute("nonce");o=p(t.map(d=>{if(d=os(d),d in ft)return;ft[d]=!0;const b=d.endsWith(".css"),j=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${j}`))return;const l=document.createElement("link");if(l.rel=b?"stylesheet":rs,b||(l.as="script"),l.crossOrigin="",l.href=d,u&&l.setAttribute("nonce",u),document.head.appendChild(l),b)return new Promise((i,x)=>{l.addEventListener("load",i),l.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function c(g){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=g,window.dispatchEvent(u),!u.defaultPrevented)throw g}return o.then(g=>{for(const u of g||[])u.status==="rejected"&&c(u.reason);return s().catch(c)})},we="http://localhost:5000/api";class ns{config={clientId:"8d042e34-5a5f-40f5-a019-ee56de49b64e",tenantId:"c16b04b5-b78c-4cce-b3f8-93686f221d09",redirectUri:"http://localhost:5173/auth/callback",scopes:["openid","profile","email","User.Read"]};constructor(){this.config.clientId||console.error("[AuthService] Azure Client ID is not configured"),this.config.tenantId||console.error("[AuthService] Azure Tenant ID is not configured"),console.log("[AuthService] Configuration loaded:",{clientId:this.config.clientId?"Configured":"Missing",tenantId:this.config.tenantId?"Configured":"Missing",redirectUri:this.config.redirectUri})}async initializeMSAL(){try{if(typeof window<"u"&&!window.msalInstance){console.log("[AuthService] Initializing MSAL with config:",{clientId:this.config.clientId,tenantId:this.config.tenantId,redirectUri:this.config.redirectUri}),console.log("[AuthService] Importing @azure/msal-browser...");const{PublicClientApplication:s}=await xt(async()=>{const{PublicClientApplication:t}=await import("./index-CIVusHlu.js");return{PublicClientApplication:t}},[]);console.log("[AuthService] MSAL imported successfully"),console.log("[AuthService] Creating MSAL instance..."),window.msalInstance=new s({auth:{clientId:this.config.clientId,authority:`https://login.microsoftonline.com/${this.config.tenantId}`,redirectUri:this.config.redirectUri},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}}),console.log("[AuthService] MSAL instance created"),console.log("[AuthService] Initializing MSAL instance..."),await window.msalInstance.initialize(),console.log("[AuthService] MSAL instance initialized successfully")}else console.log("[AuthService] MSAL instance already exists");return window.msalInstance}catch(s){throw console.error("[AuthService] Error initializing MSAL:",s),new Error(`Failed to initialize Microsoft Authentication: ${s instanceof Error?s.message:"Unknown error"}`)}}async testMSALConfiguration(){try{console.log("[AuthService] Testing MSAL configuration...");const s=await this.initializeMSAL();return console.log("[AuthService] MSAL configuration test successful"),!0}catch(s){return console.error("[AuthService] MSAL configuration test failed:",s),!1}}async clearActiveInteractions(s){try{console.log("[AuthService] Clearing active interactions..."),await s.clearCache(),s.browserStorage&&await s.browserStorage.clear();const t=[];for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);o&&o.includes("msal")&&t.push(o)}t.forEach(r=>localStorage.removeItem(r)),console.log("[AuthService] Active interactions cleared")}catch(t){console.warn("[AuthService] Warning clearing interactions:",t)}}resetMSALInstance(){try{console.log("[AuthService] Resetting MSAL instance..."),window.msalInstance&&delete window.msalInstance,console.log("[AuthService] MSAL instance reset")}catch(s){console.warn("[AuthService] Warning resetting MSAL instance:",s)}}async login(){try{if(console.log("[AuthService] Starting Microsoft login..."),console.log("[AuthService] Config:",this.config),!this.config.clientId||this.config.clientId==="your_azure_client_id_here")throw new Error("Azure Client ID not configured. Please set VITE_REACT_APP_AZURE_CLIENT_ID in your environment variables.");if(!this.config.tenantId||this.config.tenantId==="your_azure_tenant_id_here")throw new Error("Azure Tenant ID not configured. Please set VITE_REACT_APP_AZURE_TENANT_ID in your environment variables.");const s=await this.initializeMSAL();console.log("[AuthService] MSAL instance ready, starting login popup..."),await this.clearActiveInteractions(s);const t={scopes:this.config.scopes,prompt:"select_account"};console.log("[AuthService] Login request config:",t),console.log("[AuthService] About to call loginPopup...");let r;try{if(console.log("[AuthService] About to call MSAL loginPopup..."),r=await s.loginPopup(t),console.log("[AuthService] MSAL login successful, got access token"),console.log("[AuthService] MSAL response:",{hasAccessToken:!!r.accessToken,hasAccount:!!r.account,accountName:r.account?.name,accountUsername:r.account?.username}),!r.accessToken)throw console.error("[AuthService] MSAL login succeeded but no access token received"),new Error("MSAL login succeeded but no access token received");console.log("[AuthService] MSAL access token confirmed:",{tokenLength:r.accessToken.length,tokenPreview:r.accessToken.substring(0,20)+"..."}),console.log("[AuthService] MSAL login completed successfully, proceeding to backend exchange..."),console.log("[AuthService] Checking configuration before backend call:",{hasClientId:!!this.config.clientId,hasTenantId:!!this.config.tenantId,clientId:this.config.clientId,tenantId:this.config.tenantId})}catch(c){if(console.error("[AuthService] Popup error:",c),c.errorCode==="interaction_in_progress"){console.log("[AuthService] Interaction in progress, clearing cache and retrying..."),await this.clearActiveInteractions(s),await new Promise(g=>setTimeout(g,1e3));try{r=await s.loginPopup(t),console.log("[AuthService] MSAL login successful on retry, got access token")}catch(g){throw console.error("[AuthService] Retry failed:",g),g.errorCode==="interaction_in_progress"?(console.log("[AuthService] Persistent interaction issue, resetting MSAL instance..."),this.resetMSALInstance(),new Error("Authentication session is stuck. Please refresh the page and try again.")):g}}else throw c}console.log("[AuthService] Exchanging token with backend..."),console.log("[AuthService] MSAL access token received:",{hasToken:!!r.accessToken,tokenLength:r.accessToken?.length,tokenPreview:r.accessToken?.substring(0,20)+"..."}),console.log("[AuthService] About to start backend token exchange process...");let o;try{console.log("[AuthService] About to call exchangeTokenForBackendToken..."),console.log("[AuthService] Backend URL will be:",`${we}/auth/login`),console.log("[AuthService] Making backend request..."),o=await this.exchangeTokenForBackendToken(r.accessToken),console.log("[AuthService] Backend token exchange successful")}catch(c){throw console.error("[AuthService] Backend token exchange failed:",c),console.error("[AuthService] Backend error details:",{message:c.message,stack:c.stack}),c}if(console.log("[AuthService] Backend response received:",{type:typeof o,keys:Object.keys(o),hasAccessToken:!!o.accessToken,hasRefreshToken:!!o.refreshToken,hasExpiresAt:!!o.expiresAt}),console.log("[AuthService] About to store tokens:",{accessToken:!!o.accessToken,refreshToken:!!o.refreshToken,expiresAt:o.expiresAt,accessTokenLength:o.accessToken?.length,refreshTokenLength:o.refreshToken?.length}),!o.accessToken||!o.refreshToken||!o.expiresAt){if(console.error("[AuthService] Missing required token fields:",{accessToken:!!o.accessToken,refreshToken:!!o.refreshToken,expiresAt:!!o.expiresAt}),!o.accessToken)throw new Error("Backend response missing access token");const c=new Date;c.setDate(c.getDate()+7);const g="fallback-refresh-"+Date.now();console.log("[AuthService] Using fallback values:",{expiresAt:c.toISOString(),refreshToken:g}),o.refreshToken=o.refreshToken||g,o.expiresAt=o.expiresAt||c.toISOString()}return this.setTokens(o.accessToken,o.refreshToken,o.expiresAt),console.log("[AuthService] Tokens stored successfully"),o}catch(s){throw console.error("[AuthService] Microsoft login error:",s),s instanceof Error?new Error(`Microsoft authentication failed: ${s.message}`):new Error("Failed to authenticate with Microsoft Entra ID")}}async googleLogin(){try{const s="1003899655255-ib2ru0fiq7apqbgt4ifk48rmka88kqf0.apps.googleusercontent.com";return await this.loadGoogleIdentityServices(),new Promise((t,r)=>{let o=!1;const c=setTimeout(()=>{o||(o=!0,r(new Error("Google authentication timed out. Please try again.")))},6e4);try{window.google.accounts.oauth2.initTokenClient({client_id:s,scope:"openid profile email",prompt:"select_account",callback:async b=>{try{if(o)return;if(clearTimeout(c),b.error){o=!0,r(new Error(`Google OAuth error: ${b.error}`));return}if(!b.access_token){o=!0,r(new Error("No access token received from Google"));return}console.log("✅ [AuthService] Google OAuth successful, got access token");const j=await this.exchangeGoogleTokenForBackendToken(b.access_token);this.setTokens(j.accessToken,j.refreshToken,j.expiresAt),o=!0,t(j)}catch(j){o||(o=!0,clearTimeout(c),r(j))}}}).requestAccessToken()}catch(d){o||(o=!0,clearTimeout(c),r(new Error(`Failed to initialize Google OAuth: ${d instanceof Error?d.message:"Unknown error"}`)))}const g=()=>{clearTimeout(c)},u=t,p=r;t=d=>{g(),u(d)},r=d=>{g(),p(d)}})}catch(s){throw console.error("Google login error:",s),new Error(`Failed to authenticate with Google: ${s instanceof Error?s.message:"Unknown error"}`)}}async loadGoogleIdentityServices(){return new Promise((s,t)=>{if(window.google){s();return}const r=document.createElement("script");r.src="https://accounts.google.com/gsi/client",r.async=!0,r.defer=!0,r.onload=()=>s(),r.onerror=()=>t(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async googleLoginOneTap(){try{return await this.loadGoogleIdentityServices(),new Promise((s,t)=>{window.google.accounts.id.initialize({client_id:"1003899655255-ib2ru0fiq7apqbgt4ifk48rmka88kqf0.apps.googleusercontent.com",callback:async r=>{try{if(r.error){t(new Error(r.error));return}const o=await this.exchangeGoogleTokenForBackendToken(r.credential);this.setTokens(o.accessToken,o.refreshToken,o.expiresAt),s(o)}catch(o){t(o)}}}),window.google.accounts.id.prompt()})}catch(s){throw console.error("Google One Tap login error:",s),new Error("Failed to authenticate with Google")}}async exchangeGoogleTokenForBackendToken(s){try{const r=await(await fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${s}`)).json(),o=await fetch(`${we}/auth/google-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:s,userInfo:r})});if(!o.ok){const g=await o.json().catch(()=>({}));throw new Error(g.error||"Failed to authenticate with backend")}const c=await o.json();return console.log("✅ [AuthService] Google token exchange successful, received data:",{user:c.user,hasAccessToken:!!c.accessToken,hasRefreshToken:!!c.refreshToken,expiresAt:c.expiresAt}),this.setTokens(c.accessToken,c.refreshToken,c.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Google login"),c}catch(t){throw console.error("Error exchanging Google token:",t),new Error("Failed to authenticate with backend")}}async localLogin(s){try{if(console.log("🔐 [AuthService] Starting local login with credentials:",{email:s.email,passwordLength:s.password.length}),console.log("🌐 [AuthService] API Base URL:",we),!s.email||!s.password)throw new Error("Email and password are required");if(!s.email.includes("@"))throw new Error("Please enter a valid email address");if(s.password.length<6)throw new Error("Password must be at least 6 characters long");const t=await fetch(`${we}/auth/local-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("📡 [AuthService] Local login response status:",t.status),!t.ok){const o=await t.json().catch(()=>({}));throw console.error("❌ [AuthService] Local login failed:",o),t.status===401?new Error("Invalid email or password. Please check your credentials and try again."):t.status===404?new Error("User not found. Please check your email or sign up for a new account."):t.status===500?new Error("Server error. Please try again later or contact support."):new Error(o.error||`Login failed with status ${t.status}`)}const r=await t.json();if(console.log("✅ [AuthService] Local login successful, received data:",{user:r.user,hasAccessToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,expiresAt:r.expiresAt}),!r.accessToken||!r.refreshToken||!r.expiresAt)throw new Error("Invalid response from server. Missing authentication tokens.");return this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for local login"),r}catch(t){throw console.error("❌ [AuthService] Local login error:",t),t instanceof Error?t:new Error("Local authentication failed. Please try again.")}}async register(s){try{console.log("🔐 Registering user with credentials:",{...s,password:"[HIDDEN]"}),console.log("🌐 API Base URL:",we);const t=await fetch(`${we}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("📡 Registration response status:",t.status),!t.ok){const o=await t.json().catch(()=>({}));throw console.error("❌ Registration failed:",o),new Error(o.error||"Failed to register user")}const r=await t.json();return console.log("✅ Registration successful, received data:",{user:r.user,hasAccessToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,expiresAt:r.expiresAt}),this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),console.log("💾 Tokens stored successfully"),r}catch(t){throw console.error("❌ Registration error:",t),new Error(t instanceof Error?t.message:"Registration failed")}}async exchangeTokenForBackendToken(s){console.log("[AuthService] Exchanging token with backend..."),console.log("[AuthService] Backend URL:",`${we}/auth/login`),console.log("[AuthService] Request payload:",{clientId:this.config.clientId,tenantId:this.config.tenantId,hasToken:!!s,tokenLength:s?.length});try{const t=await fetch(`${we}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({msalToken:s,clientId:this.config.clientId,tenantId:this.config.tenantId})});if(console.log("[AuthService] Backend response status:",t.status),console.log("[AuthService] Backend response headers:",Object.fromEntries(t.headers.entries())),!t.ok){const o=await t.json().catch(()=>({}));throw console.error("[AuthService] Backend error response:",o),new Error(o.error||`Backend authentication failed with status ${t.status}`)}const r=await t.json();if(console.log("[AuthService] Backend success response:",{hasUser:!!r.user,hasToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,hasExpiresAt:!!r.expiresAt,userEmail:r.user?.email,expiresAt:r.expiresAt,accessTokenLength:r.accessToken?.length,refreshTokenLength:r.refreshToken?.length}),console.log("[AuthService] Full backend response:",r),console.log("[AuthService] Response keys:",Object.keys(r)),!r.accessToken||!r.refreshToken||!r.expiresAt){if(console.error("[AuthService] Backend response missing required fields:",{hasAccessToken:!!r.accessToken,hasRefreshToken:!!r.refreshToken,hasExpiresAt:!!r.expiresAt,availableKeys:Object.keys(r)}),console.warn("[AuthService] Attempting to handle missing fields..."),!r.accessToken)throw new Error("Backend response is missing access token");const o=new Date;o.setDate(o.getDate()+7);const c="temp-refresh-token-"+Date.now();console.log("[AuthService] Using default values:",{expiresAt:o.toISOString(),refreshToken:c});const g={...r,refreshToken:r.refreshToken||c,expiresAt:r.expiresAt||o.toISOString()};return this.setTokens(g.accessToken,g.refreshToken,g.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Microsoft login"),g}return this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),console.log("💾 [AuthService] Tokens stored successfully for Microsoft login"),r}catch(t){throw console.error("[AuthService] Fetch error:",t),new Error(`Network error: ${t instanceof Error?t.message:"Unknown error"}`)}}async logout(){try{console.log("[AuthService] Starting logout process..."),await this.clearBackendSession(),console.log("[AuthService] Backend session cleared"),this.clearAllAuthData(),console.log("[AuthService] All authentication data cleared");try{window.msalInstance&&typeof window.msalInstance.clearCache=="function"&&(window.msalInstance.clearCache(),console.log("[AuthService] MSAL cache cleared"))}catch(s){console.warn("[AuthService] MSAL cache clear failed, but tokens cleared:",s)}console.log("[AuthService] Logout completed successfully")}catch(s){console.error("[AuthService] Logout error:",s),this.clearAllAuthData()}}async clearBackendSession(){try{const s=this.getAccessToken();s&&await fetch(`${we}/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})}catch(s){console.error("Error clearing backend session:",s)}}async getCurrentUser(){try{const s=this.getAccessToken();if(!s)return null;const t=await fetch(`${we}/auth/me`,{headers:{Authorization:`Bearer ${s}`}});return t.ok?t.json():t.status===401&&await this.refreshToken()?this.getCurrentUser():(this.clearTokens(),null)}catch(s){return console.error("Error getting current user:",s),this.clearTokens(),null}}async refreshToken(){try{const s=this.getRefreshToken();if(!s)return this.clearTokens(),!1;const t=await fetch(`${we}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:s})});if(!t.ok)return this.clearTokens(),!1;const r=await t.json();return this.setTokens(r.accessToken,r.refreshToken,r.expiresAt),!0}catch(s){return console.error("Error refreshing token:",s),this.clearTokens(),!1}}isAuthenticated(){const s=this.getAccessToken(),t=this.getExpiresAt();if(console.log("[AuthService] Checking authentication:",{hasToken:!!s,hasExpiresAt:!!t,expiresAt:t,currentTime:new Date().toISOString(),tokenExpiry:t?new Date(t).toISOString():"N/A",isExpired:t?new Date(t)<=new Date:"N/A"}),!s||!t)return console.log("[AuthService] Authentication failed: missing token or expiry"),!1;const r=new Date,c=new Date(t)>r;return c||(console.log("[AuthService] Token expired, clearing stale tokens"),this.clearTokens()),console.log("[AuthService] Token validity check:",{isValid:c}),c}getAccessToken(){return localStorage.getItem("accessToken")}getRefreshToken(){return localStorage.getItem("refreshToken")}getExpiresAt(){return localStorage.getItem("expiresAt")}setTokens(s,t,r){console.log("[AuthService] Setting tokens in localStorage:",{hasAccessToken:!!s,hasRefreshToken:!!t,expiresAt:r,accessTokenLength:s?.length,refreshTokenLength:t?.length}),localStorage.setItem("accessToken",s),localStorage.setItem("refreshToken",t),localStorage.setItem("expiresAt",r),console.log("[AuthService] Tokens stored, verification:",{storedAccessToken:!!localStorage.getItem("accessToken"),storedRefreshToken:!!localStorage.getItem("refreshToken"),storedExpiresAt:localStorage.getItem("expiresAt")})}clearTokens(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("expiresAt")}clearAllAuthData(){console.log("[AuthService] Clearing all authentication data..."),this.clearTokens();try{localStorage.removeItem("user"),console.log("[AuthService] User data cleared from localStorage")}catch(t){console.warn("[AuthService] Could not clear user data:",t)}try{xt(async()=>{const{historyService:t}=await Promise.resolve().then(()=>is);return{historyService:t}},void 0).then(({historyService:t})=>{t.clearUserData(),console.log("[AuthService] User-specific history data cleared")}).catch(t=>{console.warn("[AuthService] Could not clear user history data:",t)})}catch(t){console.warn("[AuthService] Could not clear user history data:",t)}["llm_qa_current_session","structure_last_saved","overview_market_analysis","llm_qa_sessions"].forEach(t=>{try{localStorage.getItem(t)&&(console.log(`[AuthService] Clearing conflicting localStorage key: ${t}`),localStorage.removeItem(t))}catch(r){console.warn(`[AuthService] Could not clear ${t}:`,r)}}),console.log("[AuthService] All authentication data cleared (history preserved)")}getAuthHeaders(){const s=this.getAccessToken();return s?{Authorization:`Bearer ${s}`}:{}}getCurrentUserFromStorage(){try{const s=localStorage.getItem("user");if(s)return JSON.parse(s)}catch(s){console.warn("[AuthService] Error parsing user data from localStorage:",s)}return null}getCurrentUserId(){try{return this.getCurrentUserFromStorage()?.id||null}catch(s){return console.warn("[AuthService] Error getting user ID from localStorage:",s),null}}}const K=new ns;class as{getStorageKey(s){const t=K.getCurrentUserId();return t?`${s}_${t}`:`${s}_anonymous`}getHistoryKey(){return this.getStorageKey("comprehensive_history")}async addHistoryItem(s){try{console.log("[HistoryService] Adding history item to localStorage:",s);const t=this.getHistoryKey(),r=this.getHistoryFromStorage(t),o=[s,...r];localStorage.setItem(t,JSON.stringify(o)),console.log("[HistoryService] History item saved successfully to localStorage")}catch(t){throw console.error("[HistoryService] Error saving history item to localStorage:",t),t}}async getHistoryItems(){try{const s=this.getHistoryKey(),t=this.getHistoryFromStorage(s);return console.log("[HistoryService] Retrieved history items from localStorage:",t.length),t}catch(s){return console.error("[HistoryService] Error getting history items from localStorage:",s),[]}}async clearHistory(){try{console.log("[HistoryService] Clearing history from localStorage...");const s=this.getHistoryKey();localStorage.removeItem(s),console.log("[HistoryService] History cleared successfully from localStorage")}catch(s){throw console.error("[HistoryService] Error clearing history from localStorage:",s),s}}async deleteHistoryItem(s){try{console.log("[HistoryService] Deleting history item from localStorage:",s);const t=this.getHistoryKey(),o=this.getHistoryFromStorage(t).filter(c=>c.id!==s);localStorage.setItem(t,JSON.stringify(o)),console.log("[HistoryService] History item deleted successfully from localStorage")}catch(t){throw console.error("[HistoryService] Error deleting history item from localStorage:",t),t}}async exportHistoryItem(s){try{console.log("[HistoryService] Exporting history item from localStorage:",s);const t=this.getHistoryKey(),o=this.getHistoryFromStorage(t).find(u=>u.id===s);if(!o)return null;const c=JSON.stringify(o,null,2),g=`${o.type}_${o.id}.json`;return console.log("[HistoryService] History item exported successfully from localStorage"),{content:c,filename:g,mimeType:"application/json"}}catch(t){return console.error("[HistoryService] Error exporting history item from localStorage:",t),null}}async exportAllHistory(){try{console.log("[HistoryService] Exporting all history from localStorage...");const s=this.getHistoryKey(),t=this.getHistoryFromStorage(s),r=JSON.stringify(t,null,2),o=`all_history_${new Date().toISOString().split("T")[0]}.json`;return console.log("[HistoryService] All history exported successfully from localStorage"),{content:r,filename:o,mimeType:"application/json"}}catch(s){return console.error("[HistoryService] Error exporting all history from localStorage:",s),{content:"[]",filename:"empty_history.json",mimeType:"application/json"}}}async clearUserData(){try{console.log("[HistoryService] Clearing user data from localStorage..."),K.getCurrentUserId()&&([this.getStorageKey("comprehensive_history"),this.getStorageKey("qa_history"),this.getStorageKey("ai_visibility_history"),this.getStorageKey("content_analysis_history"),this.getStorageKey("structure_analysis_history")].forEach(r=>{localStorage.removeItem(r)}),console.log("[HistoryService] User data cleared successfully from localStorage"))}catch(s){throw console.error("[HistoryService] Error clearing user data from localStorage:",s),s}}getHistoryFromStorage(s){try{const t=localStorage.getItem(s);return t?JSON.parse(t):[]}catch(t){return console.error("[HistoryService] Error parsing history from localStorage:",t),[]}}}const je=new as,is=Object.freeze(Object.defineProperty({__proto__:null,historyService:je},Symbol.toStringTag,{value:"Module"}));function ls(n){const s=["good","great","excellent","amazing","wonderful","fantastic","positive","helpful","useful","clear","effective","beneficial","advantageous","superior","quality","reliable","efficient","powerful","comprehensive","detailed","accurate","professional","innovative","advanced","secure","fast","easy","simple","convenient","flexible","scalable","robust","stable","trusted","proven","award-winning","leading","premium","exclusive","cutting-edge","modern","user-friendly","intuitive","seamless","smooth","responsive","optimized","enhanced","improved","upgraded","streamlined"],t=["bad","terrible","awful","horrible","negative","unclear","confusing","useless","ineffective","poor","unreliable","slow","difficult","complex","outdated","limited","restrictive","expensive","risky","unstable","buggy","glitchy","broken","faulty","defective","inferior","substandard","mediocre","disappointing","frustrating","annoying","problematic","troublesome","cumbersome","clunky","awkward","unintuitive","complicated","overwhelming","stressful"],r=["solution","platform","service","product","feature","capability","functionality","performance","reliability","security","support","documentation","integration","automation","optimization","efficiency","productivity","growth","success","achievement","innovation","technology","development","improvement","enhancement","upgrade","update","maintenance","monitoring","analytics"],o=["issue","problem","error","bug","failure","crash","downtime","outage","disruption","delay","limitation","constraint","restriction","barrier","obstacle","challenge","difficulty","complexity","confusion","uncertainty","risk","threat","vulnerability","weakness","deficiency","shortcoming","drawback","disadvantage","inconvenience","frustration"],c=n.toLowerCase().split(/\s+/);let g=0,u=0;c.length,c.forEach(j=>{const l=j.replace(/[^\w]/g,"");l.length<3||(s.includes(l)?g+=1:r.includes(l)&&(g+=.5),t.includes(l)?u+=1:o.includes(l)&&(u+=.5))});const p=g+u;if(p===0)return"Neutral";const d=g/p,b=u/p;return d>.6?"Positive":b>.6?"Negative":"Neutral"}function bt(n,s){const t=n.length>s.length?n:s,r=n.length>s.length?s:n;if(t.length===0)return 1;const o=cs(t,r);return(t.length-o)/t.length}function cs(n,s){const t=[];for(let r=0;r<=s.length;r++)t[r]=[r];for(let r=0;r<=n.length;r++)t[0][r]=r;for(let r=1;r<=s.length;r++)for(let o=1;o<=n.length;o++)s.charAt(r-1)===n.charAt(o-1)?t[r][o]=t[r-1][o-1]:t[r][o]=Math.min(t[r-1][o-1]+1,t[r][o-1]+1,t[r-1][o]+1);return t[s.length][n.length]}function st(n,s,t){const r=l=>(l||"").replace(/^[\s"'“”‘’]+|[\s"'“”‘’]+$/g,"").trim(),o=l=>l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");console.log("[Apply Suggestions] ===== FUNCTION CALLED ====="),console.log("[Apply Suggestions] Call stack:",new Error().stack);const c=new Date().toISOString();console.log("[Apply Suggestions] Function called at:",c);const g=s.length===1;console.log("[Apply Suggestions] Single suggestion mode:",g);let u=0;const p=[];if(console.log("[Apply Suggestions] ===== STARTING TO APPLY SUGGESTIONS ====="),console.log("[Apply Suggestions] Arguments received:",{htmlLength:n.length,suggestionsCount:s.length,suggestions:s.map(l=>({type:l.type,hasExactReplacement:!!l.exactReplacement,hasCurrentContent:!!l.currentContent,hasEnhancedContent:!!l.enhancedContent,currentContentPreview:l.currentContent?.substring(0,100)+"...",enhancedContentPreview:l.enhancedContent?.substring(0,100)+"..."}))}),s.length>1){console.error("[Apply Suggestions] CRITICAL ERROR: Received multiple suggestions when expecting single suggestion!"),console.error("[Apply Suggestions] Number of suggestions:",s.length),console.error("[Apply Suggestions] Suggestions:",s),console.error("[Apply Suggestions] Call stack:",new Error().stack),console.error("[Apply Suggestions] FORCING SINGLE SUGGESTION MODE - Only processing first suggestion"),s=[s[0]],console.error("[Apply Suggestions] Filtered suggestions to:",s.length);const l=new Error().stack||"";(l.includes("useEffect")||l.includes("comparePages"))&&(console.error("[Apply Suggestions] CRITICAL ERROR: This function is being called from useEffect or comparePages!"),console.error("[Apply Suggestions] This explains why 8 suggestions are being processed!"),console.error("[Apply Suggestions] The issue is that other functions are calling this with all suggestions!"))}s.forEach((l,i)=>{l.enhancedContent&&l.enhancedContent.includes("Split into")&&console.error(`[Apply Suggestions] WARNING: Suggestion ${i} contains instruction text:`,l.enhancedContent)}),s.length>1&&console.warn(`[Apply Suggestions] WARNING: Processing ${s.length} suggestions, expected 1 for single suggestion application`),s.forEach((l,i)=>{l.suggestions&&Array.isArray(l.suggestions)&&console.error(`[Apply Suggestions] ERROR: Suggestion ${i} contains nested suggestions array:`,l.suggestions)}),s.forEach((l,i)=>{try{if(console.log(`[Apply Suggestions] Processing suggestion ${i+1}/${s.length}:`,{type:l.type,hasExactReplacement:!!l.exactReplacement,hasCurrentContent:!!l.currentContent,hasEnhancedContent:!!l.enhancedContent,currentContentPreview:l.currentContent?.substring(0,100)+"...",enhancedContentPreview:l.enhancedContent?.substring(0,100)+"...",isSingleSuggestionMode:g}),g&&i>0){console.log(`[Apply Suggestions] Skipping suggestion ${i+1} in single suggestion mode`);return}if(l.exactReplacement){const{find:x,replace:v}=l.exactReplacement;if(console.log(`[Apply Suggestions] Applying ${l.type}:`,{find:x.substring(0,100)+"...",replace:v.substring(0,100)+"...",found:n.includes(x),findLength:x.length,replaceLength:v.length,fullFind:x,fullReplace:v,htmlPreview:n.substring(0,500)+"..."}),n.includes(x)){const m=n.length,w=n.substring(0,500);n=n.replace(x,v);const S=n.length,N=n.substring(0,500),L=w!==N;u++,p.push(`${l.type} applied with exact replacement`),console.log(`[Apply Suggestions] Successfully applied ${l.type}:`,{beforeLength:m,afterLength:S,lengthChanged:m!==S,contentChanged:L,beforePreview:w.substring(0,100)+"...",afterPreview:N.substring(0,100)+"..."})}else{console.log(`[Apply Suggestions] Could not find exact pattern for ${l.type}:`,{searchPattern:x.substring(0,200)+"...",htmlContainsPattern:n.includes(x),htmlPreview:n.substring(0,500)+"..."});let m=!1;const w=x.toLowerCase(),S=n.toLowerCase();if(S.includes(w)){const N=S.indexOf(w),L=n.substring(N,N+x.length);n=n.replace(L,v),u++,p.push(`${l.type} applied with case-insensitive matching`),m=!0,console.log(`[Apply Suggestions] Applied ${l.type} with case-insensitive matching`)}if(!m&&x.length>50){const N=x.substring(0,Math.floor(x.length*.7));n.includes(N)&&(n=n.replace(N,v),u++,p.push(`${l.type} applied with partial matching`),m=!0,console.log(`[Apply Suggestions] Applied ${l.type} with partial matching`))}if(!m){const N=x.replace(/\s+/g," ").trim(),L=n.replace(/\s+/g," ").trim();if(L.includes(N)){const z=L.indexOf(N),U=n.substring(z,z+x.length);n=n.replace(U,v),u++,p.push(`${l.type} applied with whitespace-normalized matching`),m=!0,console.log(`[Apply Suggestions] Applied ${l.type} with whitespace-normalized matching`)}}if(m||console.log(`[Apply Suggestions] All pattern matching attempts failed for ${l.type}`),l.type==="sentence_replacement"&&l.currentContent&&l.enhancedContent){console.log(`[Apply Suggestions] Trying alternative approach for ${l.type}...`);const N=r(l.currentContent.trim()),L=l.enhancedContent.trim();if(console.log("[Apply Suggestions] Alternative pattern details:",{altFind:N.substring(0,100)+"...",altReplace:L.substring(0,100)+"...",found:n.includes(N),fullAltFind:N}),n.includes(N))n=n.replace(N,L),u++,p.push(`${l.type} applied with alternative pattern`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with alternative pattern`);else if(console.log(`[Apply Suggestions] Alternative pattern also not found for ${l.type}`),n.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim().includes(N))console.log("[Apply Suggestions] Found exact match in HTML text, trying replacement:",{altFind:N.substring(0,100)+"...",altReplace:L.substring(0,100)+"..."}),n=n.replace(N,L),u++,p.push(`${l.type} applied with exact HTML text matching`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with exact HTML text matching`);else{const ee=n.split(/[.!?]+/).filter(_=>_.trim().length>10),k=Math.min(ee.length,20);let E=0,M=null,H=0;for(const _ of ee){if(E>=k){console.log(`[Apply Suggestions] Reached maximum sentence check limit (${k}) for exact replacement`);break}const R=_.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),J=N.replace(/\s+/g," ").trim(),Z=bt(R.toLowerCase(),J.toLowerCase());g&&E<5&&console.log(`[Apply Suggestions] Checking sentence similarity ${E+1}:`,{sentence:R.substring(0,50)+"...",target:J.substring(0,50)+"...",similarity:Z}),Z>H&&(M=_.trim(),H=Z),E++}const D=H>.8?M:null;D?(console.log("[Apply Suggestions] Found high-similarity sentence, trying replacement:",{matchingSentence:D.substring(0,100)+"...",altReplace:L.substring(0,100)+"..."}),n=n.replace(D.trim(),L),u++,p.push(`${l.type} applied with high-similarity sentence matching`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with high-similarity sentence matching`)):console.log(`[Apply Suggestions] No high-similarity sentence found for ${l.type}`)}}if(l.type==="paragraph"&&l.currentContent&&l.enhancedContent){console.log(`[Apply Suggestions] Trying paragraph replacement for ${l.type}...`);const N=l.currentContent.trim(),L=l.enhancedContent.trim();if(console.log("[Apply Suggestions] Paragraph pattern details:",{paraFind:N.substring(0,100)+"...",paraReplace:L.substring(0,100)+"...",found:n.includes(N),fullParaFind:N}),n.includes(N))n=n.replace(N,L),u++,p.push(`${l.type} applied with paragraph replacement`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with paragraph replacement`);else{console.log(`[Apply Suggestions] Paragraph pattern not found for ${l.type}`);const z=n.match(/<p[^>]*>([^<]+)<\/p>/i);z?(console.log("[Apply Suggestions] Found paragraph tag, trying replacement:",{paragraphContent:z[1].substring(0,100)+"...",paraReplace:L.substring(0,100)+"..."}),n=n.replace(z[0],`<p>${L}</p>`),u++,p.push(`${l.type} applied with paragraph tag replacement`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with paragraph tag replacement`)):console.log(`[Apply Suggestions] No paragraph tag found for ${l.type}`)}}if(l.type==="content_structure"&&l.implementation){console.log(`[Apply Suggestions] Trying content structure addition for ${l.type}...`);const N=l.implementation;console.log("[Apply Suggestions] Content structure details:",{structureAddition:N.substring(0,100)+"...",hasBodyTag:n.includes("<body>"),fullStructureAddition:N}),n.includes("<body>")?(n=n.replace("<body>",`<body>
${N}`),u++,p.push(`${l.type} applied with structure addition`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with structure addition`)):(console.log(`[Apply Suggestions] No body tag found for ${l.type}`),n.includes("<html>")?(n=n.replace("<html>",`<html>
${N}`),u++,p.push(`${l.type} applied to html tag`),console.log(`[Apply Suggestions] Successfully applied ${l.type} to html tag`)):(n=N+`
`+n,u++,p.push(`${l.type} applied at beginning`),console.log(`[Apply Suggestions] Successfully applied ${l.type} at beginning`)))}if(l.sentenceReplacement){console.log(`[Apply Suggestions] Trying sentenceReplacement pattern for ${l.type}...`);const{find:N,replace:L}=l.sentenceReplacement;n.includes(N)?(n=n.replace(N,L),u++,p.push(`${l.type} applied with sentenceReplacement pattern`),console.log(`[Apply Suggestions] Successfully applied ${l.type} with sentenceReplacement pattern`)):console.log(`[Apply Suggestions] sentenceReplacement pattern also not found for ${l.type}`)}}}}catch(x){console.warn(`Failed to apply exact replacement for ${l.type}:`,x)}});let d;try{if(d=new window.DOMParser().parseFromString(n,"text/html"),d.querySelector("parsererror"))return console.warn("[Apply Suggestions] HTML parsing errors detected, using fallback approach"),n}catch(l){return console.error("[Apply Suggestions] Error parsing HTML:",l),n}const b=(l,i,x)=>{if(!i||!x)return 0;let v=0;const m=l.createTreeWalker?l.createTreeWalker(l.body||l,NodeFilter.SHOW_TEXT):d.createTreeWalker(l.body||d.body,NodeFilter.SHOW_TEXT);let w;for(;w=m.nextNode();){if(!w.textContent)continue;const S=w.textContent;let N=S;if(S.includes(i))N=S.replaceAll(i,x);else{const L=o(i).replace(/\s+/g,"\\s+"),z=new RegExp(L,"gi");N=S.replace(z,x)}N!==S&&(w.textContent=N,v++)}return v};if(d.querySelectorAll('style, link[rel="stylesheet"]'),d.querySelectorAll("script"),d.querySelector("header, nav, .header, .navbar, .navigation"),d.querySelector("footer, .footer"),s.forEach(l=>{try{if(l.exactReplacement&&n.includes(l.exactReplacement.replace))return;if(l.type==="heading"){const i=(l.enhancedContent||l.implementation||"").trim(),x=(l.currentContent||"").trim();if(i.length>0){const v=Array.from(d.querySelectorAll("h1,h2,h3"));let m=!1;v.forEach(w=>{const S=(w.textContent||"").trim();(x&&S.includes(x)||!x&&w.tagName.toLowerCase()==="h1")&&(w.textContent=i,t?.highlight,m=!0)}),m&&(u++,p.push("Heading updated"))}}if(l.type==="paragraph"){const{currentContent:i,enhancedContent:x}=l;if(i&&x){let v=!1;d.querySelectorAll("p").forEach(w=>{w.textContent&&w.textContent.includes(i)&&(w.textContent=(w.textContent||"").replaceAll(i,x),t?.highlight,v=!0)}),v||(v=b(d,i,x)>0),v&&(u++,p.push("Paragraph content replaced"))}}if(l.type==="list"){const{currentContent:i,enhancedContent:x}=l;if(i&&x){const v=d.querySelectorAll("li");let m=!1;v.forEach(w=>{w.textContent&&w.textContent.includes(i)&&(w.textContent=w.textContent.replace(i,x),t?.highlight,m=!0)}),m||(m=b(d,i,x)>0),m&&(u++,p.push("List item content replaced"))}}if(l.type==="meta_description"){let i=d.querySelector('meta[name="description"]');i||(i=d.createElement("meta"),i.name="description",d.head.appendChild(i));const x=d.querySelector("p")?.textContent||"";i.content=x.substring(0,160)||"Improved meta description.",u++,p.push("Meta description updated")}if(l.type==="title"){let i=d.querySelector("title");i||(i=d.createElement("title"),d.head.appendChild(i));const x=d.querySelector("h1")?.textContent;i.textContent=x||"Improved Title",u++,p.push("Title updated")}if(l.type==="meta_keywords"){let i=d.querySelector('meta[name="keywords"]');i||(i=d.createElement("meta"),i.name="keywords",d.head.appendChild(i));const m=(d.body.textContent||"").split(/\s+/).filter(S=>S.length>4).reduce((S,N)=>(S[N.toLowerCase()]=(S[N.toLowerCase()]||0)+1,S),{}),w=Object.entries(m).sort(([,S],[,N])=>N-S).slice(0,5).map(([S])=>S);i.content=w.join(", "),u++,p.push("Meta keywords updated")}if(l.type==="meta_viewport"){let i=d.querySelector('meta[name="viewport"]');i||(i=d.createElement("meta"),i.name="viewport",d.head.appendChild(i)),i.content="width=device-width, initial-scale=1.0",u++,p.push("Meta viewport updated")}if(l.type==="og_title"){let i=d.querySelector('meta[property="og:title"]');i||(i=d.createElement("meta"),i.setAttribute("property","og:title"),d.head.appendChild(i)),i.content=d.querySelector("h1")?.textContent||d.querySelector("title")?.textContent||"",u++,p.push("Open Graph title added")}if(l.type==="og_description"){let i=d.querySelector('meta[property="og:description"]');i||(i=d.createElement("meta"),i.setAttribute("property","og:description"),d.head.appendChild(i)),i.content=d.querySelector('meta[name="description"]')?.getAttribute("content")||"",u++,p.push("Open Graph description added")}if(l.type==="canonical"){let i=d.querySelector('link[rel="canonical"]');i||(i=d.createElement("link"),i.rel="canonical",d.head.appendChild(i)),i.href=window.location.href,u++,p.push("Canonical URL added")}if(l.type==="lang_attribute"){const i=d.documentElement;i.lang="en",u++,p.push("Language attribute updated")}if(l.type==="keyword_optimization"){const i=l.enhancedContent||l.implementation||"",x=i.match(/Enhanced with keywords:\s*(.+)/i)||i.match(/Add keywords:\s*(.+)/i);if(x&&x[1]){let v=d.querySelector('meta[name="keywords"]');v||(v=d.createElement("meta"),v.name="keywords",d.head.appendChild(v)),v.content=x[1],u++,p.push("Meta keywords updated")}}if(l.type==="content_enhancement"){const i=d.querySelectorAll("p");if(i.length>0){const x=i[0],v=l.enhancedContent;v&&v.length>10&&(x.textContent=v,u++,p.push("Content enhanced for AI understanding"))}}if(l.type==="sentence_replacement"){const i=r(l.currentContent||""),x=l.enhancedContent;if(i&&x){let v=b(d,i,x);if(v===0&&i.length>0){const m=i.charAt(0).toLowerCase()+i.slice(1);v=b(d,m,x)}v>0&&(u++,p.push("Sentence replaced for better AI understanding"))}}if(l.type==="ai_content_restructure"){const{currentContent:i,enhancedContent:x}=l;i&&x&&b(d,i,x)>0&&(u++,p.push("Content restructured"))}}catch(i){console.warn(`Failed to apply suggestion ${l.type}:`,i)}}),u>0){const l=d.createElement("script");l.type="application/json",l.id="ai-change-summary",l.textContent=JSON.stringify({appliedCount:u,appliedSuggestions:p}),d.head.appendChild(l)}let j=d.documentElement.outerHTML;if(j.includes("viewport")||(j=j.replace("</head>",`    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>`)),u===0){console.log("[Apply Suggestions] No suggestions were applied, trying aggressive fallback...");let l=!1;s.forEach(i=>{if(!l){if(console.log(`[Apply Suggestions] Trying aggressive fallback for ${i.type}...`),i.type==="heading"&&i.enhancedContent){const x=j.match(/<h[1-6][^>]*>([^<]+)<\/h[1-6]>/i);x?(j=j.replace(x[0],i.enhancedContent),u++,p.push(`${i.type} applied with aggressive fallback`),l=!0,console.log(`[Apply Suggestions] Applied ${i.type} with aggressive fallback`)):j.includes("<body>")&&(j=j.replace("<body>",`<body>
    ${i.enhancedContent}`),u++,p.push(`${i.type} added to body with aggressive fallback`),l=!0,console.log(`[Apply Suggestions] Added ${i.type} to body with aggressive fallback`))}if(i.type==="paragraph"&&i.enhancedContent){const x=j.match(/<p[^>]*>([^<]+)<\/p>/i);x&&(j=j.replace(x[0],i.enhancedContent),u++,p.push(`${i.type} applied with aggressive fallback`),l=!0,console.log(`[Apply Suggestions] Applied ${i.type} with aggressive fallback`))}if(i.type==="sentence_replacement"&&i.currentContent&&i.enhancedContent)if(j.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim().includes(i.currentContent))j=j.replace(i.currentContent,i.enhancedContent),u++,p.push(`${i.type} applied with exact text matching`),l=!0,console.log(`[Apply Suggestions] Applied ${i.type} with exact text matching`);else{const m=j.split(/[.!?]+/).filter(U=>U.trim().length>10),w=Math.min(m.length,20);let S=0,N=null,L=0;for(const U of m){if(S>=w){console.log(`[Apply Suggestions] Reached maximum sentence check limit (${w})`);break}const ee=U.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),k=i.currentContent.replace(/\s+/g," ").trim(),E=bt(ee.toLowerCase(),k.toLowerCase());g&&S<5&&console.log(`[Apply Suggestions] Aggressive fallback similarity check ${S+1}:`,{sentence:ee.substring(0,50)+"...",target:k.substring(0,50)+"...",similarity:E}),E>L&&(N=U.trim(),L=E),S++}const z=L>.9?N:null;z&&(j=j.replace(z.trim(),i.enhancedContent),u++,p.push(`${i.type} applied with high-similarity aggressive matching`),l=!0,console.log(`[Apply Suggestions] Applied ${i.type} with high-similarity aggressive matching`))}!l&&i.enhancedContent&&j.includes("<body>")&&(j=j.replace("<body>",`<body>
    ${i.enhancedContent}`),u++,p.push(`${i.type} added to body with aggressive fallback`),l=!0,console.log(`[Apply Suggestions] Added ${i.type} to body with aggressive fallback`))}}),u===0&&(console.log("[Apply Suggestions] No suggestions were applied successfully"),console.log("[Apply Suggestions] Available suggestions:",s.map(i=>({type:i.type,description:i.description,hasCurrentContent:!!i.currentContent,hasEnhancedContent:!!i.enhancedContent}))))}return console.log("[Apply Suggestions] Final result:",{originalHtmlLength:n.length,finalHtmlLength:j.length,appliedCount:u,appliedSuggestions:p,htmlChanged:j!==n,lengthChanged:j.length!==n.length}),j.includes("<!DOCTYPE html>")||(j=`<!DOCTYPE html>
`+j),j}const vt="statistics_state";function Ms({sessions:n,currentSession:s}){const[t,r]=f.useState("7d"),[o,c]=f.useState("questions"),[g,u]=f.useState([]),[p,d]=f.useState(0),[b,j]=f.useState([]),[l]=f.useState(!1);f.useEffect(()=>{(async()=>{try{const E=await je.getHistoryItems();u(E);const M=JSON.parse(localStorage.getItem("sessions")||"[]");j(M);const H=localStorage.getItem("llm_qa_current_session");if(H)try{const D=JSON.parse(H);console.log("[Statistics] Current session loaded:",{id:D.id,qaDataLength:D.qaData?.length||0})}catch(D){console.error("[Statistics] Error parsing current session:",D)}}catch(E){console.error("[Statistics] Error loading history items:",E),u([])}})()},[p,n.length,s]),f.useEffect(()=>{s&&(console.log("[Statistics] Current session prop changed:",{id:s.id,qaDataLength:s.qaData?.length||0,timestamp:s.timestamp}),d(k=>k+1))},[s?.id,s?.qaData?.length,s?.timestamp]),f.useEffect(()=>{const k=D=>{(D.key==="comprehensive_history"||D.key==="sessions"||D.key==="llm_qa_current_session")&&(console.log("[Statistics] Storage changed:",D.key,"refreshing statistics"),d(_=>_+1))};window.addEventListener("storage",k);const M=setInterval(()=>{const D=localStorage.getItem("llm_qa_current_session");if(D)try{const R=JSON.parse(D).qaData?.length||0;if(s&&s.qaData){const J=s.qaData.length;R!==J&&(console.log("[Statistics] Current session QA count changed:",J,"->",R),d(Z=>Z+1))}}catch(_){console.error("[Statistics] Error checking current session changes:",_)}},1e3),H=setInterval(async()=>{try{const D=await je.getHistoryItems(),_=JSON.parse(localStorage.getItem("sessions")||"[]");(D.length!==g.length||_.length!==b.length)&&(console.log("[Statistics] Data changed, refreshing statistics"),d(R=>R+1))}catch(D){console.error("[Statistics] Error checking for data changes:",D)}},2e3);return()=>{window.removeEventListener("storage",k),clearInterval(M),clearInterval(H)}},[g.length,b.length,s]);const i=()=>{const k=[...n,...b];g.forEach(I=>{if(I.type==="qa"){const B=I;k.push(B.sessionData)}});const M=g.filter(I=>I.type==="ai-visibility").map(I=>I),D=g.filter(I=>I.type==="content-analysis").map(I=>I),R=g.filter(I=>I.type==="structure-analysis").map(I=>I);console.log("[Statistics] Analysis types found:",{qaSessions:k.length,aiVisibilityAnalyses:M.length,contentAnalyses:D.length,structureAnalyses:R.length});const J=k.filter((I,B,Ae)=>B===Ae.findIndex(Ce=>Ce.id===I.id));if(console.log("[Statistics] Total sessions for calculation:",J.length),console.log("[Statistics] Sessions from prop:",n.length),console.log("[Statistics] Sessions from localStorage:",b.length),console.log("[Statistics] QA items from history:",g.filter(I=>I.type==="qa").length),J.forEach((I,B)=>{console.log(`[Statistics] Session ${B+1}:`,{id:I.id,qaCount:I.qaData.length,totalCost:I.statistics?.totalCost,timestamp:I.timestamp})}),!(J.length>0||M.length>0||D.length>0||R.length>0))return{totalQuestions:0,totalCost:0,totalTokens:0,avgAccuracy:0,totalSessions:0,avgQuestionsPerSession:0,successRate:0,providerDistribution:{},questionsPerDay:[],inputTokens:0,outputTokens:0,avgResponseTime:0,weeklyGrowth:0,dailyAverage:0,peakDay:"",sentimentDistribution:{positive:0,negative:0,neutral:0},geoScoreAverage:0,semanticRelevanceAverage:0,vectorSimilarityAverage:0,totalAIVisibilityAnalyses:0,totalContentAnalyses:0,totalStructureAnalyses:0,averageVisibilityScore:0,averageSEOScore:0,averageReadabilityScore:0,totalSuggestions:0};const Y=J.reduce((I,B)=>I+B.qaData.length,0),C=J.reduce((I,B)=>I+parseFloat(B.statistics?.totalCost||"0"),0),F=J.reduce((I,B)=>I+B.qaData.reduce((Ae,Ce)=>Ae+Ce.totalTokens,0),0),O=J.reduce((I,B)=>I+B.qaData.reduce((Ae,Ce)=>Ae+Ce.inputTokens,0),0),W=J.reduce((I,B)=>I+B.qaData.reduce((Ae,Ce)=>Ae+Ce.outputTokens,0),0),te=M.length,me=M.length>0?M.reduce((I,B)=>I+(B.analysis.summary.averageVisibilityScore||0),0)/M.length:0,$e=D.length,Ne=D.length>0?D.reduce((I,B)=>I+(B.analysis.seoScore||0),0)/D.length:0,ke=D.length>0?D.reduce((I,B)=>I+(B.analysis.readabilityScore||0),0)/D.length:0,ue=R.length,pe=R.reduce((I,B)=>I+(B.analysis.suggestions?.length||0),0);console.log("[Statistics] Calculated metrics:",{totalQuestions:Y,totalCost:C.toFixed(5),totalTokens:F,sessionCount:k.length});const ye=J.flatMap(I=>I.qaData),xe=ye.map(I=>parseFloat(I.accuracy||"0")).filter(I=>!isNaN(I)&&I>0),oe=xe.length>0?xe.reduce((I,B)=>I+B,0)/xe.length:0;console.log("[Statistics] Accuracy calculation:",{totalQAItems:ye.length,itemsWithAccuracy:xe.length,avgAccuracy:oe.toFixed(1)+"%",accuracyValues:xe.slice(0,5)});const X={};["openai","gemini","perplexity"].forEach(I=>{X[I]=0}),ye.forEach(I=>{const B=I.provider||"Unknown";X.hasOwnProperty(B)?X[B]++:X[B]=(X[B]||0)+1});const se={positive:0,negative:0,neutral:0},A=J[0]?.blogContent||"";if(A)try{const I=ls(A);I==="Negative"?(se.positive=0,se.negative=0,se.neutral=80):I==="Positive"?(se.positive=70,se.negative=0,se.neutral=30):(se.positive=0,se.negative=0,se.neutral=100)}catch(I){console.error("Error calculating sentiment:",I),se.positive=0,se.negative=0,se.neutral=100}else se.positive=0,se.negative=0,se.neutral=100;const T=ye.map(I=>I.geoScore||0).filter(I=>I>0),q=T.length>0?T.reduce((I,B)=>I+B,0)/T.length:0,ie=ye.map(I=>parseFloat(I.semanticRelevance||"0")).filter(I=>!isNaN(I)&&I>0),fe=ie.length>0?ie.reduce((I,B)=>I+B,0)/ie.length:0,ne=ye.map(I=>{const B=I.vectorSimilarity;return typeof B=="string"&&B.includes("%")?parseFloat(B.replace("%","")):parseFloat(B||"0")}).filter(I=>!isNaN(I)&&I>0),ve=ne.length>0?ne.reduce((I,B)=>I+B,0)/ne.length:0,ce=new Date,de=new Date(ce.getTime()-7*24*60*60*1e3),ae=new Date(ce.getTime()-14*24*60*60*1e3),Se=J.filter(I=>new Date(I.timestamp)>=de),ge=J.filter(I=>new Date(I.timestamp)>=ae&&new Date(I.timestamp)<de),Ie=Se.reduce((I,B)=>I+B.qaData.length,0),Me=ge.reduce((I,B)=>I+B.qaData.length,0),We=Me>0?(Ie-Me)/Me*100:0,Ye=Y/7,Fe=x(k,7),Xe=Fe.indexOf(Math.max(...Fe)),Ze=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][Xe]||"Unknown",et=J.filter(I=>I.qaData.some(B=>B.answer&&B.answer.trim()!=="")),Be=J.length>0?et.length/J.length*100:0,Je=J.length>0?Y/J.length:0,Ge=F>0?F/1e3*2.5:0;return{totalQuestions:Y,totalCost:C,totalTokens:F,avgAccuracy:oe,totalSessions:J.length,avgQuestionsPerSession:Je,successRate:Be,providerDistribution:X,questionsPerDay:Fe,inputTokens:O,outputTokens:W,avgResponseTime:Ge,weeklyGrowth:We,dailyAverage:Ye,peakDay:Ze,sentimentDistribution:se,geoScoreAverage:q,semanticRelevanceAverage:fe,vectorSimilarityAverage:ve,totalAIVisibilityAnalyses:te,totalContentAnalyses:$e,totalStructureAnalyses:ue,averageVisibilityScore:me,averageSEOScore:Ne,averageReadabilityScore:ke,totalSuggestions:pe}},x=(k,E)=>{const M=new Date,H=[];for(let D=E-1;D>=0;D--){const _=new Date(M);_.setDate(_.getDate()-D);const J=k.filter(Z=>{const Y=new Date(Z.timestamp);return Y.getFullYear()===_.getFullYear()&&Y.getMonth()===_.getMonth()&&Y.getDate()===_.getDate()}).reduce((Z,Y)=>Z+Y.qaData.length,0);H.push(J)}return H},v=()=>{const k=new Date,E=[],M=[],H=["#000000","#333333","#666666","#999999","#cccccc","#e6e6e6","#f0f0f0","#1a1a1a","#404040","#595959","#737373","#8c8c8c","#a6a6a6","#bfbfbf","#d9d9d9","#e6e6e6","#f2f2f2","#f5f5f5","#f8f8f8","#fafafa","#fcfcfc","#000000","#1a1a1a","#333333","#4d4d4d","#666666","#808080","#999999"],D=[...n];switch(g.forEach(_=>{if(_.type==="qa"){const R=_;D.push(R.sessionData)}}),t){case"7d":console.log("[Statistics] Generating 7-day chart data...");for(let _=6;_>=0;_--){const R=new Date(k);R.setDate(R.getDate()-_);const J=R.toLocaleDateString("en-US",{weekday:"short"});E.push(J),console.log(`[Statistics] Day ${_}: ${J} - ${R.toISOString()}`),new Date(R).setHours(0,0,0,0),new Date(R).setHours(23,59,59,999);const C=D.filter(F=>{try{const O=new Date(F.timestamp);if(isNaN(O.getTime()))return console.warn("[Statistics] Invalid session timestamp:",F.timestamp),!1;const W=O.getFullYear()*1e4+(O.getMonth()+1)*100+O.getDate(),te=R.getFullYear()*1e4+(R.getMonth()+1)*100+R.getDate();return W===te}catch(O){return console.error("[Statistics] Error parsing session timestamp:",F.timestamp,O),!1}});if(o==="questions"){const F=C.reduce((O,W)=>O+W.qaData.length,0);console.log(`[Statistics] Day ${E[E.length-1]}: ${C.length} sessions, ${F} questions`),M.push(F)}else if(o==="cost"){const F=C.reduce((O,W)=>O+parseFloat(W.statistics?.totalCost||"0"),0);M.push(F)}else o==="sessions"&&M.push(C.length)}break;case"30d":console.log("[Statistics] Generating 30-day chart data...");for(let _=29;_>=0;_--){const R=new Date(k);R.setDate(R.getDate()-_);const J=R.toLocaleDateString("en-US",{month:"short",day:"numeric"});E.push(J),console.log(`[Statistics] Day ${_}: ${J} - ${R.toISOString()}`),new Date(R).setHours(0,0,0,0),new Date(R).setHours(23,59,59,999);const C=D.filter(F=>{try{const O=new Date(F.timestamp);if(isNaN(O.getTime()))return console.warn("[Statistics] Invalid session timestamp:",F.timestamp),!1;const W=O.getFullYear()*1e4+(O.getMonth()+1)*100+O.getDate(),te=R.getFullYear()*1e4+(R.getMonth()+1)*100+R.getDate();return W===te}catch(O){return console.error("[Statistics] Error parsing session timestamp:",F.timestamp,O),!1}});if(o==="questions"){const F=C.reduce((O,W)=>O+W.qaData.length,0);console.log(`[Statistics] Day ${E[E.length-1]}: ${C.length} sessions, ${F} questions`),M.push(F)}else if(o==="cost"){const F=C.reduce((O,W)=>O+parseFloat(W.statistics?.totalCost||"0"),0);M.push(F)}else o==="sessions"&&M.push(C.length)}break}return{labels:E,values:M,colors:H}},m=i(),w=v(),S=[...n];if(g.forEach(k=>{if(k.type==="qa"){const E=k;S.push(E.sessionData)}}),S.length>0){const k=S[0];console.log("[Statistics] Sample session structure:",{id:k.id,timestamp:k.timestamp,qaDataLength:k.qaData.length,qaDataSample:k.qaData.slice(0,2).map(E=>({question:E.question.substring(0,50)+"...",hasAnswer:!!E.answer}))})}console.log("[Statistics] Sessions from prop:",n.length),console.log("[Statistics] QA items from history:",g.filter(k=>k.type==="qa").length),console.log("[Statistics] Total sessions for stats:",S.length),console.log("[Statistics] Current session QA count:",s?.qaData.length||0),console.log("[Statistics] Chart data:",w),console.log("[Statistics] Provider distribution:",m.providerDistribution),s&&console.log("[Statistics] Current session active:",{id:s.id,qaDataLength:s.qaData?.length||0}),S.length>0&&console.log("[Statistics] Sample session timestamps:",S.slice(0,3).map(k=>({id:k.id,timestamp:k.timestamp,qaDataLength:k.qaData.length,date:new Date(k.timestamp).toLocaleDateString()})));const N=w.values.length>0?Math.max(...w.values,1):1;if(!w.values.some(k=>k>0)&&S.length>0)if(console.log("[Statistics] No data found in chart, showing fallback data"),s&&s.qaData.length>0){const k=s.qaData.length,E=Math.ceil(k/7);w.values=w.values.map((M,H)=>H===0?Math.floor(E*.8):H===1?Math.floor(E*1.2):H===2?Math.floor(E*1):H===3?Math.floor(E*.9):H===4?Math.floor(E*1.1):H===5?Math.floor(E*.7):H===6?Math.floor(E*.6):0)}else{const k=n.reduce((E,M)=>E+M.qaData.length,0);if(k>0){const E=Math.ceil(k/7);w.values=w.values.map((M,H)=>H===0?Math.floor(E*.8):H===1?Math.floor(E*1.2):H===2?Math.floor(E*1):H===3?Math.floor(E*.9):H===4?Math.floor(E*1.1):H===5?Math.floor(E*.7):H===6?Math.floor(E*.6):0)}}const z=m.providerDistribution,U=["#000000","#333333","#666666","#999999","#cccccc","#e6e6e6"],ee=k=>({openai:"ChatGPT",gemini:"Gemini",perplexity:"Perplexity",Unknown:"Unknown"})[k]||k;return f.useEffect(()=>{const k=localStorage.getItem(vt);if(k)try{const E=JSON.parse(k);E.timeRange&&r(E.timeRange),E.selectedMetric&&c(E.selectedMetric)}catch{}},[]),f.useEffect(()=>{localStorage.setItem(vt,JSON.stringify({timeRange:t,selectedMetric:o}))},[t,o]),e.jsxs("div",{className:"w-full max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:e.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold text-black",children:"Live Analytics Dashboard"})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-black",children:m.totalQuestions}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Total Questions"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-black",children:m.totalAIVisibilityAnalyses+m.totalContentAnalyses+m.totalStructureAnalyses}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Total Analyses"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-black",children:[m.avgAccuracy.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Avg Accuracy"})]}),e.jsxs("div",{className:"text-center p-3 sm:p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-black",children:["$",parseFloat(m.totalCost).toFixed(5)]}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:"Total Cost"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ut,{className:"w-6 h-6 text-black"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[o==="questions"?"Questions Generated":o==="cost"?"Cost Analysis":"Sessions Created"," - ",t==="7d"?"Last 7 Days":"Last 30 Days",t==="30d"&&e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(Scroll to see all days)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t,onChange:k=>r(k.target.value),className:"bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-black",children:[e.jsx("option",{value:"7d",children:"7 Days"}),e.jsx("option",{value:"30d",children:"30 Days"})]}),e.jsxs("select",{value:o,onChange:k=>c(k.target.value),className:"bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-black",children:[e.jsx("option",{value:"questions",children:"Questions"}),e.jsx("option",{value:"cost",children:"Cost"}),e.jsx("option",{value:"sessions",children:"Sessions"})]})]})]}),e.jsx("div",{className:`h-64 bg-gray-50 rounded-lg w-full ${t==="30d"?"overflow-x-auto":"overflow-hidden"}`,style:{...t==="30d"&&{scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"}},children:e.jsxs("div",{className:"relative h-full flex items-end w-full",children:[t==="7d"&&e.jsx("div",{className:"absolute inset-0 flex items-end justify-between px-4 pb-8",children:w.values.map((k,E)=>e.jsxs("div",{className:"flex flex-col justify-end items-center h-full w-16",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 font-medium",children:o==="cost"?parseFloat(k).toFixed(5):k}),e.jsx("div",{className:"w-full rounded-t-lg transition-all duration-500 hover:opacity-80",style:{height:`${k/N*180}px`,backgroundColor:w.colors[E%w.colors.length],minHeight:"4px"}}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 text-center font-medium w-full truncate",children:w.labels[E]})]},E))}),t==="30d"&&e.jsx("div",{className:"flex items-end h-full gap-2 px-6 min-w-[1320px] pb-8",children:w.values.map((k,E)=>e.jsxs("div",{className:"flex flex-col justify-end items-center h-full w-14",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2 font-medium",children:o==="cost"?parseFloat(k).toFixed(5):k}),e.jsx("div",{className:"w-full rounded-t-lg transition-all duration-500 hover:opacity-80",style:{height:`${k/N*180}px`,backgroundColor:w.colors[E%w.colors.length],minHeight:"4px"}}),e.jsx("div",{className:"text-xs text-gray-600 mt-2 text-center font-medium w-full truncate",children:w.labels[E]})]},E))})]})}),t==="30d"&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("div",{className:"text-xs text-gray-500",children:"← Scroll horizontally to see all 30 days →"})})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Re,{className:"w-6 h-6 text-black"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Provider Distribution"})]}),Object.keys(z).length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"relative w-48 h-48",children:[e.jsx("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:Object.entries(z).map(([k,E],M)=>{const H=Object.values(z).reduce((C,F)=>C+F,0),D=H>0?E/H*100:0,_=40,R=2*Math.PI*_,J=D/100*R,Z=R-J,Y=M/Object.keys(z).length*360;return e.jsx("circle",{cx:"50",cy:"50",r:_,fill:"none",stroke:U[M%U.length],strokeWidth:"8",strokeDasharray:R,strokeDashoffset:Z,transform:`rotate(${Y} 50 50)`,className:"transition-all duration-500"},k)})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:Object.values(z).reduce((k,E)=>k+E,0)}),e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:"Total"})]})})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mt-6",children:Object.entries(z).map(([k,E],M)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:U[M%U.length]}}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:ee(k)}),e.jsx("span",{className:"text-sm font-bold text-black ml-auto",children:E})]},k))})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-lg font-medium",children:"No provider data available"}),e.jsx("div",{className:"text-sm",children:"Generate some questions to see provider distribution"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(qt,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Token Usage"})]}),e.jsx("div",{className:"text-3xl font-bold text-black mb-2",children:m.totalTokens.toLocaleString()}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Total Tokens Used"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Input Tokens"}),e.jsx("span",{className:"text-black font-semibold",children:m.inputTokens.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Output Tokens"}),e.jsx("span",{className:"text-black font-semibold",children:m.outputTokens.toLocaleString()})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(qe,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Performance"})]}),e.jsx("div",{className:"text-3xl font-bold text-black mb-2",children:m.avgQuestionsPerSession.toFixed(1)}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Avg Questions/Session"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Success Rate"}),e.jsxs("span",{className:"text-black font-semibold",children:[m.successRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Avg Response Time"}),e.jsxs("span",{className:"text-black font-semibold",children:[m.avgResponseTime.toFixed(1),"s"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ut,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Trends"})]}),e.jsxs("div",{className:"text-3xl font-bold text-black mb-2",children:[m.weeklyGrowth>=0?"+":"",m.weeklyGrowth.toFixed(1),"%"]}),e.jsx("div",{className:"text-gray-600 font-medium",children:"This Week"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Daily Avg"}),e.jsx("span",{className:"text-black font-semibold",children:m.dailyAverage.toFixed(0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Peak Day"}),e.jsx("span",{className:"text-black font-semibold",children:m.peakDay})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ht,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Sentiment Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:m.sentimentDistribution.positive}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Positive"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:m.sentimentDistribution.negative}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Negative"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:m.sentimentDistribution.neutral}),e.jsx("div",{className:"text-gray-600 font-medium",children:"Neutral"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(qe,{className:"w-5 h-5 text-black"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Quality Metrics"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"GEO Score Avg"}),e.jsxs("span",{className:"text-black font-semibold",children:[m.geoScoreAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Semantic Relevance"}),e.jsxs("span",{className:"text-black font-semibold",children:[m.semanticRelevanceAverage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Vector Similarity"}),e.jsxs("span",{className:"text-black font-semibold",children:[m.vectorSimilarityAverage.toFixed(1),"%"]})]})]})]})]})]})}const le="http://localhost:5000/api";class ds{async request(s,t={}){const r=`${le}${s}`;console.log("[ApiService] Making request to:",r);const o=await fetch(r,{headers:{"Content-Type":"application/json",...K.getAuthHeaders(),...t.headers},...t});if(console.log("[ApiService] Response status:",o.status),console.log("[ApiService] Response headers:",o.headers),o.status===403)if(console.log("[ApiService] 403 Forbidden - attempting token refresh"),await K.refreshToken()){console.log("[ApiService] Token refreshed successfully, retrying request");const u=await fetch(r,{headers:{"Content-Type":"application/json",...K.getAuthHeaders(),...t.headers},...t});if(!u.ok){const d=await u.json().catch(()=>({}));throw new Error(d.error||`HTTP error! status: ${u.status}`)}const p=u.headers.get("content-type");if(!p||!p.includes("application/json")){const d=await u.text();throw console.error("[ApiService] Non-JSON response received on retry:",d.substring(0,200)),new Error(`Expected JSON response but got: ${p}`)}return u.json()}else throw console.log("[ApiService] Token refresh failed, redirecting to login"),K.logout(),window.location.href="/login",new Error("Session expired. Please log in again.");if(!o.ok){const g=await o.json().catch(()=>({}));throw new Error(g.error||`HTTP error! status: ${o.status}`)}const c=o.headers.get("content-type");if(!c||!c.includes("application/json")){const g=await o.text();throw console.error("[ApiService] Non-JSON response received:",g.substring(0,200)),new Error(`Expected JSON response but got: ${c}`)}return o.json()}async getLLMProviders(){return this.request("/llm/providers")}async generateQuestions(s){return this.request("/llm/generate-questions",{method:"POST",body:JSON.stringify(s)})}async generateAnswers(s){return this.request("/llm/generate-answers",{method:"POST",body:JSON.stringify(s)})}async generateAnswersWeb(s){return this.request("/llm/generate-answers-web",{method:"POST",body:JSON.stringify(s)})}async generateAIFAQs(s){return this.request("/llm/generate-ai-faqs",{method:"POST",body:JSON.stringify(s)})}async calculateConfidence(s,t,r,o){return this.request("/llm/calculate-confidence",{method:"POST",body:JSON.stringify({question:s,content:t,provider:r,model:o})})}async compareQuestions(s,t,r,o){return this.request("/llm/compare-questions",{method:"POST",body:JSON.stringify({question1:s,question2:t,provider:r,model:o})})}async saveSession(s){return this.request("/sessions",{method:"POST",body:JSON.stringify(s)})}async getSessionsByType(s){return this.request(`/sessions/${s}`)}async getSessionsWithFilters(s,t){const r=new URLSearchParams;t.fromDate&&r.append("fromDate",t.fromDate),t.toDate&&r.append("toDate",t.toDate),t.llmProvider&&r.append("llmProvider",t.llmProvider),t.llmModel&&r.append("llmModel",t.llmModel),t.blogLink&&r.append("blogLink",t.blogLink),t.search&&r.append("search",t.search);const o=r.toString(),c=o?`/sessions/${s}?${o}`:`/sessions/${s}`;return this.request(c)}async getSessionsByDateRange(s,t,r){const o=new URLSearchParams({fromDate:t,toDate:r});return this.request(`/sessions/${s}/range?${o}`)}async getSessionById(s){return this.request(`/sessions/question/${s}`)}async deleteSession(s){return this.request(`/sessions/${s}`,{method:"DELETE"})}async getSessionStats(s){return this.request(`/stats/${s}`)}async bulkSaveSessions(s){return this.request("/sessions/bulk",{method:"POST",body:JSON.stringify({sessions:s})})}async exportSessions(s,t="json"){const r=await fetch(`${le}/export/${s}?format=${t}`);if(!r.ok){const o=await r.json().catch(()=>({}));throw new Error(o.error||`HTTP error! status: ${r.status}`)}return r.blob()}async healthCheck(){return this.request("/health")}async migrateFromLocalStorage(s){const t=Object.values(s);return this.bulkSaveSessions(t)}async checkQuestionRelevance(s,t,r,o,c){return this.request("/questions/check-relevance",{method:"POST",body:JSON.stringify({sourceUrls:s,blogUrl:t,questionText:r,currentProvider:o,currentModel:c})})}async calculateCitationLikelihood({answer:s,content:t,provider:r,model:o}){console.log("[Frontend] Calling /api/citation-likelihood/calculate with:",{answer:s,content:t,provider:r,model:o});const c=await fetch(`${le}/citation-likelihood/calculate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:s,content:t,provider:r,model:o})});let g;try{g=await c.json()}catch(u){throw console.error("[Frontend] Failed to parse JSON from /api/citation-likelihood/calculate:",u),new Error("Failed to parse JSON from /api/citation-likelihood/calculate")}if(console.log("[Frontend] /api/citation-likelihood/calculate response:",g),!c.ok)throw new Error("Failed to calculate citation likelihood: "+(g.error||c.status));return g}async calculateAccuracy({answer:s,content:t,provider:r,model:o}){console.log("[Frontend] Calling /api/accuracy/calculate with:",{answer:s,content:t,provider:r,model:o});const c=await fetch(`${le}/accuracy/calculate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:s,content:t,provider:r,model:o})});let g;try{g=await c.json()}catch(u){throw console.error("[Frontend] Failed to parse JSON from /api/accuracy/calculate:",u),new Error("Failed to parse JSON from /api/accuracy/calculate")}if(console.log("[Frontend] /api/accuracy/calculate response:",g),!c.ok)throw new Error("Failed to calculate accuracy: "+(g.error||c.status));return g}async calculateGeminiAccuracy({answer:s,content:t,model:r}){console.log("[Frontend] Calling /api/accuracy/gemini with:",{answer:s,content:t,model:r});const o=await fetch(`${le}/accuracy/gemini`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({answer:s,content:t,model:r})});let c;try{c=await o.json()}catch(g){throw console.error("[Frontend] Failed to parse JSON from /api/accuracy/gemini:",g),new Error("Failed to parse JSON from /api/accuracy/gemini")}if(console.log("[Frontend] /api/accuracy/gemini response:",c),!o.ok)throw new Error("Failed to calculate Gemini accuracy: "+(c.error||o.status));return c}async calculateGeoScoreBackend(s){const t=await fetch(`${le}/geo-score`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify(s)});let r;try{r=await t.json()}catch(o){throw console.error("[Frontend] Failed to parse JSON from /api/geo-score:",o),new Error("Failed to parse JSON from /api/geo-score")}if(console.log("[Frontend] /api/geo-score response:",r),!t.ok)throw new Error("Failed to calculate GEO score: "+(r.error||t.status));return r}async getGEOFanoutAnalysis(s){const t=s?`${le}/geo-fanout/analysis?sessionId=${s}`:`${le}/geo-fanout/analysis`;console.log("[Frontend] Calling GEO fanout analysis:",t);const r=await fetch(t,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}});let o;try{o=await r.json()}catch(c){throw console.error("[Frontend] Failed to parse JSON from GEO fanout analysis:",c),new Error("Failed to parse JSON from GEO fanout analysis")}if(console.log("[Frontend] GEO fanout analysis response:",o),!r.ok)throw new Error("Failed to get GEO fanout analysis: "+(o.error||r.status));return o}async analyzeCompetitor(s,t){const r=await fetch(`${le}/competitor/analyze`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({domain:s,userContent:t})}),o=await r.json();if(!r.ok)throw new Error("Failed to analyze competitor: "+(o.error||r.status));return o}async analyzeMultipleCompetitors(s,t){const r=await fetch(`${le}/competitor/analyze-multiple`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({domains:s,userContent:t})}),o=await r.json();if(!r.ok)throw new Error("Failed to analyze competitors: "+(o.error||r.status));return o}async getCompetitorAnalyses(){const s=await fetch(`${le}/competitor/analyses`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),t=await s.json();if(!s.ok)throw new Error("Failed to get competitor analyses: "+(t.error||s.status));return t}async getCompetitorAnalysis(s){const t=await fetch(`${le}/competitor/analysis/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),r=await t.json();if(!t.ok)throw new Error("Failed to get competitor analysis: "+(r.error||t.status));return r}async deleteCompetitorAnalysis(s){const t=await fetch(`${le}/competitor/analysis/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),r=await t.json();if(!t.ok)throw new Error("Failed to delete competitor analysis: "+(r.error||t.status));return r}async extractContentFromUrl(s){return console.log("[API Service] Extracting content from URL:",s),console.log("[API Service] API_BASE_URL:",le),console.log("[API Service] Access token:",localStorage.getItem("accessToken")?"Present":"Missing"),this.request("/extract-content",{method:"POST",body:JSON.stringify({url:s})})}async crawlWebsite(s,t){return console.log("[API Service] Crawling website:",s,"with options:",t),this.request("/crawl-website",{method:"POST",body:JSON.stringify({url:s,options:t})})}async extractFullPageHtml(s){return console.log("[API Service] Extracting full page HTML from URL:",s),this.request("/extract/fullpage",{method:"POST",body:JSON.stringify({url:s})})}async extractSmartHtml(s){return console.log("[API Service] Smart extract for URL:",s),this.request("/extract/smart",{method:"POST",body:JSON.stringify({url:s})})}async getOffsiteSignals(s){return this.request("/ecommerce-content/offsite-signals",{method:"POST",body:JSON.stringify(s)})}async getCompetitors(s){return this.request("/ecommerce-content/competitors",{method:"POST",body:JSON.stringify(s)})}async getProductCompetitors(s,t){return this.request("/ecommerce-content/product-competitors",{method:"POST",body:JSON.stringify({productQuery:s,currentUrl:t})})}async getSerpTop(s,t=10){return this.request("/ecommerce-content/serp-top",{method:"POST",body:JSON.stringify({query:s,num:t})})}async fetchBatchHtml(s){return this.request("/ecommerce-content/fetch-batch",{method:"POST",body:JSON.stringify({urls:s})})}async getSmartAnalyses(){const s=await fetch(`${le}/competitor/smart-analyses`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),t=await s.json();if(!s.ok)throw new Error("Failed to get smart analyses: "+(t.error||s.status));return t}async getSmartAnalysis(s){const t=await fetch(`${le}/competitor/smart-analysis/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),r=await t.json();if(!t.ok)throw new Error("Failed to get smart analysis: "+(r.error||t.status));return r}async createSmartAnalysis(s){const t=await fetch(`${le}/competitor/smart-analysis`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify(s)}),r=await t.json();if(!t.ok)throw new Error("Failed to create smart analysis: "+(r.error||t.status));return r}async deleteSmartAnalysis(s){const t=await fetch(`${le}/competitor/smart-analysis/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`}}),r=await t.json();if(!t.ok)throw new Error("Failed to delete smart analysis: "+(r.error||t.status));return r}async analyzeContentStructure(s,t){return console.log("[API Service] Analyzing content structure for:",t?`URL: ${t}`:`Content length: ${s.length}`),t?(console.log("[API Service] Using dedicated structural content crawler for URL"),this.request("/structural-content/crawl",{method:"POST",body:JSON.stringify({url:t})})):this.request("/content/analyze-structure",{method:"POST",body:JSON.stringify({content:s,url:t})})}async saveLastStructureAnalysis(s){return this.request("/structure/last",{method:"POST",body:JSON.stringify({analysis:s})})}async getLastStructureAnalysis(s){const t=s?`?url=${encodeURIComponent(s)}`:"";return this.request(`/structure/last${t}`,{method:"GET"})}async getGA4PageMetrics(s){return this.request("/analytics/ga4",{method:"POST",body:JSON.stringify(s)})}async getSearchConsoleMetrics(s){return this.request("/analytics/search-console",{method:"POST",body:JSON.stringify(s)})}async getLLMVisibility(s){return this.request("/analytics/llm-visibility",{method:"POST",body:JSON.stringify(s)})}async applyStructureSuggestions(s,t){const r=await fetch(`${le}/content/apply-suggestions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`},body:JSON.stringify({content:s,suggestions:t})}),o=await r.json();if(!r.ok)throw new Error("Failed to apply structure suggestions: "+(o.error||r.status));return o}async getAIVisibilityAnalysis(s,t,r,o){const c=new URLSearchParams;t&&c.append("industry",t),o?.productName&&c.append("product",o.productName),o?.productCategory&&c.append("category",o.productCategory),o?.competitorName&&c.append("competitor",o.competitorName),o?.country&&c.append("country",o.country);const g=c.toString(),u=g?`?${g}`:"";return this.request(`/ai-visibility/${encodeURIComponent(s)}${u}`,{signal:r?.signal})}async analyzeSingleCompetitor(s,t){return await this.request("/ai-visibility/analyze-competitor",{method:"POST",body:JSON.stringify({companyName:s,industry:t})})}getShopifyAuthStartUrl(s){const t=new URLSearchParams({shop:s});return`${le}/shopify/auth/start?${t.toString()}`}getShopifyAuthStartUrlWithCreds(s,t){const r=new URLSearchParams({shop:s,credsId:t});return`${le}/shopify/auth/start?${r.toString()}`}async listShopifyProducts(s,t){const r=new URLSearchParams;s&&r.append("after",s),t&&r.append("shop",t);const o=r.toString()?`?${r.toString()}`:"";return this.request(`/shopify/products${o}`,{method:"GET"})}async getShopifyProductByHandle(s,t){const r=new URLSearchParams({handle:s});t&&r.append("shop",t);const o=`?${r.toString()}`;return this.request(`/shopify/product${o}`,{method:"GET"})}async getShopifyProductById(s,t){const r=new URLSearchParams({id:s});t&&r.append("shop",t);const o=`?${r.toString()}`;return this.request(`/shopify/product${o}`,{method:"GET"})}async listShopifyConnections(){return this.request("/shopify/connections",{method:"GET"})}async disconnectShopify(s){const t=`?shop=${encodeURIComponent(s)}`;return this.request(`/shopify/connection${t}`,{method:"DELETE"})}async createShopifyCreds(s){return this.request("/shopify/credentials",{method:"POST",body:JSON.stringify(s)})}async listShopifyCreds(){return this.request("/shopify/credentials",{method:"GET"})}async deleteShopifyCreds(s){return this.request(`/shopify/credentials/${encodeURIComponent(s)}`,{method:"DELETE"})}async getPublicShopifyProduct(s){const t=new URLSearchParams;s.url&&t.append("url",s.url),s.shop&&t.append("shop",s.shop),s.handle&&t.append("handle",s.handle);const r=t.toString()?`?${t.toString()}`:"";return this.request(`/shopify/public-product${r}`,{method:"GET"})}async listPublicShopifyProducts(s){const t=`?shop=${encodeURIComponent(s)}`;return this.request(`/shopify/public-list${t}`,{method:"GET"})}async connectStorefront(s,t){return this.request("/shopify/storefront/connect",{method:"POST",body:JSON.stringify({shop:s,token:t})})}async testStorefront(s){const t=`?shop=${encodeURIComponent(s)}`;return this.request(`/shopify/storefront/test${t}`,{method:"GET"})}async listStorefrontConnections(){return this.request("/shopify/storefront/connections",{method:"GET"})}async listStorefrontProducts(s,t){const r=new URLSearchParams({shop:s});t&&r.append("after",t);const o=`?${r.toString()}`;return this.request(`/shopify/storefront/products${o}`,{method:"GET"})}async getStorefrontProduct(s,t){const o=`?${new URLSearchParams({shop:s,handle:t}).toString()}`;return this.request(`/shopify/storefront/product${o}`,{method:"GET"})}async getShopperBehaviorData(s,t){const r=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/shopper-behavior${r}`,{method:"GET"})}async getCartAbandonmentAnalysis(s,t){const r=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/cart-abandonment${r}`,{method:"GET"})}async getQueryIntentAnalysis(s,t){const r=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/query-intent${r}`,{method:"GET"})}async getEngagementFunnel(s,t){const r=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/engagement-funnel${r}`,{method:"GET"})}async getRealTimeMetrics(s){const t=`?storeId=${encodeURIComponent(s)}`;return this.request(`/ecommerce/real-time-metrics${t}`,{method:"GET"})}async getAIInsights(s,t){const r=`?storeId=${encodeURIComponent(s)}&timeRange=${encodeURIComponent(t)}`;return this.request(`/ecommerce/ai-insights${r}`,{method:"GET"})}async priceCompare(s,t){return this.request("/ecommerce-content/price-compare",{method:"POST",body:JSON.stringify({productQuery:s,currentUrl:t})})}async generateEcommerceContent(s){return this.request("/ecommerce/generate-content",{method:"POST",body:JSON.stringify(s)})}}const be=new ds,us=()=>{console.log("🧹 Clearing analysis data for fresh session..."),["llm_qa_current_work","enhance_content_state","ai_visibility_current_session","ai_visibility_analysis_data","content_analysis_current_session","content_analysis_data","structure_analysis_current_session","structure_analysis_data","llm_competitor_urls","session_index","session_manager_sessions","statistics_state","shopify_connections","current_analysis_session","analysis_data","analysis_results"].forEach(t=>{try{localStorage.removeItem(t),console.log(`🧹 Cleared: ${t}`)}catch(r){console.warn(`🧹 Failed to clear ${t}:`,r)}}),["enhance_content_cache_","analysis_cache_","ai_visibility_","content_analysis_","structure_analysis_"].forEach(t=>{try{Object.keys(localStorage).forEach(o=>{o.startsWith(t)&&(localStorage.removeItem(o),console.log(`🧹 Cleared prefixed key: ${o}`))})}catch(r){console.warn(`🧹 Failed to clear keys with prefix ${t}:`,r)}}),console.log("🧹 Analysis data clearing completed")},gs=n=>{console.log("🧹 Clearing user-specific data..."),console.log("🧹 User-specific data clearing completed")},hs=()=>{console.log("🧹 Clearing analysis state...");try{sessionStorage.clear(),console.log("🧹 Cleared sessionStorage")}catch(n){console.warn("🧹 Failed to clear sessionStorage:",n)}console.log("🧹 Analysis state clearing completed")},ms=async()=>{console.log("🔌 Disconnecting all Shopify connections...");try{const n=JSON.parse(localStorage.getItem("shopify_connections")||"[]");if(n.length===0){console.log("🔌 No Shopify connections to disconnect");return}const s=n.map(async t=>{try{await be.disconnectShopify(t.shop),console.log(`🔌 Successfully disconnected from ${t.shop}`)}catch(r){console.warn(`🔌 Failed to disconnect from ${t.shop} via API:`,r)}});await Promise.allSettled(s),console.log("🔌 All Shopify connections disconnected")}catch(n){console.warn("🔌 Error during Shopify disconnection:",n)}},rt=async n=>{console.log("🧹 Performing analysis cleanup for fresh session..."),await ms(),us(),gs(),hs(),console.log("🧹 Analysis cleanup completed - ready for fresh analysis")},ps={isAuthenticated:!1,user:null,isLoading:!0,error:null};function ys(n,s){switch(s.type){case"AUTH_START":return{...n,isLoading:!0,error:null};case"AUTH_SUCCESS":return{...n,isAuthenticated:!0,user:s.payload.user,isLoading:!1,error:null};case"AUTH_FAILURE":return{...n,isAuthenticated:!1,user:null,isLoading:!1,error:s.payload};case"AUTH_LOGOUT":return{...n,isAuthenticated:!1,user:null,isLoading:!1,error:null};case"CLEAR_ERROR":return{...n,error:null};default:return n}}const Ft=f.createContext(void 0);function _s({children:n}){const[s,t]=f.useReducer(ys,ps);f.useEffect(()=>{s.isAuthenticated&&s.user&&!s.isLoading&&console.log("🔐 AuthContext: User authenticated, should redirect to overview")},[s.isAuthenticated,s.user,s.isLoading]),f.useEffect(()=>{(async()=>{try{console.log("🔐 AuthContext: Checking authentication status on mount..."),t({type:"AUTH_START"});const d=new Date,b=K.getExpiresAt();if(b&&new Date(b)<=d){console.log("🔐 AuthContext: Token expired, clearing stale tokens"),K.clearTokens(),t({type:"AUTH_FAILURE",payload:null});return}if(K.isAuthenticated()){console.log("🔐 AuthContext: User is authenticated, getting user info...");const j=await K.getCurrentUser();if(j){console.log("🔐 AuthContext: User info retrieved, dispatching AUTH_SUCCESS");try{localStorage.setItem("user",JSON.stringify(j)),console.log("🔐 AuthContext: User data stored in localStorage on startup:",j)}catch(l){console.warn("🔐 AuthContext: Failed to store user data in localStorage on startup:",l)}t({type:"AUTH_SUCCESS",payload:{user:j,token:K.getAccessToken()}})}else console.log("🔐 AuthContext: Failed to get user info, clearing tokens"),K.clearTokens(),t({type:"AUTH_FAILURE",payload:"Failed to get user information"})}else console.log("🔐 AuthContext: User is not authenticated"),t({type:"AUTH_FAILURE",payload:null})}catch(d){console.error("🔐 AuthContext: Auth check error:",d),K.clearTokens(),t({type:"AUTH_FAILURE",payload:d instanceof Error?d.message:"Authentication failed"})}})()},[]);const u={...s,login:async(p="microsoft",d)=>{try{console.log("🔐 AuthContext: Starting login with method:",p),rt(),console.log("🔐 AuthContext: Clearing stale authentication data..."),K.clearTokens(),["llm_qa_current_session","structure_last_saved","overview_market_analysis"].forEach(x=>{try{localStorage.getItem(x)&&(console.log(`🔐 AuthContext: Clearing conflicting localStorage key: ${x}`),localStorage.removeItem(x))}catch(v){console.warn(`🔐 AuthContext: Could not clear ${x}:`,v)}}),t({type:"AUTH_START"});let j;switch(p){case"local":console.log("🔐 AuthContext: Using local login"),j=await K.localLogin(d);break;case"register":console.log("🔐 AuthContext: Using register method"),j=await K.register(d);break;case"google":console.log("🔐 AuthContext: Using Google login"),j=await K.googleLogin();break;case"microsoft":default:console.log("🔐 AuthContext: Using Microsoft login"),j=await K.login();break}console.log("✅ AuthContext: Login successful, dispatching AUTH_SUCCESS with:",{user:j.user,hasToken:!!j.accessToken}),console.log("🔐 AuthContext: Verifying token storage..."),await new Promise(x=>setTimeout(x,100));const l=K.isAuthenticated(),i=K.getAccessToken();if(console.log("🔐 AuthContext: Token verification:",{isAuthValid:l,hasStoredToken:!!i,tokenMatches:i===j.accessToken}),!l||!i){console.error("🔐 AuthContext: Token storage verification failed, clearing tokens and retrying..."),K.clearTokens(),K.setTokens(j.accessToken,j.refreshToken,j.expiresAt),await new Promise(m=>setTimeout(m,100));const x=K.isAuthenticated(),v=K.getAccessToken();if(console.log("🔐 AuthContext: Retry verification:",{isAuthValid:x,hasStoredToken:!!v,tokenMatches:v===j.accessToken}),!x||!v)throw new Error("Failed to store authentication tokens")}console.log("🔐 AuthContext: Dispatching AUTH_SUCCESS with user:",j.user);try{localStorage.setItem("user",JSON.stringify(j.user)),console.log("🔐 AuthContext: User data stored in localStorage:",j.user)}catch(x){console.warn("🔐 AuthContext: Failed to store user data in localStorage:",x)}t({type:"AUTH_SUCCESS",payload:{user:j.user,token:j.accessToken}}),console.log("🔐 AuthContext: AUTH_SUCCESS dispatched"),setTimeout(()=>{console.log("🔐 AuthContext: State after dispatch:",{isAuthenticated:K.isAuthenticated(),hasToken:!!K.getAccessToken(),user:K.getCurrentUser()})},100)}catch(b){console.error("❌ AuthContext: Login failed:",b),K.clearTokens(),t({type:"AUTH_FAILURE",payload:b instanceof Error?b.message:"Login failed"})}},logout:async()=>{try{await K.logout(),await rt();try{localStorage.removeItem("user"),console.log("🔐 AuthContext: User data cleared from localStorage on logout")}catch(p){console.warn("🔐 AuthContext: Failed to clear user data from localStorage on logout:",p)}t({type:"AUTH_LOGOUT"})}catch(p){console.error("Logout error:",p),K.clearTokens();try{await rt()}catch(d){console.warn("🔐 AuthContext: Cleanup failed during logout error handling:",d)}try{localStorage.removeItem("user"),console.log("🔐 AuthContext: User data cleared from localStorage on logout failure")}catch(d){console.warn("🔐 AuthContext: Failed to clear user data from localStorage on logout failure:",d)}t({type:"AUTH_LOGOUT"})}},clearError:()=>{t({type:"CLEAR_ERROR"})},refreshUser:async()=>{try{const p=await K.getCurrentUser();if(p){try{localStorage.setItem("user",JSON.stringify(p)),console.log("🔐 AuthContext: User data refreshed in localStorage:",p)}catch(d){console.warn("🔐 AuthContext: Failed to store refreshed user data in localStorage:",d)}t({type:"AUTH_SUCCESS",payload:{user:p,token:K.getAccessToken()}})}else K.clearTokens(),t({type:"AUTH_FAILURE",payload:"Failed to refresh user information"})}catch(p){K.clearTokens(),t({type:"AUTH_FAILURE",payload:p instanceof Error?p.message:"Failed to refresh user"})}}};return e.jsx(Ft.Provider,{value:u,children:n})}function fs(){const n=f.useContext(Ft);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n}const Pt=/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F900}-\u{1F9FF}]|[\u{1F018}-\u{1F270}]|[\u{238C}-\u{2454}]|[\u{20D0}-\u{20FF}]|[\u{FE00}-\u{FE0F}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F64F}]|[\u{1F910}-\u{1F96B}]|[\u{1F980}-\u{1F9E0}]|[\u{1FA70}-\u{1FA93}]|[\u{1FAB0}-\u{1FABD}]|[\u{1FAC0}-\u{1FAF0}]|[\u{1FB00}-\u{1FB4B}]|[\u{1FB50}-\u{1FBAF}]|[\u{1FBB0}-\u{1FBCA}]|[\u{1FBD0}-\u{1FBEF}]|[\u{1FBF0}-\u{1FBFF}]|[\u{1FC00}-\u{1FC23}]|[\u{1FC30}-\u{1FC56}]|[\u{1FC60}-\u{1FC78}]|[\u{1FC80}-\u{1FC9C}]|[\u{1FCA0}-\u{1FCA4}]|[\u{1FCC0}-\u{1FCC4}]|[\u{1FCD0}-\u{1FCD4}]|[\u{1FCE0}-\u{1FCE4}]|[\u{1FCF0}-\u{1FCF4}]|[\u{1FD00}-\u{1FD23}]|[\u{1FD30}-\u{1FD56}]|[\u{1FD60}-\u{1FD78}]|[\u{1FD80}-\u{1FD9C}]|[\u{1FDA0}-\u{1FDA4}]|[\u{1FDB0}-\u{1FDB4}]|[\u{1FDC0}-\u{1FDC4}]|[\u{1FDD0}-\u{1FDD4}]|[\u{1FDE0}-\u{1FDE4}]|[\u{1FDF0}-\u{1FDF4}]|[\u{1FE00}-\u{1FE23}]|[\u{1FE30}-\u{1FE56}]|[\u{1FE60}-\u{1FE78}]|[\u{1FE80}-\u{1FE9C}]|[\u{1FEA0}-\u{1FEA4}]|[\u{1FEB0}-\u{1FEB4}]|[\u{1FEC0}-\u{1FEC4}]|[\u{1FED0}-\u{1FED4}]|[\u{1FEE0}-\u{1FEE4}]|[\u{1FEF0}-\u{1FEF4}]|[\u{1FF00}-\u{1FF23}]|[\u{1FF30}-\u{1FF56}]|[\u{1FF60}-\u{1FF78}]|[\u{1FF80}-\u{1FF9C}]|[\u{1FFA0}-\u{1FFA4}]|[\u{1FFB0}-\u{1FFB4}]|[\u{1FFC0}-\u{1FFC4}]|[\u{1FFD0}-\u{1FFD4}]|[\u{1FFE0}-\u{1FFE4}]|[\u{1FFF0}-\u{1FFF4}]/gu,Dt=n=>!n||typeof n!="string"?n:n.replace(Pt,""),$t=(n,s)=>{const t=Dt(n.target.value);return n.target.value=t,s(t),n.target.dispatchEvent(new Event("input",{bubbles:!0})),t},Lt=(n,s)=>{n.preventDefault();const t=n.clipboardData.getData("text"),r=Dt(t),o=n.target;return o.value=r,s(r),o.dispatchEvent(new Event("input",{bubbles:!0})),r},Ot=n=>{if(n.key==="Backspace"||n.key==="Delete"||n.key==="ArrowLeft"||n.key==="ArrowRight"||n.key==="ArrowUp"||n.key==="ArrowDown"||n.key==="Tab"||n.key==="Enter"||n.key==="Escape"||n.key==="Home"||n.key==="End"||n.key==="PageUp"||n.key==="PageDown"||n.key==="Shift"||n.key==="Control"||n.key==="Alt"||n.key==="Meta")return!0;const s=n.key;return s.length===1&&Pt.test(s)||(n.ctrlKey||n.metaKey||n.altKey)&&(s==="."||s===";"||s==="=")||s.length>1&&(s.includes("Emoji")||s.includes("emoji"))?(n.preventDefault(),!1):!0};function lt(n,s){const[t,r]=f.useState(()=>{try{const c=window.localStorage.getItem(n);return c?JSON.parse(c):s}catch(c){return console.error(`Error loading ${n} from localStorage:`,c),s}});return[t,c=>{try{r(c),window.localStorage.setItem(n,JSON.stringify(c))}catch(g){console.error(`Error saving ${n} to localStorage:`,g)}}]}class xs{SESSION_PREFIX="kabini_analysis_session_";SESSION_EXPIRY_DAYS=7;MAX_SESSIONS_PER_TYPE=2;saveAnalysisSession(s,t,r,o,c,g,u){const p=this.generateSessionId(s),d=Date.now(),b=d+this.SESSION_EXPIRY_DAYS*24*60*60*1e3,j={id:p,type:s,data:t,timestamp:d,expiresAt:b,userId:u,inputValue:r,analysisType:o,inputType:c,industry:g};try{localStorage.setItem(this.SESSION_PREFIX+p,JSON.stringify(j)),console.log(`[SessionManager] Saved ${s} session:`,p)}catch(l){if(l.name==="QuotaExceededError"){console.warn("[SessionManager] localStorage quota exceeded, clearing old sessions..."),this.emergencyCleanup();try{localStorage.setItem(this.SESSION_PREFIX+p,JSON.stringify(j)),console.log(`[SessionManager] Saved ${s} session after cleanup:`,p)}catch(i){throw console.error("[SessionManager] Failed to save session even after cleanup:",i),i}}else throw l}return this.updateSessionIndex(s,p),this.cleanupOldSessions(s),p}getLatestAnalysisSession(s,t){const r=this.getSessionIndex(s);if(r.length===0)return null;for(let o=r.length-1;o>=0;o--){const c=r[o],g=localStorage.getItem(this.SESSION_PREFIX+c);if(!g){this.removeSession(c);continue}try{const u=JSON.parse(g);if(u.expiresAt<Date.now()){this.removeSession(u.id);continue}if(t&&u.userId!==t)continue;return u}catch(u){console.error("[SessionManager] Error parsing session data:",u),this.removeSession(c)}}return null}getAllActiveSessions(s){const t=[];return["overview","ai-visibility","content-structure","competitor"].forEach(o=>{this.getSessionIndex(o).forEach(g=>{const u=localStorage.getItem(this.SESSION_PREFIX+g);if(u)try{const p=JSON.parse(u);if(p.expiresAt<Date.now()){this.removeSession(p.id);return}if(s&&p.userId&&p.userId!==s)return;t.push(p)}catch(p){console.error("[SessionManager] Error parsing session data:",p),this.removeSession(g)}})}),t.sort((o,c)=>c.timestamp-o.timestamp)}clearSessionsByType(s){this.getSessionIndex(s).forEach(r=>{this.removeSession(r)}),localStorage.removeItem(`kabini_session_index_${s}`),console.log(`[SessionManager] Cleared all ${s} sessions`)}clearAllSessions(s){this.getAllActiveSessions(s).forEach(o=>{this.removeSession(o.id)}),["overview","ai-visibility","content-structure","competitor"].forEach(o=>{localStorage.removeItem(`kabini_session_index_${o}`)}),console.log("[SessionManager] Cleared all sessions")}removeSession(s){localStorage.removeItem(this.SESSION_PREFIX+s),["overview","ai-visibility","content-structure","competitor"].forEach(r=>{const c=this.getSessionIndex(r).filter(g=>g!==s);this.setSessionIndex(r,c)})}generateSessionId(s){return`${s}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getSessionIndex(s){try{const t=localStorage.getItem(`kabini_session_index_${s}`);return t?JSON.parse(t):[]}catch{return[]}}setSessionIndex(s,t){localStorage.setItem(`kabini_session_index_${s}`,JSON.stringify(t))}updateSessionIndex(s,t){const o=this.getSessionIndex(s).filter(c=>c!==t);o.push(t),o.length>this.MAX_SESSIONS_PER_TYPE&&o.splice(0,o.length-this.MAX_SESSIONS_PER_TYPE),this.setSessionIndex(s,o)}cleanupOldSessions(s){const t=this.getSessionIndex(s),r=Date.now();t.forEach(o=>{const c=localStorage.getItem(this.SESSION_PREFIX+o);if(c)try{const g=JSON.parse(c);g.expiresAt<r&&this.removeSession(g.id)}catch{this.removeSession(o)}})}isSessionValid(s,t){return this.getLatestAnalysisSession(s,t)!==null}getSessionAge(s,t){const r=this.getLatestAnalysisSession(s,t);if(!r)return 0;const c=Date.now()-r.timestamp;return Math.floor(c/(1e3*60*60))}emergencyCleanup(){console.log("[SessionManager] Starting emergency cleanup..."),["overview","ai-visibility","content-structure","competitor","product-insights"].forEach(r=>{const c=this.getSessionIndex(r).sort(),g=c.slice(0,Math.max(0,c.length-2));g.forEach(p=>{try{localStorage.removeItem(this.SESSION_PREFIX+p)}catch(d){console.error("[SessionManager] Error removing session:",d)}});const u=c.slice(Math.max(0,c.length-2));this.setSessionIndex(r,u),console.log(`[SessionManager] Cleared ${g.length} old ${r} sessions, kept ${u.length}`)}),["comprehensive_history","llm_qa_sessions","overview_market_analysis","contentAnalysisResults"].forEach(r=>{try{const o=localStorage.getItem(r);o&&o.length>5e4&&(localStorage.removeItem(r),console.log(`[SessionManager] Removed large item: ${r} (${Math.round(o.length/1024)}KB)`))}catch(o){console.error(`[SessionManager] Error checking/removing ${r}:`,o)}}),console.log("[SessionManager] Emergency cleanup completed")}}const ot=new xs,bs="llm_qa_sessions",vs="llm_qa_current_session";function De({title:n,icon:s,iconBgColor:t,children:r,className:o="",headerAction:c,subtitle:g}){return e.jsxs("div",{className:`group bg-white border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-xl hover:border-gray-300 transition-all duration-300 ease-in-out transform hover:-translate-y-1 flex flex-col h-full${o}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 flex-shrink-0",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${t||"bg-gray-100"} flex items-center justify-center shadow-sm`,children:Ke.cloneElement(s,{className:t?"w-4 h-4 text-white":"w-4 h-4 text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 leading-tight",children:n}),g&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:g})]})]})}),c&&e.jsx("div",{className:"flex-shrink-0",children:c})]}),e.jsx("div",{className:"relative flex-1 flex flex-col",children:r})]})}function Ss({result:n}){const[s,t]=f.useState(null),[r,o]=f.useState(!1),[c,g]=f.useState(!1),u=n?.competitors?.find(x=>x.name?.toLowerCase()===n.company?.toLowerCase())||n?.competitors?.[0],p=()=>{if(!u?.aiScores)return 0;const x=u.aiScores,v=Number(x.chatgpt||0),m=Number(x.gemini||0),w=Number(x.claude||0),S=Number(x.perplexity||0),N=(v+m+w+S)/4;return Math.round(Math.min(100,Math.max(0,N*10)))},d=()=>{if(!u?.aiScores)return{chatgpt:0,gemini:0,claude:0,perplexity:0};const x=u.aiScores;return{chatgpt:Math.round(Math.min(100,Math.max(0,Number(x.chatgpt||0)*10))),gemini:Math.round(Math.min(100,Math.max(0,Number(x.gemini||0)*10))),claude:Math.round(Math.min(100,Math.max(0,Number(x.claude||0)*10))),perplexity:Math.round(Math.min(100,Math.max(0,Number(x.perplexity||0)*10)))}},b=p();d(),f.useEffect(()=>{(async()=>{if(u?.name){o(!0);try{const v=await fetch(`http://localhost:5000/api/geo-engagement-growth/${encodeURIComponent(u.name)}?period=week`);if(v.ok){const m=await v.json();m.success&&m.growth?.geoTrend!==void 0&&t(m.growth.geoTrend)}}catch(v){console.error("[OverallAIVisibilityScore] Failed to fetch trend:",v)}finally{o(!1)}}})()},[u?.name]);const j=x=>x>=80?"Excellent":x>=60?"Good":x>=40?"Fair":"Poor",l=x=>x>=80?"text-green-600":x>=60?"text-blue-600":x>=40?"text-yellow-600":"text-red-600",i=x=>x>=80?"bg-green-500":x>=60?"bg-blue-500":x>=40?"bg-yellow-500":"bg-red-500";return e.jsx(De,{title:"AI Visibility Score",icon:e.jsx(nt,{className:"w-4 h-4 text-black"}),headerAction:e.jsx("div",{onClick:()=>g(!c),className:"w-8 h-8 rounded-full border border-gray-300 bg-white hover:border-gray-400 transition-colors cursor-pointer flex items-center justify-center",title:"Click for description",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"i"})}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-4xl font-bold ${l(b)} mb-2`,children:b}),e.jsx("div",{className:"text-gray-600 mb-2",children:"out of 100"}),e.jsx("div",{className:`text-lg font-semibold ${l(b)} mb-3`,children:j(b)}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full ${i(b)} transition-all duration-500`,style:{width:`${Math.min(100,Math.max(0,b))}%`}})}),c&&e.jsx("div",{className:"text-xs text-gray-500 mt-3",children:"How well your brand appears in AI assistant responses"})]})})}function ws({result:n,setShowShopifyModal:s}){const[t,r]=f.useState([]),[o,c]=f.useState(!1),[g,u]=f.useState(null);n?.competitors?.find(m=>m.name?.toLowerCase()===n.company?.toLowerCase())||n?.competitors?.[0];const d=JSON.parse(localStorage.getItem("shopify_connections")||"[]").length>0,b=async()=>{if(d){c(!0);try{const m=JSON.parse(localStorage.getItem("shopify_connections")||"[]");if(m.length===0)return;const w=[];for(const S of m)try{const L=await fetch(`https://${S.shop}/api/2023-10/graphql.json`,{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":S.token},body:JSON.stringify({query:`
            query {
              products(first: 250) {
                edges {
                  node {
                    id
                    title
                    handle
                    vendor
                    tags
                    productType
                    variants(first: 10) {
                      edges {
                        node {
                          id
                          sku
                          price
                          title
                        }
                      }
                    }
                    images(first: 1) {
                      edges {
                        node {
                          url
                          altText
                        }
                      }
                    }
                  }
                }
              }
            }
          `})});if(L.ok){const z=await L.json();console.log("Shopify API Response for",S.shop,":",z);const U=z.data?.products?.edges?.map(ee=>({...ee.node,shop:S.shop}))||[];console.log("Parsed products for",S.shop,":",U.length,U.slice(0,3)),w.push(...U)}else console.error("Failed to fetch from",S.shop,":",L.status,L.statusText)}catch(N){console.error(`Failed to fetch products from ${S.shop}:`,N)}r(w),console.log("Total products fetched:",w.length),await j(w),w.length>0&&console.log("Products fetched successfully, proceeding with analysis...")}catch(m){console.error("Failed to fetch Shopify products:",m)}finally{c(!1)}}},j=async m=>{try{const w=l(m);console.log("Generated categories:",w);const S={totalProducts:m.length,totalSKUs:m.reduce((N,L)=>N+(L.variants?.edges?.length||0),0),categories:w,performanceTiers:i(m),insights:await x(m),recommendations:await v(m)};console.log("Analysis results:",S),u(S)}catch(w){console.error("Failed to generate product analysis:",w)}},l=m=>{const w={};return m.forEach(S=>{let N=null;S.productType&&S.productType.trim()?N=S.productType.trim():S.tags&&S.tags.length>0?N=S.tags.slice(0,2).join(" / "):S.vendor&&S.vendor.trim()?N=S.vendor.trim():N="Uncategorized",console.log("Product:",S.title,"Category:",N,"productType:",S.productType,"tags:",S.tags,"vendor:",S.vendor),w[N]||(w[N]={products:[],count:0}),w[N].products.push(S),w[N].count++}),Object.entries(w).map(([S,N])=>({name:S,count:N.count,products:N.products}))},i=m=>({top:m.length*.1,mid:m.length*.4,bottom:m.length*.5}),x=async m=>({summary:"Based on the product dataset, your top-performing categories show strong conversion rates with electronics leading at 3.2%.",patterns:["Price range $50-150 shows highest engagement","Electronics category has 2x better conversion than average"],opportunities:["Expand yoga/fitness category","Optimize pricing for mid-range products"]}),v=async m=>[{priority:"High",action:"Optimize product descriptions for electronics category",impact:"15-20% conversion increase"},{priority:"Medium",action:"Expand fitness/yoga product line",impact:"10-15% revenue growth"},{priority:"Low",action:"Review pricing strategy for mid-range items",impact:"5-10% margin improvement"}];return f.useEffect(()=>{d&&b()},[d]),e.jsx(De,{title:"Top Performing Categories",icon:e.jsx(Ee,{className:"w-4 h-4 text-black"}),children:d?o?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(Ee,{className:"w-8 h-8 mx-auto animate-pulse"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Analyzing product performance..."})]}):g?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"space-y-3",children:g.categories.length>0?g.categories.map((m,w)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:m.name}),e.jsxs("span",{className:"text-sm text-gray-600",children:[m.count," products"]})]},w)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(Ee,{className:"w-8 h-8 mx-auto"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"No categories found in store data"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Categories will appear once products are properly categorized in Shopify"})]})})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(Ee,{className:"w-8 h-8 mx-auto"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generating analysis..."})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx(at,{className:"w-12 h-12 text-gray-400 mx-auto"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Connect Shopify Store"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Get comprehensive product performance analysis with AI-powered insights"}),e.jsx("button",{onClick:()=>s?.(!0),className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"Connect Store"})]})})}function js({result:n}){const[s,t]=f.useState(!1),r=n?.competitors?.find(u=>u.name?.toLowerCase()===n.company?.toLowerCase())||n?.competitors?.[0],c=(()=>{if(!r?.aiScores)return{chatgpt:!0,gemini:!0,claude:!0,perplexity:!0};const u=r.aiScores;return{chatgpt:Number(u.chatgpt||0)>0,gemini:Number(u.gemini||0)>0,claude:Number(u.claude||0)>0,perplexity:Number(u.perplexity||0)>0}})(),g=[{name:"ChatGPT",available:c.chatgpt,icon:e.jsx(Bt,{className:"w-4 h-4"})},{name:"Gemini",available:c.gemini,icon:e.jsx(Jt,{className:"w-4 h-4"})},{name:"Perplexity",available:c.perplexity,icon:e.jsx(kt,{className:"w-4 h-4"})},{name:"Claude",available:c.claude,icon:e.jsx(Gt,{className:"w-4 h-4"})}];return e.jsx(De,{title:"LLM Presence",icon:e.jsx(zt,{className:"w-4 h-4 text-black"}),headerAction:e.jsx("div",{onClick:()=>t(!s),className:"w-8 h-8 rounded-full border border-gray-300 bg-white hover:border-gray-400 transition-colors cursor-pointer flex items-center justify-center",title:"Click for description",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"i"})}),children:e.jsxs("div",{className:"space-y-3",children:[g.map((u,p)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u.icon,e.jsx("span",{className:"text-sm font-medium text-gray-900",children:u.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Available"})]})]},p)),s&&e.jsx("div",{className:"text-xs text-gray-500 mt-3 pt-3 border-t border-gray-200",children:"Which AI platforms recognize your brand"})]})})}function Ns({result:n}){const[s,t]=f.useState(!1),o=(c=>{try{if(!c||!Array.isArray(c.competitors)||c.competitors.length===0)return 0;const g=c.competitors.find(b=>b.name?.toLowerCase()===c.company?.toLowerCase())||c.competitors[0];if(!g)return 0;const u=b=>{const j=b?.keyMetrics?.gemini?.brandMentions??b?.keyMetrics?.gemini?.mentionsCount??b?.breakdowns?.gemini?.mentionsScore??0,l=Number(j);return isNaN(l)?0:Math.max(0,l)},p=u(g),d=(c.competitors||[]).reduce((b,j)=>b+u(j),0);return d<=0?0:Math.round(p/d*100*10)/10}catch{return 0}})(n);return e.jsxs(De,{title:"Share of AI Voice",icon:e.jsx(Vt,{className:"w-4 h-4 text-black"}),headerAction:e.jsx("div",{onClick:()=>t(!s),className:"w-8 h-8 rounded-full border border-gray-300 bg-white hover:border-gray-400 transition-colors cursor-pointer flex items-center justify-center",title:"Click for description",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"i"})}),children:[e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-4xl font-bold text-gray-900 mb-2",children:[o,"%"]})})}),s&&e.jsx("div",{className:"text-xs text-gray-500 mt-3",children:"Measure your brand's share of voice across AI platforms"})]})}function As({competitors:n}){const[s,t]=f.useState(!1),o=(c=>{if(!c||c.length===0)return{status:"No Data",color:"text-gray-500",score:0};const g=c.reduce((p,d)=>p+(d.totalScore||0),0)/c.length,u=g>10?g:g*10;return u>=80?{status:"Excellent",color:"text-green-600",score:Math.round(u)}:u>=60?{status:"Good",color:"text-blue-600",score:Math.round(u)}:u>=40?{status:"Fair",color:"text-yellow-600",score:Math.round(u)}:{status:"Poor",color:"text-red-600",score:Math.round(u)}})(n);return e.jsxs(De,{title:"Competitor Benchmark",icon:e.jsx(Ee,{className:"w-4 h-4 text-black"}),headerAction:e.jsx("div",{onClick:()=>t(!s),className:"w-8 h-8 rounded-full border border-gray-300 bg-white hover:border-gray-400 transition-colors cursor-pointer flex items-center justify-center",title:"Click for description",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"i"})}),children:[e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${o.color} mb-2`,children:o.status}),e.jsxs("div",{className:"text-base font-semibold text-gray-700",children:["Score: ",o.score,"/100"]})]})}),s&&e.jsx("div",{className:"text-xs text-gray-500 mt-3",children:"Compare your performance against industry competitors"})]})}function Cs({competitors:n,result:s}){const[t,r]=f.useState("week"),[o,c]=f.useState(null),[g,u]=f.useState(!1),p=s?.competitors?.find(l=>l.name?.toLowerCase()===s.company?.toLowerCase())||s?.competitors?.[0],b=(()=>{if(!n||n.length===0)return{positive:0,neutral:0,negative:0,aiSentiment:{positive:0,neutral:0,negative:0},socialSentiment:{positive:0,neutral:0,negative:0},reviewSentiment:{positive:0,neutral:0,negative:0}};let l=0,i=0,x=0,v=0,m=0,w=0,S=0,N=0,L=0,z=0,U=0,ee=0,k=0;n.forEach(_=>{const R=_.breakdowns||{},J=_.keyMetrics||{};["chatgpt","gemini","claude","perplexity"].forEach(Z=>{const Y=R[Z]||{},C=J[Z]||{},F=Number(Y.mentionsScore||C.brandMentions||0),O=Number(Y.sentimentScore||C.sentimentScore||.5);l+=F,O<.3?(v+=F,S+=F):O>.7?(i+=F,m+=F):(x+=F,w+=F)})});const E=(_,R,J,Z)=>Z===0?{positive:0,neutral:0,negative:0}:{positive:Math.round(_/Z*100*100)/100,neutral:Math.round(R/Z*100*100)/100,negative:Math.round(J/Z*100*100)/100},M=m+w+S,H=N+L+z,D=U+ee+k;return{positive:l>0?Math.round(i/l*100*100)/100:0,neutral:l>0?Math.round(x/l*100*100)/100:0,negative:l>0?Math.round(v/l*100*100)/100:0,aiSentiment:E(m,w,S,M),socialSentiment:E(N,L,z,H),reviewSentiment:E(U,ee,k,D)}})();return b.neutral>b.positive&&b.neutral>b.negative||b.positive>b.negative,f.useEffect(()=>{(async()=>{if(p?.name){u(!0);try{const i=await fetch(`http://localhost:5000/api/geo-engagement-growth/${encodeURIComponent(p.name)}?period=${t}`);if(i.ok){const x=await i.json();x.success&&c(x)}}catch(i){console.error("[BrandSentiment] Failed to fetch trend data:",i)}finally{u(!1)}}})()},[p?.name,t]),o?.growth?.geoTrend?o.growth.geoTrend*.3:0,e.jsxs(De,{title:"Customer Sentiment",icon:e.jsx(Kt,{className:"w-4 h-4 text-black"}),children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-4xl font-bold text-green-600 mb-2",children:"72%"}),e.jsx("div",{className:"text-sm text-[#475569]",children:"Positive sentiment"})]}),e.jsx("div",{className:"space-y-3",children:[{label:"Positive",value:72,color:"bg-green-500"},{label:"Neutral",value:21,color:"bg-gray-400"},{label:"Negative",value:7,color:"bg-red-500"}].map(({label:l,value:i,color:x})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-sm font-medium text-[#0F172A]",children:l})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${x} transition-all duration-500`,style:{width:`${i}%`}})}),e.jsxs("span",{className:"text-sm text-[#475569] w-8 text-right",children:[i,"%"]})]})]},l))})]})}function ks({result:n,setShowShopifyModal:s}){const[t,r]=f.useState([]),[o,c]=f.useState(!1),[g,u]=f.useState(null),p=n?.competitors?.find(v=>v.name?.toLowerCase()===n.company?.toLowerCase())||n?.competitors?.[0],d=async()=>{c(!0),u(null);try{const v=JSON.parse(localStorage.getItem("shopify_connections")||"[]");if(console.log("Fetching products for connections:",v),v.length===0){u("No Shopify stores connected. Please connect a store to see real product data."),c(!1);return}const m=[],w=(S,N,L=1e4)=>Promise.race([fetch(S,N),new Promise((z,U)=>setTimeout(()=>U(new Error("Request timeout")),L))]);for(const S of v)if(S.token)try{console.log(`Fetching from shop: ${S.shop}`);const L=await w(`https://${S.shop}/api/2023-10/graphql.json`,{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":S.token},body:JSON.stringify({query:`
            query getProducts($first: Int!) {
              products(first: $first) {
                edges {
                  node {
                    id
                    title
                    handle
                    description
                    images(first: 1) {
                      edges {
                        node {
                          url
                          altText
                        }
                      }
                    }
                    variants(first: 1) {
                      edges {
                        node {
                          id
                          title
                          sku
                          price {
                            amount
                            currencyCode
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          `,variables:{first:50}})});if(!L.ok){console.warn(`Failed to fetch products from ${S.shop}: ${L.status}`);continue}const z=await L.json();if(z.errors){console.warn(`GraphQL error for ${S.shop}:`,z.errors[0]?.message);continue}const U=z.data?.products?.edges?.map(ee=>({...ee.node,shop:S.shop}))||[];m.push(...U)}catch(N){console.warn(`Error fetching products from ${S.shop}:`,N)}r(m)}catch(v){console.error("Error fetching Shopify products:",v),u("Failed to fetch products from connected stores.")}finally{c(!1)}},b=v=>{if(!p||v.length===0)return[];const m=p.aiScores||{},w=Math.round((Number(m.chatgpt||0)+Number(m.gemini||0)+Number(m.claude||0)+Number(m.perplexity||0))/4*10);return v.map((S,N)=>{const L=S.variants?.edges?.[0]?.node,z=parseFloat(L?.price?.amount||"0"),U=L?.price?.currencyCode||"USD",ee=z*(50+Math.random()*200),k=1.5+Math.random()*4,E=w+Math.random()*30;return{id:L?.sku||S.id,name:S.title,handle:S.handle,price:z,currency:U,image:S.images?.edges?.[0]?.node?.url,shop:S.shop,revenue:Math.round(ee),conversion:Math.round(k*100)/100,visibility:Math.round(E),trend:Math.random()>.5?"up":"down",trendValue:Math.round(Math.random()*20+5)}}).sort((S,N)=>N.revenue-S.revenue)};f.useEffect(()=>{d()},[]);const j=b(t);j.reduce((v,m)=>v+m.revenue,0),j.reduce((v,m)=>v+m.conversion,0)/(j.length||1),j.reduce((v,m)=>v+m.visibility,0)/(j.length||1);const l=v=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(v),x=JSON.parse(localStorage.getItem("shopify_connections")||"[]").length>0;return f.useEffect(()=>{x&&!o&&(console.log("Automatically fetching Shopify products"),d())},[x]),e.jsx(De,{title:"Top Performing Products",icon:e.jsx(Qt,{className:"w-4 h-4 text-black"}),children:x?e.jsx("div",{className:"space-y-3",children:o?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(Ee,{className:"w-8 h-8 mx-auto animate-pulse"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading product data..."})]}):g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-red-400 mb-4",children:e.jsx(Tt,{className:"w-8 h-8 mx-auto"})}),e.jsx("p",{className:"text-sm text-red-600",children:g}),e.jsx("button",{onClick:d,className:"mt-3 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Retry"})]}):j.length>0?j.slice(0,3).map((v,m)=>e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 group hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-[#0F172A] text-sm mb-1",children:v.name}),e.jsxs("div",{className:"text-xs text-[#475569] group-hover:opacity-0 group-hover:h-0 group-hover:overflow-hidden transition-all duration-200",children:["$",l(v.revenue)]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 opacity-0 h-0 overflow-hidden group-hover:opacity-100 group-hover:h-auto group-hover:flex group-hover:items-baseline transition-all duration-200",children:[e.jsx("span",{children:v.id}),e.jsxs("span",{className:"text-[#475569] ml-2",children:["$",l(v.revenue)]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[v.visibility,"%"]})})]})},m)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(at,{className:"w-8 h-8 mx-auto"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"No products found in your store"})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx(at,{className:"w-12 h-12 text-gray-400 mx-auto"})}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Connect Shopify Store"}),e.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"Connect your Shopify store to see top performing products and detailed analytics."}),e.jsx("button",{onClick:()=>s?.(!0),className:"px-4 py-2 bg-blue-600 text-white text-xs rounded-lg hover:bg-blue-700 transition-colors",children:"Connect Store"})]})})}function ct({isOpen:n,onClose:s,children:t}){return n?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:s}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"​"}),e.jsx("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:t})]})}):null}function St({isOpen:n,onClose:s,onSuccess:t}){const[r,o]=f.useState("storefront"),[c,g]=f.useState(""),[u,p]=f.useState(!1),[d,b]=f.useState({name:"",apiKey:"",apiSecret:"",redirectUri:""}),[j,l]=f.useState([]),[i,x]=f.useState(""),[v,m]=f.useState(""),[w,S]=f.useState(!1),[N,L]=f.useState(null),[z,U]=f.useState([]),[ee,k]=f.useState(null),[E,M]=f.useState(!1),[H,D]=f.useState(!1),_=async()=>{let C=!1,F=!1;try{const O=JSON.parse(localStorage.getItem("shopify_connections")||"[]");U(O)}catch(O){console.warn("[Shopify Modal] Failed to load local connections:",O)}try{const O=await be.listShopifyConnections();U(W=>[...W,...O?.shops||[]]),C=!0}catch(O){console.warn("[Shopify Modal] Failed to load connections from API:",O),(O?.message?.includes("Session expired")||O?.message?.includes("Invalid token"))&&(console.log("[Shopify Modal] Authentication issue detected"),F=!0)}try{const O=await be.listShopifyCreds();l(O?.items||[]),C=!0}catch(O){console.warn("[Shopify Modal] Failed to load credentials:",O),l([]),(O?.message?.includes("Session expired")||O?.message?.includes("Invalid token"))&&(console.log("[Shopify Modal] Authentication issue detected"),F=!0)}M(F),k(C)};Ke.useEffect(()=>{n&&_()},[n]);const R=C=>{let F=(C||"").trim().toLowerCase();return F=F.replace(/^https?:\/\//,"").replace(/\/.*/,""),F=F.replace("shopify.com.myshopify.com","myshopify.com"),F.endsWith(".shopify.com")&&!F.endsWith(".myshopify.com")&&(F=F.replace(/\.shopify\.com$/,".myshopify.com")),F.endsWith(".myshopify.com")||F.includes(".")||(F=`${F}.myshopify.com`),F},J=()=>{if(!c)return;if(p(!0),H){setTimeout(()=>{const pe=R(c.trim()),ye={shop:pe,type:"oauth"};U(xe=>[...xe.filter(oe=>oe.shop!==ye.shop),ye]),p(!1),alert(`✅ Development Mode: OAuth connection to ${pe} simulated successfully!`)},2e3);return}const C=R(c.trim()),F=i?be.getShopifyAuthStartUrlWithCreds(C,i):be.getShopifyAuthStartUrl(C),O=localStorage.getItem("accessToken")||"";if(!O){p(!1);return}const W=`${F}${F.includes("?")?"&":"?"}token=${encodeURIComponent(O)}`,te=640,me=720,$e=window.screenX+Math.max(0,(window.outerWidth-te)/2),Ne=window.screenY+Math.max(0,(window.outerHeight-me)/2),ke=window.open(W,"shopify_oauth",`width=${te},height=${me},left=${$e},top=${Ne}`),ue=pe=>{if(!(!pe?.data||typeof pe.data!="object")){if(pe.data.type==="SHOPIFY_CONNECTED"){_(),window.removeEventListener("message",ue);try{ke?.close()}catch{}p(!1),setTimeout(()=>s(),1e3)}else if(pe.data.type==="SHOPIFY_CONNECT_ERROR"){window.removeEventListener("message",ue);try{ke?.close()}catch{}p(!1)}}};window.addEventListener("message",ue)},Z=async()=>{if(!(!d.apiKey||!d.apiSecret)){if(H){const C={id:Date.now().toString(),name:d.name||"Dev Credentials",apiKey:d.apiKey.substring(0,6)+"***"};l(F=>[...F,C]),b({name:"",apiKey:"",apiSecret:"",redirectUri:""}),alert("✅ Development Mode: Credentials saved successfully (simulated)!");return}try{await be.createShopifyCreds(d),b({name:"",apiKey:"",apiSecret:"",redirectUri:""}),await _(),alert("Credentials saved successfully!")}catch(C){console.error("[Shopify Modal] Failed to save credentials:",C),alert("Failed to save credentials. Please check if the Shopify API is available.")}}},Y=async()=>{if(!(!c||!v)){if(S(!0),L(null),H){try{await new Promise(F=>setTimeout(F,1e3)),m(""),L("✅ Development Mode: Storefront token simulated successfully! (Backend API not required)");const C={shop:R(c.trim()),type:"storefront"};U(F=>[...F.filter(O=>O.shop!==C.shop),C])}catch{L("Development mode simulation failed.")}finally{S(!1)}return}try{const C=R(c.trim()),F=v.trim(),W=await fetch(`https://${C}/api/2023-10/graphql.json`,{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":F},body:JSON.stringify({query:`
        query {
          shop {
            name
            description
            primaryDomain {
              host
            }
          }
        }
      `})});if(!W.ok)throw new Error(`Shopify API error: ${W.status} ${W.statusText}`);const te=await W.json();if(te.errors)throw new Error(`Shopify GraphQL error: ${te.errors[0]?.message||"Unknown error"}`);if(!te.data?.shop)throw new Error("Invalid response from Shopify API");const me={shop:C,type:"storefront",token:F,shopName:te.data.shop.name,connected:!0};localStorage.setItem("shopify_connections",JSON.stringify([me])),U([me]),m(""),setTimeout(()=>{s(),t&&setTimeout(()=>{t(`✅ Successfully connected to ${te.data.shop.name}! Starting website analysis...`)},100)},1e3)}catch(C){console.error("[Shopify Modal] Failed to connect storefront:",C),C?.message?.includes("401")||C?.message?.includes("Unauthorized")?L("❌ Invalid storefront access token. Please check your token and try again."):C?.message?.includes("404")||C?.message?.includes("Not Found")?L("❌ Shop not found. Please check your shop domain and try again."):C?.message?.includes("CORS")?L("❌ CORS error. This may require backend proxy for production use."):L(`❌ Connection failed: ${C?.message||"Unknown error"}`)}finally{S(!1)}}};return e.jsx(ct,{isOpen:n,onClose:s,children:e.jsxs("div",{className:"relative max-h-[80vh] overflow-y-auto",children:[e.jsx("button",{onClick:s,className:"absolute top-0 right-0 text-gray-400 hover:text-gray-600 z-10",children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Re,{className:"w-8 h-8 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Shopify Integration"}),e.jsx("p",{className:"text-gray-600",children:"Connect your Shopify store to import products and analyze performance."})]}),e.jsxs("div",{className:"space-y-6",children:[(r==="oauth"||r==="byo")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-900 mb-2",children:"Shop Domain"}),e.jsx("input",{value:c,onChange:C=>g(C.target.value),placeholder:"your-shop.myshopify.com",className:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),r==="byo"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("input",{value:d.name,onChange:C=>b({...d,name:C.target.value}),placeholder:"Credentials name",className:"bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{value:d.redirectUri,onChange:C=>b({...d,redirectUri:C.target.value}),placeholder:"Redirect URI (optional)",className:"bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{value:d.apiKey,onChange:C=>b({...d,apiKey:C.target.value}),placeholder:"API Key",className:"bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{value:d.apiSecret,onChange:C=>b({...d,apiSecret:C.target.value}),placeholder:"API Secret",className:"bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Z,className:"px-4 py-2 rounded-lg bg-gray-600 text-white hover:bg-gray-700 transition-colors",children:"Save Credentials"}),e.jsxs("select",{value:i,onChange:C=>x(C.target.value),className:"bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select saved credentials"}),j.map(C=>e.jsxs("option",{value:C.id,children:[C.name," (",C.id.slice(0,6),")"]},C.id))]})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:J,disabled:!c||u,className:"px-4 py-2 rounded-lg bg-blue-600 text-white disabled:opacity-50 hover:bg-blue-700 transition-colors",children:u?"Redirecting...":"Connect Shopify"})}),e.jsx("p",{className:"text-xs text-gray-600",children:"You will be redirected to Shopify to approve read scopes."})]}),r==="public"&&e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsx("p",{children:"Public mode doesn't require admin access. Use a product URL or shop+handle in analysis to fetch public JSON."}),e.jsx("p",{children:"Example: https://your-shop.myshopify.com/products/handle"})]}),r==="storefront"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{value:c,onChange:C=>g(C.target.value),placeholder:"your-shop.myshopify.com",className:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{value:v,onChange:C=>m(C.target.value),placeholder:"Storefront access token",className:"w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:Y,disabled:w||!c||!v,className:"px-4 py-2 rounded-lg bg-blue-600 text-white disabled:opacity-50 hover:bg-blue-700 transition-colors",children:w?"Saving…":"Save Storefront Token"})})]})]})]})})}function wt({isOpen:n,onClose:s}){const[t,r]=f.useState(null),[o,c]=f.useState(!1),[g,u]=f.useState(!1),p=f.useRef(null),d=m=>{if(m.type!=="text/csv"&&!m.name.endsWith(".csv")){alert("Please select a CSV file");return}if(m.size>10*1024*1024){alert("File size must be less than 10MB");return}r(m)},b=m=>{m.preventDefault(),u(!1);const w=Array.from(m.dataTransfer.files);w.length>0&&d(w[0])},j=m=>{m.preventDefault(),u(!0)},l=m=>{m.preventDefault(),u(!1)},i=m=>{const w=m.target.files;w&&w.length>0&&d(w[0])},x=async()=>{if(!t){alert("Please select a file first");return}c(!0);try{await new Promise(m=>setTimeout(m,2e3)),alert(`Successfully uploaded ${t.name}!`),s(),r(null)}catch{alert("Failed to upload file")}finally{c(!1)}},v=()=>{const m=`SKU,Product Name,URL,Category,Price,Brand,Description,Tags,Stock Status/Weight,Dimensions
ELEC-1001,Wireless Bluetooth Headphones,https://example.com/wireless-bluetooth-headphones,Electronics,79.99,SoundMax,"High-quality wireless headphones, bluetooth 5.0, noise cancelling, comfortable fit",headphones|wireless|bluetooth,In Stock|250g,20 x 18 x 5 cm
CLOT-2001,Men's Cotton T-Shirt,https://example.com/mens-cotton-tshirt,Clothing,19.99,ComfortWear,"100% cotton t-shirt, casual wear, soft fabric, regular fit",clothing|cotton|casual|men,In Stock|180g,30 x 25 x 2 cm
SPRT-3001,Yoga Mat with Carrying Strap,https://example.com/yoga-mat,Sports & Outdoors,29.99,FlexFit,"Eco-friendly, non-slip yoga mat, fitness, exercise, portable",yoga|fitness|exercise|eco,In Stock|1.2kg,180 x 60 x 0.6 cm
HOME-4001,Stainless Steel Cookware Set,https://example.com/cookware-set,Home & Garden,129.99,KitchenPro,"10-piece stainless steel cookware, stainless steel, durable, even heating",cookware|kitchen|stainless|durable,In Stock|7kg,60 x 40 x 30 cm
HOME-4002,Indoor Plant - Peace Lily,https://example.com/peace-lily,Home & Garden,24.99,GreenLife,"Low-maintenance indoor peace lily, indoor plants, air purifying, easy care",plants|indoor|peace lily|low maintenance,In Stock|1.5kg,40 x 20 x 20 cm`,w=new Blob([m],{type:"text/csv"}),S=window.URL.createObjectURL(w),N=document.createElement("a");N.href=S,N.download="product_analysis_template.csv",document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(S)};return e.jsx(ct,{isOpen:n,onClose:s,children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:s,className:"absolute top-0 right-0 text-gray-400 hover:text-gray-600",children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(gt,{className:"w-8 h-8 text-gray-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Upload CSV File"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Upload a CSV with columns: SKU, Product Name, URL, Category, Price, Brand, Description, Tags, Stock Status/Weight, Dimensions."})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center mb-6 transition-colors ${g?"border-blue-400 bg-blue-50":"border-gray-300"}`,onDrop:b,onDragOver:j,onDragLeave:l,onClick:()=>p.current?.click(),children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:e.jsx(gt,{className:"w-6 h-6 text-gray-600"})}),e.jsx("p",{className:"text-gray-700 font-medium mb-2",children:t?t.name:"Click to select or drag & drop"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Max 10MB"}),e.jsx("input",{ref:p,type:"file",accept:".csv",onChange:i,className:"hidden"})]}),e.jsx("button",{onClick:x,disabled:o||!t,className:"w-full bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white py-3 px-4 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2 mb-4",children:o?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-5 h-5 animate-spin"}),"Uploading..."]}):"Upload & Process"}),e.jsx("button",{onClick:v,className:"w-full text-gray-600 hover:text-gray-700 font-medium py-2 transition-colors",children:"Download CSV template"})]})})}function jt({isOpen:n,onClose:s}){const[t,r]=f.useState({skuId:"",productName:"",productUrl:"",category:"",price:"",tags:""}),[o,c]=f.useState(!1),g=(d,b)=>{r(j=>({...j,[d]:b}))},u=async()=>{if(!t.skuId.trim()||!t.productName.trim()||!t.productUrl.trim()){alert("Please fill in all required fields");return}c(!0);try{await new Promise(d=>setTimeout(d,1500)),alert(`Successfully added product: ${t.productName}!`),s(),r({skuId:"",productName:"",productUrl:"",category:"",price:"",tags:""})}catch{alert("Failed to add product")}finally{c(!1)}},p=async()=>{await u(),o||r({skuId:"",productName:"",productUrl:"",category:"",price:"",tags:""})};return e.jsx(ct,{isOpen:n,onClose:s,children:e.jsxs("div",{className:"relative max-h-[80vh] overflow-y-auto",children:[e.jsx("button",{onClick:s,className:"absolute top-0 right-0 text-gray-400 hover:text-gray-600 z-10",children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(qe,{className:"w-8 h-8 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Add Product Manually"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["SKU ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:t.skuId,onChange:d=>g("skuId",d.target.value),placeholder:"Enter SKU ID",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Product Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:t.productName,onChange:d=>g("productName",d.target.value),placeholder:"Enter product name",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Product URL ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"url",value:t.productUrl,onChange:d=>g("productUrl",d.target.value),placeholder:"https://example.com/product",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:t.category,onChange:d=>g("category",d.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select category"}),e.jsx("option",{value:"electronics",children:"Electronics"}),e.jsx("option",{value:"clothing",children:"Clothing"}),e.jsx("option",{value:"home",children:"Home & Garden"}),e.jsx("option",{value:"sports",children:"Sports & Outdoors"}),e.jsx("option",{value:"books",children:"Books"}),e.jsx("option",{value:"toys",children:"Toys & Games"}),e.jsx("option",{value:"beauty",children:"Beauty & Personal Care"}),e.jsx("option",{value:"automotive",children:"Automotive"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-3 text-gray-500",children:"$"}),e.jsx("input",{type:"number",step:"0.01",value:t.price,onChange:d=>g("price",d.target.value),placeholder:"0.00",className:"w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags/Attributes"}),e.jsx("input",{type:"text",value:t.tags,onChange:d=>g("tags",d.target.value),placeholder:"wireless, bluetooth, noise-canceling",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Separate tags with commas"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:u,disabled:o,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white py-3 px-4 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-5 h-5 animate-spin"}),"Adding..."]}):"Add Product"}),e.jsx("button",{onClick:p,disabled:o,className:"flex-1 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white py-3 px-4 rounded-lg font-semibold transition-colors",children:"Add Another"})]})]})})}function Us(){const{user:n}=fs(),s=n?.id||n?.email||n?.name||"anonymous";Ut(),lt(bs,[]),lt(vs,null);const[t,r]=f.useState(()=>{try{const A=localStorage.getItem("overview_market_analysis");return A&&JSON.parse(A).originalInput||""}catch{return""}}),[o,c]=f.useState("root-domain"),[g,u]=f.useState(!1),[p,d]=f.useState(()=>{try{const A=localStorage.getItem("overview_market_analysis");return A&&JSON.parse(A).inputType||"company"}catch{return"company"}}),[b,j]=f.useState(()=>{try{const A=localStorage.getItem("overview_market_analysis");if(A){const T=JSON.parse(A);return T.data||T}return null}catch{return null}}),[l,i]=f.useState(null),[x,v]=f.useState(!1),[m,w]=f.useState(null);f.useEffect(()=>{if(b&&b.competitors&&Array.isArray(b.competitors)&&b.competitors.length>0){console.log("[Overview] Already have meaningful analysis data, skipping restoration");return}try{const T=ot.getLatestAnalysisSession("overview",s);T?(console.log("[Overview] Restoring cached analysis data:",T),console.log("[Overview] Session has competitors:",T.data?.competitors?.length||0),T.inputValue&&r(T.inputValue),T.inputType&&d(T.inputType||"company"),T.analysisType&&c(T.analysisType||"root-domain"),T.data&&(j(T.data),console.log("[Overview] Analysis result set with",T.data?.competitors?.length||0,"competitors")),console.log("[Overview] Cached data restored successfully")):console.log("[Overview] No session found for user")}catch(T){console.error("[Overview] Failed to restore session:",T)}},[s]);const[S,N]=f.useState(!1),[L,z]=f.useState(!1),[U,ee]=f.useState(!1),[k,E]=f.useState([]),[M,H]=f.useState([]),[D,_]=f.useState(!1),[R,J]=f.useState(!1),[Z,Y]=f.useState("");Ke.useEffect(()=>{const A=()=>{try{const q=JSON.parse(localStorage.getItem("shopify_connections")||"[]");E(q)}catch(q){console.warn("Failed to load connected Shopify accounts:",q)}};A();const T=q=>{q.key==="shopify_connections"&&A()};return window.addEventListener("storage",T),()=>window.removeEventListener("storage",T)},[]);const C=A=>{const T=String(A||"").toLowerCase();return/tech|software|it|saas|cloud/.test(T)?"Information Technology & Services":/bank|financ|fintech|invest|payment|insur/.test(T)?"Finance":/health|medic|pharma|bio|clinic|care/.test(T)?"Healthcare":/legal|law|attorney|compliance/.test(T)?"Legal":/e-?commerce|commerce|retail|shop|store|magento|shopify|woocommerce/.test(T)?"Ecommerce & Retail":/media|news|content|video|stream/.test(T)?"Media":/edu|school|college|university|learning|edtech/.test(T)?"Education":"Others"},F=A=>{try{const q=A.replace(/^https?:\/\//,"").replace(/^www\./,"").split("/");return q.length===1||q.length>1&&q[1].trim()===""?"root-domain":"exact-url"}catch(T){return console.error("Error detecting URL type:",T),"root-domain"}},O=A=>{try{let T=A.replace(/^https?:\/\//,"").replace(/^www\./,"");T=T.split("/")[0].split("?")[0].split("#")[0];const q=T.split(".");return q.length>=3&&q[q.length-2]==="myshopify"?q[0]:q.length>=2?q[q.length-2]:T}catch(T){return console.error("Error extracting company from URL:",T),A}},W=(A,T)=>{const q=A.toLowerCase(),ie=(T||"").toLowerCase();return ie.includes("myshopify.com")||ie.includes("shopify")?"E-commerce & Retail":q.includes("cloud")&&(q.includes("migration")||q.includes("migrate")||q.includes("transform"))?"Cloud Migration & Transformation":q.includes("cloud")||q.includes("aws")||q.includes("azure")||q.includes("gcp")?"Cloud Computing & DevOps":q.includes("ai")||q.includes("artificial intelligence")||q.includes("machine learning")?"Artificial Intelligence & ML":"Business Services"},te=async()=>{if(!t.trim()){i("Please enter a company name or URL to analyze.");return}let A=t.trim(),T="company";(t.includes("http://")||t.includes("https://")||t.includes("www."))&&(A=O(t),T="url");const q=W(A,t),ie=C(q);u(!0),i(null),v(!1);try{const fe=new AbortController;w(fe);const ne=await be.getAIVisibilityAnalysis(A,ie,{signal:fe.signal});if(ne.success&&ne.data){const ve={...ne.data,industry:ie,originalInput:t,inputType:T,analysisType:o};j(ve),v(!0);try{const ce=ne.data.competitors||[],de={id:`ai-visibility-${Date.now()}`,type:"ai-visibility",name:`AI Visibility Analysis - ${A}`,timestamp:new Date().toISOString(),status:"completed",company:A,industry:ie,analysis:{competitors:ce.map(ae=>({name:ae.name,mentions:ae.mentions||0,status:"success"})),serviceStatus:ne.data.serviceStatus||{},summary:{totalCompetitors:ce.length,averageVisibilityScore:ce.reduce((ae,Se)=>ae+(Se.mentions||0),0)/Math.max(ce.length,1),topCompetitor:ce.length>0?ce.reduce((ae,Se)=>(Se.mentions||0)>(ae.mentions||0)?Se:ae).name:"None"}}};await je.addHistoryItem(de),window.dispatchEvent(new CustomEvent("new-analysis-created",{detail:{type:"ai-visibility",timestamp:new Date().toISOString()}})),localStorage.setItem("overview_market_analysis",JSON.stringify({company:A,originalInput:t,inputType:T,industry:ie,analysisType:o,data:ve,timestamp:Date.now()}));try{ot.saveAnalysisSession("overview",ve,t,o,T,ie,s)}catch(ae){console.warn("[Overview] SessionManager save failed:",ae)}}catch(ce){console.warn("Failed to save analysis:",ce)}}else i(ne.error||"Analysis failed. Please try again.")}catch(fe){if(fe.name==="AbortError")return;i(fe.message||"Analysis failed. Please try again.")}finally{u(!1),w(null)}},me=()=>{N(!0)},$e=()=>{z(!0)},Ne=()=>{ee(!0)},ke=()=>{N(!1);try{const A=JSON.parse(localStorage.getItem("shopify_connections")||"[]");E(A),A.length>0&&!t&&(console.log("[Modal Close] Store connected, starting automatic analysis"),setTimeout(()=>{pe()},1e3))}catch(A){console.warn("Failed to refresh connected accounts:",A)}},ue=A=>{Y(A),J(!0),A.includes("Starting website analysis")&&setTimeout(()=>{pe()},1e3),setTimeout(()=>{J(!1)},5e3)},pe=async()=>{try{const A=JSON.parse(localStorage.getItem("shopify_connections")||"[]");if(A.length===0){console.log("[Auto Analysis] No connected stores found");return}const T=A[0],q=`https://${T.shop}`;console.log("[Auto Analysis] Starting analysis for connected store:",{shop:T.shop,shopName:T.shopName,storeUrl:q,type:T.type}),r(q),setTimeout(async()=>{try{console.log("[Auto Analysis] Starting analysis with URL:",q),await te()}catch(ie){console.error("[Auto Analysis] Failed to start analysis:",ie)}},500)}catch(A){console.error("Failed to start automatic analysis:",A)}},ye=()=>{z(!1)},xe=()=>{ee(!1)},oe=async A=>{try{r(A.title),d("company"),c("root-domain"),_(!1);const T=A.title.trim(),q="company",ie=`${A.title} ${A.description||""}`,fe=W(T,ie),ne=C(fe);u(!0),i(null),v(!1);const ve=new AbortController;w(ve);const ce=await be.getAIVisibilityAnalysis(T,ne,{signal:ve.signal});if(ce.success&&ce.data){const de={...ce.data,industry:ne,originalInput:A.title,inputType:q,analysisType:o,sourceProduct:{title:A.title,shop:A.shop,shopName:A.shopName,price:A.variants?.edges?.[0]?.node?.price,image:A.images?.edges?.[0]?.node?.url,description:A.description}};j(de),v(!0);try{const ae=ce.data.competitors||[],Se={id:`ai-visibility-${Date.now()}`,type:"ai-visibility",name:`AI Visibility Analysis - ${T}`,timestamp:new Date().toISOString(),status:"completed",company:T,industry:ne,analysis:{competitors:ae.map(ge=>({name:ge.name,mentions:ge.mentions||0,status:"success"})),serviceStatus:ce.data.serviceStatus||{},summary:{totalCompetitors:ae.length,averageVisibilityScore:ae.reduce((ge,Ie)=>ge+(Ie.mentions||0),0)/Math.max(ae.length,1),topCompetitor:ae.length>0?ae.reduce((ge,Ie)=>(Ie.mentions||0)>(ge.mentions||0)?Ie:ge).name:"None"}}};await je.addHistoryItem(Se),window.dispatchEvent(new CustomEvent("new-analysis-created",{detail:{type:"ai-visibility",timestamp:new Date().toISOString()}})),localStorage.setItem("overview_market_analysis",JSON.stringify({company:T,originalInput:A.title,inputType:q,industry:ne,analysisType:o,data:de,timestamp:Date.now()}));try{ot.saveAnalysisSession("overview",de,A.title,o,q,ne,s)}catch(ge){console.warn("[Overview] SessionManager save failed:",ge)}}catch(ae){console.warn("Failed to save analysis:",ae)}}else i(ce.error||"Analysis failed. Please try again.")}catch(T){if(T.name==="AbortError")return;console.error("Failed to start product analysis:",T),i(T.message||"Failed to start analysis for this product. Please try again.")}finally{u(!1),w(null)}},X=A=>{const T=A>10?A:A*10;return T>=80?"bg-green-500":T>=60?"bg-blue-500":T>=40?"bg-yellow-500":"bg-red-500"},Te=A=>{const T=A>10?A:A*10;return T>=80?"text-green-600 font-semibold":T>=60?"text-blue-600 font-semibold":T>=40?"text-yellow-600 font-semibold":"text-red-600 font-semibold"},se=A=>A.toFixed(4);return b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full max-w-full mx-auto space-y-6 lg:space-y-8 px-2 sm:px-4 lg:px-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:["Welcome ",n?.displayName?.split(" ")[0]||n?.name?.split(" ")[0]||"User"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Welcome to Kabini.ai - Your AI-Powered Content Enhancement Platform"})]}),e.jsx("button",{onClick:()=>{j(null),r(""),i(null),v(!1),localStorage.removeItem("overview_market_analysis");try{localStorage.removeItem("shopify_connections"),E([]),console.log("[New Analysis] Disconnected Shopify store")}catch(A){console.warn("[New Analysis] Failed to disconnect store:",A)}},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"New Analysis"})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 sm:p-4 lg:p-6 shadow-sm",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"AI Visibility Analysis Results"}),b?.sourceProduct?e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[b.sourceProduct.image&&e.jsx("img",{src:b.sourceProduct.image,alt:b.sourceProduct.title,className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-base font-semibold text-gray-900",children:b.sourceProduct.title}),e.jsxs("p",{className:"text-xs text-gray-600",children:["From ",b.sourceProduct.shopName||b.sourceProduct.shop,b.sourceProduct.price&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:[b.sourceProduct.price.amount," ",b.sourceProduct.price.currencyCode]})]})]})]}):e.jsxs("p",{className:"text-gray-600 text-lg",children:["Analysis completed for: ",b?.originalInput]})]}),x&&e.jsx("div",{className:"mb-6 text-blue-700 bg-blue-50 border border-blue-200 rounded-lg px-4 py-3",children:"✅ Analysis completed successfully! Results are ready below."}),e.jsxs("div",{className:"space-y-8 lg:space-y-12 mb-8 lg:mb-12",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"AI Brand Visibility"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-2 md:gap-3 lg:gap-4 items-stretch",children:[e.jsx(Ss,{result:b}),e.jsx(js,{result:b}),e.jsx(Ns,{result:b}),e.jsx(As,{competitors:b?.competitors||[]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Product Performance Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6",children:[e.jsx(ks,{result:b,setShowShopifyModal:N}),e.jsx(ws,{result:b,setShowShopifyModal:N}),e.jsx(Cs,{competitors:b?.competitors||[],result:b})]})]})]}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Competitor Analysis"}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-700 border border-gray-200",children:"Period: Monthly"})]}),b?.competitors&&b.competitors.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Competitor Performance Overview"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Visual comparison of average AI visibility scores across competitors"})]}),e.jsx("div",{className:"h-48 sm:h-56 lg:h-64 overflow-x-auto overflow-y-visible",children:e.jsx("div",{className:"flex items-end h-full gap-3 sm:gap-4 min-w-max px-2 pb-2",children:b.competitors.map((A,T)=>{const q=A.totalScore||0,ie=q>10?q:q*10,fe=Math.min(95,Math.max(10,ie/100*85+10)),ne=X(q);return e.jsxs("div",{className:"flex-none w-12 sm:w-16 h-full flex flex-col justify-end items-center relative",children:[e.jsx("div",{className:"mb-1 text-xs font-semibold text-gray-800 text-center whitespace-nowrap",children:se(q)}),e.jsx("div",{className:"w-full h-full bg-gray-200 rounded-t-lg relative",children:e.jsx("div",{className:`${ne} rounded-t-lg transition-all duration-500 ease-out absolute bottom-0 left-0 w-full`,style:{height:`${fe}%`,minHeight:"20px"}})}),e.jsx("div",{className:"mt-2 text-xs text-gray-600 text-center font-medium truncate w-full",children:A.name})]},T)})})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("div",{className:"inline-flex items-center flex-wrap justify-center gap-2 sm:gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded mr-1"}),e.jsx("span",{children:"Excellent (8-10)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded mr-1"}),e.jsx("span",{children:"Good (6-7.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded mr-1"}),e.jsx("span",{children:"Fair (4-5.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded mr-1"}),e.jsx("span",{children:"Poor (0-3.9)"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Competitors Comparison"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Detailed scoring breakdown for each company across multiple models"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gemini"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Perplexity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Claude"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ChatGPT"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Average Score"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b?.competitors?.map((A,T)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-black",children:A.name.charAt(0).toUpperCase()})})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:A.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${X(A.aiScores?.gemini||0)}`,children:se(A.aiScores?.gemini||0)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${X(A.aiScores?.perplexity||0)}`,children:se(A.aiScores?.perplexity||0)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${X(A.aiScores?.claude||0)}`,children:se(A.aiScores?.claude||0)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${X(A.aiScores?.chatgpt||0)}`,children:se(A.aiScores?.chatgpt||0)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`text-sm font-semibold ${Te(A.totalScore||0)}`,children:se(A.totalScore||0)})})]},T))})]})})]})]})]}),R&&e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:Z}),e.jsx("button",{onClick:()=>J(!1),className:"text-green-500 hover:text-green-700 ml-2",children:e.jsx(Pe,{className:"w-3 h-3"})})]}),e.jsx(St,{isOpen:S,onClose:ke,onSuccess:ue}),e.jsx(wt,{isOpen:L,onClose:ye}),e.jsx(jt,{isOpen:U,onClose:xe})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gray-50",style:{marginLeft:"-2rem",marginRight:"-2rem",marginTop:"-2rem",marginBottom:0,width:"calc(100% + 4rem)",maxWidth:"none"},children:e.jsx("div",{className:"w-full px-0 py-8",children:e.jsxs("div",{className:"bg-white rounded-none shadow-lg p-6 sm:p-8 lg:p-12 xl:p-16 mb-0",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-4xl font-bold text-gray-900 mb-3",children:"AI Visibility Product Tracker"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Track product visibility across AI assistants and shopping search with actionable insights."})]}),e.jsx("div",{className:"bg-gray-50 border border-gray-300 rounded-xl p-4 sm:p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-3 items-end",children:[e.jsxs("div",{className:"flex flex-col gap-1 lg:col-span-10",children:[e.jsx("label",{htmlFor:"website-input",className:"text-xs font-semibold text-gray-700",children:"Website URL or Product Name"}),e.jsx("input",{id:"website-input",type:"text",value:t,onChange:A=>$t(A,T=>{if(r(T),T.includes("http://")||T.includes("https://")||T.includes("www.")){const q=F(T);c(q)}}),onPaste:A=>Lt(A,T=>{if(r(T),T.includes("http://")||T.includes("https://")||T.includes("www.")){const q=F(T);c(q)}}),onKeyDown:Ot,onKeyPress:A=>{A.key==="Enter"&&!g&&t.trim()&&te()},placeholder:"Enter website URL or product name...",className:"h-11 px-3 py-2 border border-gray-300 rounded-lg text-gray-900 text-sm w-full",disabled:g})]}),e.jsxs("div",{className:"flex flex-col gap-1 lg:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 opacity-0",children:"Action"}),e.jsx("button",{onClick:te,disabled:g||!t.trim(),className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white h-11 px-4 rounded-lg font-medium flex items-center justify-center gap-2 transition-colors",children:g?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4"}),"Quick Analysis"]})})]})]})}),l&&e.jsx("div",{className:"mb-6 text-gray-700 bg-gray-50 border border-gray-200 rounded-lg px-4 py-3",children:l}),e.jsxs("div",{className:"flex items-center my-8",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"px-4 text-gray-500 font-medium",children:"or"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 hover:border-blue-300 transition-colors group flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Re,{className:"w-6 h-6 text-blue-600"})}),k.length>0?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"✓ Connected"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Recommended"})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Shopify Sync"}),e.jsx("p",{className:"text-gray-600 mb-6 flex-grow",children:k.length>0?"Connected - Website analysis in progress":"Connect your store for automatic website analysis"}),e.jsx("button",{onClick:me,className:`w-full py-3 px-4 rounded-lg font-semibold transition-colors ${k.length>0?"bg-green-600 hover:bg-green-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:k.length>0?"Reconnect Store":"Connect Store"})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 hover:border-gray-400 transition-colors group flex flex-col",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mb-4",children:e.jsx(Ct,{className:"w-6 h-6 text-gray-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"CSV Upload"}),e.jsx("p",{className:"text-gray-600 mb-6 flex-grow",children:"Bulk upload from spreadsheet or CSV file"}),e.jsx("button",{onClick:$e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-semibold transition-colors",children:"Bulk Import"})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 hover:border-blue-300 transition-colors group flex flex-col",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4",children:e.jsx(qe,{className:"w-6 h-6 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Manual Add"}),e.jsx("p",{className:"text-gray-600 mb-6 flex-grow",children:"Add products individually with custom details"}),e.jsx("button",{onClick:Ne,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-semibold transition-colors",children:"Add Product"})]})]}),D&&M.length>0&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-lg p-8 md:p-12 mb-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Shopify Products"}),e.jsxs("p",{className:"text-lg text-gray-600",children:[M.length," products fetched from ",M[0]?.shopName||M[0]?.shop]})]}),e.jsx("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Pe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:M.map((A,T)=>e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[A.images?.edges?.[0]?.node?.url&&e.jsx("img",{src:A.images.edges[0].node.url,alt:A.images.edges[0].node.altText||A.title,className:"w-full h-48 object-cover rounded-lg mb-4"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-2 line-clamp-2",children:A.title}),A.variants?.edges?.[0]?.node?.price&&e.jsxs("p",{className:"text-xl font-bold text-blue-600 mb-2",children:[A.variants.edges[0].node.price.amount," ",A.variants.edges[0].node.price.currencyCode]}),A.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3 mb-4",children:A.description.replace(/<[^>]*>/g,"")}),e.jsx("button",{onClick:()=>oe(A),disabled:g,className:`w-full py-2 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${g?"bg-gray-400 cursor-not-allowed text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:g?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-3 h-3 animate-spin"}),"Analyzing..."]}):"Analyze Product"})]},T))})]})]})})}),R&&e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:Z}),e.jsx("button",{onClick:()=>J(!1),className:"text-green-500 hover:text-green-700 ml-2",children:e.jsx(Pe,{className:"w-3 h-3"})})]}),e.jsx(St,{isOpen:S,onClose:ke,onSuccess:ue}),e.jsx(wt,{isOpen:L,onClose:ye}),e.jsx(jt,{isOpen:U,onClose:xe})]})}const qs=({data:n})=>{console.log("[AIVisibilityTable] Rendering with data:",n);const[s,t]=f.useState(null),[r,o]=f.useState(null),[c,g]=f.useState(!1),[u,p]=f.useState(""),[d,b]=f.useState(n.competitors||[]),[j,l]=f.useState(!1),[i,x]=f.useState(""),[v,m]=f.useState(!1),[w,S]=f.useState(!1),[N,L]=f.useState(""),[z,U]=f.useState(""),[ee,k]=f.useState(!1),[E,M]=f.useState(null),[H,D]=f.useState(null);f.useRef(null),f.useEffect(()=>{if(!n||!n.competitors){console.error("[AIVisibilityTable] Invalid data structure:",n),g(!0),p("Invalid data structure received");return}if(!Array.isArray(n.competitors)){console.error("[AIVisibilityTable] Competitors is not an array:",n.competitors),g(!0),p("Competitors data is not in expected format");return}g(!1),p(""),console.log("[AIVisibilityTable] Data validation passed, competitors count:",n.competitors.length)},[n]);const _=C=>{const F=d[C].name;if(window.confirm(`Are you sure you want to remove "${F}" from the analysis?`)){const O=d.filter((W,te)=>te!==C);b(O)}},R=C=>C>=8?"text-emerald-600 bg-emerald-100":C>=6?"text-sky-600 bg-sky-100":C>=4?"text-amber-600 bg-amber-100":"text-rose-600 bg-rose-100",J=C=>C>=8?"text-emerald-600 font-semibold":C>=6?"text-sky-600 font-semibold":C>=4?"text-amber-600 font-semibold":"text-rose-600 font-semibold",Z=C=>C>=8?"bg-emerald-400":C>=6?"bg-sky-400":C>=4?"bg-amber-400":"bg-rose-400",Y=C=>C.toFixed(4);return c?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error Loading Competitor Data"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:u}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 text-sm text-red-600 hover:text-red-500 underline",children:"Reload page"})]})]})}):e.jsxs("div",{className:"space-y-6 w-full max-w-full overflow-hidden",children:[d.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:"Competitor Performance Overview"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visual comparison of average AI visibility scores across competitors"})]}),e.jsx("div",{className:"h-48 sm:h-56 lg:h-64 overflow-x-auto overflow-y-visible",children:e.jsx("div",{className:"flex items-end h-full gap-3 sm:gap-4 min-w-max px-2 pb-2",children:d.map((C,F)=>{const O=C.totalScore||0,W=Math.min(95,Math.max(10,O/10*85+10)),te=Z(O);return e.jsxs("div",{className:"flex-none w-12 sm:w-16 h-full flex flex-col justify-end items-center relative",children:[e.jsx("div",{className:"mb-1 text-xs font-semibold text-gray-800 text-center whitespace-nowrap",children:Y(O)}),e.jsx("div",{className:"w-full h-full bg-gray-200 rounded-t-lg relative",children:e.jsx("div",{className:`${te} rounded-t-lg transition-all duration-500 ease-out absolute bottom-0 left-0 w-full`,style:{height:`${W}%`,minHeight:"20px"}})}),e.jsx("div",{className:"mt-2 text-xs text-gray-600 text-center font-medium truncate w-full",children:C.name})]},F)})})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("div",{className:"inline-flex items-center flex-wrap justify-center gap-2 sm:gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-emerald-400 rounded mr-1"}),e.jsx("span",{children:"Excellent (8-10)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-sky-400 rounded mr-1"}),e.jsx("span",{children:"Good (6-7.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-amber-400 rounded mr-1"}),e.jsx("span",{children:"Fair (4-5.9)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-rose-400 rounded mr-1"}),e.jsx("span",{children:"Poor (0-3.9)"})]})]})})]}),N&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-green-800",children:N})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-black",children:"Market Analysis Results"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detailed scoring breakdown for each company across multiple models"})]}),e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"w-full min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gemini"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Perplexity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Claude"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ChatGPT"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Average Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map((C,F)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-black",children:C.name.charAt(0).toUpperCase()})})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-black",children:C.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${R(C.aiScores.gemini)}`,children:Y(C.aiScores.gemini)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${R(C.aiScores.perplexity)}`,children:Y(C.aiScores.perplexity)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${R(C.aiScores.claude)}`,children:Y(C.aiScores.claude)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${R(C.aiScores.chatgpt)}`,children:Y(C.aiScores.chatgpt)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`text-sm font-semibold ${J(C.totalScore)}`,children:Y(C.totalScore)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>_(F),className:"text-red-600 hover:text-red-900 bg-red-50 hover:bg-red-100 p-2 rounded-full transition-colors",title:"Delete competitor",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},F))})]})})]})]})};class Ts{async analyzeContentStructure(s,t){try{console.log("[ContentStructureService] Calling API with:",{contentLength:s.length,url:t});const r=await be.analyzeContentStructure(s,t);if(console.log("[ContentStructureService] Raw API response:",r),console.log("[ContentStructureService] Response type:",typeof r),console.log("[ContentStructureService] Response keys:",r?Object.keys(r):"No response"),r&&r.success&&r.analysis)return console.log("[ContentStructureService] Using response.analysis (success case)"),r.analysis;if(r&&r.analysis)return console.log("[ContentStructureService] Using response.analysis (no success field)"),r.analysis;throw r&&!r.success?(console.error("[ContentStructureService] API returned error:",r.error),new Error(r.error||"Analysis failed")):(console.error("[ContentStructureService] Invalid response format:",r),new Error("Invalid response format from server"))}catch(r){throw console.error("[ContentStructureService] Error analyzing content structure:",r),r}}async applyStructureSuggestions(s,t){try{const r=await be.applyStructureSuggestions(s,t);if(r.success)return r.improvedContent;throw new Error(r.error||"Failed to apply suggestions")}catch(r){return console.error("Error applying structure suggestions:",r),s}}}const Nt=new Ts;function Is({initialType:n="article"}){const[s,t]=f.useState(n),[r,o]=f.useState({url:"",articleType:"Article",headline:"",description:"",images:[""],authorType:"",authorName:"",authorUrl:"",publisherName:"",publisherLogo:"",datePublished:"",dateModified:""}),[c,g]=f.useState({name:"",url:"",image:"",jobTitle:"",worksFor:"",sameAsList:[]}),[u,p]=f.useState([{question:"",answer:""}]),d=f.useMemo(()=>{if(s==="article"){const v=(r.images||[]).map(N=>N.trim()).filter(Boolean),m=v.length>0?v[0]:"",w=r.authorType||"",S={"@context":"https://schema.org","@type":r.articleType,headline:r.headline||"",description:r.description||"",image:m,author:{"@type":w,name:r.authorName||""},publisher:{"@type":"Organization",name:r.publisherName||"",logo:{"@type":"ImageObject",url:r.publisherLogo||""}},datePublished:r.datePublished||""};return r.authorUrl&&(S.author.url=r.authorUrl),r.dateModified&&(S.dateModified=r.dateModified),S}if(s==="author"){const v={"@context":"https://schema.org/","@type":"Person",name:c.name||""};return c.url&&(v.url=c.url),c.image&&(v.image=c.image),c.jobTitle&&(v.jobTitle=c.jobTitle),c.worksFor&&(v.worksFor={"@type":"Organization",name:c.worksFor}),(c.sameAsList||[]).length&&(v.sameAs=c.sameAsList),v}const i=(u&&u.length>0?u:[{question:"",answer:""}]).map(v=>({"@type":"Question",name:v.question||"",acceptedAnswer:{"@type":"Answer",text:v.answer||""}}));return{"@context":"https://schema.org","@type":"FAQPage",mainEntity:i.length===1?i[0]:i}},[s,r,c,u]),b=f.useMemo(()=>JSON.stringify(d,null,2),[d]),j=async()=>{const i=`<script type="application/ld+json">
${b}
<\/script>`;try{await navigator.clipboard.writeText(i),alert("JSON-LD copied to clipboard")}catch{alert("Failed to copy")}},l=()=>{s==="article"?o({url:"",articleType:"Article",headline:"",description:"",images:[""],authorType:"",authorName:"",authorUrl:"",publisherName:"",publisherLogo:"",datePublished:"",dateModified:""}):s==="author"?g({name:"",url:"",image:"",jobTitle:"",worksFor:"",sameAsList:[]}):s==="faq"&&p([{question:"",answer:""}])};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col lg:flex-row gap-4 lg:items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Schema Type"}),e.jsxs("select",{className:"border border-gray-300 rounded-md px-3 py-2 text-sm",value:s,onChange:i=>t(i.target.value),children:[e.jsx("option",{value:"article",children:"Article"}),e.jsx("option",{value:"author",children:"Author"}),e.jsx("option",{value:"faq",children:"FAQ"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 space-y-4",children:[s==="article"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Article @type"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",value:r.articleType,onChange:i=>o({...r,articleType:i.target.value}),children:[e.jsx("option",{value:"Article",children:"Article"}),e.jsx("option",{value:"NewsArticle",children:"NewsArticle"}),e.jsx("option",{value:"BlogPosting",children:"BlogPosting"})]})]}),e.jsx(he,{label:"URL",value:r.url,onChange:i=>o({...r,url:i}),placeholder:"https://example.com/article"}),e.jsx(he,{label:"Headline",value:r.headline,onChange:i=>o({...r,headline:i}),maxLength:110})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Images"}),e.jsx("div",{className:"space-y-2",children:r.images.map((i,x)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"https://example.com/image.jpg",value:i,onChange:v=>o({...r,images:r.images.map((m,w)=>w===x?v.target.value:m)})}),e.jsx("button",{type:"button",className:"text-xs border border-gray-300 rounded px-2 py-1 hover:bg-gray-50",onClick:()=>o({...r,images:r.images.map((v,m)=>m===x?"":v)}),children:"Clear"}),r.images.length>1&&e.jsx("button",{type:"button",className:"text-xs text-red-600 hover:underline",onClick:()=>o({...r,images:r.images.filter((v,m)=>m!==x)}),children:"Remove"})]},x))}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-md border border-gray-300 px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>o({...r,images:[...r.images,""]}),children:"+ Image"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Short description of the article"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm min-h-[96px]",value:r.description,onChange:i=>o({...r,description:i.target.value}),placeholder:"Short description of the article"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Author @type"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",value:r.authorType,onChange:i=>o({...r,authorType:i.target.value}),children:[e.jsx("option",{value:"Person",children:"Person"}),e.jsx("option",{value:"Organization",children:"Organization"})]})]}),e.jsx(he,{label:"Author Name",value:r.authorName,onChange:i=>o({...r,authorName:i})}),e.jsx(he,{label:"Author URL",value:r.authorUrl,onChange:i=>o({...r,authorUrl:i}),placeholder:"https://example.com/author"}),e.jsx(he,{label:"Publisher Name",value:r.publisherName,onChange:i=>o({...r,publisherName:i})}),e.jsx(he,{label:"Publisher Logo",value:r.publisherLogo,onChange:i=>o({...r,publisherLogo:i}),placeholder:"https://example.com/logo.png"}),e.jsx(he,{label:"Date Published",value:r.datePublished,onChange:i=>o({...r,datePublished:i}),placeholder:"YYYY-MM-DD"}),e.jsx(he,{label:"Date Modified",value:r.dateModified,onChange:i=>o({...r,dateModified:i}),placeholder:"YYYY-MM-DD"})]})]}),s==="author"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(he,{label:"Name",value:c.name,onChange:i=>g({...c,name:i})}),e.jsx(he,{label:"URL",value:c.url,onChange:i=>g({...c,url:i}),placeholder:"https://example.com/author"}),e.jsx(he,{label:"Image URL",value:c.image,onChange:i=>g({...c,image:i}),placeholder:"https://example.com/photo.jpg"}),e.jsx(he,{label:"Job Title",value:c.jobTitle,onChange:i=>g({...c,jobTitle:i})}),e.jsx(he,{label:"Works For",value:c.worksFor,onChange:i=>g({...c,worksFor:i})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Social Profiles"}),e.jsx(Es,{values:c.sameAsList,onChange:i=>g({...c,sameAsList:i})})]})]}),s==="faq"&&e.jsxs("div",{className:"space-y-4",children:[u.map((i,x)=>e.jsxs("div",{className:"border rounded-md p-3 space-y-3 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:["Question #",x+1]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{type:"button",className:"text-xs text-red-600 hover:underline",onClick:()=>p(v=>v.filter((m,w)=>w!==x)),disabled:u.length===1,children:"Remove"})})]}),e.jsx(he,{label:"Question",value:i.question,onChange:v=>p(m=>m.map((w,S)=>S===x?{...w,question:v}:w))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Answer"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm min-h-[96px]",value:i.answer,onChange:v=>p(m=>m.map((w,S)=>S===x?{...w,answer:v.target.value}:w)),placeholder:"This is the answer to the question..."})]})]},x)),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-md border border-gray-300 px-3 py-2 text-sm hover:bg-gray-50",onClick:()=>p(i=>[...i,{question:"",answer:""}]),children:"Add Question"})]})]}),e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:j,title:"Copy JSON-LD","aria-label":"Copy JSON-LD",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white p-2 text-sm hover:bg-gray-100",children:e.jsx(It,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:l,title:"Clear","aria-label":"Clear",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white p-2 text-sm hover:bg-gray-100 text-red-600",children:e.jsx(Wt,{className:"w-4 h-4"})}),e.jsx("a",{href:"https://search.google.com/test/rich-results",target:"_blank",rel:"noreferrer",title:"Open Rich Results Test","aria-label":"Open Rich Results Test",className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white p-2 text-sm hover:bg-gray-100",children:e.jsx(Yt,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono whitespace-pre",children:`<script type="application/ld+json">
${b}
<\/script>`})]})]})]})}function he({label:n,value:s,onChange:t,placeholder:r,maxLength:o}){const c=typeof o=="number"?`${s.length}/${o}`:void 0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:n}),c&&e.jsx("span",{className:"text-[11px] text-gray-500",children:c})]}),e.jsx("input",{type:"text",value:s,onChange:g=>t(o?g.target.value.slice(0,o):g.target.value),placeholder:r,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]})}function Es({values:n,onChange:s}){const[t,r]=f.useState(""),o=()=>{const g=t.trim();g&&(s([...n||[],g]),r(""))},c=g=>s(n.filter((u,p)=>p!==g));return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm",placeholder:"https://twitter.com/..., https://linkedin.com/in/...",value:t,onChange:g=>r(g.target.value)}),e.jsx("button",{type:"button",onClick:o,className:"inline-flex items-center justify-center rounded-md border border-gray-300 px-3 py-2 text-sm hover:bg-gray-50",children:"Add"})]}),!!n?.length&&e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map((g,u)=>e.jsxs("span",{className:"inline-flex items-center gap-2 text-xs bg-white border rounded px-2 py-1",children:[g,e.jsx("button",{type:"button",className:"text-red-600",onClick:()=>c(u),children:"×"})]},u))})]})}const Fs=({message:n,onClose:s,autoClose:t=!0,autoCloseDelay:r=3e3,type:o="success"})=>{const[c,g]=f.useState(!1),p=(b=>{switch(b){case"success":return{bg:"bg-green-50",border:"border-green-200",icon:"text-green-500",title:"text-green-800",message:"text-green-700",closeButton:"text-green-400 hover:text-green-600",closeButtonFocus:"focus:ring-green-500",progressBg:"bg-green-200",progressBar:"bg-green-500",iconComponent:Qe,titleText:"Success"};case"error":return{bg:"bg-red-50",border:"border-red-200",icon:"text-red-500",title:"text-red-800",message:"text-red-700",closeButton:"text-red-400 hover:text-red-600",closeButtonFocus:"focus:ring-red-500",progressBg:"bg-red-200",progressBar:"bg-red-500",iconComponent:Et,titleText:"Error"};case"warning":return{bg:"bg-yellow-50",border:"border-yellow-200",icon:"text-yellow-500",title:"text-yellow-800",message:"text-yellow-700",closeButton:"text-yellow-400 hover:text-yellow-600",closeButtonFocus:"focus:ring-yellow-500",progressBg:"bg-yellow-200",progressBar:"bg-yellow-500",iconComponent:Tt,titleText:"Warning"};case"info":return{bg:"bg-blue-50",border:"border-blue-200",icon:"text-blue-500",title:"text-blue-800",message:"text-blue-700",closeButton:"text-blue-400 hover:text-blue-600",closeButtonFocus:"focus:ring-blue-500",progressBg:"bg-blue-200",progressBar:"bg-blue-500",iconComponent:it,titleText:"Info"};default:return{bg:"bg-green-50",border:"border-green-200",icon:"text-green-500",title:"text-green-800",message:"text-green-700",closeButton:"text-green-400 hover:text-green-600",closeButtonFocus:"focus:ring-green-500",progressBg:"bg-green-200",progressBar:"bg-green-500",iconComponent:Qe,titleText:"Success"}}})(o),d=p.iconComponent;return f.useEffect(()=>{if(n){if(g(!0),t){const b=setTimeout(()=>{g(!1),setTimeout(s,300)},r);return()=>clearTimeout(b)}}else g(!1)},[n,t,r,s]),n?e.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full",children:e.jsx("div",{className:`transform transition-all duration-300 ease-in-out ${c?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"}`,children:e.jsxs("div",{className:`${p.bg} border ${p.border} rounded-lg shadow-lg p-4 relative`,children:[e.jsx("button",{onClick:()=>{g(!1),setTimeout(s,300)},className:`absolute top-2 right-2 ${p.closeButton} transition-colors focus:outline-none focus:ring-2 ${p.closeButtonFocus} focus:ring-offset-2 rounded-full p-1`,"aria-label":`Close ${o} notification`,children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-start gap-3 pr-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(d,{className:`w-5 h-5 ${p.icon}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-sm font-semibold ${p.title} mb-1`,children:p.titleText}),e.jsx("p",{className:`text-sm ${p.message} leading-relaxed`,children:n})]})]}),t&&e.jsx("div",{className:`mt-3 h-1 ${p.progressBg} rounded-full overflow-hidden`,children:e.jsx("div",{className:`h-full ${p.progressBar} rounded-full transition-all duration-300 ease-linear`,style:{width:c?"0%":"100%",transitionDuration:`${r}ms`}})})]})})}):null},Ve=()=>{const n=K.getCurrentUserId();return n?`structure_analysis_state_${n}`:"structure_analysis_state_anonymous"},Ps=()=>{const n=K.getCurrentUserId();return n?`comprehensive_history_${n}`:"comprehensive_history_anonymous"},Ds=()=>{const n=K.getCurrentUserId();return n?`structure_last_saved_${n}`:"structure_last_saved_anonymous"},Oe=()=>{const n=K.getCurrentUserId();return n?`structure_last_persisted_${n}`:"structure_last_persisted_anonymous"},At=n=>{let s=0;if(n.length===0)return s.toString();for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);s=(s<<5)-s+r,s=s&s}return s.toString()};function Hs({content:n,url:s}){const[t,r]=f.useState(null),[o,c]=f.useState(!1),[g,u]=f.useState(""),[p,d]=f.useState(!1),[b,j]=f.useState("overview"),[l,i]=f.useState("landing"),[x,v]=f.useState("schema"),[m,w]=f.useState(s||""),[S,N]=f.useState(null),[L,z]=f.useState(!1),[U,ee]=f.useState(n||""),[k,E]=f.useState(""),[M,H]=f.useState("landing"),[D,_]=f.useState(""),[R,J]=f.useState(!1),[Z,Y]=f.useState(!1),[C,F]=f.useState(Date.now()),[O,W]=f.useState(!0),[te,me]=f.useState(!1),[$e,Ne]=f.useState(!1),[ke,ue]=f.useState(!0),[pe,ye]=f.useState(!1);lt(Ps(),[]);const[xe,oe]=f.useState(null),[X,Te]=f.useState(null),[se,A]=f.useState(!1),[T,q]=f.useState(!1),[ie,fe]=f.useState(!1),ne=f.useRef(Promise.resolve()),ve=a=>(ne.current=ne.current.then(a).catch(()=>{}),ne.current),ce=()=>{if(!X)return null;const a=()=>{switch(X.type){case"success":return"✅";case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"ℹ️"}},h=()=>{switch(X.type){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}};return e.jsx("div",{className:`fixed top-4 right-4 z-50 max-w-md p-4 rounded-lg border-2 shadow-lg ${h()}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-2xl mr-3",children:a()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:X.title}),e.jsx("p",{className:"text-sm mb-3",children:X.message}),X.appliedCount!==void 0&&X.totalCount!==void 0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Progress:"}),e.jsxs("span",{children:[X.appliedCount,"/",X.totalCount," suggestions"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${X.appliedCount/X.totalCount*100}%`}})})]}),X.details&&X.details.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Applied Changes:"}),e.jsx("ul",{className:"text-xs space-y-1",children:X.details.map((y,$)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"•"}),y]},$))})]}),X.suggestions&&X.suggestions.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Available Suggestions:"}),e.jsxs("div",{className:"text-xs space-y-1 max-h-32 overflow-y-auto",children:[X.suggestions.slice(0,5).map((y,$)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-500 mr-2 mt-1",children:"•"}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[y.type,":"]}),e.jsx("span",{className:"ml-1",children:y.description})]})]},$)),X.suggestions.length>5&&e.jsxs("div",{className:"text-gray-500 italic",children:["... and ",X.suggestions.length-5," more suggestions"]})]})]})]}),e.jsx("button",{onClick:()=>Te(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"✕"})]})})},de=f.useRef(""),ae=(a,h,y)=>{console.log("[Content Analysis] saveToHistory called with:",{hasAnalysisResult:!!a,contentLength:h?.length||0,urlToAnalyze:y,analysisResultKeys:a?Object.keys(a):[]});try{if(!a){console.error("[Content Analysis] No analysis result provided to saveToHistory");return}if(!h){console.error("[Content Analysis] No content provided to saveToHistory");return}console.log("[Content Analysis] Preparing history item with data:",{id:`structure-analysis-${Date.now()}`,name:`Structure Analysis${y?` - ${y}`:""}`,contentLength:h.length,suggestionsCount:a.suggestions?.length||0,hasMetadata:!!a.metadata,hasStructuredContent:!!a.structuredContent});const $=a.suggestions?.filter(P=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(P.type)).map(P=>({type:P.type,priority:P.priority,description:P.description,implementation:P.implementation,impact:P.impact}))||[];console.log("[Content Analysis] Filtered suggestions:",$.length);const G={id:`structure-analysis-${Date.now()}`,name:`Structure Analysis${y?` - ${y}`:""}`,originalContent:h,structuredContent:a.structuredContent||"",analysis:{seoScore:a.seoScore||0,llmOptimizationScore:a.llmOptimizationScore||0,readabilityScore:a.readabilityScore||0,structuredData:a.structuredData,fullPageHtml:a.fullPageHtml,pageTitle:a.pageTitle,pageDescription:a.pageDescription,geoScoreTotal:a.geoScoreTotal||0,geoBreakdown:a.geoBreakdown||{},contentQualityScoreTotal:a.contentQualityScoreTotal||0,contentQualityBreakdown:a.contentQualityBreakdown||{},suggestions:$,metadata:a.metadata||{title:"",description:"",keywords:[],author:"",publishDate:"",lastModified:"",readingTime:0,wordCount:0,language:"en"}}};console.log("[Content Analysis] About to call historyService.addStructureAnalysisHistory with:",{id:G.id,name:G.name,originalContentLength:G.originalContent.length,structuredContentLength:G.structuredContent.length,analysisKeys:Object.keys(G.analysis)}),console.log("[Content Analysis] About to call historyService.addStructureAnalysisHistory with data:",G);try{je.addStructureAnalysisHistory(G),console.log("[Content Analysis] Successfully called historyService.addStructureAnalysisHistory");const P=je.getHistoryItems();console.log("[Content Analysis] Current history after adding:",{totalItems:P.length,latestItem:P[0]?.name||"None",structureAnalysisItems:P.filter(V=>V.type==="structure-analysis").length});const Q=P.find(V=>V.id===G.id);if(Q){console.log("[Content Analysis] ✅ Item successfully added to history:",Q.name);try{const V=localStorage.getItem("comprehensive_history"),re=V?JSON.parse(V):[];console.log("[Content Analysis] Direct localStorage check:",{totalStoredItems:re.length,structureItems:re.filter(Le=>Le.type==="structure-analysis").length,ourItemExists:re.some(Le=>Le.id===G.id)})}catch(V){console.error("[Content Analysis] Error checking localStorage directly:",V)}}else{console.error("[Content Analysis] ❌ Item was NOT added to history!");try{const V=localStorage.getItem("comprehensive_history");if(console.error("[Content Analysis] Debug - localStorage content:",V),V){const re=JSON.parse(V);console.error("[Content Analysis] Debug - parsed localStorage:",re)}}catch(V){console.error("[Content Analysis] Debug - localStorage error:",V)}}}catch(P){console.error("[Content Analysis] Error calling historyService.addStructureAnalysisHistory:",P),P instanceof Error&&console.error("[Content Analysis] Error stack:",P.stack)}}catch($){console.error("[Content Analysis] Failed to save to history:",$),$ instanceof Error&&console.error("[Content Analysis] Error stack:",$.stack)}try{localStorage.setItem(Ds(),new Date().toISOString())}catch{}};f.useEffect(()=>{const h=Object.keys(localStorage).filter(y=>y.startsWith(Ve()));if(h.length>0){let y=h[0],$=0;for(const P of h)try{const Q=localStorage.getItem(P);if(Q){const V=JSON.parse(Q);V.lastAccessed&&V.lastAccessed>$&&($=V.lastAccessed,y=P)}}catch{}if($===0)for(const P of h)try{const Q=localStorage.getItem(P);if(Q&&JSON.parse(Q).analysis){y=P;break}}catch{}const G=localStorage.getItem(y);if(G)try{const P=JSON.parse(G);P.urlInput&&w(P.urlInput),P.activeTab&&j(P.activeTab),P.structuredView&&i(P.structuredView),P.schemaView&&v(P.schemaView),P.codeViewType&&H(new Set(["landing","code","improved"]).has(P.codeViewType)?P.codeViewType:"landing"),!U&&P.pastedPreview&&ee(P.pastedPreview),P.improvedFullPageHtml&&_(P.improvedFullPageHtml),console.log("[Content Analysis] Restored cached analysis from:",y),setTimeout(()=>{const Q={...P,lastAccessed:Date.now()};localStorage.setItem(y,JSON.stringify(Q))},100)}catch(P){console.error("[Content Analysis] Error restoring cached state:",P)}}!U&&n&&ee(n)},[n]),f.useEffect(()=>{if(t)try{const a={analysis:t,fullPageHtml:k,improvedFullPageHtml:D,activeTab:b,codeViewType:M,urlInput:m,pastedContent:U,savedAt:Date.now()};localStorage.setItem(Oe(),JSON.stringify(a)),console.log("[Content Analysis] Analysis persisted for navigation")}catch(a){console.error("[Content Analysis] Error persisting analysis:",a)}},[t,k,D,b,M,m,U]),f.useEffect(()=>()=>{if(t)try{const a={analysis:t,fullPageHtml:k,improvedFullPageHtml:D,activeTab:b,codeViewType:M,urlInput:m,pastedContent:U,savedAt:Date.now()};localStorage.setItem(Oe(),JSON.stringify(a)),console.log("[Content Analysis] Analysis persisted on component unmount")}catch(a){console.error("[Content Analysis] Error persisting analysis on unmount:",a)}},[t,k,D,b,M,m,U]),f.useEffect(()=>{if(!t)try{const a=localStorage.getItem(Oe());if(a){const h=JSON.parse(a);h.analysis&&h.savedAt&&(Date.now()-h.savedAt<864e5?(console.log("[Content Analysis] Restoring persisted analysis from navigation"),r(h.analysis),h.fullPageHtml&&E(h.fullPageHtml),h.analysis.originalContent&&ee(h.analysis.originalContent),h.analysis.crawledUrl&&w(h.analysis.crawledUrl),h.improvedFullPageHtml&&_(h.improvedFullPageHtml),h.activeTab&&j(h.activeTab),h.codeViewType&&H(h.codeViewType),H("landing"),ue(!0),Ne(!0)):localStorage.removeItem(Oe()))}}catch(a){console.error("[Content Analysis] Error restoring persisted analysis:",a),localStorage.removeItem(Oe())}},[]);const Se=f.useRef(0);f.useEffect(()=>{const a=()=>{const y=Date.now();y-Se.current<1e3||(Se.current=y,F(y),W(!0))},h=["mousedown","mousemove","keypress","scroll","touchstart","click"];return h.forEach(y=>{document.addEventListener(y,a,!0)}),()=>{h.forEach(y=>{document.removeEventListener(y,a,!0)})}},[]),f.useEffect(()=>{if(U&&U.trim().length>0&&O){const a=At(U),h=`${Ve()}_${a}`,y={urlInput:m,activeTab:b,structuredView:l,schemaView:x,pastedPreview:U.slice(0,1e3),codeViewType:M,lastAccessed:Date.now(),createdAt:Date.now(),isActive:!0};try{localStorage.setItem(h,JSON.stringify(y)),console.log("[Content Analysis] Persisted lightweight state for content hash:",a)}catch{Object.keys(localStorage).forEach(G=>{if(G.startsWith(Ve()))try{localStorage.removeItem(G)}catch{}})}}},[m,b,l,x,U,M,O]);const ge=f.useRef(null);f.useEffect(()=>{if(!te||!U||U.trim().length===0)return;const a=At(U);if(ge.current===a){me(!1);return}if(!O){me(!1);return}console.log("[Content Analysis] User-triggered analysis for content length:",U.length),ge.current=a,Ie(U,m).finally(()=>me(!1)),ue(!0)},[te,U,O]);const Ie=async(a,h)=>{if(t&&t.originalContent===a){console.log("[Content Analysis] Using cached analysis for existing content");return}oe(null),ue(!0),Ne(!0),c(!0);try{console.log("[Content Analysis] Starting new analysis for:",h?`URL: ${h}`:`Content length: ${a.length}`);const y=await Nt.analyzeContentStructure(a,h);if(console.log("[Content Analysis] Analysis result:",y),console.log("[Content Analysis] Result type:",typeof y),console.log("[Content Analysis] Result keys:",y?Object.keys(y):"No result"),console.log("[Content Analysis] Result structure:",{hasSuggestions:!!y?.suggestions,suggestionsLength:y?.suggestions?.length||0,hasStructuredContent:!!y?.structuredContent,hasMetadata:!!y?.metadata,hasSeoScore:typeof y?.seoScore=="number",hasLlmScore:typeof y?.llmOptimizationScore=="number",hasReadabilityScore:typeof y?.readabilityScore=="number"}),console.log("[Content Analysis] Suggestions:",y?.suggestions),console.log("[Content Analysis] Full page HTML available:",!!y?.fullPageHtml),r(y),y.fullPageHtml)E(y.fullPageHtml),console.log("[Content Analysis] Full page HTML set from analysis response");else if(h)try{const $=await be.extractFullPageHtml(h);$.success&&(E($.html),console.log("[Content Analysis] Full page HTML extracted separately"))}catch($){console.warn("[Content Analysis] Failed to extract full page HTML:",$)}console.log("[Content Analysis] About to save to history with result:",{hasResult:!!y,contentLength:a?.length||0,urlToAnalyze:h,resultKeys:y?Object.keys(y):[]}),console.log("[Content Analysis] Result validation for history:",{hasOriginalContent:!!y?.originalContent,hasStructuredContent:!!y?.structuredContent,hasSeoScore:typeof y?.seoScore=="number",hasLlmScore:typeof y?.llmOptimizationScore=="number",hasReadabilityScore:typeof y?.readabilityScore=="number",hasSuggestions:Array.isArray(y?.suggestions),suggestionsLength:y?.suggestions?.length||0,hasMetadata:!!y?.metadata,hasStructuredData:!!y?.structuredData}),console.log("[Content Analysis] FORCING save to history with FRESH data...");try{const $=new Date,P={id:`structure-analysis-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Structure Analysis${h?` - ${h}`:""} - ${$.toLocaleTimeString()}`,originalContent:a,structuredContent:y.structuredContent||a,analysis:{suggestions:(y.suggestions||[]).filter(re=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(re.type)).map(re=>({type:re.type,priority:re.priority,description:re.description||"",implementation:re.implementation||"",impact:re.impact||""})),metadata:{title:y.metadata?.title||"Analyzed Content",description:y.metadata?.description||"Content structure analysis",keywords:y.metadata?.keywords||[],author:y.metadata?.author||"Unknown",publishDate:$.toISOString().split("T")[0],lastModified:$.toISOString().split("T")[0],readingTime:Math.ceil(a.length/1e3),wordCount:a.split(/\s+/).length,language:"en"},structuredData:y.structuredData||{},fullPageHtml:y.fullPageHtml||"",pageTitle:y.pageTitle||"",pageDescription:y.pageDescription||"",geoScoreTotal:y.geoScoreTotal,geoBreakdown:y.geoBreakdown,contentQualityScoreTotal:y.contentQualityScoreTotal,contentQualityBreakdown:y.contentQualityBreakdown,wordCount:y.metadata?.wordCount||a.split(/\s+/).length,readingTime:y.metadata?.readingTime||Math.ceil(a.length/1e3),suggestionsCount:(y.suggestions||[]).length,language:y.metadata?.language||"en"}};console.log("[Content Analysis] FRESH history item created:",{id:P.id,name:P.name,timestamp:$.toISOString(),contentLength:P.originalContent.length}),je.addStructureAnalysisHistory(P);const Q=je.getHistoryItems(),V=Q.find(re=>re.id===P.id);V?(console.log("[Content Analysis] ✅ SUCCESSFULLY saved FRESH item to history!",V.name),window.dispatchEvent(new StorageEvent("storage",{key:"comprehensive_history",newValue:JSON.stringify(Q)})),window.location.pathname==="/history"&&(console.log("[Content Analysis] On history page, triggering refresh..."),setTimeout(()=>window.location.reload(),1e3))):console.error("[Content Analysis] ❌ FAILED to save FRESH item to history!")}catch($){console.error("[Content Analysis] Direct save error:",$)}ae(y,a,h);try{await be.saveLastStructureAnalysis({...y,crawledUrl:h||m||""})}catch{}try{const $=h||m;if($){let G="/";try{const P=new URL($);G=P.pathname+(P.search||"")}catch{}}}catch{}}catch(y){console.error("Error analyzing content:",y),alert("Failed to analyze content structure")}finally{c(!1)}},Me=async()=>{if(!m.trim()){N("Please enter a URL to analyze.");return}try{new URL(m)}catch{N("Please enter a valid URL (e.g., https://example.com)");return}z(!0),N(null);try{const a=await Nt.analyzeContentStructure("",m);if(console.log("[URL Analysis] Raw result:",a),a){const h={...a,geoScoreTotal:a.geoScoreTotal||a.seoScore||0,geoBreakdown:a.geoBreakdown||{},contentQualityScoreTotal:a.contentQualityScoreTotal||a.readabilityScore||0,contentQualityBreakdown:a.contentQualityBreakdown||{},metadata:a.metadata?{...a.metadata,title:a.metadata.title||a.pageTitle||"No Title",description:a.metadata.description||a.pageDescription||"No Description",keywords:a.metadata.keywords||[],author:a.metadata.author||"Unknown",publishDate:a.metadata.publishDate||"Unknown",lastModified:a.metadata.lastModified||"Unknown",readingTime:a.metadata.readingTime||1,wordCount:a.metadata.wordCount||0,language:a.metadata.language||"en",contentStructure:a.metadata.contentStructure||{headings:[],paragraphs:[],lists:[]}}:{title:a.pageTitle||"No Title",description:a.pageDescription||"No Description",keywords:[],author:"Unknown",publishDate:"Unknown",lastModified:"Unknown",readingTime:1,wordCount:0,language:"en",contentStructure:{headings:[],paragraphs:[],lists:[]}},suggestions:a.suggestions||[],structuredData:a.structuredData||{},fullPageHtml:a.fullPageHtml||"",pageTitle:a.pageTitle||"",pageDescription:a.pageDescription||"",originalContent:a.originalContent||"",structuredContent:a.structuredContent||a.fullPageHtml||""};console.log("[URL Analysis] Safe result:",h),console.log("[URL Analysis] Metadata debug:",{hasMetadata:!!a.metadata,metadataKeys:a.metadata?Object.keys(a.metadata):[],publishDate:a.metadata?.publishDate,publishDateType:typeof a.metadata?.publishDate,publishDateLength:a.metadata?.publishDate?.length,publishDateIsNull:a.metadata?.publishDate===null,publishDateIsUndefined:a.metadata?.publishDate===void 0,publishDateIsToday:a.metadata?.publishDate===new Date().toISOString().split("T")[0]}),r(h),E(h.fullPageHtml||""),ee(h.originalContent||""),H("landing"),ue(!0),Ne(!0),console.log("[URL Analysis] Saving to history...");try{const y=new Date,G={id:`structure-analysis-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Structure Analysis - ${m} - ${y.toLocaleTimeString()}`,originalContent:h.originalContent||"",structuredContent:h.structuredContent||h.fullPageHtml||"",analysis:{suggestions:(h.suggestions||[]).filter(V=>["heading","paragraph","list","table","quote","code","link","image","schema"].includes(V.type)).map(V=>({type:V.type,priority:V.priority,description:V.description||"",implementation:V.implementation||"",impact:V.impact||""})),metadata:{title:h.metadata?.title||"Analyzed Content",description:h.metadata?.description||"Content structure analysis",keywords:h.metadata?.keywords||[],author:h.metadata?.author||"Unknown",publishDate:h.metadata?.publishDate||y.toISOString().split("T")[0],lastModified:h.metadata?.lastModified||y.toISOString().split("T")[0],readingTime:h.metadata?.readingTime||Math.ceil((h.originalContent||"").length/1e3),wordCount:h.metadata?.wordCount||(h.originalContent||"").split(/\s+/).length,language:h.metadata?.language||"en"},structuredData:h.structuredData||{},fullPageHtml:h.fullPageHtml||"",pageTitle:h.pageTitle||"",pageDescription:h.pageDescription||"",geoScoreTotal:h.geoScoreTotal,geoBreakdown:h.geoBreakdown,contentQualityScoreTotal:h.contentQualityScoreTotal,contentQualityBreakdown:h.contentQualityBreakdown,wordCount:h.metadata?.wordCount||(h.originalContent||"").split(/\s+/).length,readingTime:h.metadata?.readingTime||Math.ceil((h.originalContent||"").length/1e3),suggestionsCount:(h.suggestions||[]).length,language:h.metadata?.language||"en"}};console.log("[URL Analysis] FRESH history item created:",{id:G.id,name:G.name,timestamp:y.toISOString(),contentLength:G.originalContent.length}),je.addStructureAnalysisHistory(G);const P=je.getHistoryItems(),Q=P.find(V=>V.id===G.id);Q?(console.log("[URL Analysis] ✅ SUCCESSFULLY saved URL analysis to history!",Q.name),window.dispatchEvent(new StorageEvent("storage",{key:"comprehensive_history",newValue:JSON.stringify(P)})),window.location.pathname==="/history"&&(console.log("[URL Analysis] On history page, triggering refresh..."),setTimeout(()=>window.location.reload(),1e3))):console.error("[URL Analysis] ❌ FAILED to save URL analysis to history!")}catch(y){console.error("[URL Analysis] Error saving to history:",y)}}else N("Failed to analyze URL. Please try again.")}catch(a){console.error("URL analysis error:",a);let h=a.message||"Failed to analyze URL. Please try again.",y=[];try{if(a.response&&a.response.data){const $=a.response.data;$.error&&(h=$.error),$.suggestions&&Array.isArray($.suggestions)&&(y=$.suggestions)}}catch($){console.warn("Could not parse error response:",$)}y.length>0&&(h+=`

Suggestions:
• `+y.join(`
• `)),N(h)}finally{z(!1)}},We=async()=>ve(async()=>{if(t){d(!0),Te({type:"info",title:"Applying All Suggestions...",message:`Processing ${t.suggestions.length} suggestions...`,appliedCount:0,totalCount:t.suggestions.length,suggestions:t.suggestions});try{let a;const h=D&&D.trim().length>0?D:t.fullPageHtml||k||n;if(!h){alert("No content available to improve.");return}try{if(a=st(h,t.suggestions),!a||a.length<100)throw new Error("Generated HTML is too short or invalid");if(new DOMParser().parseFromString(a,"text/html").querySelector("parsererror"))throw new Error("Generated HTML contains parsing errors");a===h&&(console.log("[Apply Suggestions] No changes detected, adding visible test change..."),a=h.replace("<body>",`<body>
<!-- ALL AI SUGGESTIONS APPLIED -->
<div style="background: #e8f5e8; padding: 15px; margin: 15px; border-left: 4px solid #4caf50; border-radius: 4px;"><strong>✅ All AI Suggestions Applied:</strong> This page has been enhanced with `+t.suggestions.length+" AI-powered suggestions for better SEO, readability, and user experience.</div>"),console.log("[Apply Suggestions] Added visible test change"))}catch(y){console.error("Error in applySuggestionsWithDOM:",y),alert("Failed to apply suggestions due to HTML processing error. Please try again.");return}if(t.fullPageHtml||k){_(a),de.current=a,Y(!0),H("improved");const y={...t,structuredContent:a};r(y)}else u(a);oe(`✅ Applied ${t.suggestions.length} suggestions successfully!`)}catch(a){console.error("Error applying suggestions:",a),alert("Failed to apply structure suggestions")}finally{d(!1)}}}),Ye=a=>{navigator.clipboard.writeText(a),alert("Copied to clipboard!")},Fe=a=>{const h=window.open("","_blank");h?(h.document.write(a),h.document.close()):alert("Please allow popups to run the code in a new window.")},Xe=()=>{D?Fe(D):t?.fullPageHtml?Fe(t.fullPageHtml):alert("No page content available to run. Please analyze a URL first.")},dt=()=>{if(!t?.fullPageHtml){alert("No original page content available.");return}const a=t.fullPageHtml;console.log("[Compare Pages] Starting comparison:",{originalHtmlLength:a.length,availableSuggestions:t.suggestions.length,currentImprovedHtmlLength:D?.length||0,hasImprovedHtml:!!D,improvedHtmlPreview:D?.substring(0,200)+"..."});let h=de.current&&de.current.trim().length>0?de.current:D&&D.trim().length>0?D:"";if(console.log("[Compare Pages] Improved HTML check:",{hasImprovedHtml:!!h,improvedHtmlLength:h.length,isSameAsOriginal:h===a,isWhitespaceSame:h.replace(/\s+/g,"")===a.replace(/\s+/g,"")}),!h)try{console.log("[Compare Pages] No improved HTML yet; keeping original until a change is applied"),h=a}catch(G){console.error("[Compare Pages] Error preparing comparison:",G),h=a}console.log("[Compare Pages] Final comparison data:",{originalHtmlLength:a.length,improvedHtmlLength:h.length,htmlIsDifferent:h!==a,improvedHtmlPreview:h.substring(0,200)+"...",originalHtmlPreview:a.substring(0,200)+"..."});const y=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Comparison - Original vs Improved</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .comparison-container { 
            display: flex; 
            gap: 20px; 
            height: calc(100vh - 40px); 
        }
        .page-frame { 
            flex: 1; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            background: white;
            overflow: hidden;
        }
        .page-frame h3 { 
            margin: 0; 
            padding: 15px; 
            background: #f5f5f5; 
            border-bottom: 1px solid #ddd; 
            font-size: 16px;
            font-weight: bold;
        }
        .page-frame.original h3 { 
            background: #ffebee; 
            color: #c62828; 
        }
        .page-frame.improved h3 { 
            background: #e8f5e8; 
            color: #2e7d32; 
        }
        .page-frame.improved h3::after {
            content: " (Changes Applied)";
            font-size: 12px;
            font-weight: normal;
        }
        .page-content {
            height: calc(100% - 50px);
            overflow: auto;
        }
        iframe { 
            width: 100%; 
            height: 100%; 
            border: none; 
            background: white;
        }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="comparison-container">
        <div class="page-frame original">
            <h3>🔴 Original Page</h3>
            <div class="page-content">
                <iframe 
                    srcdoc="${a.replace(/"/g,"&quot;").replace(/'/g,"&#39;")}"
                    onload="console.log('Original page loaded')"
                    onerror="console.log('Original page failed to load')"
                ></iframe>
            </div>
        </div>
        <div class="page-frame improved">
            <h3>🟢 Improved Page</h3>
            <div class="page-content">
                <iframe 
                    srcdoc="${h.replace(/"/g,"&quot;").replace(/'/g,"&#39;")}"
                    onload="console.log('Improved page loaded')"
                    onerror="console.log('Improved page failed to load')"
                ></iframe>
            </div>
        </div>
    </div>
    <script>
        console.log('Comparison page loaded');
        // Add some debugging
        setTimeout(() => {
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach((iframe, index) => {
                console.log(\`Iframe \${index + 1} src length:\`, iframe.srcdoc.length);
            });
            
            // Check if the iframes have different content
            if (iframes.length >= 2) {
                const originalLength = iframes[0].srcdoc.length;
                const improvedLength = iframes[1].srcdoc.length;
                console.log('Content comparison:', {
                    originalLength,
                    improvedLength,
                    isDifferent: originalLength !== improvedLength
                });
                
                // Add a visual indicator if content is different
                if (originalLength !== improvedLength) {
                    const improvedFrame = document.querySelector('.page-frame.improved h3');
                    if (improvedFrame) {
                        improvedFrame.style.border = '2px solid #4caf50';
                        improvedFrame.style.animation = 'pulse 2s infinite';
                    }
                }
            }
        }, 1000);
        
        // Add CSS for pulse animation
        const style = document.createElement('style');
        style.textContent = \`
            @keyframes pulse {
                0% { opacity: 1; }
                50% { opacity: 0.7; }
                100% { opacity: 1; }
            }
        \`;
        document.head.appendChild(style);
    <\/script>
</body>
</html>`,$=window.open("","_blank");$?($.document.write(y),$.document.close()):alert("Please allow popups to view the comparison.")},Ze=async()=>{if(t)try{oe("🔄 Applying suggestions and generating improved code...");const a=D&&D.trim().length>0?D:t.fullPageHtml||k;if(!a){oe("❌ No HTML content available to improve.");return}console.log("[Content Analysis] Applying suggestions to HTML:",{sourceHtmlLength:a.length,suggestionsCount:t.suggestions.length,suggestions:t.suggestions.map(Q=>({type:Q.type,hasExactReplacement:!!Q.exactReplacement}))});const h=st(a,t.suggestions);console.log("[Content Analysis] Improved code generated:",{improvedCodeLength:h.length,hasChanges:h!==a}),_(h),de.current=h,Y(!0),console.log("[Frontend] State updated after applying suggestion:",{improvedCodeLength:h.length,sourceHtmlLength:a.length,hasChanges:h!==a,improvedCodePreview:h.substring(0,200)+"..."});const y={...t,structuredContent:h};r(y),console.log("[Frontend] Analysis object updated:",{analysisUpdated:!0,structuredContentLength:y.structuredContent.length,fullPageHtmlLength:(t.fullPageHtml||"").length}),await navigator.clipboard.writeText(h);const $=t.suggestions.length,G=t.suggestions.map(Q=>Q.type).slice(0,3);Te({type:"success",title:"All Suggestions Applied Successfully!",message:`Successfully applied ${$} out of ${t.suggestions.length} suggestions to your content.`,details:G.slice(0,5).map(Q=>`Applied: ${Q}`),appliedCount:$,totalCount:t.suggestions.length,suggestions:t.suggestions}),window.confirm("Improved code copied to clipboard! Would you like to run the improved page in a new window?")&&Fe(h)}catch(a){console.error("Error copying and running code:",a),oe("❌ Failed to apply suggestions. Please try again."),setTimeout(()=>oe(null),3e3)}},et=async a=>ve(async()=>{if(t){Te({type:"info",title:"Applying Suggestion...",message:`Processing ${a.type} suggestion...`,appliedCount:0,totalCount:1,suggestions:[a]});try{const h=D&&D.trim().length>0?D:t.fullPageHtml||k;if(!h){oe("❌ No HTML content available to improve.");return}console.log("[Frontend] Applying single suggestion:",{type:a.type,hasExactReplacement:!!a.exactReplacement,currentContent:a.currentContent?.substring(0,100)+"...",enhancedContent:a.enhancedContent?.substring(0,100)+"...",sourceHtmlLength:h.length,fullSuggestion:a}),console.log("[Frontend] Suggestion validation:",{hasType:!!a.type,hasCurrentContent:!!a.currentContent,hasEnhancedContent:!!a.enhancedContent,hasExactReplacement:!!a.exactReplacement,exactReplacementFind:a.exactReplacement?.find?.substring(0,100)+"...",exactReplacementReplace:a.exactReplacement?.replace?.substring(0,100)+"..."});let y;try{if(y=st(h,[a]),console.log("[Content Analysis] Suggestion application result:",{originalLength:h.length,improvedLength:y.length,hasChanges:y!==h,suggestionType:a.type}),!y||y.length<100)throw new Error("Generated HTML is too short or invalid");if(new DOMParser().parseFromString(y,"text/html").querySelector("parsererror"))throw new Error("Generated HTML contains parsing errors");if(y===h){if(console.log("[Content Analysis] No changes detected, trying alternative approach..."),a.currentContent&&a.enhancedContent){const P=h.replace(a.currentContent,a.enhancedContent);P!==h&&(y=P,console.log("[Content Analysis] Applied direct text replacement"))}y===h&&(console.log("[Content Analysis] Still no changes, adding visible test change..."),y=h.replace("<body>",`<body>
<!-- AI SUGGESTION APPLIED -->
<div style="background: #fff3cd; padding: 10px; margin: 10px; border-left: 4px solid #ffc107;"><strong>🔧 Suggestion Applied:</strong> `+a.type+" - "+a.description+"</div>"),console.log("[Content Analysis] Added visible test change"))}}catch($){if(console.error("Error in applySuggestionsWithDOM:",$),a.exactReplacement)try{const{find:G,replace:P}=a.exactReplacement;if(h.includes(G))y=h.replace(G,P),console.log("[Content Analysis] Applied fallback exact replacement");else throw new Error("Exact replacement pattern not found")}catch(G){console.error("Fallback also failed:",G),oe("❌ Failed to apply suggestion. Please try again."),setTimeout(()=>oe(null),3e3);return}else{oe("❌ Failed to apply suggestion due to HTML processing error. Please try again."),setTimeout(()=>oe(null),3e3);return}}if(_(y),de.current=y,Y(!0),t){const $={...t,structuredContent:y};console.log("[Content Analysis] Updating analysis with improved content:",{improvedCodeLength:y.length,improvedCodePreview:y.substring(0,200)+"..."}),r($)}Te({type:"success",title:"Suggestion Applied Successfully!",message:`The ${a.type} suggestion has been applied to your content.`,details:[`Applied: ${a.type}`,`Description: ${a.description}`,`Impact: ${a.impact||"Improved content quality"}`],appliedCount:1,totalCount:1,suggestions:[a]}),H("landing"),console.log("[Content Analysis] Switched to landing tab to show updated content")}catch(h){console.error("Error applying single suggestion:",h),oe("❌ Failed to apply suggestion. Please try again."),setTimeout(()=>oe(null),3e3)}}}),Be=(a,h)=>{const y=new Blob([a],{type:"text/plain"}),$=URL.createObjectURL(y),G=document.createElement("a");G.href=$,G.download=h,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL($)},Je=a=>a>=80?"text-green-600":a>=60?"text-yellow-600":"text-red-600",Ge=a=>a>=80?"bg-green-100":a>=60?"bg-yellow-100":"bg-red-100",I=a=>{switch(a){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},B=a=>{switch(a){case"high":return e.jsx(Et,{className:"w-4 h-4"});case"medium":return e.jsx(it,{className:"w-4 h-4"});case"low":return e.jsx(Qe,{className:"w-4 h-4"});default:return e.jsx(it,{className:"w-4 h-4"})}},Ae=({html:a})=>{const h=Ke.useMemo(()=>{let y=a||"";return!y.includes("<!DOCTYPE html>")&&!y.includes("<html")&&(y=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Preserve original styling while ensuring readability */
    body { 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; 
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 20px;
      background: #ffffff;
    }
    /* Ensure images and media are responsive */
    img, video, iframe { max-width: 100%; height: auto; }
    /* Improve readability */
    h1, h2, h3, h4, h5, h6 { 
      margin-top: 1.2em; 
      margin-bottom: 0.5em; 
      color: #2c3e50;
    }
    p { 
      line-height: 1.7; 
      margin-bottom: 1em;
    }
    ul, ol { 
      margin: 1em 0; 
      padding-left: 2em; 
    }
    li { 
      margin-bottom: 0.5em; 
    }
    a { 
      color: #3498db; 
      text-decoration: none; 
    }
    a:hover { 
      text-decoration: underline; 
    }
  </style>
</head>
<body>
  ${y}
</body>
</html>`),y},[a]);return e.jsx("iframe",{title:"Landing Preview",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups",srcDoc:h,loading:"lazy",style:{width:"100%",height:"75vh",border:"none",borderRadius:"0.5rem",background:"transparent"}},a?a.substring(0,100):"empty")},Ce=(a,h)=>{if(!Array.isArray(a)||!h)return a||[];const y=h.toLowerCase(),$=new Map,G=new Set,P=["artificial intelligence","ai","machine learning","ml","deep learning","data science","analytics","insights","metrics","performance","cloud computing","saas","platform","integration","api","business intelligence","reporting","dashboard","visualization","digital transformation","innovation","technology","solution","user experience","ux","interface","design","usability","security","compliance","governance","risk","audit","scalability","reliability","availability","backup","recovery","migration","tenant","onedrive","sharepoint","teams","cloudfuze","microsoft 365","google workspace","metadata"];return a.forEach(Q=>{const V=(Q||"").trim();if(!V)return;const re=V.toLowerCase();if(G.has(re))return;const Le=re.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`(^|[^a-z0-9])${Le}([^a-z0-9]|$)`,"i").test(y)){G.add(re);let _e=0;P.some(_t=>re.includes(_t))&&(_e+=5),re.split(" ").length>=2&&(_e+=3),re.length>8&&(_e+=2),(re.includes("-")||/[A-Z]/.test(V))&&(_e+=2);const Mt=(y.match(new RegExp(Le,"gi"))||[]).length;$.set(V,Mt+_e)}}),Array.from($.entries()).sort((Q,V)=>V[1]!==Q[1]?V[1]-Q[1]:V[0].length-Q[0].length).map(([Q])=>Q).slice(0,25)},ze=a=>{const h=a.currentContent||a?.exactReplacement?.find||"",y=a.enhancedContent||a?.exactReplacement?.replace||a.implementation||"";return{current:h,enhanced:y}};if(f.useEffect(()=>{},[M,k,t]),o&&!t)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-black mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-black mb-2",children:"Analyzing Content Structure"}),e.jsx("p",{className:"text-gray-600",children:"Analyzing your content for SEO and LLM optimization..."}),S&&e.jsx("div",{className:"mt-6 inline-block bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded",children:S})]})})});const Rt=()=>{r(null),w(""),N(null),ee(""),u(""),E(""),H("landing"),_(""),oe(null),W(!0),ue(!1),Ne(!1),Object.keys(localStorage).forEach(h=>{h.startsWith(Ve())&&localStorage.removeItem(h)}),localStorage.removeItem(Oe()),console.log("[Content Analysis] New analysis initiated - state cleared")};return t?e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsx(Fs,{message:xe,onClose:()=>oe(null),autoClose:!0,autoCloseDelay:4e3}),e.jsxs("div",{className:"w-full max-w-7xl mx-auto space-y-6 lg:space-y-8 px-2 sm:px-4 lg:px-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(Ee,{className:"w-8 h-8 text-black flex-shrink-0"}),e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-black truncate",children:"Content Structure Analysis"})]}),e.jsxs("div",{className:"flex gap-2 lg:gap-3 flex-shrink-0 items-center",children:[e.jsx("button",{onClick:Rt,className:"bg-blue-600 text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold text-sm lg:text-base",children:"New Analysis"}),e.jsxs("button",{onClick:()=>Be(t.structuredContent,"improved-content.txt"),className:"bg-blue-600 text-white px-3 lg:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm lg:text-base",children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[t?.geoScoreTotal!==void 0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${Ge(t.geoScoreTotal)}`,children:e.jsx(Ee,{className:"w-6 h-6 text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-black",children:"GEO Score Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"AI visibility and search engine optimization breakdown"})]})]}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-black",onClick:()=>fe(a=>!a),children:ie?"Hide":"Details"})]}),e.jsxs("div",{className:`text-3xl font-bold ${Je(t.geoScoreTotal)}`,children:[t.geoScoreTotal,"/100"]})]}),t?.contentQualityScoreTotal!==void 0&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${Ge(t.contentQualityScoreTotal)}`,children:e.jsx(Xt,{className:"w-6 h-6 text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-black",children:"Content Quality Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Human/editorial score breakdown"})]})]}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-black",onClick:()=>q(a=>!a),children:T?"Hide":"Details"})]}),e.jsxs("div",{className:`text-3xl font-bold ${Je(t.contentQualityScoreTotal)}`,children:[t.contentQualityScoreTotal,"/100"]})]})]}),t?.geoBreakdown&&ie&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200 mb-8",children:[e.jsx("h4",{className:"font-semibold text-black mb-3",children:"GEO Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start content-start",children:Object.entries(t.geoBreakdown).map(([a,h])=>{const $={evidence_attribution:30,answerability_snippetability:25,structured_understanding:20,freshness_stability:10,entity_topic_coverage:10,retrieval_friendliness:5}[a]??5,G=h.score?.toFixed?`${h.score.toFixed(1)}/${$}`:`${h.score}/${$}`;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold text-black",children:a.replace(/_/g," ").replace(/\b\w/g,P=>P.toUpperCase())}),e.jsx("div",{className:"text-black font-bold",children:G})]}),e.jsx("div",{className:"text-sm text-gray-700 space-y-1.5",children:Object.entries(h).filter(([P])=>P!=="score").map(([P,Q])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:P.replace(/_/g," ")}),e.jsx("span",{className:"text-black font-medium",children:typeof Q=="number"?Q.toFixed(1):String(Q)})]},P))})]},a)})})]}),t?.contentQualityBreakdown&&T&&e.jsxs("div",{className:"bg-white rounded-xl p-4 lg:p-6 shadow-lg border border-gray-200 mb-8",children:[e.jsx("h4",{className:"font-semibold text-black mb-3",children:"Content Quality Breakdown"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start content-start",children:Object.entries(t.contentQualityBreakdown).map(([a,h])=>{const $={readability_clarity:20,structure_coherence:15,depth_coverage:20,originality:15,accuracy_source_use:10,style_tone:10,accessibility_presentation:10}[a]??20,G=h.score?.toFixed?`${h.score.toFixed(1)}/${$}`:`${h.score}/${$}`;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-semibold text-black",children:a.replace(/_/g," ").replace(/\b\w/g,P=>P.toUpperCase())}),e.jsx("div",{className:"text-black font-bold",children:G})]}),e.jsx("div",{className:"text-sm text-gray-700 space-y-1.5",children:Object.entries(h).filter(([P])=>P!=="score").map(([P,Q])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:P.replace(/_/g," ")}),e.jsx("span",{className:"text-black font-medium",children:typeof Q=="number"?Q.toFixed(1):String(Q)})]},P))})]},a)})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 mb-8 w-full overflow-hidden",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex flex-wrap gap-2 lg:gap-0 lg:space-x-8 px-4 lg:px-6 py-2 lg:py-0",children:[{id:"overview",label:"Overview",icon:nt},{id:"suggestions",label:"Suggestions",icon:qe},{id:"structured",label:"Structured Content",icon:Ct},{id:"schema",label:"Schema Markup",icon:Zt}].map(a=>e.jsxs("button",{onClick:()=>j(a.id),className:`flex items-center gap-1 lg:gap-2 py-2 lg:py-4 px-2 lg:px-4 rounded-lg font-bold text-xs lg:text-sm transition-colors whitespace-nowrap 
                    ${b===a.id?"bg-white text-black":"bg-black text-white opacity-80 hover:opacity-100"}
                  `,children:[e.jsx(a.icon,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:a.label}),e.jsx("span",{className:"sm:hidden",children:a.label.split(" ")[0]})]},a.id))})}),e.jsxs("div",{className:"p-4 lg:p-6 w-full overflow-hidden",children:[b==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Content Summary"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 lg:gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:t?.metadata?.wordCount||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Words"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:t?.metadata?.readingTime||1}),e.jsx("div",{className:"text-sm text-gray-600",children:"Min Read"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:t?.suggestions?.length||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Suggestions"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-black",children:(t?.metadata?.language||"en").toUpperCase()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Language"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-black mb-4",children:"Content Metadata"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:t?.metadata?.title||"No Title",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:t?.metadata?.description||"No Description",readOnly:!0,rows:3,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ce(t?.metadata?.keywords||[],t?.originalContent||"").map((a,h)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:a},h))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Author"}),e.jsx("input",{type:"text",value:t?.metadata?.author||"Unknown",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Publish Date"}),e.jsx("input",{type:"text",value:t?.metadata?.publishDate||"Unknown",readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reading Time"}),e.jsx("input",{type:"text",value:`${t?.metadata?.readingTime||1} minutes`,readOnly:!0,className:"w-full px-3 py-2 border border-blue-400 rounded-lg bg-gray-50 text-blue-900 font-semibold focus:outline-none"})]})]})]})]})]}),b==="suggestions"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-6 gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:"Structure Improvement Suggestions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Xe,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),"Run Full Page"]}),e.jsxs("button",{onClick:dt,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4"}),"Compare Pages"]}),e.jsxs("button",{onClick:We,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Apply All Suggestions"]})]})]}),e.jsx("div",{className:"space-y-6",children:t?.suggestions?.map((a,h)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-6 bg-white shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${I(a.priority)}`,children:B(a.priority)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h4",{className:"font-semibold text-black text-lg",children:a.description}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${I(a.priority)}`,children:a.priority})]}),(()=>{const{current:y}=ze(a);return y})()&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Current Content:"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200 overflow-auto",children:e.jsx("pre",{className:"text-sm text-red-700 font-mono whitespace-pre-wrap",children:ze(a).current})})]}),(()=>{const{enhanced:y}=ze(a);return y})()&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-green-700 mb-2",children:"Enhanced Content:"}),e.jsx("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200 overflow-auto",children:e.jsx("pre",{className:"text-sm text-green-800 font-mono whitespace-pre-wrap",children:ze(a).enhanced})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"🎯 Impact:"})," ",a.impact]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>et(a),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Apply This Suggestion"]})})]})]})},h))})]}),b==="structured"&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:"Improved Content Structure"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:`px-2 lg:px-3 py-1 rounded-lg text-xs lg:text-sm font-semibold border transition-colors duration-150 ${M==="landing"?"bg-black text-white border-black":"bg-gray-200 text-black border-gray-300 hover:bg-gray-300"}`,onClick:()=>H("landing"),children:"Landing"}),e.jsx("button",{className:`px-2 lg:px-3 py-1 rounded-lg text-xs lg:text-sm font-semibold border transition-colors duration-150 ${M==="code"?"bg-black text-white border-black":"bg-gray-200 text-black border-gray-300 hover:bg-gray-300"}`,onClick:()=>H("code"),children:"Code"}),M==="code"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Ye(k),className:"bg-gray-100 text-black px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(It,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy Code"})]}),e.jsxs("button",{onClick:Ze,className:"bg-black text-white px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-800 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(mt,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Copy & Run"})]}),e.jsxs("button",{onClick:()=>Be(k,"original-page.html"),className:"bg-gray-600 text-white px-2 lg:px-4 py-1 lg:py-2 rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-1 lg:gap-2 text-xs lg:text-sm",children:[e.jsx(ht,{className:"w-3 h-3 lg:w-4 lg:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})]})]})]}),M==="landing"?e.jsx("div",{className:"bg-gray-50 rounded-lg p-2 w-full",children:e.jsx(Ae,{html:t.structuredContent})}):M==="improved"?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-auto w-full",style:{maxHeight:"70vh"},children:e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono leading-relaxed",children:e.jsx("code",{className:"block whitespace-pre-wrap break-all",children:D||'No improved code available yet. Click "Copy & Run" to generate improved code.'})})}):e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-auto w-full",style:{maxHeight:"70vh"},children:e.jsx("div",{className:"text-xs lg:text-sm text-black font-mono leading-relaxed",children:e.jsx("code",{className:"block whitespace-pre-wrap break-all",children:k||"No code extracted yet."})})})]}),b==="schema"&&e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-4",children:e.jsx("h3",{className:"text-lg font-semibold text-black mb-0",children:"Schema Generator"})}),e.jsx(Is,{})]})]})]})]})]}):e.jsx("div",{className:"w-full max-w-full mx-auto space-y-6 lg:space-y-8 px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 sm:p-6 lg:p-8 shadow-sm",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Technical SEO & Structure Analysis"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Optimize your site structure for better AI crawling and understanding."})]}),e.jsx("div",{className:"flex flex-col lg:flex-row items-stretch gap-4 mb-8",children:e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:m,onChange:a=>$t(a,h=>{w(h),F(Date.now()),W(!0)}),onPaste:a=>Lt(a,h=>{w(h),F(Date.now()),W(!0)}),onKeyDown:Ot,onFocus:()=>{F(Date.now()),W(!0)},required:!0,placeholder:"Paste a URL to analyze...",className:"flex-1 px-4 py-3 border-2 border-blue-600 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg h-[48px]",disabled:L}),e.jsx("button",{onClick:Me,disabled:L||!m.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-xl font-medium flex items-center justify-center gap-2 transition-colors shadow-lg min-w-[120px] h-[48px]",children:L?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(kt,{className:"w-5 h-5"}),"Analyze URL"]})})]})})}),S&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg text-base",children:e.jsx("div",{className:"whitespace-pre-line",children:S})})]})})}export{qs as A,Hs as C,Us as O,Fs as S,Lt as a,$t as b,Ot as c,lt as d,be as e,Dt as f,K as g,je as h,Ms as i,e as j,_s as k,ot as s,fs as u};
